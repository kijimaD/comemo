# [インデックス 10805] ファイルの概要

このコミットは、Goプロジェクトのリポジトリにおけるタグ付けに関する変更です。具体的には、`weekly.2011-12-14`という週次リリースを示すタグと、`weekly`という最新の週次リリースを示すタグを、リポジトリのタグ情報を管理する`.hgtags`ファイルに追加しています。

## コミット

```
commit 3621f2d3fe5469a03ae13180c6452eaf1b033225
Author: Andrew Gerrand <adg@golang.org>
Date:   Thu Dec 15 16:57:28 2011 +1100

    tag weekly.2011-12-14
    
    R=r
    CC=golang-dev
    https://golang.org/cl/5489046
```

## GitHub上でのコミットページへのリンク

[https://github.com/golang/go/commit/3621f2d3fe5469a03ae13180c6452eaf1b033225](https://github.com/golang/go/commit/3621f2d3fe5469a03ae13180c6452eaf1b033225)

## 元コミット内容

```
tag weekly.2011-12-14

R=r
CC=golang-dev
https://golang.org/cl/5489046
```

このコミットメッセージは、`weekly.2011-12-14`というタグが作成されたことを示しています。`R=r`と`CC=golang-dev`はコードレビューとメーリングリストへの通知に関する情報であり、`https://golang.org/cl/5489046`はGoプロジェクトが当時使用していたGerritベースのコードレビューシステムへのリンクです。

## 変更の背景

このコミットは、Goプロジェクトが当時採用していた週次リリース（weekly release）のプロセスの一環として行われました。Goは初期の頃、安定版リリースとは別に、開発の進捗を定期的にユーザーに提供するために週次ビルドを公開していました。この週次ビルドには、特定のコミットに紐付けられたタグが付与され、ユーザーが簡単に特定の時点のコードベースを取得できるようにしていました。

このコミットの目的は、2011年12月14日時点のコードベースに`weekly.2011-12-14`というタグを付与し、さらに`weekly`というタグも同じコミットに付与することで、常に最新の週次リリースを指し示すようにすることです。これにより、ユーザーは`weekly`タグをチェックアウトするだけで、最新の週次ビルドを簡単に利用できました。

## 前提知識の解説

### 1. バージョン管理システムとタグ

バージョン管理システム（VCS）は、ソフトウェア開発におけるソースコードやその他のファイルの変更履歴を管理するためのツールです。GitやMercurialなどが代表的です。

**タグ（Tag）**は、バージョン管理システムにおいて、特定のコミット（リビジョン）に意味のある名前を付ける機能です。これは、ソフトウェアのリリースバージョン（例: `v1.0.0`）や、重要な開発マイルストーン（例: `beta-release`）など、後から参照しやすいように目印を付けるために使用されます。タグは通常、変更されない固定された参照点として扱われます。

### 2. Mercurialと`.hgtags`ファイル

Goプロジェクトは、初期にはMercurialという分散型バージョン管理システムを使用していました。MercurialはGitと同様に人気のあるVCSですが、内部的な仕組みやコマンド体系が異なります。

Mercurialでは、リポジトリ内のタグ情報は通常、リポジトリのルートディレクトリにある`.hgtags`というファイルに保存されます。このファイルは、各行が「コミットハッシュ タグ名」の形式で構成されており、どのコミットにどのタグが付けられているかを記録します。このファイル自体もバージョン管理の対象となり、タグの追加や削除は`.hgtags`ファイルの変更としてコミットされます。

Goプロジェクトは後にGitに移行しましたが、このコミットが作成された2011年時点ではまだMercurialを使用していたため、`.hgtags`ファイルが変更されています。

### 3. Goプロジェクトの週次リリース

Goプロジェクトは、安定版のメジャーリリースとは別に、開発の進捗を早期にユーザーに提供するために「週次リリース（weekly release）」という形式を採用していました。これは、毎週特定の曜日に最新の開発版スナップショットをビルドし、公開するものです。これにより、ユーザーは最新の機能やバグ修正を試すことができ、開発チームはより迅速にフィードバックを得ることができました。

## 技術的詳細

このコミットは、Mercurialリポジトリにおけるタグ付けのメカニズムを直接的に示しています。

1.  **`.hgtags`ファイルの役割**: Mercurialでは、タグはリポジトリのメタデータの一部として`.hgtags`ファイルに記録されます。このファイルは、リポジトリの履歴の一部として扱われるため、タグの追加や削除は通常のファイル変更と同様にコミットされます。これにより、タグの履歴もバージョン管理されることになります。

2.  **タグの追加**:
    ```diff
    --- a/.hgtags
    +++ b/.hgtags
    @@ -98,3 +98,5 @@ b4a91b6933748db1a7150c06a1b55ad506e52906 weekly.2011-11-18
    80db2da6495a20ddff8305c236825811db8c8665 weekly.2011-12-01
    0beb796b4ef8747af601ed5ea6766d5b1340086b weekly.2011-12-02
    0c39eee85b0d1606b79c8ebcdeb3b67ed5849e39 weekly.2011-12-06
    +82fdc445f2ff2c85043446eb84a19cc999dfcb95 weekly.2011-12-14
    +82fdc445f2ff2c85043446eb84a19cc999dfcb95 weekly
    ```
    上記の差分が示すように、2つの新しい行が`.hgtags`ファイルに追加されています。
    -   `82fdc445f2ff2c85043446eb84a19cc999dfcb95 weekly.2011-12-14`: これは、コミットハッシュ`82fdc445f2ff2c85043446eb84a19cc999dfcb95`に`weekly.2011-12-14`というタグを関連付けています。このタグは、特定の日付の週次リリースを指します。
    -   `82fdc445f2ff2c85043446eb84a19cc999dfcb95 weekly`: これは、同じコミットハッシュに`weekly`というタグを関連付けています。この`weekly`タグは、常に最新の週次リリースを指すように更新される「移動するタグ」として機能します。これにより、ユーザーは特定の週次リリースを日付で指定する代わりに、常に最新版を`weekly`というシンプルな名前で参照できました。

このアプローチは、Gitにおける軽量タグ（lightweight tag）と似ていますが、Gitではタグ情報が`.git/refs/tags`以下に直接ファイルとして保存されるのに対し、Mercurialでは`.hgtags`という単一のファイルで管理される点が異なります。

## コアとなるコードの変更箇所

```diff
--- a/.hgtags
+++ b/.hgtags
@@ -98,3 +98,5 @@ b4a91b6933748db1a7150c06a1b55ad506e52906 weekly.2011-11-18
80db2da6495a20ddff8305c236825811db8c8665 weekly.2011-12-01
0beb796b4ef8747af601ed5ea6766d5b1340086b weekly.2011-12-02
0c39eee85b0d1606b79c8ebcdeb3b67ed5849e39 weekly.2011-12-06
+82fdc445f2ff2c85043446eb84a19cc999dfcb95 weekly.2011-12-14
+82fdc445f2ff2c85043446eb84a19cc999dfcb95 weekly
```

変更は`.hgtags`ファイルのみです。このファイルに2行が追加されています。

## コアとなるコードの解説

追加された2行は、Mercurialのタグ定義の標準的な形式に従っています。

-   `82fdc445f2ff2c85043446eb84a19cc999dfcb95`: これは、タグが指し示すコミットのハッシュ値です。このハッシュ値は、Goリポジトリの特定の時点のコードベースを一意に識別します。
-   `weekly.2011-12-14`: これは、特定の日付（2011年12月14日）の週次リリースを示すタグ名です。
-   `weekly`: これは、常に最新の週次リリースを指すように更新される汎用的なタグ名です。

この変更により、Mercurialリポジトリのタグ情報が更新され、ユーザーは`hg update weekly.2011-12-14`または`hg update weekly`といったコマンドを使用して、それぞれ特定の日付の週次リリースまたは最新の週次リリースにコードベースを切り替えることが可能になりました。

## 関連リンク

-   **Mercurial 公式サイト**: Mercurialの基本的な情報やドキュメントが提供されています。
    -   [https://www.mercurial-scm.org/](https://www.mercurial-scm.org/)
-   **Goプロジェクトのバージョン管理の歴史**: GoプロジェクトがMercurialからGitへ移行した経緯に関する情報。
    -   [https://go.dev/doc/faq#git_vs_hg](https://go.dev/doc/faq#git_vs_hg) (GoのFAQにMercurialとGitに関する記述があります)

## 参考にした情報源リンク

-   **Mercurial Book - Tags**: Mercurialにおけるタグの概念と`.hgtags`ファイルに関する詳細な説明。
    -   [https://www.mercurial-scm.org/book/index.html#tags](https://www.mercurial-scm.org/book/index.html#tags) (Mercurialの公式ドキュメント)
-   **Go Project Weekly Builds**: Goプロジェクトの週次ビルドに関する過去の情報。
    -   [https://go.dev/doc/devel/release](https://go.dev/doc/devel/release) (Goのリリースに関するドキュメント。週次ビルドの歴史的背景が示唆されています。)
-   **Gerrit Code Review**: Goプロジェクトが使用していたコードレビューシステムGerritに関する情報。
    -   [https://www.gerritcodereview.com/](https://www.gerritcodereview.com/)
-   **GitHub Commit Page**: このコミットのGitHubページ。
    -   [https://github.com/golang/go/commit/3621f2d3fe5469a03ae13180c6452eaf1b033225](https://github.com/golang/go/commit/3621f2d3fe5469a03ae13180c6452eaf1b033225)

