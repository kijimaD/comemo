# [インデックス 12458] ファイルの概要

このコミットは、Go言語プロジェクトのバージョン管理システムにおいて、`misc/cgo/stdio/test.bash`スクリプトによって生成される一時ファイル`run.out`を無視するように`.hgignore`ファイルにエントリを追加するものです。これにより、不要な生成物がリポジトリにコミットされるのを防ぎ、クリーンな作業環境を維持します。

## コミット

```
commit ca21b1289c3fbbd55c5d749453b3f37ec7f64b61
Author: Francisco Souza <franciscossouza@gmail.com>
Date:   Wed Mar 7 01:21:38 2012 -0500

    hgignore: ignore run.out generated by misc/cgo/stdio/test.bash
    
    R=golang-dev, minux.ma, rsc
    CC=golang-dev
    https://golang.org/cl/5757059
---
 .hgignore | 1 +
 1 file changed, 1 insertion(+)

diff --git a/.hgignore b/.hgignore
index b4b9adec2a..626e084686 100644
--- a/.hgignore
+++ b/.hgignore
@@ -26,6 +26,7 @@ test.out
 doc/tmpltohtml
 doc/codelab/wiki/*.bin
 misc/cgo/life/run.out
+misc/cgo/stdio/run.out
 misc/dashboard/builder/gobuilder
 misc/goplay/goplay
 misc/osx/*.pkg
```

## GitHub上でのコミットページへのリンク

[https://github.com/golang/go/commit/ca21b1289c3fbbd55c5d749453b3f37ec7f64b61](https://github.com/golang/go/commit/ca21b1289c3fbbd55c5d749453b3f37ec7f64b61)

## 元コミット内容

```
hgignore: ignore run.out generated by misc/cgo/stdio/test.bash

R=golang-dev, minux.ma, rsc
CC=golang-dev
https://golang.org/cl/5757059
```

## 変更の背景

ソフトウェア開発において、ビルドプロセスやテスト実行中に一時ファイルや生成ファイルが作成されることはよくあります。これらのファイルは、ソースコードの一部ではなく、開発者のローカル環境で生成されるものであり、バージョン管理システム（VCS）に含めるべきではありません。VCSに含めてしまうと、以下のような問題が発生します。

1.  **リポジトリの肥大化**: 不要なファイルがリポジトリの履歴に残り、クローンやフェッチの時間が長くなります。
2.  **コンフリクトの発生**: 異なる開発環境で同じ名前のファイルが異なる内容で生成された場合、マージ時にコンフリクトが発生する可能性があります。
3.  **クリーンな作業環境の妨げ**: `git status`（またはMercurialの`hg status`）を実行した際に、多数の未追跡ファイルが表示され、本当に変更すべきファイルが見つけにくくなります。
4.  **ビルドの再現性の問題**: 生成ファイルがコミットされていると、ビルドプロセスがそのファイルを再生成する代わりに既存のファイルを使用してしまい、ビルドの再現性が損なわれる可能性があります。

このコミットは、`misc/cgo/stdio/test.bash`というテストスクリプトが実行時に`run.out`というファイルを生成することに対応しています。この`run.out`ファイルはテストの出力結果や一時的なデータであり、リポジトリに含めるべきではありません。そのため、Mercurialの無視リストである`.hgignore`にこのファイルを追加することで、これらの問題を防ぐことが目的です。

## 前提知識の解説

### 1. バージョン管理システムと無視ファイル

*   **バージョン管理システム (VCS)**: ソフトウェア開発において、ソースコードやその他のファイルの変更履歴を管理するためのシステムです。GitやMercurialが代表的です。VCSは、ファイルの変更を追跡し、過去のバージョンに戻したり、複数の開発者間での共同作業を容易にしたりする機能を提供します。
*   **`.hgignore`**: MercurialというVCSで使用される設定ファイルです。このファイルに記述されたパターンに一致するファイルやディレクトリは、Mercurialの追跡対象から除外されます。これにより、一時ファイル、ビルド生成物、個人設定ファイルなどが誤ってリポジトリにコミットされるのを防ぎます。Gitにおける`.gitignore`と全く同じ役割を果たします。Goプロジェクトは初期にはMercurialを使用しており、このコミットが作成された2012年時点ではMercurialが主要なVCSでした。

### 2. Go言語の`cgo`

*   **`cgo`**: Go言語の標準パッケージの一つで、GoプログラムからC言語のコードを呼び出すためのメカニズムを提供します。また、C言語のコードからGo言語の関数を呼び出すことも可能です。`cgo`を使用することで、既存のCライブラリをGoプロジェクトに統合したり、パフォーマンスが重要な部分をC言語で記述したりすることができます。
*   `cgo`を使用する際には、GoコンパイラがCコードをコンパイルし、Goコードとリンクするための追加のステップが必要になります。このプロセス中に、一時ファイルや実行ファイルが生成されることがあります。

### 3. `test.bash`スクリプト

*   **`test.bash`**: このファイル名から、これはBashシェルスクリプトであり、テストの実行を目的としていることが推測されます。Goプロジェクトでは、Go言語のテストフレームワークだけでなく、シェルスクリプトを使用して特定のテストシナリオ（特に`cgo`のような外部連携を伴うものや、ビルドプロセス全体をテストするもの）を実行することがよくあります。
*   このようなスクリプトは、テストの実行中に中間ファイルや出力ファイルを生成することが一般的です。今回のケースでは、`run.out`というファイルが生成されることが明示されています。

## 技術的詳細

このコミットは、Goプロジェクトの`misc/cgo/stdio`ディレクトリに関連しています。このディレクトリは、`cgo`を使用して標準入出力（stdio）を扱う例やテストが含まれていると考えられます。

`misc/cgo/stdio/test.bash`スクリプトは、おそらく`cgo`を利用したGoプログラムをビルドし、実行し、その出力を`run.out`というファイルにリダイレクトしていると推測されます。これは、テストの出力をキャプチャして後で検証するためによく行われる手法です。

例えば、`test.bash`の内容は以下のようなものだったかもしれません（あくまで推測です）：

```bash
#!/bin/bash

# Goプログラムをビルド
go build -o myprogram main.go

# ビルドしたプログラムを実行し、出力をrun.outにリダイレクト
./myprogram > run.out

# run.outの内容を検証する（テストの一部）
diff -u expected.out run.out
```

このようなプロセスで生成される`run.out`は、テストが成功したかどうかにかかわらず、テスト実行のたびに内容が変わりうる一時的なファイルです。これをバージョン管理下に置いてしまうと、開発者がテストを実行するたびに`run.out`が変更され、`hg status`で常に「変更あり」と表示されたり、誤ってコミットされて他の開発者の環境とコンフリクトを起こしたりする原因となります。

このコミットは、このような問題を回避するために、`misc/cgo/stdio/run.out`というパスを`.hgignore`に追加することで、Mercurialがこのファイルを無視するように指示しています。これにより、開発者はテストを自由に実行でき、生成された`run.out`ファイルがVCSによって追跡される心配がなくなります。

## コアとなるコードの変更箇所

変更は`.hgignore`ファイルに対して行われました。具体的には、以下の1行が追加されています。

```diff
--- a/.hgignore
+++ b/.hgignore
@@ -26,6 +26,7 @@ test.out
 doc/tmpltohtml
 doc/codelab/wiki/*.bin
 misc/cgo/life/run.out
+misc/cgo/stdio/run.out
 misc/dashboard/builder/gobuilder
 misc/goplay/goplay
 misc/osx/*.pkg
```

## コアとなるコードの解説

追加された行 `misc/cgo/stdio/run.out` は、Mercurialに対して、リポジトリのルートディレクトリから見て`misc/cgo/stdio/`ディレクトリ内にある`run.out`という名前のファイルを無視するよう指示しています。

*   `misc/`: Goプロジェクトの様々なユーティリティや実験的なコードが置かれるディレクトリ。
*   `cgo/`: `cgo`に関連するコードや例が置かれるディレクトリ。
*   `stdio/`: `cgo`の標準入出力に関する特定の例やテストが置かれるサブディレクトリ。
*   `run.out`: `test.bash`スクリプトによって生成される具体的なファイル名。

この変更により、`misc/cgo/stdio/test.bash`を実行した際に`run.out`が生成されても、Mercurialはそれを未追跡ファイルとして表示せず、`hg add`や`hg commit`の対象から自動的に除外します。これにより、開発者はよりクリーンで効率的なワークフローを享受できます。

既存の`.hgignore`ファイルには、すでに`misc/cgo/life/run.out`というエントリが存在しており、これは`misc/cgo/life`ディレクトリ内の`run.out`ファイルを無視するためのものです。今回の変更は、同様の理由で別の`cgo`関連ディレクトリ内の`run.out`を無視するよう拡張した形になります。これは、プロジェクト全体で生成ファイルを適切に管理するという一貫した方針を示しています。

## 関連リンク

*   **Go Gerrit Change-ID**: `https://golang.org/cl/5757059`
    *   これは、GoプロジェクトがMercurialからGitに移行する前に使用していたコードレビューシステムであるGerritの変更リスト（Change-ID）へのリンクです。このリンクを辿ることで、このコミットに関する詳細な議論やレビューコメントを確認できます。

## 参考にした情報源リンク

*   Mercurial Documentation: `.hgignore` (Mercurialの公式ドキュメントにおける`.hgignore`の説明)
*   Go Programming Language: `cgo` (Go言語の`cgo`パッケージに関する公式ドキュメント)
*   Git Documentation: `.gitignore` (Gitにおける無視ファイルの概念を理解するための参考)
*   [https://go.dev/doc/articles/cgo](https://go.dev/doc/articles/cgo) (Go言語におけるcgoの利用に関する公式記事)
*   [https://go.dev/doc/code](https://go.dev/doc/code) (Go言語のコード構成に関する一般的な情報)
*   [https://go.dev/doc/contribute](https://go.dev/doc/contribute) (Goプロジェクトへの貢献ガイドライン、Mercurial時代の情報も含まれる可能性)
*   [https://github.com/golang/go/wiki/MercurialToGit](https://github.com/golang/go/wiki/MercurialToGit) (GoプロジェクトのMercurialからGitへの移行に関する情報)

