commit dddc1ba847467524c397eda22b69862773e9f21a
Author: Matthew Dempsky <mdempsky@google.com>
Date:   Thu Aug 18 11:04:21 2022 -0700

    cmd/compile: restore test/nested.go test cases
    
    [Re-land of CL 424854, which was reverted as CL 425214.]
    
    When handling a type declaration like:
    
    ```
    type B A
    ```
    
    unified IR has been writing out that B's underlying type is A, rather
    than the underlying type of A.
    
    This is a bit awkward to implement and adds complexity to importers,
    who need to handle resolving the underlying type themselves. But it
    was necessary to handle when A was declared like:
    
    ```
    //go:notinheap
    type A int
    ```
    
    Because we expected A's not-in-heap'ness to be conferred to B, which
    required knowing that A was on the path from B to its actual
    underlying type int.
    
    However, since #46731 was accepted, we no longer need to support this
    case. Instead we can write out B's actual underlying type.
    
    One stumbling point though is the existing code for exporting
    interfaces doesn't work for the underlying type of `comparable`, which
    is now needed to implement `type C comparable`. As a bit of a hack, we
    we instead export its underlying type as `interface{ comparable }`.
    
    Fixes #54512.
    
    Change-Id: I9aa087e0a277527003195ebc7f4fbba6922e788c
    Reviewed-on: https://go-review.googlesource.com/c/go/+/455279
    Run-TryBot: Matthew Dempsky <mdempsky@google.com>
    TryBot-Result: Gopher Robot <gobot@golang.org>
    Reviewed-by: Robert Griesemer <gri@google.com>

 src/cmd/compile/internal/noder/writer.go | 39 +++++++++++++++++++-------------
 1 file changed, 23 insertions(+), 16 deletions(-)
