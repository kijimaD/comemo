commit 15fa7a84b88165092d3a05fb0af11f11d967065d
Author: Than McIntosh <thanm@google.com>
Date:   Fri Nov 10 07:57:46 2023 -0500

    cmd/compile/internal/inline: rework call scoring for non-inlinable funcs
    
    This patch fixes some problems with call site scoring, adds some new
    tests, and moves more of the scoring-related code (for example, the
    function "ScoreCalls") into "scoring.go". This also fixes some
    problems with scoring of calls in non-inlinable functions (when new
    inliner is turned on, scoring has to happen for all functions run
    through the inliner, not just for inlinable functions). For such
    functions, we build a table of inlinable call sites immediately prior
    to scoring; the storage for this table is preserved between functions
    so as to reduce allocations.
    
    Change-Id: Ie6f691a3ad04fb7a03ab39f882a60aadaf957f6c
    Reviewed-on: https://go-review.googlesource.com/c/go/+/542217
    Reviewed-by: Matthew Dempsky <mdempsky@google.com>
    LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>

 src/cmd/compile/internal/inline/inl.go             |  23 +--
 src/cmd/compile/internal/inline/inlheur/analyze.go |  39 ++---
 .../inline/inlheur/analyze_func_callsites.go       | 103 +-----------
 .../compile/internal/inline/inlheur/callsite.go    |  12 --
 .../internal/inline/inlheur/dumpscores_test.go     |  98 ++++++++++++
 src/cmd/compile/internal/inline/inlheur/scoring.go | 176 ++++++++++++++++++++-
 .../internal/inline/inlheur/testdata/dumpscores.go |  45 ++++++
 .../inline/inlheur/testdata/props/calls.go         |  33 ++++
 8 files changed, 377 insertions(+), 152 deletions(-)
