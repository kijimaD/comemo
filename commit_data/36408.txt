commit 736390c2bd2d7f00d62ca62f18836f82eb1f51a3
Author: Matthew Dempsky <mdempsky@google.com>
Date:   Wed Apr 25 12:36:36 2018 -0700

    cmd/compile: allow SSA of multi-field structs while instrumenting
    
    When we moved racewalk to buildssa, we disabled SSA of structs with
    2-4 fields while instrumenting because it caused false dependencies
    because for "x.f" we would emit
    
        (StructSelect (Load (Addr x)) "f")
    
    Even though we later simplify this to
    
        (Load (OffPtr (Addr x) "f"))
    
    the instrumentation saw a load of x in its entirety and would issue
    appropriate race/msan calls.
    
    The fix taken here is to directly emit the OffPtr form when x.f is
    addressable and can't be represented in SSA form.
    
    Change-Id: I0caf37bced52e9c16937466b0ac8cab6d356e525
    Reviewed-on: https://go-review.googlesource.com/109360
    Run-TryBot: Matthew Dempsky <mdempsky@google.com>
    TryBot-Result: Gobot Gobot <gobot@golang.org>
    Reviewed-by: Cherry Zhang <cherryyz@google.com>

 src/cmd/compile/internal/gc/ssa.go | 25 ++++++++++---------------
 1 file changed, 10 insertions(+), 15 deletions(-)
