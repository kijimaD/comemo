commit 574ec1c6457c7779cd20db873fef2e2ed7e31ff1
Author: Matthew Dempsky <mdempsky@google.com>
Date:   Tue Jun 22 13:44:18 2021 -0700

    [dev.typeparams] cmd/compile: desugar ORECOVER into ORECOVERFP
    
    Currently ORECOVER is a single operation that both (1) calculates
    the (logical) caller frame pointer and (2) calls runtime.gorecover.
    This is normally fine, but it's inconvenient for regabi, which wants
    to wrap "defer recover()" into "defer func() { recover() }" and
    needs (1) and (2) to happen at different times.
    
    The current solution is to apply walkRecover early to split it into
    the two steps, but calling it during order is a minor layering
    violation. It works well today because the order and walk phases are
    closely related anyway and walkRecover is relatively simple, but it
    won't work for go/defer wrapping earlier into the frontend.
    
    This CL adds a new, lower-level ORECOVERFP primitive, which represents
    just part (2); and OGETCALLER{PC,SP} primitives, which provide a way
    to compute (1) in the frontend too.
    
    OGETCALLERPC isn't needed/used today, but it seems worth including for
    completeness. Maybe it will be useful at some point for intrinsifying
    runtime.getcaller{pc,sp}, like we already do for runtime.getg.
    
    Change-Id: Iaa8ae51e09306c45c147b6759a5b7c24dcc317ca
    Reviewed-on: https://go-review.googlesource.com/c/go/+/330192
    Run-TryBot: Matthew Dempsky <mdempsky@google.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Trust: Matthew Dempsky <mdempsky@google.com>
    Reviewed-by: Cuong Manh Le <cuong.manhle.vn@gmail.com>

 src/cmd/compile/internal/escape/call.go         |  3 ++
 src/cmd/compile/internal/escape/desugar.go      | 37 +++++++++++++++++++++++++
 src/cmd/compile/internal/escape/expr.go         |  7 ++---
 src/cmd/compile/internal/ir/expr.go             |  8 ++++--
 src/cmd/compile/internal/ssagen/ssa.go          |  8 ++++++
 src/cmd/compile/internal/typecheck/func.go      | 15 ++++++++++
 src/cmd/compile/internal/typecheck/typecheck.go | 12 ++++++++
 src/cmd/compile/internal/walk/builtin.go        | 13 ++-------
 src/cmd/compile/internal/walk/expr.go           |  6 ++--
 src/cmd/compile/internal/walk/order.go          | 13 ++-------
 src/cmd/compile/internal/walk/stmt.go           |  2 +-
 src/cmd/compile/internal/walk/walk.go           |  2 +-
 12 files changed, 94 insertions(+), 32 deletions(-)
