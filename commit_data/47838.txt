commit c19759aa487f7d6f479daa00e7462425f4efc481
Author: Austin Clements <austin@google.com>
Date:   Tue Apr 13 08:44:56 2021 -0400

    runtime: eliminate externalthreadhandler
    
    This function is no longer used.
    
    Eliminating this actually fixes several problems:
    
    - It made assumptions about what registers memclrNoHeapPointers would
      preserve. Besides being an abstraction violation and lurking
      maintenance issue, this actively became a problem for regabi because
      the call to memclrNoHeapPointers now happens through an ABI wrapper,
      which is generated by the compiler and hence we can't easily control
      what registers it clobbers.
    
    - The amd64 implementation (at least), does not interact with the host
      ABI correctly. Notably, it doesn't save many of the registers that
      are callee-save in the host ABI but caller-save in the Go ABI.
    
    - It interacts strangely with the NOSPLIT checker because it allocates
      an entire M and G on its stack. It worked around this on arm64, and
      happened to do things the NOSPLIT checker couldn't track on 386 and
      amd64, and happened to be *4 bytes* below the limit on arm (so any
      addition to the m or g structs would cause a NOSPLIT failure). See
      CL 309031 for a more complete explanation.
    
    Fixes #45530.
    Updates #40724.
    
    Change-Id: Ic70d4d7e1c17f1d796575b3377b8529449e93576
    Reviewed-on: https://go-review.googlesource.com/c/go/+/309634
    Trust: Austin Clements <austin@google.com>
    Run-TryBot: Austin Clements <austin@google.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Michael Pratt <mpratt@google.com>
    Reviewed-by: Michael Knyszek <mknyszek@google.com>

 src/cmd/internal/objabi/funcid.go | 44 ++++++++++++-------------
 src/cmd/link/internal/ld/pe.go    |  4 +--
 src/runtime/memclr_386.s          |  2 --
 src/runtime/memclr_amd64.s        |  2 --
 src/runtime/os_windows.go         |  1 -
 src/runtime/symtab.go             |  1 -
 src/runtime/sys_windows_386.s     | 51 -----------------------------
 src/runtime/sys_windows_amd64.s   | 51 -----------------------------
 src/runtime/sys_windows_arm.s     | 67 ---------------------------------------
 src/runtime/sys_windows_arm64.s   | 60 -----------------------------------
 10 files changed, 22 insertions(+), 261 deletions(-)
