commit aa6a7fa775d8f38225ad74a622187bbe891eaf1c
Author: Matthew Dempsky <mdempsky@google.com>
Date:   Thu Aug 18 15:16:23 2022 -0700

    cmd/compile: fix reflect naming of local generic types
    
    To disambiguate local types, we append a "·N" suffix to their name and
    then trim it off again when producing their runtime type descriptors.
    
    However, if a local type is generic, then we were further appending
    the type arguments after this suffix, and the code in types/fmt.go
    responsible for trimming didn't know to handle this.
    
    We could extend the types/fmt.go code to look for the "·N" suffix
    elsewhere in the type name, but this is risky because it could
    legitimately (albeit unlikely) appear in struct field tags.
    
    Instead, the most robust solution is to just change the mangling logic
    to keep the "·N" suffix at the end, where types/fmt.go can easily and
    reliably trim it.
    
    Note: the "·N" suffix is still visible within the type arguments
    list (e.g., the "·3" suffixes in nested.out), because we currently use
    the link strings in the type arguments list.
    
    Fixes #54456.
    
    Change-Id: Ie9beaf7e5330982f539bff57b8d48868a3674a37
    Reviewed-on: https://go-review.googlesource.com/c/go/+/424901
    TryBot-Result: Gopher Robot <gobot@golang.org>
    Run-TryBot: Matthew Dempsky <mdempsky@google.com>
    Reviewed-by: Cuong Manh Le <cuong.manhle.vn@gmail.com>
    Reviewed-by: Than McIntosh <thanm@google.com>

 src/cmd/compile/internal/noder/reader.go |  8 ++++++-
 src/cmd/compile/internal/noder/writer.go |  7 ++++--
 src/cmd/compile/internal/types/fmt.go    | 25 +++++++++++++++------
 test/run.go                              |  1 +
 test/typeparam/issue54456.go             | 37 ++++++++++++++++++++++++++++++++
 test/typeparam/nested.out                |  8 +++----
 6 files changed, 72 insertions(+), 14 deletions(-)
