commit b548eee3d96fc0b6e962a243b28121e1f37ad792
Author: Keith Randall <khr@golang.org>
Date:   Mon Feb 13 09:37:06 2017 -0800

    cmd/compile: fix load-combining rules
    
    CL 33632 reorders args of commutative ops in order to make
    CSE for commutative ops more robust.  Unfortunately, that
    broke the load-combining rules which depend on a certain ordering
    of OR ops' arguments.
    
    Introduce some additional rules that order OR ops' arguments
    consistently so that the load-combining rules fire.
    
    Note: there's also something else wrong with the s390x rules.
    I've filed #19059 for that.
    
    Fixes #18946
    
    Change-Id: I0a5447196bd88a55ccee683c69a57b943a9972e1
    Reviewed-on: https://go-review.googlesource.com/36911
    Run-TryBot: Keith Randall <khr@golang.org>
    TryBot-Result: Gobot Gobot <gobot@golang.org>
    Reviewed-by: Josh Bleecher Snyder <josharian@gmail.com>

 src/cmd/compile/internal/gc/asm_test.go      | 33 +++++++++++++++++++++++++++
 src/cmd/compile/internal/ssa/gen/386.rules   |  3 +++
 src/cmd/compile/internal/ssa/gen/AMD64.rules |  4 ++++
 src/cmd/compile/internal/ssa/gen/S390X.rules |  4 ++++
 src/cmd/compile/internal/ssa/rewrite386.go   | 17 ++++++++++++++
 src/cmd/compile/internal/ssa/rewriteAMD64.go | 34 ++++++++++++++++++++++++++++
 src/cmd/compile/internal/ssa/rewriteS390X.go | 34 ++++++++++++++++++++++++++++
 7 files changed, 129 insertions(+)
