commit a2d01473aec0e9d19ff31bb9727dcc350d500e56
Author: Michael Matloob <matloob@golang.org>
Date:   Tue Nov 3 13:12:19 2020 -0500

    cmd/go: support cgo files in overlays
    
    This is a roll-forward of golang.org/cl/267197, which was reverted in
    golang.org/cl/267357. It makes the following changes in addition to
    the ones in the next paragraph: It avoids outputting trimpath
    arguments for an overlay unless the overlay affects the package being
    compiled (to avoid hitting windows command line argument limits), and
    it fixes processing of regexps in the script test framework to treat
    the first *non flag* argument to grep, stdout, and stderr as a regexp,
    not just the first argument.
    
    golang.org/cl/267917 was a roll-forward of golang.org/cl/262618, which
    was reverted in golang.org/cl/267037. The only differences between
    this CL and the original were the three calls to fflush from the C
    files in build_overlay.txt, to guarantee that the string we were
    expecting was
    actually written out.
    
    The CL requires rewriting the paths of the files passed to the cgo
    tool toolchain to use the overlaid paths instead of the disk paths of
    files. Because the directories of the overlaid paths don't exist in
    general, the cgo tool have been updated to run in base.Cwd instead of
    the package directory.
    
    For #39958
    
    Change-Id: I1bd96db257564bcfd95b3502aeca14d04bd28618
    Reviewed-on: https://go-review.googlesource.com/c/go/+/267797
    Trust: Michael Matloob <matloob@golang.org>
    Trust: Bryan C. Mills <bcmills@google.com>
    Run-TryBot: Michael Matloob <matloob@golang.org>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Bryan C. Mills <bcmills@google.com>

 src/cmd/go/internal/work/exec.go                  | 48 +++++++++++--
 src/cmd/go/internal/work/gc.go                    | 45 ++++++++++--
 src/cmd/go/testdata/script/build_overlay.txt      | 83 ++++++++++++++++++++++-
 src/cmd/go/testdata/script/build_trimpath_cgo.txt | 28 ++++++++
 4 files changed, 189 insertions(+), 15 deletions(-)
