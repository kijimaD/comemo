commit 6e70fddec0e1d4a43ffb450f555dde82ff313397
Author: Dmitry Vyukov <dvyukov@google.com>
Date:   Tue Feb 17 14:25:49 2015 +0300

    runtime: fix cputicks on x86
    
    See the following issue for context:
    https://github.com/golang/go/issues/9729#issuecomment-74648287
    In short, RDTSC can produce skewed results without preceding LFENCE/MFENCE.
    Information on this matter is very scrappy in the internet.
    But this is what linux kernel does (see rdtsc_barrier).
    It also fixes the test program on my machine.
    
    Update #9729
    
    Change-Id: I3c1ffbf129fdfdd388bd5b7911b392b319248e68
    Reviewed-on: https://go-review.googlesource.com/5033
    Reviewed-by: Ian Lance Taylor <iant@golang.org>

 src/runtime/asm_386.s   | 25 +++++++++++++++++++++++--
 src/runtime/asm_amd64.s | 22 +++++++++++++++++++++-
 src/runtime/runtime1.go |  7 -------
 src/runtime/runtime2.go |  8 ++++++--
 4 files changed, 50 insertions(+), 12 deletions(-)
