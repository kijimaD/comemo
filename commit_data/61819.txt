commit 7d7192e54f4d4eb51018ad128c25d52e26f02a3f
Author: Filippo Valsorda <filippo@golang.org>
Date:   Fri Nov 29 13:15:11 2024 +0100

    crypto/rsa: move precomputation to crypto/internal/fips140/rsa
    
    We are severely limited by the crypto/rsa API in a few ways:
    
     - Precompute doesn't return an error, but is the only function allowed
       to modify a PrivateKey.
    
     - Clients presumably expect the PrecomputedValues big.Ints to be
       populated after Precompute.
    
     - MarshalPKCS1PrivateKey requires the precomputed values, and doesn't
       have an error return.
    
     - PrivateKeys with only N, e, and D have worked so far, so they might
       have to keep working.
    
    To move precomputation to the FIPS module, we focus on the happy path of
    a PrivateKey with two primes where Precompute is called before anything
    else, which match ParsePKCS1PrivateKey and GenerateKey.
    
    There is a significant slowdown in the Parse benchmark due to the
    constant-time inversion of qInv. This will be addressed in a follow-up
    CL that will use (and check) the value in the ASN.1.
    
    Note that the prime product check now moved to checkPrivateKey is broken
    (Î  should start at 1 not 0) and fixed in CL 632478.
    
    Updates #69799
    For #69536
    
    Change-Id: I95a8bc1244755c6d15d7c4eb179135a15608ddd6
    Reviewed-on: https://go-review.googlesource.com/c/go/+/632476
    LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
    Auto-Submit: Filippo Valsorda <filippo@golang.org>
    Reviewed-by: Roland Shoemaker <roland@golang.org>
    Reviewed-by: Russ Cox <rsc@golang.org>

 doc/next/6-stdlib/99-minor/crypto/x509/69799.md |   3 +
 src/crypto/internal/fips140/bigmod/nat.go       |  21 ++-
 src/crypto/internal/fips140/rsa/rsa.go          | 108 ++++++++++++--
 src/crypto/rsa/rsa.go                           | 191 ++++++++++++------------
 src/crypto/x509/pkcs1.go                        |   9 +-
 src/crypto/x509/pkcs8.go                        |   6 +
 src/crypto/x509/x509_test.go                    |   2 +-
 7 files changed, 217 insertions(+), 123 deletions(-)
