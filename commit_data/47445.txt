commit c71acbfe8372099877cdc989b546389b05222600
Author: Austin Clements <austin@google.com>
Date:   Wed Mar 17 18:28:38 2021 -0400

    test: make nosplit test invariant to ABI wrappers
    
    Currently, the nosplit test disables ABI wrapper generation because it
    generates a main.main in assembly, and so the ABI wrapper for calling
    from runtime.main to main.main counts against the nosplit limit, which
    cases some of the tests to fail.
    
    Fix this by first entering ABI0 in a splittable context and then
    calling from there into the test entry point, since this doesn't
    introduce an ABI wrapper.
    
    While we're here, this CL removes the test's check for the
    framepointer experiment. That's now statically enabled, so it doesn't
    appear in the experiment line, and enabling any other experiment
    causes the test to think that the framepointer experiment *isn't*
    enabled.
    
    For #40724.
    
    Change-Id: I6291eb9391f129779e726c5fc8c41b7b4a14eeb9
    Reviewed-on: https://go-review.googlesource.com/c/go/+/302772
    Trust: Austin Clements <austin@google.com>
    Run-TryBot: Austin Clements <austin@google.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Cherry Zhang <cherryyz@google.com>
    Reviewed-by: Than McIntosh <thanm@google.com>

 test/nosplit.go | 178 ++++++++++++++++++++++++++++----------------------------
 1 file changed, 88 insertions(+), 90 deletions(-)
