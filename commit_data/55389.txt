commit 6224db9b4d6acbc04a357ef0505424d74b723233
Author: Keith Randall <khr@golang.org>
Date:   Wed Feb 1 08:31:03 2023 -0800

    cmd/compile: schedule values with no in-block uses later
    
    When scheduling a block, deprioritize values whose results aren't used
    until subsequent blocks.
    
    For #58166, this has the effect of pushing the induction variable increment
    to the end of the block, past all the other uses of the pre-incremented value.
    
    Do this only with optimizations on. Debuggers have a preference for values
    in source code order, which this CL can degrade.
    
    Fixes #58166
    Fixes #57976
    
    Change-Id: I40d5885c661b142443c6d4702294c8abe8026c4f
    Reviewed-on: https://go-review.googlesource.com/c/go/+/463751
    Run-TryBot: Keith Randall <khr@golang.org>
    Reviewed-by: David Chase <drchase@google.com>
    Reviewed-by: Keith Randall <khr@google.com>
    TryBot-Result: Gopher Robot <gobot@golang.org>

 src/cmd/compile/internal/ssa/schedule.go | 28 ++++++++++++++++++++++++++--
 test/codegen/issue58166.go               | 23 +++++++++++++++++++++++
 2 files changed, 49 insertions(+), 2 deletions(-)
