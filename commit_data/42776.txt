commit e94544cf012535da6b3c9e735bc4026e2db1c99c
Author: Matthew Dempsky <mdempsky@google.com>
Date:   Wed Aug 19 21:39:12 2020 -0700

    cmd/compile: fix checkptr handling of &^
    
    checkptr has code to recognize &^ expressions, but it didn't take into
    account that "p &^ x" gets rewritten to "p & ^x" during walk, which
    resulted in false positive diagnostics.
    
    This CL changes walkexpr to mark OANDNOT expressions with Implicit
    when they're rewritten to OAND, so that walkCheckPtrArithmetic can
    still recognize them later.
    
    It would be slightly more idiomatic to instead mark the OBITNOT
    expression as Implicit (as it's a compiler-generated Node), but the
    OBITNOT expression might get constant folded. It's not worth the extra
    complexity/subtlety of relying on n.Right.Orig, so we set Implicit on
    the OAND node instead.
    
    To atone for this transgression, I add documentation for nodeImplicit.
    
    Fixes #40917.
    
    Change-Id: I386304171ad299c530e151e5924f179e9a5fd5b8
    Reviewed-on: https://go-review.googlesource.com/c/go/+/249477
    Run-TryBot: Matthew Dempsky <mdempsky@google.com>
    TryBot-Result: Gobot Gobot <gobot@golang.org>
    Reviewed-by: Keith Randall <khr@golang.org>
    Reviewed-by: Cuong Manh Le <cuong.manhle.vn@gmail.com>

 src/cmd/compile/internal/gc/syntax.go     |  4 ++--
 src/cmd/compile/internal/gc/walk.go       |  7 ++++++-
 src/runtime/checkptr_test.go              |  1 +
 src/runtime/testdata/testprog/checkptr.go |  8 ++++++++
 test/fixedbugs/issue40917.go              | 23 +++++++++++++++++++++++
 5 files changed, 40 insertions(+), 3 deletions(-)
