commit 0fcf54b3d2bc42a947c65e9a520d078b671f8432
Merge: 9ef4e56108 5fce15a2a3
Author: Russ Cox <rsc@golang.org>
Date:   Sat Nov 15 08:00:38 2014 -0500

    [dev.garbage] all: merge dev.cc into dev.garbage
    
    The garbage collector is now written in Go.
    There is plenty to clean up (just like on dev.cc).
    
    all.bash passes on darwin/amd64, darwin/386, linux/amd64, linux/386.
    
    TBR=rlh
    R=austin, rlh, bradfitz
    CC=golang-codereviews
    https://golang.org/cl/173250043

 dev.cc                                             |    0
 include/link.h                                     |    2 +-
 src/cmd/5c/Makefile                                |    5 -
 src/cmd/5c/cgen.c                                  | 1213 -------
 src/cmd/5c/doc.go                                  |   16 -
 src/cmd/5c/gc.h                                    |  333 --
 src/cmd/5c/list.c                                  |   39 -
 src/cmd/5c/mul.c                                   |  640 ----
 src/cmd/5c/peep.c                                  | 1478 --------
 src/cmd/5c/reg.c                                   | 1210 -------
 src/cmd/5c/sgen.c                                  |  265 --
 src/cmd/5c/swt.c                                   |  461 ---
 src/cmd/5c/txt.c                                   | 1361 -------
 src/cmd/6c/Makefile                                |    5 -
 src/cmd/6c/cgen.c                                  | 2046 -----------
 src/cmd/6c/div.c                                   |  236 --
 src/cmd/6c/doc.go                                  |   16 -
 src/cmd/6c/gc.h                                    |  359 --
 src/cmd/6c/list.c                                  |   38 -
 src/cmd/6c/machcap.c                               |  107 -
 src/cmd/6c/mul.c                                   |  458 ---
 src/cmd/6c/peep.c                                  |  902 -----
 src/cmd/6c/reg.c                                   | 1523 --------
 src/cmd/6c/sgen.c                                  |  483 ---
 src/cmd/6c/swt.c                                   |  353 --
 src/cmd/6c/txt.c                                   | 1674 ---------
 src/cmd/8c/Makefile                                |    5 -
 src/cmd/8c/cgen.c                                  | 1939 ----------
 src/cmd/8c/cgen64.c                                | 2657 --------------
 src/cmd/8c/div.c                                   |  236 --
 src/cmd/8c/doc.go                                  |   16 -
 src/cmd/8c/gc.h                                    |  364 --
 src/cmd/8c/list.c                                  |   38 -
 src/cmd/8c/machcap.c                               |  116 -
 src/cmd/8c/mul.c                                   |  458 ---
 src/cmd/8c/peep.c                                  |  807 -----
 src/cmd/8c/reg.c                                   | 1438 --------
 src/cmd/8c/sgen.c                                  |  483 ---
 src/cmd/8c/swt.c                                   |  341 --
 src/cmd/8c/txt.c                                   | 1537 --------
 src/cmd/cc/Makefile                                |   10 -
 src/cmd/cc/acid.c                                  |  344 --
 src/cmd/cc/bits.c                                  |  120 -
 src/cmd/cc/cc.h                                    |  835 -----
 src/cmd/cc/cc.y                                    | 1220 -------
 src/cmd/cc/com.c                                   | 1384 -------
 src/cmd/cc/com64.c                                 |  644 ----
 src/cmd/cc/dcl.c                                   | 1707 ---------
 src/cmd/cc/doc.go                                  |   13 -
 src/cmd/cc/dpchk.c                                 |  793 ----
 src/cmd/cc/funct.c                                 |  431 ---
 src/cmd/cc/godefs.c                                |  367 --
 src/cmd/cc/lex.c                                   | 1593 --------
 src/cmd/cc/mac.c                                   |   34 -
 src/cmd/cc/omachcap.c                              |   40 -
 src/cmd/cc/pgen.c                                  |  622 ----
 src/cmd/cc/pswt.c                                  |  140 -
 src/cmd/cc/scon.c                                  |  640 ----
 src/cmd/cc/sub.c                                   | 2068 -----------
 src/cmd/cc/y.tab.c                                 | 3822 --------------------
 src/cmd/cc/y.tab.h                                 |  230 --
 src/cmd/cgo/main.go                                |    1 +
 src/cmd/cgo/out.go                                 |  154 +-
 src/cmd/dist/build.c                               |  146 +-
 src/cmd/dist/buildruntime.c                        |  306 --
 src/cmd/gc/export.c                                |   41 +
 src/cmd/gc/go.h                                    |    7 +
 src/cmd/gc/lex.c                                   |  200 +
 src/cmd/gc/obj.c                                   |   12 +
 src/cmd/gc/reflect.c                               |    6 +-
 src/cmd/gc/subr.c                                  |   46 +-
 src/cmd/go/build.go                                |   54 +-
 src/liblink/asm6.c                                 |    5 +-
 src/liblink/objfile.c                              |   33 +-
 src/reflect/type.go                                |    5 +-
 src/run.bash                                       |    4 +-
 src/runtime/alg.go                                 |    3 -
 src/runtime/arch1_386.go                           |   15 +
 src/runtime/arch1_amd64.go                         |   15 +
 src/runtime/arch1_arm.go                           |   15 +
 src/runtime/arch_386.h                             |   17 -
 src/runtime/arch_amd64.h                           |   25 -
 src/runtime/arch_arm.h                             |   17 -
 src/runtime/asm.s                                  |    5 +
 src/runtime/asm_386.s                              |   65 +-
 src/runtime/asm_amd64.s                            |   63 +-
 src/runtime/asm_amd64p32.s                         |   52 +-
 src/runtime/asm_arm.s                              |   60 +-
 src/runtime/atomic.go                              |   81 -
 src/runtime/atomic_386.c                           |   46 -
 src/runtime/atomic_386.go                          |   91 +
 src/runtime/atomic_amd64x.c                        |   29 -
 src/runtime/atomic_amd64x.go                       |   82 +
 src/runtime/atomic_arm.go                          |   10 +-
 src/runtime/cgo.go                                 |   23 +
 src/runtime/cgo/callbacks.c                        |   83 -
 src/runtime/cgo/callbacks.go                       |   95 +
 src/runtime/cgo/{dragonfly.c => dragonfly.go}      |   14 +-
 src/runtime/cgo/{freebsd.c => freebsd.go}          |   17 +-
 src/runtime/cgo/{iscgo.c => iscgo.go}              |   11 +-
 src/runtime/cgo/{netbsd.c => netbsd.go}            |   14 +-
 src/runtime/cgo/{openbsd.c => openbsd.go}          |   24 +-
 src/runtime/cgo/setenv.c                           |   13 -
 src/runtime/cgo/setenv.go                          |   21 +
 src/runtime/cgocall.go                             |   20 +-
 src/runtime/chan.go                                |    2 +-
 src/runtime/chan.h                                 |   68 -
 src/runtime/chan1.go                               |   61 +
 src/runtime/complex.go                             |   39 +-
 src/runtime/cpuprof.go                             |    8 +-
 src/runtime/cputicks.go                            |   11 +
 src/runtime/debug.go                               |   18 +-
 src/runtime/defs.c                                 |   15 -
 src/runtime/defs1_netbsd_386.go                    |  171 +
 src/runtime/defs1_netbsd_amd64.go                  |  183 +
 src/runtime/defs1_netbsd_arm.go                    |  170 +
 src/runtime/defs1_solaris_amd64.go                 |  245 ++
 src/runtime/defs_android_arm.h                     |    3 -
 src/runtime/defs_darwin_386.go                     |  382 ++
 src/runtime/defs_darwin_386.h                      |  392 --
 src/runtime/defs_darwin_amd64.go                   |  385 ++
 src/runtime/defs_darwin_amd64.h                    |  395 --
 src/runtime/defs_dragonfly_386.go                  |  190 +
 src/runtime/defs_dragonfly_386.h                   |  198 -
 src/runtime/defs_dragonfly_amd64.go                |  208 ++
 src/runtime/defs_dragonfly_amd64.h                 |  208 --
 src/runtime/defs_freebsd_386.go                    |  213 ++
 src/runtime/defs_freebsd_386.h                     |  213 --
 src/runtime/defs_freebsd_amd64.go                  |  224 ++
 src/runtime/defs_freebsd_amd64.h                   |  224 --
 src/runtime/defs_freebsd_arm.go                    |  186 +
 src/runtime/defs_freebsd_arm.h                     |  186 -
 src/runtime/defs_linux_386.go                      |  217 ++
 src/runtime/defs_linux_386.h                       |  211 --
 src/runtime/defs_linux_amd64.go                    |  253 ++
 src/runtime/defs_linux_amd64.h                     |  254 --
 src/runtime/defs_linux_arm.go                      |  167 +
 src/runtime/defs_linux_arm.h                       |  168 -
 src/runtime/defs_nacl_386.go                       |   42 +
 src/runtime/defs_nacl_386.h                        |   63 -
 src/runtime/defs_nacl_amd64p32.go                  |   63 +
 src/runtime/defs_nacl_amd64p32.h                   |   90 -
 src/runtime/defs_nacl_arm.go                       |   49 +
 src/runtime/defs_nacl_arm.h                        |   70 -
 src/runtime/defs_netbsd_386.h                      |  182 -
 src/runtime/defs_netbsd_amd64.h                    |  194 -
 src/runtime/defs_netbsd_arm.h                      |  184 -
 src/runtime/defs_openbsd_386.go                    |  170 +
 src/runtime/defs_openbsd_386.h                     |  168 -
 src/runtime/defs_openbsd_amd64.go                  |  181 +
 src/runtime/defs_openbsd_amd64.h                   |  179 -
 src/runtime/defs_plan9_386.go                      |   23 +
 src/runtime/defs_plan9_386.h                       |   26 -
 src/runtime/defs_plan9_amd64.go                    |   32 +
 src/runtime/defs_plan9_amd64.h                     |   34 -
 src/runtime/defs_solaris_amd64.h                   |  254 --
 src/runtime/defs_windows_386.go                    |  109 +
 src/runtime/defs_windows_386.h                     |  116 -
 src/runtime/defs_windows_amd64.go                  |  124 +
 src/runtime/defs_windows_amd64.h                   |  131 -
 src/runtime/env_posix.go                           |   10 +-
 src/runtime/export_test.go                         |   80 +-
 src/runtime/extern.go                              |    3 +-
 src/runtime/float.c                                |   10 -
 src/runtime/funcdata.h                             |   10 +-
 src/runtime/futex_test.go                          |    4 +-
 src/runtime/gcinfo_test.go                         |    5 +-
 src/runtime/go_tls.h                               |   22 +
 src/runtime/heapdump.c                             |  851 -----
 src/runtime/heapdump.go                            |  729 ++++
 src/runtime/lfstack.c                              |   85 -
 src/runtime/lfstack.go                             |   36 +
 src/runtime/lfstack_32bit.go                       |   21 +
 src/runtime/lfstack_amd64.go                       |   24 +
 src/runtime/lfstack_linux_power64x.go              |   26 +
 src/runtime/lock_futex.go                          |    7 +-
 src/runtime/lock_sema.go                           |    8 +-
 src/runtime/malloc.c                               |  396 --
 src/runtime/malloc.go                              |  134 +-
 src/runtime/malloc.h                               |  620 ----
 src/runtime/malloc1.go                             |  318 ++
 src/runtime/malloc2.go                             |  473 +++
 src/runtime/mcache.c                               |  115 -
 src/runtime/mcache.go                              |   91 +
 src/runtime/mcentral.c                             |  214 --
 src/runtime/mcentral.go                            |  199 +
 src/runtime/mem.go                                 |   24 +-
 src/runtime/mem_bsd.go                             |   88 +
 src/runtime/mem_darwin.c                           |   82 -
 src/runtime/mem_darwin.go                          |   58 +
 src/runtime/mem_dragonfly.c                        |  105 -
 src/runtime/mem_freebsd.c                          |  100 -
 src/runtime/mem_linux.c                            |  166 -
 src/runtime/mem_linux.go                           |  135 +
 src/runtime/mem_netbsd.c                           |  100 -
 src/runtime/mem_openbsd.c                          |  100 -
 src/runtime/mem_solaris.c                          |  101 -
 src/runtime/mem_windows.c                          |  132 -
 src/runtime/mem_windows.go                         |  119 +
 src/runtime/mfixalloc.c                            |   64 -
 src/runtime/mfixalloc.go                           |   59 +
 src/runtime/mgc.go                                 | 2422 +++++++++++++
 src/runtime/mgc0.c                                 | 2682 --------------
 src/runtime/mgc0.go                                |   18 +-
 src/runtime/mgc0.h                                 |   74 +-
 src/runtime/mgc1.go                                |   80 +
 src/runtime/mheap.c                                |  889 -----
 src/runtime/mheap.go                               |  785 ++++
 src/runtime/mprof.go                               |   33 +-
 src/runtime/msize.c                                |  184 -
 src/runtime/msize.go                               |  174 +
 src/runtime/netpoll.go                             |   53 +-
 .../{netpoll_solaris.c => netpoll_solaris.go}      |  259 +-
 src/runtime/netpoll_windows.c                      |  163 -
 src/runtime/netpoll_windows.go                     |  156 +
 src/runtime/norace_test.go                         |    4 +-
 src/runtime/os1_darwin.go                          |  423 +++
 src/runtime/os1_dragonfly.go                       |  220 ++
 src/runtime/os1_freebsd.go                         |  221 ++
 src/runtime/os1_linux.go                           |  287 ++
 src/runtime/os1_openbsd.go                         |  235 ++
 src/runtime/os2_darwin.go                          |   14 +
 src/runtime/os2_dragonfly.go                       |   12 +
 src/runtime/os2_freebsd.go                         |   12 +
 src/runtime/os2_linux.go                           |   23 +
 src/runtime/os2_openbsd.go                         |   14 +
 src/runtime/os2_solaris.go                         |   13 +
 src/runtime/os3_solaris.go                         |  493 +++
 src/runtime/os_darwin.c                            |  570 ---
 src/runtime/os_darwin.go                           |   30 +-
 src/runtime/os_darwin.h                            |   43 -
 src/runtime/os_dragonfly.c                         |  315 --
 src/runtime/os_dragonfly.go                        |   34 +-
 src/runtime/os_dragonfly.h                         |   30 -
 src/runtime/os_freebsd.c                           |  323 --
 src/runtime/os_freebsd.go                          |   29 +-
 src/runtime/os_freebsd.h                           |   29 -
 .../{os_freebsd_arm.c => os_freebsd_arm.go}        |   17 +-
 src/runtime/os_linux.c                             |  362 --
 src/runtime/os_linux.go                            |   26 +-
 src/runtime/os_linux.h                             |   41 -
 src/runtime/os_linux_386.c                         |   38 -
 src/runtime/os_linux_386.go                        |   36 +
 src/runtime/os_linux_arm.c                         |   80 -
 src/runtime/os_linux_arm.go                        |   75 +
 src/runtime/os_openbsd.c                           |  312 --
 src/runtime/os_openbsd.go                          |   30 +-
 src/runtime/os_openbsd.h                           |   26 -
 src/runtime/os_solaris.c                           |  560 ---
 src/runtime/os_solaris.go                          |   52 +-
 src/runtime/os_solaris.h                           |   55 -
 src/runtime/os_windows.go                          |    4 -
 src/runtime/panic.c                                |  200 -
 src/runtime/panic.go                               |   50 +-
 src/runtime/panic1.go                              |  161 +
 src/runtime/parfor.c                               |  226 --
 src/runtime/parfor.go                              |  186 +
 src/runtime/pprof/pprof_test.go                    |    2 +-
 src/runtime/proc.c                                 | 3497 ------------------
 src/runtime/proc.go                                |   42 +-
 src/runtime/proc1.go                               | 3186 ++++++++++++++++
 src/runtime/race.c                                 |  314 --
 src/runtime/race.go                                |   42 +-
 src/runtime/race.h                                 |   34 -
 src/runtime/race0.go                               |    2 +-
 src/runtime/race1.go                               |  304 ++
 src/runtime/race_amd64.s                           |    3 +-
 src/runtime/rdebug.go                              |   18 -
 src/runtime/rt0_linux_386.s                        |    1 -
 src/runtime/rt0_windows_amd64.s                    |    3 +-
 src/runtime/runtime.c                              |  411 ---
 src/runtime/runtime.h                              | 1151 ------
 src/runtime/runtime1.go                            |  417 +++
 src/runtime/runtime2.go                            |  613 ++++
 src/runtime/runtime2_windows.go                    |    8 +
 src/runtime/select.go                              |    6 +-
 src/runtime/signal.c                               |   25 -
 src/runtime/signal1_unix.go                        |  111 +
 src/runtime/signal_386.c                           |  122 -
 src/runtime/signal_386.go                          |  131 +
 src/runtime/signal_amd64x.c                        |  156 -
 src/runtime/signal_amd64x.go                       |  163 +
 src/runtime/signal_arm.c                           |  121 -
 src/runtime/signal_arm.go                          |  126 +
 src/runtime/signal_darwin.go                       |   45 +
 src/runtime/signal_darwin_386.go                   |   34 +
 src/runtime/signal_darwin_386.h                    |   23 -
 src/runtime/signal_darwin_amd64.go                 |   42 +
 src/runtime/signal_darwin_amd64.h                  |   31 -
 src/runtime/signal_dragonfly.go                    |   46 +
 src/runtime/signal_dragonfly_amd64.go              |   44 +
 src/runtime/signal_dragonfly_amd64.h               |   31 -
 src/runtime/signal_freebsd.go                      |   46 +
 src/runtime/signal_freebsd_386.go                  |   34 +
 src/runtime/signal_freebsd_386.h                   |   23 -
 src/runtime/signal_freebsd_amd64.go                |   44 +
 src/runtime/signal_freebsd_amd64.h                 |   31 -
 src/runtime/signal_freebsd_arm.go                  |   48 +
 src/runtime/signal_freebsd_arm.h                   |   28 -
 src/runtime/signal_linux.go                        |   78 +
 src/runtime/signal_linux_386.go                    |   36 +
 src/runtime/signal_linux_386.h                     |   24 -
 src/runtime/signal_linux_amd64.go                  |   46 +
 src/runtime/signal_linux_amd64.h                   |   32 -
 src/runtime/signal_linux_arm.go                    |   48 +
 src/runtime/signal_linux_arm.h                     |   28 -
 src/runtime/signal_openbsd.go                      |   46 +
 src/runtime/signal_openbsd_386.go                  |   41 +
 src/runtime/signal_openbsd_386.h                   |   23 -
 src/runtime/signal_openbsd_amd64.go                |   49 +
 src/runtime/signal_openbsd_amd64.h                 |   31 -
 src/runtime/signal_solaris.go                      |   88 +
 src/runtime/signal_solaris_amd64.go                |   46 +
 src/runtime/signal_solaris_amd64.h                 |   31 -
 src/runtime/signal_unix.c                          |  119 -
 src/runtime/signal_unix.go                         |    4 +-
 src/runtime/signals_darwin.h                       |   53 -
 src/runtime/signals_dragonfly.h                    |   54 -
 src/runtime/signals_freebsd.h                      |   54 -
 src/runtime/signals_linux.h                        |   86 -
 src/runtime/signals_openbsd.h                      |   54 -
 src/runtime/signals_solaris.h                      |   97 -
 src/runtime/sigpanic_unix.go                       |    9 +-
 src/runtime/sigqueue.go                            |   21 +-
 src/runtime/slice.go                               |    8 +-
 src/runtime/softfloat64.go                         |   22 +-
 src/runtime/softfloat64_test.go                    |    2 +-
 src/runtime/softfloat_arm.c                        |  687 ----
 src/runtime/softfloat_arm.go                       |  644 ++++
 src/runtime/sqrt.go                                |    9 +-
 src/runtime/stack.c                                |  874 -----
 src/runtime/stack.go                               |   13 -
 src/runtime/stack.h                                |   97 +-
 src/runtime/stack1.go                              |  818 +++++
 src/runtime/stack2.go                              |  106 +
 src/runtime/string.c                               |  226 --
 src/runtime/string.go                              |   14 +-
 src/runtime/string1.go                             |  108 +
 src/runtime/stubs.go                               |  164 +-
 src/runtime/stubs2.go                              |   27 +
 src/runtime/symtab.go                              |   22 +-
 src/runtime/sys_arm.c                              |   35 -
 src/runtime/sys_arm.go                             |   35 +
 src/runtime/sys_darwin_386.s                       |    3 +-
 src/runtime/sys_darwin_amd64.s                     |    3 +-
 src/runtime/sys_dragonfly_386.s                    |    3 +-
 src/runtime/sys_dragonfly_amd64.s                  |    3 +-
 src/runtime/sys_freebsd_386.s                      |    3 +-
 src/runtime/sys_freebsd_amd64.s                    |    3 +-
 src/runtime/sys_freebsd_arm.s                      |    5 +-
 src/runtime/sys_linux_386.s                        |    3 +-
 src/runtime/sys_linux_amd64.s                      |    3 +-
 src/runtime/sys_linux_arm.s                        |    5 +-
 src/runtime/sys_nacl_386.s                         |    3 +-
 src/runtime/sys_nacl_amd64p32.s                    |    3 +-
 src/runtime/sys_nacl_arm.s                         |    5 +-
 src/runtime/sys_netbsd_386.s                       |    3 +-
 src/runtime/sys_netbsd_amd64.s                     |    3 +-
 src/runtime/sys_netbsd_arm.s                       |    5 +-
 src/runtime/sys_openbsd_386.s                      |    3 +-
 src/runtime/sys_openbsd_amd64.s                    |    3 +-
 src/runtime/sys_plan9_386.s                        |    3 +-
 src/runtime/sys_plan9_amd64.s                      |    3 +-
 src/runtime/sys_solaris_amd64.s                    |   15 +-
 src/runtime/sys_windows_386.s                      |    3 +-
 src/runtime/sys_windows_amd64.s                    |    3 +-
 src/runtime/{sys_x86.c => sys_x86.go}              |   58 +-
 src/runtime/syscall2_solaris.go                    |   47 +
 src/runtime/syscall_solaris.c                      |   23 -
 src/runtime/syscall_solaris.go                     |   79 +-
 src/runtime/thunk.s                                |   16 +-
 src/runtime/thunk_solaris_amd64.s                  |   88 -
 src/runtime/thunk_windows.s                        |    3 +-
 src/runtime/tls_arm.s                              |    3 +-
 src/runtime/traceback.go                           |   28 +-
 src/runtime/type.go                                |   99 +
 src/runtime/type.h                                 |  113 -
 src/runtime/typekind.h                             |   12 +-
 src/runtime/typekind1.go                           |   39 +
 src/runtime/vdso_linux_amd64.c                     |  371 --
 src/runtime/vdso_linux_amd64.go                    |  328 ++
 src/runtime/vdso_none.go                           |   11 +
 src/runtime/vlop_arm.s                             |    5 +-
 src/runtime/vlrt.c                                 |  914 -----
 384 files changed, 22418 insertions(+), 69496 deletions(-)
