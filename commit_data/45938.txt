commit 7c9b6b1ca249c14d358075da9678cd1c20041b21
Author: Russ Cox <rsc@golang.org>
Date:   Sat Nov 28 15:28:18 2020 -0500

    [dev.regabi] cmd/compile: clean up in preparation for statement Nodes
    
    Using statement nodes restricts the set of valid SetOp operations,
    because you can't SetOp across representation. Rewrite various
    code to avoid crossing those as-yet-unintroduced boundaries.
    
    In particular, code like
    
            x, y := v.(T)
            x, y := f()
            x, y := m[k]
            x, y := <-c
    
    starts out with Op = OAS2, and then it turns into a specific Op
    OAS2DOTTYPE, OAS2FUNC, OAS2MAPR, OAS2RECV, and then
    later in walk is lowered to an OAS2 again.
    
    In the middle, the specific forms move the right-hand side from
    n.Rlist().First() to n.Right(), and then the conversion to OAS2 moves
    it back. This is unnecessary and makes it hard for these all to
    share an underlying Node implementation.
    
    This CL changes these specific forms to leave the right-hand side
    in n.Rlist().First().
    
    Similarly, OSELRECV2 is really just a temporary form of OAS2.
    This CL changes it to use same fields too.
    
    Finally, this CL fixes the printing of OAS2 nodes in ir/fmt.go,
    which formerly printed n.Right() instead of n.Rlist().
    This results in a (correct!) update to cmd/compile/internal/logopt's
    expected output: ~R0 = <N> becomes ~R0 = &y.b.
    
    Passes buildall w/ toolstash -cmp.
    
    Change-Id: I164aa2e17dc55bfb292024de53d7d250192ad64a
    Reviewed-on: https://go-review.googlesource.com/c/go/+/274105
    Trust: Russ Cox <rsc@golang.org>
    Reviewed-by: Matthew Dempsky <mdempsky@google.com>

 src/cmd/compile/internal/gc/escape.go          |  17 ++--
 src/cmd/compile/internal/gc/iexport.go         |   8 +-
 src/cmd/compile/internal/gc/initorder.go       |   2 +-
 src/cmd/compile/internal/gc/inl.go             |  74 +++++++-------
 src/cmd/compile/internal/gc/noder.go           |  19 ++--
 src/cmd/compile/internal/gc/order.go           | 136 ++++++++++++-------------
 src/cmd/compile/internal/gc/range.go           | 102 +++++++++----------
 src/cmd/compile/internal/gc/select.go          |  99 +++++++++---------
 src/cmd/compile/internal/gc/ssa.go             |  10 +-
 src/cmd/compile/internal/gc/typecheck.go       |   4 -
 src/cmd/compile/internal/gc/universe.go        |   1 +
 src/cmd/compile/internal/gc/walk.go            |  19 ++--
 src/cmd/compile/internal/ir/fmt.go             |   9 +-
 src/cmd/compile/internal/ir/node.go            |   4 +-
 src/cmd/compile/internal/logopt/logopt_test.go |   4 +-
 15 files changed, 241 insertions(+), 267 deletions(-)
