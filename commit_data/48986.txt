commit 6dec18cc75021bfbfac267941a567b257721208b
Author: Dan Scales <danscales@google.com>
Date:   Mon Jun 28 18:04:58 2021 -0700

    [dev.typeparams] cmd/compile: start using sub-dictionary entries where needed
    
    Added new struct instInfo for information about an instantiation (of a
    generic function/method with gcshapes or concrete types). We use this to
    remember the dictionary param node, the nodes where sub-dictionaries
    need to be used, etc. The instInfo map replaces the Stencil map in
    Package.
    
    Added code to access sub-dictionary entries at the appropriate call
    sites. We are currently still calculating the corresponding main
    dictionary, even when we really only need a sub-dictionary. I'll clean
    that up in a follow-up CL.
    
    Added code to deal with "generic" closures (closures that reference some
    generic variables/types). We decided that closures will share the same
    dictionary as the containing function (accessing the dictionary via a
    closure variable). So, the getGfInfo function now traverses all the
    nodes of each closure in a function that it is analyzing, so that a
    function's dictionary has all the entries needed for all its closures as
    well. Also, the instInfo of a closure is largely shared with its
    containing function. A good test for generic closures already exists
    with orderedmap.go.
    
    Other improvements:
     - Only create sub-dictionary entries when the function/method
       call/value or closure actually has type params in it. Added new test
       file subdict.go with an example where a generic method has an
       instantiated method call that does not depend not have type params.
    
    Change-Id: I691b9dc024a89d2305fcf1d8ba8540e53c9d103f
    Reviewed-on: https://go-review.googlesource.com/c/go/+/331516
    Trust: Dan Scales <danscales@google.com>
    Run-TryBot: Dan Scales <danscales@google.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Keith Randall <khr@golang.org>

 src/cmd/compile/internal/ir/package.go    |   3 -
 src/cmd/compile/internal/noder/irgen.go   |  32 ++-
 src/cmd/compile/internal/noder/stencil.go | 344 ++++++++++++++++++++----------
 test/typeparam/subdict.go                 |  42 ++++
 4 files changed, 309 insertions(+), 112 deletions(-)
