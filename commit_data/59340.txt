commit 8af32240c6c8f21695cdcb3b6df8293d7f2d3bc7
Author: Keith Randall <khr@golang.org>
Date:   Wed Mar 19 10:17:22 2025 -0700

    cmd/compile: don't evaluate side effects of range over array
    
    If the thing we're ranging over is an array or ptr to array, and
    it doesn't have a function call or channel receive in it, then we
    shouldn't evaluate it.
    
    Typecheck the ranged-over value as a constant in that case.
    That makes the unified exporter replace the range expression
    with a constant int.
    
    Change-Id: I0d4ea081de70d20cf6d1fa8d25ef6cb021975554
    Reviewed-on: https://go-review.googlesource.com/c/go/+/659317
    Reviewed-by: Junyang Shao <shaojunyang@google.com>
    LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
    Reviewed-by: Robert Griesemer <gri@google.com>

 src/cmd/compile/internal/ssa/nilcheck.go |  4 ++--
 src/cmd/compile/internal/types2/range.go | 25 +++++++++++++++++++++++
 src/cmd/compile/internal/walk/range.go   | 35 +++++++++++++++++++++++++++-----
 src/go/types/range.go                    | 25 +++++++++++++++++++++++
 test/codegen/issue52635.go               | 12 +++++++++++
 5 files changed, 94 insertions(+), 7 deletions(-)
