commit b9540246ba591e0ec5cd7cc1d6d62ab911ff9328
Author: Bryan C. Mills <bcmills@google.com>
Date:   Wed Oct 27 16:31:18 2021 -0400

    cmd/go: disallow the -fuzz flag for tests outside the main module
    
    Normally, when fuzzing identifies a failure it saves the failing input
    to the package's testdata directory. However, the testdata directory
    for packages outside the main module is normally not writable â€” and
    when it is, writing to a testdata directory inside the module cache
    would corrupt the checksum for that module (and permanently alter the
    behavior of that version of the module globally).
    
    In the future we could consider a flag to allow failures to be saved
    to an alternate location, or perhaps in the build cache; or, we could
    suppress writes entirely and rely on the user to identify and copy the
    failing input from the test log. However, it's a bit late in the cycle
    for that big a design decision right now. For Go 1.18, we will just
    enforce that the package to be fuzzed resides in the main module,
    which is typically a writable VCS checkout.
    
    Fixes #48495
    
    Change-Id: I8d3d56372394b1aaa94fa920399c659363fa17fa
    Reviewed-on: https://go-review.googlesource.com/c/go/+/359414
    Trust: Bryan C. Mills <bcmills@google.com>
    Trust: Katie Hockman <katie@golang.org>
    Run-TryBot: Bryan C. Mills <bcmills@google.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Katie Hockman <katie@golang.org>

 src/cmd/go/alldocs.go                              | 11 ++--
 src/cmd/go/internal/test/test.go                   | 45 +++++++++++++++--
 .../testdata/mod/example.com_fuzzfail_v0.1.0.txt   | 20 ++++++++
 .../testdata/mod/example.com_fuzzfail_v0.2.0.txt   | 23 +++++++++
 src/cmd/go/testdata/script/test_fuzz_modcache.txt  | 58 ++++++++++++++++++++++
 5 files changed, 147 insertions(+), 10 deletions(-)
