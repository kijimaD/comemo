commit 1b45cc45e37cfe67733ebff5eb5cabfef207eef6
Author: Keith Randall <khr@golang.org>
Date:   Tue Mar 25 14:11:34 2014 -0700

    runtime: redo stack map entries to avoid false retention
    
    Change two-bit stack map entries to encode:
    0 = dead
    1 = scalar
    2 = pointer
    3 = multiword
    
    If multiword, the two-bit entry for the following word encodes:
    0 = string
    1 = slice
    2 = iface
    3 = eface
    
    That way, during stack scanning we can check if a string
    is zero length or a slice has zero capacity.  We can avoid
    following the contained pointer in those cases.  It is safe
    to do so because it can never be dereferenced, and it is
    desirable to do so because it may cause false retention
    of the following block in memory.
    
    Slice feature turned off until issue 7564 is fixed.
    
    Update #7549
    
    LGTM=rsc
    R=golang-codereviews, bradfitz, rsc
    CC=golang-codereviews
    https://golang.org/cl/76380043

 src/cmd/cc/pgen.c              | 10 ++++--
 src/cmd/gc/plive.c             | 41 +++++++++++++++------
 src/pkg/runtime/extern.go      |  3 ++
 src/pkg/runtime/malloc.h       | 10 ++++--
 src/pkg/runtime/mfinal_test.go | 81 ++++++++++++++++++++++++++++++++++++++++++
 src/pkg/runtime/mgc0.c         | 50 +++++++++++++++++++++++---
 src/pkg/runtime/runtime.c      |  1 +
 src/pkg/runtime/runtime.h      |  1 +
 src/pkg/runtime/stack.c        | 58 +++++++++++++++++++++---------
 9 files changed, 218 insertions(+), 37 deletions(-)
