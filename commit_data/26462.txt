commit 7b773946c09e075ed50c49e76e08f61c16616ee4
Author: Keith Randall <khr@golang.org>
Date:   Fri Jan 22 13:44:58 2016 -0800

    [dev.ssa] cmd/compile: disable xor clearing when flags must be preserved
    
    The x86 backend automatically rewrites MOV $0, AX to
    XOR AX, AX.  That rewrite isn't ok when the flags register
    is live across the MOV.  Keep track of which moves care
    about preserving flags, then disable this rewrite for them.
    
    On x86, Prog.Mark was being used to hold the length of the
    instruction.  We already store that in Prog.Isize, so no
    need to store it in Prog.Mark also.  This frees up Prog.Mark
    to hold a bitmask on x86 just like all the other architectures.
    
    Update #12405
    
    Change-Id: Ibad8a8f41fc6222bec1e4904221887d3cc3ca029
    Reviewed-on: https://go-review.googlesource.com/18861
    Reviewed-by: David Chase <drchase@google.com>
    Reviewed-by: Russ Cox <rsc@golang.org>

 src/cmd/compile/internal/gc/ssa.go           | 29 ++++++++++++++++++++++++++++
 src/cmd/compile/internal/ssa/block.go        |  3 +++
 src/cmd/compile/internal/ssa/flagalloc.go    |  5 +++++
 src/cmd/compile/internal/ssa/gen/AMD64Ops.go | 11 ++++-------
 src/cmd/compile/internal/ssa/opGen.go        |  4 ----
 src/cmd/compile/internal/ssa/regalloc.go     |  9 ---------
 src/cmd/internal/obj/link.go                 |  6 +++---
 src/cmd/internal/obj/pass.go                 |  1 -
 src/cmd/internal/obj/x86/a.out.go            |  6 ++++++
 src/cmd/internal/obj/x86/asm6.go             |  9 ++++++---
 src/cmd/internal/obj/x86/obj6.go             | 20 +++++++++----------
 11 files changed, 66 insertions(+), 37 deletions(-)
