commit 55044288ad22f0c46ac55375ed9ef3de1babb77c
Author: Keith Randall <khr@golang.org>
Date:   Thu Oct 20 14:20:41 2022 -0700

    runtime: reimplement GODEBUG=cgocheck=2 as a GOEXPERIMENT
    
    Move this knob from a binary-startup thing to a build-time thing.
    This will enable followon optmizations to the write barrier.
    
    Change-Id: Ic3323348621c76a7dc390c09ff55016b19c43018
    Reviewed-on: https://go-review.googlesource.com/c/go/+/447778
    Reviewed-by: Michael Knyszek <mknyszek@google.com>
    Run-TryBot: Keith Randall <khr@golang.org>
    TryBot-Result: Gopher Robot <gobot@golang.org>
    Reviewed-by: Cherry Mui <cherryyz@google.com>

 misc/cgo/errors/ptr_test.go                    | 62 ++++++++++++++++++--------
 src/cmd/compile/internal/ir/symtab.go          |  2 +
 src/cmd/compile/internal/ssa/writebarrier.go   | 22 ++++++++-
 src/cmd/compile/internal/ssagen/ssa.go         |  6 +++
 src/internal/goexperiment/exp_cgocheck2_off.go |  9 ++++
 src/internal/goexperiment/exp_cgocheck2_on.go  |  9 ++++
 src/internal/goexperiment/flags.go             |  5 +++
 src/runtime/atomic_pointer.go                  | 18 +++++++-
 src/runtime/cgocall.go                         |  5 ++-
 src/runtime/cgocheck.go                        | 34 ++++++++++----
 src/runtime/extern.go                          |  6 +--
 src/runtime/mbarrier.go                        | 11 ++---
 src/runtime/mbitmap.go                         | 16 +++----
 src/runtime/mgc.go                             |  5 +--
 src/runtime/mgcmark.go                         |  4 +-
 src/runtime/mwbbuf.go                          | 29 ++----------
 src/runtime/proc.go                            | 11 -----
 src/runtime/runtime1.go                        |  4 ++
 18 files changed, 168 insertions(+), 90 deletions(-)
