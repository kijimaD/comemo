commit 878439cfe592165bdeaeed037bf1d3351e638853
Author: Matthew Dempsky <mdempsky@google.com>
Date:   Mon Jul 18 12:41:56 2022 -0700

    [dev.unified] cmd/compile/internal/noder: preserve RTTI for select statements
    
    In a select statement, `case i = <-c: ...` may require an implicit
    conversion of the received value to i's type, but walk does not expect
    a conversion here. Instead, typecheck actually discards the
    conversion (resulting in ill-typed IR), and then relies on it being
    reinserted later when walk desugars the assignment.
    
    However, that might lose the explicit RTTI operands we've set for
    conversions to interface type, so explicitly introduce a temporary
    variable and rewrite as `case tmp := <-c: i = tmp; ...`, which is
    semantically equivalent and allows the `i = tmp` assignment to
    maintain the explicit RTTI without confusing the rest of the compiler
    frontend.
    
    Change-Id: Ie6c4dc9b19437e83970cd3ce83420813b8a47dc4
    Reviewed-on: https://go-review.googlesource.com/c/go/+/418098
    Run-TryBot: Matthew Dempsky <mdempsky@google.com>
    Reviewed-by: Cuong Manh Le <cuong.manhle.vn@gmail.com>
    Reviewed-by: Keith Randall <khr@google.com>
    TryBot-Result: Gopher Robot <gobot@golang.org>
    Reviewed-by: Keith Randall <khr@golang.org>

 src/cmd/compile/internal/noder/reader.go | 45 +++++++++++++++++++++++++++-----
 1 file changed, 38 insertions(+), 7 deletions(-)
