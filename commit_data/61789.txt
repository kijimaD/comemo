commit 7f049eac1b9378ecc4dddd43ebedeae0916c0606
Author: Carlos Amedee <carlos@golang.org>
Date:   Wed Nov 20 17:20:41 2024 -0500

    runtime: properly search for cleanups in cleanup.stop
    
    This change modifies the logic which searches for existing cleanups.
    The existing search logic sets the next node to the current node
    in certain conditions. This would cause future searches to loop
    endlessly. The existing loop could convert non-cleanup specials into
    cleanups and cause data corruption.
    
    This also changes where we release the m while we are adding a
    cleanup. We are currently holding onto an p-specific gcwork after
    releasing the m.
    
    Change-Id: I0ac0b304f40910549c8df114e523c89d9f0d7a75
    Reviewed-on: https://go-review.googlesource.com/c/go/+/630278
    LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
    Auto-Submit: Carlos Amedee <carlos@golang.org>
    Reviewed-by: David Chase <drchase@google.com>
    Reviewed-by: Michael Knyszek <mknyszek@google.com>

 src/runtime/mcleanup.go | 18 ++++++++++++++++--
 src/runtime/mheap.go    |  2 +-
 2 files changed, 17 insertions(+), 3 deletions(-)
