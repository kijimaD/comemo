commit 6f13d0bfe42115d1d5452bee0bb7648d968beeb4
Author: Michael Anthony Knyszek <mknyszek@google.com>
Date:   Thu May 18 15:51:57 2023 +0000

    runtime: fix usage of stale "now" value for netpolling Ms
    
    Currently pidleget gets passed "now" from before the M goes into
    netpoll, resulting in incorrect accounting of idle CPU time.
    lastpoll is also stored with a stale "now": the mistake was added in the
    same CL it was added for pidleget.
    
    Recompute "now" after returning from netpoll.
    
    Also, start tracking idle time on js/wasm at all.
    
    Credit to Rhys Hiltner for the test case.
    
    Fixes #60276.
    
    Change-Id: I5dd677471f74c915dfcf3d01621430876c3ff307
    Reviewed-on: https://go-review.googlesource.com/c/go/+/496183
    Reviewed-by: Michael Pratt <mpratt@google.com>
    TryBot-Result: Gopher Robot <gobot@golang.org>
    Run-TryBot: Michael Knyszek <mknyszek@google.com>
    Reviewed-by: Ian Lance Taylor <iant@google.com>

 src/runtime/lock_js.go      |  6 +++++
 src/runtime/metrics_test.go | 59 +++++++++++++++++++++++++++++++++++++++++++++
 src/runtime/proc.go         |  7 ++++--
 3 files changed, 70 insertions(+), 2 deletions(-)
