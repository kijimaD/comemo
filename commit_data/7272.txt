commit 4608feb18b515ef7e01b906913b10bbca9d6b08a
Author: Russ Cox <rsc@golang.org>
Date:   Fri Jan 28 15:03:26 2011 -0500

    runtime: simpler heap map, memory allocation
    
    The old heap maps used a multilevel table, but that
    was overkill: there are only 1M entries on a 32-bit
    machine and we can arrange to use a dense address
    range on a 64-bit machine.
    
    The heap map is in bss.  The assumption is that if
    we don't touch the pages they won't be mapped in.
    
    Also moved some duplicated memory allocation
    code out of the OS-specific files.
    
    R=r
    CC=golang-dev
    https://golang.org/cl/4118042

 src/pkg/runtime/Makefile           |   2 -
 src/pkg/runtime/amd64/traceback.c  |   4 +-
 src/pkg/runtime/darwin/386/sys.s   |   2 +-
 src/pkg/runtime/darwin/amd64/sys.s |   2 +-
 src/pkg/runtime/darwin/mem.c       |  19 ++++--
 src/pkg/runtime/darwin/thread.c    |   8 ++-
 src/pkg/runtime/debug.go           |   1 -
 src/pkg/runtime/freebsd/mem.c      |  19 ++++--
 src/pkg/runtime/linux/mem.c        |  21 +++++--
 src/pkg/runtime/malloc.goc         |  67 ++++++++++++++++++++-
 src/pkg/runtime/malloc.h           |  42 +++++++------
 src/pkg/runtime/malloc_defs.go     |   1 -
 src/pkg/runtime/mcentral.c         |   3 +-
 src/pkg/runtime/mgc0.c             |   2 +-
 src/pkg/runtime/mheap.c            |  96 +++++++++++++++++++-----------
 src/pkg/runtime/mheapmap32.c       |  96 ------------------------------
 src/pkg/runtime/mheapmap32.h       |  41 -------------
 src/pkg/runtime/mheapmap32_defs.go |  23 --------
 src/pkg/runtime/mheapmap64.c       | 117 -------------------------------------
 src/pkg/runtime/mheapmap64.h       |  60 -------------------
 src/pkg/runtime/mheapmap64_defs.go |  31 ----------
 src/pkg/runtime/pprof/pprof.go     |   1 -
 src/pkg/runtime/proc.c             |   6 ++
 src/pkg/runtime/runtime.h          |   1 +
 src/pkg/runtime/windows/mem.c      |  24 +++++---
 test/run                           |   4 +-
 26 files changed, 235 insertions(+), 458 deletions(-)
