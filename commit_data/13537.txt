commit 20d9fd3ae18bd5f80c3c0f8f424ebd9a72b6788a
Author: Rob Pike <r@golang.org>
Date:   Mon Jul 30 15:11:20 2012 -0700

    text/template/parse: fix data race
    The situation only affects diagnostics but is easy to fix.
    When computing lineNumber, use the position of the last item
    returned by nextItem rather than the current state of the lexer.
    This is internal only and does not affect the API.
    
    Fixes #3886.
    
    R=golang-dev, iant
    CC=golang-dev
    https://golang.org/cl/6445061

 src/pkg/text/template/parse/lex.go      |  19 ++-
 src/pkg/text/template/parse/lex_test.go | 235 ++++++++++++++++++++------------
 2 files changed, 159 insertions(+), 95 deletions(-)
