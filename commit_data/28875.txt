commit 52fcff3ec147ea8ae48c023f3d5000a8bf42fe8c
Author: Jan Mercl <0xjnml@gmail.com>
Date:   Tue Aug 2 13:00:46 2016 +0200

    go/token: Fix race in FileSet.PositionFor.
    
    Methods of FileSet are documented to be safe for concurrent use by
    multiple goroutines, so FileSet is protected by a mutex and all its
    methods use it to prevent concurrent mutations. All methods of File that
    mutate the respective FileSet, including AddLine, do also lock its
    mutex, but that does not help when PositionFor is invoked concurrently
    and reads without synchronization what AddLine mutates.
    
    The change adds acquiring a RLock around the racy call of File.position
    and the respective test.
    
    Fixes #16548
    
    Change-Id: Iecaaa02630b2532cb29ab555376633ee862315dd
    Reviewed-on: https://go-review.googlesource.com/25345
    Reviewed-by: Robert Griesemer <gri@golang.org>
    Run-TryBot: Brad Fitzpatrick <bradfitz@golang.org>
    TryBot-Result: Gobot Gobot <gobot@golang.org>

 src/go/token/position.go      |  2 ++
 src/go/token/position_test.go | 31 ++++++++++++++++++++++++++++++-
 2 files changed, 32 insertions(+), 1 deletion(-)
