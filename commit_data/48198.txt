commit e94f7df957b6cfbdfbed7092fd05628452c5e018
Author: Robert Griesemer <gri@golang.org>
Date:   Tue Feb 22 13:06:52 2022 -0800

    go/types, types2: generalize cleanup phase after type checking
    
    Use a cleanup method and simple registration mechanism
    for types that need some final processing before the end
    of type checking.
    
    Use cleanup mechanism instead of expandDefTypes mechanism
    for *Named types. There is no change in functionality here.
    
    Use cleanup mechanism also for TypeParam and Interface types
    to ensure that their check fields are nilled out at the end.
    
    Introduce a simple constructor method for Interface types
    to ensure that the cleanup method is always registered.
    
    In go/types, add tracing code to Checker.checkFiles to match
    types2.
    
    Minor comment adjustments.
    
    Fixes #51316.
    Fixes #51326.
    
    Change-Id: I7b2bd79cc419717982f3c918645af623c0e80d5e
    Reviewed-on: https://go-review.googlesource.com/c/go/+/387417
    Trust: Robert Griesemer <gri@golang.org>
    Run-TryBot: Robert Griesemer <gri@golang.org>
    Reviewed-by: Robert Findley <rfindley@google.com>
    TryBot-Result: Gopher Robot <gobot@golang.org>

 src/cmd/compile/internal/types2/check.go     | 45 ++++++++++-----------
 src/cmd/compile/internal/types2/interface.go | 28 +++++++++-----
 src/cmd/compile/internal/types2/named.go     | 32 ++++++++++++---
 src/cmd/compile/internal/types2/subst.go     |  5 ++-
 src/cmd/compile/internal/types2/typeparam.go | 12 +++---
 src/cmd/compile/internal/types2/typexpr.go   |  2 +-
 src/go/types/check.go                        | 58 +++++++++++++++++-----------
 src/go/types/interface.go                    | 28 +++++++++-----
 src/go/types/named.go                        | 32 ++++++++++++---
 src/go/types/subst.go                        |  5 ++-
 src/go/types/typeparam.go                    | 12 +++---
 src/go/types/typexpr.go                      |  2 +-
 12 files changed, 168 insertions(+), 93 deletions(-)
