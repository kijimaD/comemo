commit 4a7aba775d6886109e0d4117d8c0a02112568686
Author: Keith Randall <khr@golang.org>
Date:   Mon Mar 28 11:25:17 2016 -0700

    cmd/compile: better job of naming compound types
    
    Compound AUTO types weren't named previously.  That was because live
    variable analysis (plive.go) doesn't handle spilling to compound types.
    It can't handle them because there is no valid place to put VARDEFs when
    regalloc is spilling compound types.
    
    compound types = multiword builtin types: complex, string, slice, and
    interface.
    
    Instead, we split named AUTOs into individual one-word variables.  For
    example, a string s gets split into a byte ptr s.ptr and an integer
    s.len.  Those two variables can be spilled to / restored from
    independently.  As a result, live variable analysis can handle them
    because they are one-word objects.
    
    This CL will change how AUTOs are described in DWARF information.
    Consider the code:
    
    func f(s string, i int) int {
        x := s[i:i+5]
        g()
        return lookup(x)
    }
    
    The old compiler would spill x to two consecutive slots on the stack,
    both named x (at offsets 0 and 8).  The new compiler spills the pointer
    of x to a slot named x.ptr.  It doesn't spill x.len at all, as it is a
    constant (5) and can be rematerialized for the call to lookup.
    
    So compound objects may not be spilled in their entirety, and even if
    they are they won't necessarily be contiguous.  Such is the price of
    optimization.
    
    Re-enable live variable analysis tests.  One test remains disabled, it
    fails because of #14904.
    
    Change-Id: I8ef2b5ab91e43a0d2136bfc231c05d100ec0b801
    Reviewed-on: https://go-review.googlesource.com/21233
    Run-TryBot: Keith Randall <khr@golang.org>
    TryBot-Result: Gobot Gobot <gobot@golang.org>
    Reviewed-by: David Chase <drchase@google.com>

 src/cmd/compile/internal/gc/ssa.go             |  96 +++-
 src/cmd/compile/internal/ssa/config.go         |   7 +
 src/cmd/compile/internal/ssa/decompose.go      |  13 +-
 src/cmd/compile/internal/ssa/export_test.go    |  17 +
 src/cmd/compile/internal/ssa/gen/dec.rules     |  86 ++++
 src/cmd/compile/internal/ssa/gen/generic.rules |  95 +---
 src/cmd/compile/internal/ssa/rewritedec.go     | 384 +++++++++++++++
 src/cmd/compile/internal/ssa/rewritegeneric.go | 401 +--------------
 src/cmd/compile/internal/ssa/stackalloc.go     |   2 +-
 test/live_ssa.go                               | 649 +++++++++++++++++++++++++
 10 files changed, 1253 insertions(+), 497 deletions(-)
