commit 374546d800124e9ab4d51b75e335a71f866f3ef8
Author: Alessandro Arzilli <alessandro.arzilli@gmail.com>
Date:   Wed Sep 19 14:45:45 2018 +0200

    cmd/go: respect gcflags, ldflags in 'go test'
    
    Fixes bug introduced by https://golang.org/cl/129059 where
    gcflags='all=...' and ldflags='all=...' would not be applied to some
    packages built by 'go test'.
    
    LoadImport used to set gcflags/ldflags for the Package objects it
    created, in https://golang.org/cl/129059 this code was factored out to
    setToolFlags. The codepath of `go build` was updated to call
    setToolFlags appropriatley, but the codepath of `go test -c` wasn't,
    resulting in gcflags/ldflags being applied inconsistently when building
    tests.
    
    This commit changes TestPackagesFor to call setToolFlags on the package
    objects it creates.
    
    Fixes #27681
    
    Change-Id: Idcbec0c989ee96ec066207184611f08818873e8d
    Reviewed-on: https://go-review.googlesource.com/c/136275
    Run-TryBot: Jay Conrod <jayconrod@google.com>
    TryBot-Result: Gobot Gobot <gobot@golang.org>
    Reviewed-by: Jay Conrod <jayconrod@google.com>

 src/cmd/go/internal/load/test.go                | 6 ++++++
 src/cmd/go/testdata/script/gcflags_patterns.txt | 8 ++++++++
 2 files changed, 14 insertions(+)
