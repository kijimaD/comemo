commit 1c10598064dcc560cf4b447f573e0d0dd34762e4
Author: Adam Langley <agl@golang.org>
Date:   Wed Apr 29 10:10:48 2015 -0700

    crypto/tls: update the supported signature algorithms.
    
    This is the second in a two-part change. See https://golang.org/cl/9415
    for details of the overall change.
    
    This change updates the supported signature algorithms to include
    SHA-384 and updates all the testdata/ files accordingly. Even some of
    the testdata/ files named “TLS1.0” and “TLS1.1” have been updated
    because they have TLS 1.2 ClientHello's even though the server picks a
    lower version.
    
    Fixes #9757.
    
    Change-Id: Ia76de2b548d3b39cd4aa3f71132b0da7c917debd
    Reviewed-on: https://go-review.googlesource.com/9472
    Reviewed-by: Brad Fitzpatrick <bradfitz@golang.org>
---
 src/crypto/tls/common.go                           |   2 +
 .../testdata/Client-TLSv10-ClientCert-ECDSA-ECDSA  |  96 ++++++++++----------
 .../testdata/Client-TLSv10-ClientCert-ECDSA-RSA    |  58 ++++++------
 .../testdata/Client-TLSv10-ClientCert-RSA-ECDSA    |  96 ++++++++++----------
 .../tls/testdata/Client-TLSv10-ClientCert-RSA-RSA  |  58 ++++++------
 .../tls/testdata/Client-TLSv10-ECDHE-ECDSA-AES     |  78 ++++++++--------
 .../tls/testdata/Client-TLSv10-ECDHE-RSA-AES       |  78 ++++++++--------
 src/crypto/tls/testdata/Client-TLSv10-RSA-RC4      |  40 ++++-----
 .../tls/testdata/Client-TLSv11-ECDHE-ECDSA-AES     |  78 ++++++++--------
 .../tls/testdata/Client-TLSv11-ECDHE-RSA-AES       |  78 ++++++++--------
 src/crypto/tls/testdata/Client-TLSv11-RSA-RC4      |  40 ++++-----
 src/crypto/tls/testdata/Client-TLSv12-ALPN         |  70 +++++++--------
 src/crypto/tls/testdata/Client-TLSv12-ALPN-NoMatch |  72 +++++++--------
 .../testdata/Client-TLSv12-ClientCert-ECDSA-ECDSA  | 100 ++++++++++-----------
 .../testdata/Client-TLSv12-ClientCert-ECDSA-RSA    |  61 +++++++------
 .../Client-TLSv12-ClientCert-RSA-AES256-GCM-SHA384 |  90 +++++++++----------
 .../testdata/Client-TLSv12-ClientCert-RSA-ECDSA    |  96 ++++++++++----------
 .../tls/testdata/Client-TLSv12-ClientCert-RSA-RSA  |  58 ++++++------
 .../tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES     |  80 ++++++++---------
 .../tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES-GCM |  72 +++++++--------
 .../Client-TLSv12-ECDHE-ECDSA-AES256-GCM-SHA384    |  74 +++++++--------
 .../tls/testdata/Client-TLSv12-ECDHE-RSA-AES       |  78 ++++++++--------
 src/crypto/tls/testdata/Client-TLSv12-RSA-RC4      |  40 ++++-----
 src/crypto/tls/testdata/Client-TLSv12-SCT          |  70 +++++++--------
 src/crypto/tls/testdata/Server-TLSv12-ALPN         |  68 +++++++-------
 src/crypto/tls/testdata/Server-TLSv12-ALPN-NoMatch |  68 +++++++-------
 .../Server-TLSv12-CipherSuiteCertPreferenceECDSA   |  83 +++++++++--------
 .../Server-TLSv12-CipherSuiteCertPreferenceRSA     |  81 +++++++++--------
 .../Server-TLSv12-ClientAuthRequestedAndECDSAGiven |  70 +++++++--------
 .../Server-TLSv12-ClientAuthRequestedAndGiven      |  68 +++++++-------
 .../Server-TLSv12-ClientAuthRequestedNotGiven      |  50 +++++------
 .../tls/testdata/Server-TLSv12-ECDHE-ECDSA-AES     |  70 +++++++--------
 src/crypto/tls/testdata/Server-TLSv12-RSA-AES-GCM  |  70 +++++++--------
 .../testdata/Server-TLSv12-RSA-AES256-GCM-SHA384   |  69 +++++++-------
 34 files changed, 1180 insertions(+), 1180 deletions(-)

diff --git a/src/crypto/tls/common.go b/src/crypto/tls/common.go
index 8840841bf7..12500ab72a 100644
--- a/src/crypto/tls/common.go
+++ b/src/crypto/tls/common.go
@@ -147,6 +147,8 @@ type signatureAndHash struct {
 var supportedSignatureAlgorithms = []signatureAndHash{
 	{hashSHA256, signatureRSA},
 	{hashSHA256, signatureECDSA},
+	{hashSHA384, signatureRSA},
+	{hashSHA384, signatureECDSA},
 	{hashSHA1, signatureRSA},
 	{hashSHA1, signatureECDSA},
 }
diff --git a/src/crypto/tls/testdata/Client-TLSv10-ClientCert-ECDSA-ECDSA b/src/crypto/tls/testdata/Client-TLSv10-ClientCert-ECDSA-ECDSA
index 27764d3763..4bad7865df 100644
--- a/src/crypto/tls/testdata/Client-TLSv10-ClientCert-ECDSA-ECDSA
+++ b/src/crypto/tls/testdata/Client-TLSv10-ClientCert-ECDSA-ECDSA
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 01 00 59 02 00 00  55 03 01 78 c1 5c b4 a6  |....Y...U..x.\..|
-00000010  e8 72 33 c9 e2 c9 b2 da  12 9d 78 60 08 ae cd 37  |.r3.......x`...7|
-00000020  33 9a 39 0b d4 fb cb 69  db f0 35 20 4e 95 ee 5e  |3.9....i..5 N..^|
-00000030  00 32 18 0d cf 52 7f 08  0d 8c b7 21 36 8a f0 2f  |.2...R.....!6../|
-00000040  22 b8 60 4c b7 2f 5a 7a  02 11 9d ce c0 09 00 00  |".`L./Zz........|
+00000000  16 03 01 00 59 02 00 00  55 03 01 c0 e1 5c 5b 45  |....Y...U....\[E|
+00000010  70 fc a1 73 44 e7 69 b6  83 a1 71 bc 03 21 2e cc  |p..sD.i...q..!..|
+00000020  21 7a 28 20 82 6b 2f 77  7d 40 c7 20 0d e4 19 db  |!z( .k/w}@. ....|
+00000030  35 cd 75 a4 e7 e5 6c 3e  c9 d5 fe 9d c5 88 78 7b  |5.u...l>......x{|
+00000040  c4 fc 04 9a c1 10 7a 15  d9 e9 4a 95 c0 09 00 00  |......z...J.....|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  01 02 0e 0b 00 02 0a 00  02 07 00 02 04 30 82 02  |.............0..|
 00000070  00 30 82 01 62 02 09 00  b8 bf 2d 47 a0 d2 eb f4  |.0..b.....-G....|
@@ -48,20 +48,20 @@
 00000240  13 83 0d 94 06 bb d4 37  7a f6 ec 7a c9 86 2e dd  |.......7z..z....|
 00000250  d7 11 69 7f 85 7c 56 de  fb 31 78 2b e4 c7 78 0d  |..i..|V..1x+..x.|
 00000260  ae cb be 9e 4e 36 24 31  7b 6a 0f 39 95 12 07 8f  |....N6$1{j.9....|
-00000270  2a 16 03 01 00 d6 0c 00  00 d2 03 00 17 41 04 66  |*............A.f|
-00000280  aa 89 a3 0e 62 af 7e 8f  86 9e 91 b6 54 c9 4d 2d  |....b.~.....T.M-|
-00000290  06 2c 95 57 8b 9c 95 e5  93 08 c7 8e 44 43 14 ef  |.,.W........DC..|
-000002a0  d7 de f4 89 d4 d3 53 27  36 57 d2 25 35 b7 20 fc  |......S'6W.%5. .|
-000002b0  7b 1e d5 01 af dc 94 3d  69 ed 3e c9 97 61 53 00  |{......=i.>..aS.|
-000002c0  8b 30 81 88 02 42 01 15  d3 cf d0 80 98 16 cd ff  |.0...B..........|
-000002d0  7e 40 dc 09 06 d4 38 3b  9c 3c c1 d1 c6 eb 4c 94  |~@....8;.<....L.|
-000002e0  49 9c f8 9f c4 1f f3 23  ae 20 77 b1 47 c3 f7 85  |I......#. w.G...|
-000002f0  94 0c a4 d0 d1 47 48 35  e6 a7 18 d5 84 21 8a f2  |.....GH5.....!..|
-00000300  7f af d3 1c a3 e9 76 e1  02 42 00 81 ef 3d 55 ea  |......v..B...=U.|
-00000310  7e 38 3a 11 44 43 98 1e  0f c8 8c 71 8b 2d 97 6d  |~8:.DC.....q.-.m|
-00000320  44 dc 86 b3 02 34 01 d5  8c ce 81 b4 6e 11 c3 ed  |D....4......n...|
-00000330  66 9c ba 1d f4 51 db 8f  4a 9b 43 52 c6 99 aa 06  |f....Q..J.CR....|
-00000340  1b 6d d4 f6 a5 26 d8 86  8e 92 c8 49 16 03 01 00  |.m...&.....I....|
+00000270  2a 16 03 01 00 d6 0c 00  00 d2 03 00 17 41 04 01  |*............A..|
+00000280  74 83 af 3a 65 7a ad 1a  63 1f 13 82 9d f4 de 06  |t..:ez..c.......|
+00000290  4e 3a 03 81 61 72 ff f8  58 da 7b f5 81 6d 81 57  |N:..ar..X.{..m.W|
+000002a0  d9 d1 b1 6d e3 97 db 86  72 17 15 18 16 d4 ec 04  |...m....r.......|
+000002b0  32 7c 38 90 6b a4 3c e9  35 79 2d 4c 39 5e 2d 00  |2|8.k.<.5y-L9^-.|
+000002c0  8b 30 81 88 02 42 01 44  78 e1 2a bb 95 f7 45 58  |.0...B.Dx.*...EX|
+000002d0  d4 0d b6 e4 4e ff 48 b3  11 14 ee d5 6c bb 5f 0c  |....N.H.....l._.|
+000002e0  90 b6 ef bc 05 77 f6 05  42 b4 d8 a6 70 e6 8c 90  |.....w..B...p...|
+000002f0  f0 4b 3b c9 d3 4e 0c 85  65 b4 e0 fe b5 10 09 9b  |.K;..N..e.......|
+00000300  e1 08 84 ea 93 96 8e a4  02 42 01 c7 15 ee 9d 98  |.........B......|
+00000310  b7 25 eb 07 ff f6 94 7e  e7 9d a5 17 9e 37 93 40  |.%.....~.....7.@|
+00000320  4c 9f eb 6b a3 7a 57 d8  81 c6 d9 09 34 aa 96 8c  |L..k.zW.....4...|
+00000330  4d 28 2e 9f f7 0b 1c 09  e1 d1 d8 48 6e 8a 8e 9c  |M(.........Hn...|
+00000340  01 4c e7 2d 53 8f 8e 71  61 82 ff ff 16 03 01 00  |.L.-S..qa.......|
 00000350  0e 0d 00 00 06 03 01 02  40 00 00 0e 00 00 00     |........@......|
 >>> Flow 3 (client to server)
 00000000  16 03 01 02 0a 0b 00 02  06 00 02 03 00 02 00 30  |...............0|
@@ -102,29 +102,29 @@
 00000230  24 20 3e b2 56 1c ce 97  28 5e f8 2b 2d 4f 9e f1  |$ >.V...(^.+-O..|
 00000240  07 9f 6c 4b 5b 83 56 e2  32 42 e9 58 b6 d7 49 a6  |..lK[.V.2B.X..I.|
 00000250  b5 68 1a 41 03 56 6b dc  5a 89 16 03 01 00 91 0f  |.h.A.Vk.Z.......|
-00000260  00 00 8d 00 8b 30 81 88  02 42 00 8d 68 bb 44 5f  |.....0...B..h.D_|
-00000270  bb 5e 3b 58 02 e2 39 8c  be f0 0e 4d 9b 0a a2 d5  |.^;X..9....M....|
-00000280  8d 36 e9 ed d6 60 22 59  a5 5d 91 11 dc e0 49 d8  |.6...`"Y.]....I.|
-00000290  5c 40 63 78 7f 79 57 cd  da 35 d5 54 a8 92 2d 23  |\@cx.yW..5.T..-#|
-000002a0  95 d8 df d1 e3 af 69 46  ac b9 b8 e4 02 42 01 35  |......iF.....B.5|
-000002b0  12 86 8a 00 e2 f6 ee 2c  e0 67 96 66 3d aa 4e 55  |.......,.g.f=.NU|
-000002c0  f2 70 ff de 6a 3a e1 ed  4d 16 45 09 78 7d ac 65  |.p..j:..M.E.x}.e|
-000002d0  03 f5 f6 57 82 0d 9f 93  cb 8b 18 39 74 81 c8 4d  |...W.......9t..M|
-000002e0  e5 c3 1c 17 f1 0b 80 a0  b0 91 95 5b 29 d7 94 ed  |...........[)...|
-000002f0  14 03 01 00 01 01 16 03  01 00 30 6c a7 aa 9c 49  |..........0l...I|
-00000300  77 68 e7 da ea d6 3b b7  ba cc fe e9 9c 03 68 53  |wh....;.......hS|
-00000310  d5 88 4c 48 b3 1d a3 a3  9c 7a e6 78 3d ab ad 7c  |..LH.....z.x=..||
-00000320  66 f4 6e 3a d6 30 77 93  54 dd c2                 |f.n:.0w.T..|
+00000260  00 00 8d 00 8b 30 81 88  02 42 01 91 2d e9 99 a4  |.....0...B..-...|
+00000270  88 5c 03 9c ea 8b 64 07  f2 c9 e7 ad 5b a3 fb 27  |.\....d.....[..'|
+00000280  fd 19 9b 78 bd 7b 9d 0a  cc 8a 61 c5 83 33 02 29  |...x.{....a..3.)|
+00000290  c3 66 24 9d 5f bc 03 d9  2a 49 aa 59 51 83 49 72  |.f$._...*I.YQ.Ir|
+000002a0  13 be ea 82 5a 5c 09 2f  da 23 bc 18 02 42 01 0d  |....Z\./.#...B..|
+000002b0  a1 15 4d fe 18 ec 90 d5  4e 9a 75 60 05 67 10 5e  |..M.....N.u`.g.^|
+000002c0  3c 34 00 e8 18 33 8f 90  26 2e d3 a9 81 6c 43 17  |<4...3..&....lC.|
+000002d0  80 9e c5 bd 23 c9 24 96  a1 29 23 a4 13 3f ad d2  |....#.$..)#..?..|
+000002e0  45 19 0b 56 56 4b c1 f1  cc 70 c8 af 44 ff 34 96  |E..VVK...p..D.4.|
+000002f0  14 03 01 00 01 01 16 03  01 00 30 c4 0c 67 53 06  |..........0..gS.|
+00000300  49 b3 c9 5c 2e 72 f6 54  ba ad ac a8 80 55 17 01  |I..\.r.T.....U..|
+00000310  5c 44 71 7d ad 15 34 95  9a 7f 7b 95 0e 08 70 ce  |\Dq}..4...{...p.|
+00000320  5a 33 f4 3b 4e 80 06 43  70 93 17                 |Z3.;N..Cp..|
 >>> Flow 4 (server to client)
-00000000  14 03 01 00 01 01 16 03  01 00 30 7a 13 14 04 f6  |..........0z....|
-00000010  ea 6b 40 87 60 bd 5a bc  e8 15 5a ec 85 50 aa e4  |.k@.`.Z...Z..P..|
-00000020  81 09 3d 0b 07 1d 58 6f  d2 25 d6 62 7c c1 5e d2  |..=...Xo.%.b|.^.|
-00000030  cc 2f e3 36 3d 47 e4 d3  6b f9 3d                 |./.6=G..k.=|
+00000000  14 03 01 00 01 01 16 03  01 00 30 3b ba 6c 73 ec  |..........0;.ls.|
+00000010  11 5b 44 46 1d bb 31 1b  1b e8 d8 51 4f 95 b0 40  |.[DF..1....QO..@|
+00000020  87 49 33 73 40 98 61 1c  94 02 48 9b 80 d3 6c af  |.I3s@.a...H...l.|
+00000030  e2 31 63 11 a7 c8 db ed  7a a4 4d                 |.1c.....z.M|
 >>> Flow 5 (client to server)
-00000000  17 03 01 00 20 1c df c9  6f 16 a4 ff c3 e5 e9 0e  |.... ...o.......|
-00000010  0a 9e 2e 5d 9a f6 4e aa  9b 94 6c 3d f7 f8 a8 ad  |...]..N...l=....|
-00000020  3c b8 92 73 0f 17 03 01  00 20 2f 4a 97 67 eb 8b  |<..s..... /J.g..|
-00000030  db cc 1c 5d 21 60 e7 40  25 13 e2 e4 48 4a 65 ff  |...]!`.@%...HJe.|
-00000040  bd 11 84 2f dd 45 09 ea  6f ae 15 03 01 00 20 94  |.../.E..o..... .|
-00000050  2a 18 8a b0 34 d2 ca 69  65 ac ae 3b 8b e5 3a cd  |*...4..ie..;..:.|
-00000060  99 94 ef bb b4 31 b4 7e  d7 81 a3 03 52 3b 25     |.....1.~....R;%|
+00000000  17 03 01 00 20 2e f7 66  f0 ce 50 d7 38 7a d4 fd  |.... ..f..P.8z..|
+00000010  e3 66 b1 76 76 59 ad bc  b0 0a 75 1d f0 92 6e e3  |.f.vvY....u...n.|
+00000020  21 1d 13 dc ad 17 03 01  00 20 f1 b2 0f 3b 26 91  |!........ ...;&.|
+00000030  ed ff 9f fc 41 04 7e 47  17 02 af 0c 2b e8 b7 31  |....A.~G....+..1|
+00000040  ae 29 71 f9 a8 89 84 f3  e8 da 15 03 01 00 20 1f  |.)q........... .|
+00000050  26 64 cf 34 c1 48 6b 79  61 e2 77 57 9d 27 14 45  |&d.4.Hkya.wW.'.E|
+00000060  46 24 ad 2d 35 57 db 2b  32 03 e2 68 b0 1a 5a     |F$.-5W.+2..h..Z|
diff --git a/src/crypto/tls/testdata/Client-TLSv10-ClientCert-ECDSA-RSA b/src/crypto/tls/testdata/Client-TLSv10-ClientCert-ECDSA-RSA
index 80f576c9c1..0e420a6480 100644
--- a/src/crypto/tls/testdata/Client-TLSv10-ClientCert-ECDSA-RSA
+++ b/src/crypto/tls/testdata/Client-TLSv10-ClientCert-ECDSA-RSA
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 01 00 51 02 00 00  4d 03 01 e1 fc f6 05 2a  |....Q...M......*|
-00000010  e3 8e 5d 62 22 73 b8 7f  69 11 29 90 26 21 c2 66  |..]b"s..i.).&!.f|
-00000020  23 d9 c8 22 c0 08 c2 a6  95 ac 17 20 d6 6d e3 15  |#.."....... .m..|
-00000030  e0 e5 65 e3 45 17 e9 45  2f 90 66 81 bc 10 7a 6e  |..e.E..E/.f...zn|
-00000040  b6 3a 7e db 84 5d 59 53  d2 be 8c f4 00 05 00 00  |.:~..]YS........|
+00000000  16 03 01 00 51 02 00 00  4d 03 01 b7 de 52 5a 07  |....Q...M....RZ.|
+00000010  43 b8 72 1d d9 6f 5c a5  70 da ee 27 b7 a9 50 9d  |C.r..o\.p..'..P.|
+00000020  e7 75 ad 61 a5 2f 69 47  2a d8 2e 20 a8 b0 64 6b  |.u.a./iG*.. ..dk|
+00000030  4d 25 ec 50 2b 8e a7 9b  0c f9 f5 3c 62 96 a3 53  |M%.P+......<b..S|
+00000040  a7 4b af 33 1e e7 f8 43  b9 be 6e e7 00 05 00 00  |.K.3...C..n.....|
 00000050  05 ff 01 00 01 00 16 03  01 02 be 0b 00 02 ba 00  |................|
 00000060  02 b7 00 02 b4 30 82 02  b0 30 82 02 19 a0 03 02  |.....0...0......|
 00000070  01 02 02 09 00 85 b0 bb  a4 8a 7f b8 ca 30 0d 06  |.............0..|
@@ -103,24 +103,24 @@
 00000270  bd 77 82 6f 23 b6 e0 bd  a2 92 b7 3a ac e8 56 f1  |.w.o#......:..V.|
 00000280  af 54 5e 46 87 e9 3b 33  e7 b8 28 b7 d6 c8 90 35  |.T^F..;3..(....5|
 00000290  d4 1c 43 d1 30 6f 55 4e  0a 70 16 03 01 00 91 0f  |..C.0oUN.p......|
-000002a0  00 00 8d 00 8b 30 81 88  02 42 01 31 94 8d 30 cc  |.....0...B.1..0.|
-000002b0  aa 3c de 14 df db 93 d2  d9 27 e2 d7 95 7e f4 8b  |.<.......'...~..|
-000002c0  d5 b1 97 3f 2a b8 27 c4  ba 67 89 ea 67 91 ea 6d  |...?*.'..g..g..m|
-000002d0  6d 62 14 3c 6d b1 b1 56  7c 85 c4 a2 07 92 87 6d  |mb.<m..V|......m|
-000002e0  cb 0c d8 bb 00 2b d8 2f  3f fc ad 1d 02 42 01 43  |.....+./?....B.C|
-000002f0  38 74 04 2c 90 25 1c 43  b0 78 35 af 8f 1d 62 27  |8t.,.%.C.x5...b'|
-00000300  bf 0a 68 b3 20 2e 3f 90  f3 d4 61 b4 8f 67 de 35  |..h. .?...a..g.5|
-00000310  28 92 5c 9d 8b 33 82 ac  0d e3 7d 92 52 9c 78 25  |(.\..3....}.R.x%|
-00000320  bb e6 21 85 6e 70 63 03  06 51 24 db 15 1e ac 82  |..!.npc..Q$.....|
-00000330  14 03 01 00 01 01 16 03  01 00 24 c0 9a a8 1b 4b  |..........$....K|
-00000340  49 19 62 7d 25 4f bf c8  1c 96 93 fd 46 48 8f 6b  |I.b}%O......FH.k|
-00000350  31 05 3b 35 22 42 ba 72  de 9d 85 76 e8 98 53     |1.;5"B.r...v..S|
+000002a0  00 00 8d 00 8b 30 81 88  02 42 00 b5 1a 9d 48 90  |.....0...B....H.|
+000002b0  2f d9 1a 04 66 f7 3b 4d  d7 ae d9 1e dd 3c fa 24  |/...f.;M.....<.$|
+000002c0  0f 24 97 b2 61 46 16 d9  a0 35 f9 f7 54 45 92 fd  |.$..aF...5..TE..|
+000002d0  10 56 ab 26 d7 b5 10 80  8b 88 95 ef c6 73 1c d2  |.V.&.........s..|
+000002e0  ff e9 20 cd 18 a8 40 c4  4d 83 c2 e2 02 42 01 8c  |.. ...@.M....B..|
+000002f0  d2 13 4c cc e5 38 37 17  6c 83 d6 ad c1 dc af ec  |..L..87.l.......|
+00000300  8d 06 75 b8 08 ad 56 4a  8f b9 03 59 80 f8 81 d4  |..u...VJ...Y....|
+00000310  f3 91 89 eb 9c 27 5d e1  dc 6d ef d6 20 da e7 9c  |.....']..m.. ...|
+00000320  71 75 cb 2a f9 e4 05 46  c8 85 ca 7b 9c 97 e8 6d  |qu.*...F...{...m|
+00000330  14 03 01 00 01 01 16 03  01 00 24 9f 67 4e 22 04  |..........$.gN".|
+00000340  10 f4 28 55 3e 50 88 90  61 07 42 29 f5 9b f5 32  |..(U>P..a.B)...2|
+00000350  16 3d ea c1 8f aa a1 4c  b5 72 26 d8 32 cd 50     |.=.....L.r&.2.P|
 >>> Flow 4 (server to client)
-00000000  14 03 01 00 01 01 16 03  01 00 24 f3 9c e5 c4 59  |..........$....Y|
-00000010  46 e8 1e 97 95 4e 5b 4e  e9 38 25 57 5c a5 23 66  |F....N[N.8%W\.#f|
-00000020  4a c6 c7 a1 8b f8 00 dc  44 da 4c 1b d4 42 c3     |J.......D.L..B.|
+00000000  14 03 01 00 01 01 16 03  01 00 24 df 8d f1 07 6d  |..........$....m|
+00000010  63 39 fc ba b1 67 3b 68  85 b9 37 7d d3 67 19 76  |c9...g;h..7}.g.v|
+00000020  34 a4 1b 86 31 bd fe 06  72 00 d8 2b f2 65 3d     |4...1...r..+.e=|
 >>> Flow 5 (client to server)
-00000000  17 03 01 00 1a 22 0a ba  84 61 7b 18 e0 f3 c6 53  |....."...a{....S|
-00000010  f4 82 6d 03 dc d7 c5 c3  c8 6e bf be a2 dc 73 15  |..m......n....s.|
-00000020  03 01 00 16 11 1b cc 6f  58 c4 fc ca 0a ff fd a4  |.......oX.......|
-00000030  12 45 c6 81 78 17 73 52  ce b3                    |.E..x.sR..|
+00000000  17 03 01 00 1a 60 cc 81  4f 8b 73 b3 7f 34 bf f1  |.....`..O.s..4..|
+00000010  7c d8 32 0a ef 2a 26 f9  b8 69 84 83 48 21 ee 15  ||.2..*&..i..H!..|
+00000020  03 01 00 16 23 7a 0c 65  3a 66 1a 75 03 e4 85 3f  |....#z.e:f.u...?|
+00000030  83 cd 55 70 99 f4 44 dc  67 ba                    |..Up..D.g.|
diff --git a/src/crypto/tls/testdata/Client-TLSv10-ClientCert-RSA-ECDSA b/src/crypto/tls/testdata/Client-TLSv10-ClientCert-RSA-ECDSA
index 4aa6d80517..7e33edc189 100644
--- a/src/crypto/tls/testdata/Client-TLSv10-ClientCert-RSA-ECDSA
+++ b/src/crypto/tls/testdata/Client-TLSv10-ClientCert-RSA-ECDSA
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 01 00 59 02 00 00  55 03 01 f0 45 fd 0c 7b  |....Y...U...E..{|
-00000010  34 08 a5 2c 41 57 7c ef  54 b1 11 a4 88 c4 8b b7  |4..,AW|.T.......|
-00000020  37 ff 64 e8 e9 49 59 62  30 07 50 20 6e cc 00 df  |7.d..IYb0.P n...|
-00000030  d4 5c f4 64 ce 63 7c 86  89 9a 6f 41 c6 e7 0a e9  |.\.d.c|...oA....|
-00000040  5b 46 c4 a2 fd b3 13 dc  e4 2c b2 80 c0 09 00 00  |[F.......,......|
+00000000  16 03 01 00 59 02 00 00  55 03 01 dc a9 22 c2 a2  |....Y...U...."..|
+00000010  05 ba c4 66 9a 71 aa 0f  92 6a fc df b0 29 4d 36  |...f.q...j...)M6|
+00000020  39 2e f8 39 ed 8e f6 7f  8f 17 13 20 f8 9c f3 3d  |9..9....... ...=|
+00000030  0a 41 8f 30 c7 5d cd 17  c5 ad 1c 52 45 a3 47 8c  |.A.0.].....RE.G.|
+00000040  07 4c 48 e1 00 2b 32 38  01 c8 79 b7 c0 09 00 00  |.LH..+28..y.....|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  01 02 0e 0b 00 02 0a 00  02 07 00 02 04 30 82 02  |.............0..|
 00000070  00 30 82 01 62 02 09 00  b8 bf 2d 47 a0 d2 eb f4  |.0..b.....-G....|
@@ -48,20 +48,20 @@
 00000240  13 83 0d 94 06 bb d4 37  7a f6 ec 7a c9 86 2e dd  |.......7z..z....|
 00000250  d7 11 69 7f 85 7c 56 de  fb 31 78 2b e4 c7 78 0d  |..i..|V..1x+..x.|
 00000260  ae cb be 9e 4e 36 24 31  7b 6a 0f 39 95 12 07 8f  |....N6$1{j.9....|
-00000270  2a 16 03 01 00 d5 0c 00  00 d1 03 00 17 41 04 95  |*............A..|
-00000280  cd 51 ea 04 1b ba ca 31  b8 01 60 6c 20 45 31 03  |.Q.....1..`l E1.|
-00000290  03 5f 9f 9d 04 b8 8e 82  7a 4d fd 3e 48 40 ea 5c  |._......zM.>H@.\|
-000002a0  cb d5 4b 2b 2b df bd 38  c7 c8 33 5e 75 2e 88 1a  |..K++..8..3^u...|
-000002b0  4a e3 40 ed ad 79 32 3f  ea 23 d5 a0 26 57 b2 00  |J.@..y2?.#..&W..|
-000002c0  8a 30 81 87 02 42 01 9e  d5 0a 85 a4 ad 7d c2 8a  |.0...B.......}..|
-000002d0  ba 0b 21 4c 97 df 57 dd  59 cf 89 32 ff 9d 9c c5  |..!L..W.Y..2....|
-000002e0  30 a1 fe 58 fa ab 18 41  8e d2 82 6b 5c 07 89 96  |0..X...A...k\...|
-000002f0  5a d3 a4 62 48 16 24 a1  ce 17 ea 72 62 e5 b2 9e  |Z..bH.$....rb...|
-00000300  8c 27 ac 6c 62 d7 0c 2d  02 41 13 73 90 e0 cb 0f  |.'.lb..-.A.s....|
-00000310  49 5f b3 20 a5 1b ff b4  6a ea 3b 4c 0b d8 2a da  |I_. ....j.;L..*.|
-00000320  44 49 be 16 6a 8b 13 02  88 5e 4c 17 40 4a 1a 38  |DI..j....^L.@J.8|
-00000330  91 82 fa d9 5c 40 04 d6  59 4c d1 9a 04 5a 97 8d  |....\@..YL...Z..|
-00000340  b0 5b 4b e7 da ea ad f0  a8 39 f9 16 03 01 00 0e  |.[K......9......|
+00000270  2a 16 03 01 00 d5 0c 00  00 d1 03 00 17 41 04 89  |*............A..|
+00000280  95 9a 90 82 59 ab 29 bf  10 06 8c 6c 0d 67 cf b1  |....Y.)....l.g..|
+00000290  66 8b 5e 43 b8 46 56 3a  8d 30 92 35 28 82 f2 38  |f.^C.FV:.0.5(..8|
+000002a0  6e 19 5d 37 f0 ab fc 78  15 6a 6a 73 ca dc a6 f2  |n.]7...x.jjs....|
+000002b0  68 5d b3 ab 6d 68 44 3b  80 d2 d9 cd 78 0a ed 00  |h]..mhD;....x...|
+000002c0  8a 30 81 87 02 42 01 80  63 4a 22 4c 8e 66 4e 25  |.0...B..cJ"L.fN%|
+000002d0  e1 86 27 81 de eb b3 a0  c4 dc dc e2 a0 94 2a b6  |..'...........*.|
+000002e0  b3 e9 e7 42 e1 1d 1a c0  43 8d a1 d6 8d 77 84 06  |...B....C....w..|
+000002f0  ba 95 99 e3 54 80 59 4e  3c fb 0c f3 b7 d3 a8 d2  |....T.YN<.......|
+00000300  ce 49 97 fb e2 79 91 93  02 41 2b 2c b7 9f 81 ea  |.I...y...A+,....|
+00000310  de 17 12 af 4d 20 bc a1  43 1d 60 a0 37 52 a2 7b  |....M ..C.`.7R.{|
+00000320  a8 4c de fd 1d fe 37 3b  00 23 61 ce d2 80 47 43  |.L....7;.#a...GC|
+00000330  b0 3a f3 1f aa c7 07 b1  68 5b d8 f3 03 a9 56 5c  |.:......h[....V\|
+00000340  63 ef 83 1d 9c 9c 8d 29  81 e9 3b 16 03 01 00 0e  |c......)..;.....|
 00000350  0d 00 00 06 03 01 02 40  00 00 0e 00 00 00        |.......@......|
 >>> Flow 3 (client to server)
 00000000  16 03 01 01 fb 0b 00 01  f7 00 01 f4 00 01 f1 30  |...............0|
@@ -101,29 +101,29 @@
 00000220  a7 24 20 3e b2 56 1c ce  97 28 5e f8 2b 2d 4f 9e  |.$ >.V...(^.+-O.|
 00000230  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000240  a6 b5 68 1a 41 03 56 6b  dc 5a 89 16 03 01 00 86  |..h.A.Vk.Z......|
-00000250  0f 00 00 82 00 80 4b d2  ef 33 07 cc fb b4 e8 0f  |......K..3......|
-00000260  10 5d 42 29 2b d8 b2 45  1d 5f 83 b5 48 79 f8 78  |.]B)+..E._..Hy.x|
-00000270  a6 6b 46 22 46 7b da 57  63 10 8e c7 fa a4 20 f7  |.kF"F{.Wc..... .|
-00000280  9d 82 51 06 9e b7 18 ac  a7 8f 91 c6 57 a4 2f 86  |..Q.........W./.|
-00000290  c3 ed 64 3a e8 2c a4 de  c3 8e c0 7b ef 32 a8 7b  |..d:.,.....{.2.{|
-000002a0  c5 69 b1 4f 96 9e a5 34  9c 18 0c 42 7f 4f b8 17  |.i.O...4...B.O..|
-000002b0  cc 75 66 8f 80 5d d5 53  0f a3 fc 60 39 05 4b 7f  |.uf..].S...`9.K.|
-000002c0  59 f2 57 50 fe 4d 36 14  8e 6c b2 56 eb b6 dd 0c  |Y.WP.M6..l.V....|
-000002d0  29 77 1f d1 76 58 14 03  01 00 01 01 16 03 01 00  |)w..vX..........|
-000002e0  30 e5 e6 54 c4 fc 21 54  55 78 5e 5f f9 7b d1 94  |0..T..!TUx^_.{..|
-000002f0  1a bf 11 27 cc d8 4a 45  67 fa 95 9a 5e 0d 34 0c  |...'..JEg...^.4.|
-00000300  49 0a a6 60 26 2e a0 f5  a2 c1 04 23 3d 57 36 ac  |I..`&......#=W6.|
-00000310  2d                                                |-|
+00000250  0f 00 00 82 00 80 0e 80  9c 3a 6e 40 51 09 39 d4  |.........:n@Q.9.|
+00000260  40 58 10 da 7f 32 12 08  9e f0 4d 9a d7 20 a2 9c  |@X...2....M.. ..|
+00000270  b0 95 3a 33 4e f8 b1 a3  74 62 ab 51 7d 23 d4 32  |..:3N...tb.Q}#.2|
+00000280  a2 af b8 5a 3b b0 23 e4  7a f1 eb 4d b7 bb 23 d5  |...Z;.#.z..M..#.|
+00000290  a9 0d b4 81 d2 b4 45 bd  15 52 ad 58 da 92 a2 c4  |......E..R.X....|
+000002a0  30 66 87 f2 ae c5 e4 8c  fa ba a0 40 76 b8 3f 72  |0f.........@v.?r|
+000002b0  2a d9 95 2a 2d c6 05 3c  1e 2f 11 ef c5 3c 11 e4  |*..*-..<./...<..|
+000002c0  be 5a de 37 43 7f 74 52  6e ee 3c 39 cc f1 14 05  |.Z.7C.tRn.<9....|
+000002d0  2d 91 c2 3d c4 7c 14 03  01 00 01 01 16 03 01 00  |-..=.|..........|
+000002e0  30 cd 3c 92 f8 b9 36 7a  e7 8a fb 0f 2f b8 2c 7b  |0.<...6z..../.,{|
+000002f0  10 59 45 14 0a b0 6a 8c  31 b2 89 5b ac 19 dc 12  |.YE...j.1..[....|
+00000300  73 8c 8c 10 49 5a bf 9f  bc 58 82 32 11 ba c5 38  |s...IZ...X.2...8|
+00000310  ff                                                |.|
 >>> Flow 4 (server to client)
-00000000  14 03 01 00 01 01 16 03  01 00 30 35 60 71 60 83  |..........05`q`.|
-00000010  d9 7c 2a 4d 1f 77 94 aa  7a 5b c1 62 95 9a 97 54  |.|*M.w..z[.b...T|
-00000020  39 b0 65 87 1b 12 28 99  07 70 b8 7c 10 94 69 93  |9.e...(..p.|..i.|
-00000030  30 37 bf f4 87 c7 e0 69  0e 75 e5                 |07.....i.u.|
+00000000  14 03 01 00 01 01 16 03  01 00 30 da 45 99 fe 52  |..........0.E..R|
+00000010  4f cd d0 e6 30 19 f4 bd  80 6d 5c 8a 72 03 d3 88  |O...0....m\.r...|
+00000020  38 63 e9 c9 39 ee ab 3f  52 26 84 b0 4d cb 5c a4  |8c..9..?R&..M.\.|
+00000030  0d 51 c7 47 48 43 3a bf  89 c7 13                 |.Q.GHC:....|
 >>> Flow 5 (client to server)
-00000000  17 03 01 00 20 10 f4 8d  d4 50 ca 0c a0 c4 ea 18  |.... ....P......|
-00000010  ef fb f8 c7 62 38 d5 e9  d6 03 5f 6d 41 d5 36 bf  |....b8...._mA.6.|
-00000020  fc c9 6e 85 3b 17 03 01  00 20 8d 96 f6 e0 5f c6  |..n.;.... ...._.|
-00000030  c5 93 f9 0b 14 05 be d3  92 9a 8c 98 1c 63 5b dd  |.............c[.|
-00000040  15 ef 90 4d 46 a6 af 34  b2 08 15 03 01 00 20 8a  |...MF..4...... .|
-00000050  dc e8 c7 55 02 36 fe 48  bd 9b cf 63 da ec 81 9b  |...U.6.H...c....|
-00000060  54 be 43 ce 19 ab b3 c9  60 53 13 55 58 31 73     |T.C.....`S.UX1s|
+00000000  17 03 01 00 20 4d d9 1d  0d 3d 8b 73 91 b9 4e 5e  |.... M...=.s..N^|
+00000010  35 71 4f 67 79 d2 f7 39  35 ea 23 d0 6d 64 de a5  |5qOgy..95.#.md..|
+00000020  59 fb 75 1f c9 17 03 01  00 20 ba bd 3c b4 d7 be  |Y.u...... ..<...|
+00000030  24 64 68 1e 8c b2 bf 6f  78 9f ad 7f fa dd 89 a6  |$dh....ox.......|
+00000040  f9 e7 5e 70 db e9 db 3a  62 b2 15 03 01 00 20 2a  |..^p...:b..... *|
+00000050  82 f4 8b 45 fc 76 35 6c  54 48 62 2f 52 55 f2 d9  |...E.v5lTHb/RU..|
+00000060  99 b2 b5 2d 5f a0 05 ab  f1 93 58 75 4a 87 35     |...-_.....XuJ.5|
diff --git a/src/crypto/tls/testdata/Client-TLSv10-ClientCert-RSA-RSA b/src/crypto/tls/testdata/Client-TLSv10-ClientCert-RSA-RSA
index 32cb457be3..9b1a5533ac 100644
--- a/src/crypto/tls/testdata/Client-TLSv10-ClientCert-RSA-RSA
+++ b/src/crypto/tls/testdata/Client-TLSv10-ClientCert-RSA-RSA
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 01 00 51 02 00 00  4d 03 01 36 ad 48 bc e4  |....Q...M..6.H..|
-00000010  9e 09 3e 1f 02 c6 4d 8a  44 c4 8c 17 9f 85 7e 99  |..>...M.D.....~.|
-00000020  72 d4 aa d1 2a 0b 74 bf  37 59 b2 20 86 a4 23 d8  |r...*.t.7Y. ..#.|
-00000030  e1 66 16 72 87 ad b5 c8  58 05 a8 c2 6c 4e eb 3c  |.f.r....X...lN.<|
-00000040  1c fb 5e 61 34 6e 0b d5  c7 ce 4d 83 00 05 00 00  |..^a4n....M.....|
+00000000  16 03 01 00 51 02 00 00  4d 03 01 90 e6 e1 c6 bd  |....Q...M.......|
+00000010  86 08 db 33 94 f3 bd 0b  2d fc e0 ba 89 a7 c5 66  |...3....-......f|
+00000020  a5 19 78 33 2b b9 c4 22  d8 e0 63 20 2e 85 53 25  |..x3+.."..c ..S%|
+00000030  f2 22 e3 ca 79 94 9e 50  00 13 da 9d 21 33 49 27  |."..y..P....!3I'|
+00000040  9b 44 c5 10 bc e8 44 01  04 31 02 81 00 05 00 00  |.D....D..1......|
 00000050  05 ff 01 00 01 00 16 03  01 02 be 0b 00 02 ba 00  |................|
 00000060  02 b7 00 02 b4 30 82 02  b0 30 82 02 19 a0 03 02  |.....0...0......|
 00000070  01 02 02 09 00 85 b0 bb  a4 8a 7f b8 ca 30 0d 06  |.............0..|
@@ -102,24 +102,24 @@
 00000260  e6 bd 77 82 6f 23 b6 e0  bd a2 92 b7 3a ac e8 56  |..w.o#......:..V|
 00000270  f1 af 54 5e 46 87 e9 3b  33 e7 b8 28 b7 d6 c8 90  |..T^F..;3..(....|
 00000280  35 d4 1c 43 d1 30 6f 55  4e 0a 70 16 03 01 00 86  |5..C.0oUN.p.....|
-00000290  0f 00 00 82 00 80 31 5d  f2 d2 f9 c7 65 8a 70 7f  |......1]....e.p.|
-000002a0  ce fb b6 8e 0d ea 1b 9b  1c e2 81 e4 95 c1 09 71  |...............q|
-000002b0  48 4b 0d 13 a0 98 2d 8e  13 5a 36 c7 62 a3 7c af  |HK....-..Z6.b.|.|
-000002c0  bb 2f d2 b1 df fd a6 8a  35 ab 3c c5 fb 11 72 14  |./......5.<...r.|
-000002d0  7b ec 02 d8 34 ef fc b9  c2 03 70 1d 88 27 fb 54  |{...4.....p..'.T|
-000002e0  a6 68 dc 3d f4 78 b9 a5  87 06 a7 a5 63 51 11 6f  |.h.=.x......cQ.o|
-000002f0  9b 31 aa 45 e0 cb bf ad  16 b9 4d e1 e8 41 18 12  |.1.E......M..A..|
-00000300  12 e4 b5 2c 27 03 23 bb  70 cd f0 23 c5 3d 50 b9  |...,'.#.p..#.=P.|
-00000310  06 2d 7d 9f 58 25 14 03  01 00 01 01 16 03 01 00  |.-}.X%..........|
-00000320  24 b5 b9 40 ad b8 89 b9  22 61 12 4c 54 98 7b d5  |$..@...."a.LT.{.|
-00000330  72 20 ca fb 73 a3 e0 cb  52 09 03 9f e4 93 09 28  |r ..s...R......(|
-00000340  02 db 8a e7 12                                    |.....|
+00000290  0f 00 00 82 00 80 10 19  57 14 c3 ee 2d da cb de  |........W...-...|
+000002a0  f3 70 c5 62 91 2f ad 62  dd 10 f1 65 20 a2 cf d5  |.p.b./.b...e ...|
+000002b0  cd 6d 5f e4 b3 3e 38 e8  d0 1a f7 f0 e7 7e b6 5d  |.m_..>8......~.]|
+000002c0  c3 6c ad f6 0d 05 1e 41  35 2d 04 15 3c 36 96 00  |.l.....A5-..<6..|
+000002d0  e8 02 b2 01 b8 9f 21 4b  34 85 ef 5e 4c 87 ef 49  |......!K4..^L..I|
+000002e0  df d1 9a b6 b2 bd b8 90  fd 3f 31 93 0c dc c7 18  |.........?1.....|
+000002f0  ff f6 76 bd 5b 74 76 b3  62 87 6a df ff 63 15 d5  |..v.[tv.b.j..c..|
+00000300  94 d5 fe fd 4c 12 df f1  35 07 f1 8a f1 77 7a 35  |....L...5....wz5|
+00000310  cd 99 1d 2a d7 9a 14 03  01 00 01 01 16 03 01 00  |...*............|
+00000320  24 8d db 0c 87 b5 df fd  68 de fe 46 3e e4 41 b5  |$.......h..F>.A.|
+00000330  19 64 68 3c c4 e2 2b 43  50 e4 ee 52 75 34 d3 c1  |.dh<..+CP..Ru4..|
+00000340  51 18 c0 b2 5f                                    |Q..._|
 >>> Flow 4 (server to client)
-00000000  14 03 01 00 01 01 16 03  01 00 24 d1 cb e3 a0 b5  |..........$.....|
-00000010  38 9e 39 4c b5 5f cd eb  d8 4e 29 9e 7e cf fd dd  |8.9L._...N).~...|
-00000020  a8 f1 9e 03 64 61 e7 20  d2 6d fc 14 8d e1 d9     |....da. .m.....|
+00000000  14 03 01 00 01 01 16 03  01 00 24 0b a4 04 46 60  |..........$...F`|
+00000010  15 fb 9a 9f 47 51 6d b4  4b c6 e7 2a 1b 98 b4 8a  |....GQm.K..*....|
+00000020  8a 1a 03 cf f4 16 7d 80  70 27 e5 e8 d5 9f ad     |......}.p'.....|
 >>> Flow 5 (client to server)
-00000000  17 03 01 00 1a f9 73 04  45 ca 7c 71 75 fe c2 8b  |......s.E.|qu...|
-00000010  41 09 ff 4b 79 2b ec b0  d3 ad f4 d9 8b 0c 70 15  |A..Ky+........p.|
-00000020  03 01 00 16 4a 70 2a a1  2f 3c 1f 6f 23 15 35 a8  |....Jp*./<.o#.5.|
-00000030  12 08 07 c1 0f f2 13 55  b4 d8                    |.......U..|
+00000000  17 03 01 00 1a 6f 84 50  27 c7 f1 aa b0 04 7d 80  |.....o.P'.....}.|
+00000010  6d a7 20 8a 73 cf d9 de  9a d6 f5 e9 36 13 7c 15  |m. .s.......6.|.|
+00000020  03 01 00 16 e8 0b e0 a6  3b 1e 21 24 65 4e 49 b2  |........;.!$eNI.|
+00000030  2d a3 41 2b 98 23 4e d5  4b fd                    |-.A+.#N.K.|
diff --git a/src/crypto/tls/testdata/Client-TLSv10-ECDHE-ECDSA-AES b/src/crypto/tls/testdata/Client-TLSv10-ECDHE-ECDSA-AES
index 6a6fb0599c..937c2909f9 100644
--- a/src/crypto/tls/testdata/Client-TLSv10-ECDHE-ECDSA-AES
+++ b/src/crypto/tls/testdata/Client-TLSv10-ECDHE-ECDSA-AES
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 01 00 59 02 00 00  55 03 01 0b ed c6 10 bb  |....Y...U.......|
-00000010  d6 01 89 bd 70 f2 ac 4f  65 2d 6f 62 3c bc 88 c9  |....p..Oe-ob<...|
-00000020  51 25 2b c4 bd cc c2 c5  5f 3e c1 20 ad 6f 8d 1f  |Q%+....._>. .o..|
-00000030  a5 c5 41 8e 11 1c 63 94  6e 1f 63 68 fd 18 d2 c8  |..A...c.n.ch....|
-00000040  8c 17 14 8a 89 42 0f 02  c1 19 7e 1a c0 09 00 00  |.....B....~.....|
+00000000  16 03 01 00 59 02 00 00  55 03 01 f5 8f 8d 8e ca  |....Y...U.......|
+00000010  30 6b fe 63 c9 84 57 c0  f1 c8 a5 d8 10 56 14 62  |0k.c..W......V.b|
+00000020  c8 02 b2 89 21 5c 09 67  86 d8 9b 20 dc 3f 55 54  |....!\.g... .?UT|
+00000030  33 29 47 45 d3 e0 87 1a  4b 1b 75 30 89 e0 4d 01  |3)GE....K.u0..M.|
+00000040  a1 6a 46 f7 8f 23 d6 74  fd 90 2f 53 c0 09 00 00  |.jF..#.t../S....|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  01 02 0e 0b 00 02 0a 00  02 07 00 02 04 30 82 02  |.............0..|
 00000070  00 30 82 01 62 02 09 00  b8 bf 2d 47 a0 d2 eb f4  |.0..b.....-G....|
@@ -48,20 +48,20 @@
 00000240  13 83 0d 94 06 bb d4 37  7a f6 ec 7a c9 86 2e dd  |.......7z..z....|
 00000250  d7 11 69 7f 85 7c 56 de  fb 31 78 2b e4 c7 78 0d  |..i..|V..1x+..x.|
 00000260  ae cb be 9e 4e 36 24 31  7b 6a 0f 39 95 12 07 8f  |....N6$1{j.9....|
-00000270  2a 16 03 01 00 d5 0c 00  00 d1 03 00 17 41 04 95  |*............A..|
-00000280  13 2e d8 9d 00 71 1b a5  a7 ee 0f bd e8 46 6c b5  |.....q.......Fl.|
-00000290  63 ba 88 49 80 98 ca 15  79 50 75 62 19 33 84 4f  |c..I....yPub.3.O|
-000002a0  fb f4 5c 94 20 25 61 81  d4 c8 d5 fa 23 53 84 cb  |..\. %a.....#S..|
-000002b0  84 68 38 93 b7 b4 6f b9  83 a8 1b ed 45 fd 9f 00  |.h8...o.....E...|
-000002c0  8a 30 81 87 02 42 01 aa  42 6b 9a ab 46 81 36 eb  |.0...B..Bk..F.6.|
-000002d0  95 0f 15 d8 32 51 37 cd  4d 4b f6 a1 ef cf f9 c4  |....2Q7.MK......|
-000002e0  91 76 be c3 37 a8 6f de  9e ad c5 8f 1d 50 96 c4  |.v..7.o......P..|
-000002f0  0a bf c7 24 1b 62 e2 cb  db 96 e2 9e 40 4b 2f 0a  |...$.b......@K/.|
-00000300  96 f9 83 2e c2 a1 9a 27  02 41 39 2b d6 f5 b5 2b  |.......'.A9+...+|
-00000310  76 5b fa 88 e8 a2 d9 c9  aa b9 a4 33 85 f3 d1 87  |v[.........3....|
-00000320  b3 4c e4 73 63 55 20 f4  f6 2c 32 33 5a a8 e8 41  |.L.scU ..,23Z..A|
-00000330  13 d1 2d ef cd 86 8d 98  ba 52 32 bc bf c4 66 25  |..-......R2...f%|
-00000340  62 22 53 59 5f 64 15 ed  5a 31 89 16 03 01 00 04  |b"SY_d..Z1......|
+00000270  2a 16 03 01 00 d5 0c 00  00 d1 03 00 17 41 04 22  |*............A."|
+00000280  8a 47 c6 d3 7a c4 30 a4  8e 41 11 ac b3 2d 2f 45  |.G..z.0..A...-/E|
+00000290  61 54 9b 1f 2e 03 5d 50  eb fc 5b 44 a0 a7 48 78  |aT....]P..[D..Hx|
+000002a0  ce 14 d5 39 a7 c4 ed f5  4d 8f da 9d 71 52 69 70  |...9....M...qRip|
+000002b0  7e 52 29 ad 80 8a 19 ad  4c 5d 1c f1 22 7e 1a 00  |~R).....L].."~..|
+000002c0  8a 30 81 87 02 42 00 97  8b 6d f7 87 c1 a9 a6 55  |.0...B...m.....U|
+000002d0  0f 61 c2 f2 e1 05 26 a8  83 16 1c 0b 69 3b 95 57  |.a....&.....i;.W|
+000002e0  76 5b eb 45 7a bd 6a f1  3e a0 93 49 fa 74 32 fd  |v[.Ez.j.>..I.t2.|
+000002f0  dc 20 3a bb e3 ee 6d b8  56 aa e9 d2 7d 6a ec b7  |. :...m.V...}j..|
+00000300  0a bd aa dc d7 b0 69 65  02 41 4d 19 61 16 d8 5f  |......ie.AM.a.._|
+00000310  1d c1 32 25 15 26 eb 88  5b c1 dd 9a 12 40 fa f1  |..2%.&..[....@..|
+00000320  81 5e 7d b8 2b 6e 60 63  1a 9e 86 cb d5 64 96 d4  |.^}.+n`c.....d..|
+00000330  75 fc 02 33 e0 66 60 b2  40 47 cf e6 6d 25 9c 83  |u..3.f`.@G..m%..|
+00000340  23 d3 4b e2 eb ac f1 56  44 f8 3f 16 03 01 00 04  |#.K....VD.?.....|
 00000350  0e 00 00 00                                       |....|
 >>> Flow 3 (client to server)
 00000000  16 03 01 00 46 10 00 00  42 41 04 1e 18 37 ef 0d  |....F...BA...7..|
@@ -69,20 +69,20 @@
 00000020  a7 24 20 3e b2 56 1c ce  97 28 5e f8 2b 2d 4f 9e  |.$ >.V...(^.+-O.|
 00000030  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000040  a6 b5 68 1a 41 03 56 6b  dc 5a 89 14 03 01 00 01  |..h.A.Vk.Z......|
-00000050  01 16 03 01 00 30 7f f0  e3 39 82 31 46 e3 5a cc  |.....0...9.1F.Z.|
-00000060  68 40 83 69 37 1b 8e d5  30 34 6f ab 23 91 3f 2c  |h@.i7...04o.#.?,|
-00000070  bd 0d 89 d9 d9 c9 11 64  54 02 e1 fc d2 5e a4 07  |.......dT....^..|
-00000080  88 de c5 5e ab 1b                                 |...^..|
+00000050  01 16 03 01 00 30 cc 86  f1 7e 6e a8 c9 b5 02 5f  |.....0...~n...._|
+00000060  fb b2 3b ea 74 bf a8 da  e4 6a 69 50 a2 5a 78 4f  |..;.t....jiP.ZxO|
+00000070  35 e1 cc 87 c3 fb 1f 5e  f6 a4 5c 63 cc 59 12 3e  |5......^..\c.Y.>|
+00000080  07 c3 a8 d7 87 ba                                 |......|
 >>> Flow 4 (server to client)
-00000000  14 03 01 00 01 01 16 03  01 00 30 e0 39 c9 77 b6  |..........0.9.w.|
-00000010  cb 9a eb e5 47 c4 d7 5f  42 22 6d 0d c8 23 9a b5  |....G.._B"m..#..|
-00000020  bb 56 38 f8 6e de fd b5  0d d2 28 d0 ee 38 ad 76  |.V8.n.....(..8.v|
-00000030  b7 83 f7 6b 21 89 de b9  65 e9 77                 |...k!...e.w|
+00000000  14 03 01 00 01 01 16 03  01 00 30 e8 b6 20 b9 c1  |..........0.. ..|
+00000010  07 38 38 bb 42 b2 b2 a1  c5 8d 92 62 db 67 ab fc  |.88.B......b.g..|
+00000020  f6 64 3f 71 83 1d a0 86  bb 2d e3 4f 65 d5 44 52  |.d?q.....-.Oe.DR|
+00000030  4d f5 62 80 3c af 95 87  19 7c 20                 |M.b.<....| |
 >>> Flow 5 (client to server)
-00000000  17 03 01 00 20 36 a7 d4  98 b5 2a 24 ca 98 34 4d  |.... 6....*$..4M|
-00000010  59 0c d4 03 04 02 23 17  4b a4 77 68 45 1e c0 74  |Y.....#.K.whE..t|
-00000020  c3 e7 7d 97 d4 17 03 01  00 20 cb d5 ac 68 dd 5a  |..}...... ...h.Z|
-00000030  41 a7 86 c5 7e 1e 51 51  4e d5 c8 03 3f ee 69 39  |A...~.QQN...?.i9|
-00000040  87 8e a1 20 8f af 99 8a  cb 9f 15 03 01 00 20 a7  |... .......... .|
-00000050  77 e8 00 f1 71 89 49 6d  87 c6 20 19 bc cf 52 42  |w...q.Im.. ...RB|
-00000060  72 78 4c cd 1d 6d a1 cc  ab 6f b5 ea 87 a6 b4     |rxL..m...o.....|
+00000000  17 03 01 00 20 bd 65 61  28 e5 ea 1b 81 db 75 92  |.... .ea(.....u.|
+00000010  ad a7 3b 01 a3 23 0e 3b  60 10 8a 1e 04 91 fb 9e  |..;..#.;`.......|
+00000020  7a cf 1f cf 9c 17 03 01  00 20 87 9c dc ed 0d 08  |z........ ......|
+00000030  56 40 23 8b c5 2c d8 7e  42 82 3c 0a c9 f3 77 6d  |V@#..,.~B.<...wm|
+00000040  8d 9a 30 d1 9c c4 ae 04  fb b7 15 03 01 00 20 f7  |..0........... .|
+00000050  f0 12 0d e5 03 c1 80 4e  7e 21 d7 75 55 1c 91 89  |.......N~!.uU...|
+00000060  e7 e1 45 fc 7d d8 fc b1  d0 e7 dc e2 4c ba f4     |..E.}.......L..|
diff --git a/src/crypto/tls/testdata/Client-TLSv10-ECDHE-RSA-AES b/src/crypto/tls/testdata/Client-TLSv10-ECDHE-RSA-AES
index 043d1f7537..f8183f1035 100644
--- a/src/crypto/tls/testdata/Client-TLSv10-ECDHE-RSA-AES
+++ b/src/crypto/tls/testdata/Client-TLSv10-ECDHE-RSA-AES
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 01 00 59 02 00 00  55 03 01 e7 24 a6 8c 53  |....Y...U...$..S|
-00000010  c3 bc fc 86 68 75 5c f7  36 0b b1 ff 7d 25 16 70  |....hu\.6...}%.p|
-00000020  18 a0 64 d8 9f 65 3b 3e  6b 48 52 20 7c 86 b4 4a  |..d..e;>kHR |..J|
-00000030  64 b2 6b ee 72 d8 36 fb  f5 5c e3 7e 1b 3a ff 69  |d.k.r.6..\.~.:.i|
-00000040  b7 3d 92 48 c7 a1 c6 9f  69 ab 8a 3d c0 13 00 00  |.=.H....i..=....|
+00000000  16 03 01 00 59 02 00 00  55 03 01 5c 69 d0 60 d6  |....Y...U..\i.`.|
+00000010  b3 f4 23 19 5e 3e 26 d8  29 ea c3 94 e4 ed 51 f6  |..#.^>&.).....Q.|
+00000020  58 a2 e3 9c 79 a1 0b 6d  29 90 32 20 23 5b 47 b1  |X...y..m).2 #[G.|
+00000030  8f 22 bc 06 aa ee f7 c3  97 ca 93 df b1 90 7d b4  |."............}.|
+00000040  8c c0 d9 54 35 ca 5b 11  98 37 84 ea c0 13 00 00  |...T5.[..7......|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  01 02 be 0b 00 02 ba 00  02 b7 00 02 b4 30 82 02  |.............0..|
 00000070  b0 30 82 02 19 a0 03 02  01 02 02 09 00 85 b0 bb  |.0..............|
@@ -59,40 +59,40 @@
 000002f0  5f 33 c4 b6 d8 c9 75 90  96 8c 0f 52 98 b5 cd 98  |_3....u....R....|
 00000300  1f 89 20 5f f2 a0 1c a3  1b 96 94 dd a9 fd 57 e9  |.. _..........W.|
 00000310  70 e8 26 6d 71 99 9b 26  6e 38 50 29 6c 90 a7 bd  |p.&mq..&n8P)l...|
-00000320  d9 16 03 01 00 cb 0c 00  00 c7 03 00 17 41 04 33  |.............A.3|
-00000330  62 6e b1 57 74 80 ab 83  3a e0 8d ed e2 71 ae c0  |bn.Wt...:....q..|
-00000340  75 37 f1 61 dc c2 73 30  1d a8 4f 29 6d b3 49 7e  |u7.a..s0..O)m.I~|
-00000350  57 3f 71 a1 8e c2 8d c9  c0 e3 c8 cc 57 dc 47 09  |W?q.........W.G.|
-00000360  0c 48 81 97 3e 7b 3a ad  f9 64 9f 23 9e de 37 00  |.H..>{:..d.#..7.|
-00000370  80 03 83 0e 5f fe 54 4f  e1 c7 d3 41 5f 27 75 82  |...._.TO...A_'u.|
-00000380  40 f8 7c 9c 68 15 f0 7a  bc 0c 4e 40 6c a3 64 e4  |@.|.h..z..N@l.d.|
-00000390  92 54 e4 01 fd 60 2a 24  30 22 0e 5d a8 52 9e 74  |.T...`*$0".].R.t|
-000003a0  eb b6 48 70 e0 7a ad 63  65 36 27 78 90 09 3b 23  |..Hp.z.ce6'x..;#|
-000003b0  4b 9c dc 5b c5 61 17 f3  0d fc b6 6c 7f 19 92 23  |K..[.a.....l...#|
-000003c0  c7 8e d8 b2 c0 18 e8 3c  08 0b 1d 59 99 00 98 d2  |.......<...Y....|
-000003d0  35 78 be 19 a6 ac 7e 0e  91 35 17 d4 c7 88 41 ce  |5x....~..5....A.|
-000003e0  a2 60 98 b2 94 1f a6 05  20 06 90 21 d3 7e a6 e6  |.`...... ..!.~..|
-000003f0  c6 16 03 01 00 04 0e 00  00 00                    |..........|
+00000320  d9 16 03 01 00 cb 0c 00  00 c7 03 00 17 41 04 a6  |.............A..|
+00000330  57 60 8d 63 4e 4d 3f 48  e0 5d ad 9a 9c f7 e6 8c  |W`.cNM?H.]......|
+00000340  00 18 9c eb 34 ea f0 5c  d5 77 3f af 81 a9 50 d9  |....4..\.w?...P.|
+00000350  05 cf b9 bf 88 5c 70 29  24 61 6f d8 77 11 21 57  |.....\p)$ao.w.!W|
+00000360  a0 4d e1 4b 8e 55 06 50  7f a2 30 c1 c2 b9 c6 00  |.M.K.U.P..0.....|
+00000370  80 68 7c e4 1a bc a4 1e  16 b9 3e 4a 59 39 a9 54  |.h|.......>JY9.T|
+00000380  6f c7 17 b2 f5 af b5 73  5b db cc 71 f2 1b aa dc  |o......s[..q....|
+00000390  9d 64 3c 0f 82 e6 da 1a  6b 96 19 e2 f0 15 b0 df  |.d<.....k.......|
+000003a0  8a 2d 96 09 63 52 f6 53  ef 12 d4 3b 35 b7 0b 43  |.-..cR.S...;5..C|
+000003b0  2c 6e 58 4c c8 2f b8 55  84 89 c9 39 81 7a 7a 7d  |,nXL./.U...9.zz}|
+000003c0  88 68 db eb d7 81 aa 2e  b2 25 ba 98 6c 46 b7 85  |.h.......%..lF..|
+000003d0  8a 21 17 b9 36 23 c0 84  94 af 3b 9b 04 5d ec 31  |.!..6#....;..].1|
+000003e0  f5 75 84 d8 77 d7 80 37  ae c3 5c 26 41 f6 72 af  |.u..w..7..\&A.r.|
+000003f0  88 16 03 01 00 04 0e 00  00 00                    |..........|
 >>> Flow 3 (client to server)
 00000000  16 03 01 00 46 10 00 00  42 41 04 1e 18 37 ef 0d  |....F...BA...7..|
 00000010  19 51 88 35 75 71 b5 e5  54 5b 12 2e 8f 09 67 fd  |.Q.5uq..T[....g.|
 00000020  a7 24 20 3e b2 56 1c ce  97 28 5e f8 2b 2d 4f 9e  |.$ >.V...(^.+-O.|
 00000030  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000040  a6 b5 68 1a 41 03 56 6b  dc 5a 89 14 03 01 00 01  |..h.A.Vk.Z......|
-00000050  01 16 03 01 00 30 12 12  1b 40 63 b8 fb 97 a4 5f  |.....0...@c...._|
-00000060  07 91 4b 01 f0 e8 d4 8b  c2 c4 0a a2 bd ee 0d 05  |..K.............|
-00000070  b1 38 99 9e e8 ae df a9  37 fc 8d 31 05 bd ea 93  |.8......7..1....|
-00000080  fa ff a5 82 74 07                                 |....t.|
+00000050  01 16 03 01 00 30 d2 5b  27 5a f5 64 49 31 d5 aa  |.....0.['Z.dI1..|
+00000060  a3 72 ae c9 af 0b aa 75  af ac f3 45 f4 e3 03 fa  |.r.....u...E....|
+00000070  e8 97 88 7b 51 a9 ae 61  40 c8 11 74 3e d8 9a b6  |...{Q..a@..t>...|
+00000080  e7 6a 5e 71 84 7e                                 |.j^q.~|
 >>> Flow 4 (server to client)
-00000000  14 03 01 00 01 01 16 03  01 00 30 27 e5 f7 a2 69  |..........0'...i|
-00000010  55 61 87 32 46 be d0 41  f2 8f 8b 19 52 61 d2 2e  |Ua.2F..A....Ra..|
-00000020  28 63 fb 45 37 43 cc 88  25 5c 97 b9 03 3b 69 51  |(c.E7C..%\...;iQ|
-00000030  14 c5 bc 16 67 56 d7 30  37 c0 04                 |....gV.07..|
+00000000  14 03 01 00 01 01 16 03  01 00 30 8d 63 fc 58 2e  |..........0.c.X.|
+00000010  50 f7 60 2c 9f 5a 8e 58  29 6c a6 3a 8d 2b a7 2b  |P.`,.Z.X)l.:.+.+|
+00000020  1c 12 8a 53 3f d5 60 79  12 c3 78 e3 aa 50 15 45  |...S?.`y..x..P.E|
+00000030  07 da 2d c7 a9 c3 45 07  48 00 78                 |..-...E.H.x|
 >>> Flow 5 (client to server)
-00000000  17 03 01 00 20 e4 46 36  a5 57 c8 70 6c 0a b0 ed  |.... .F6.W.pl...|
-00000010  52 23 d6 39 7b ea 14 51  86 7e 59 8c af 66 26 2b  |R#.9{..Q.~Y..f&+|
-00000020  cd d0 73 f2 2a 17 03 01  00 20 47 4f 0c fb 3e 9b  |..s.*.... GO..>.|
-00000030  d2 2c 29 90 37 07 38 27  43 93 5c 72 b7 35 01 8c  |.,).7.8'C.\r.5..|
-00000040  05 23 13 c3 04 9f 45 a2  ca d3 15 03 01 00 20 33  |.#....E....... 3|
-00000050  6d 4f f3 16 0f 9f a0 01  ea ac 04 16 0d b1 dd a7  |mO..............|
-00000060  48 55 29 f9 6f 84 ff 6c  d7 24 a9 b5 4c 6d dd     |HU).o..l.$..Lm.|
+00000000  17 03 01 00 20 40 91 8d  e6 95 2f 97 c8 0c 94 5c  |.... @..../....\|
+00000010  46 a7 d3 31 82 3d dc 7e  86 5b dd df 3f 3b 5b 9c  |F..1.=.~.[..?;[.|
+00000020  d5 0d 52 5a 53 17 03 01  00 20 1d 18 da 6b e8 66  |..RZS.... ...k.f|
+00000030  ce 58 18 81 4b 69 8c f6  db 1a ee d0 78 fb f5 68  |.X..Ki......x..h|
+00000040  2c 99 48 47 65 15 2a ae  ff 4e 15 03 01 00 20 68  |,.HGe.*..N.... h|
+00000050  aa 7f 75 33 45 7a 1a 33  18 35 5a 5b 14 b0 f6 83  |..u3Ez.3.5Z[....|
+00000060  97 85 3f b2 dc 78 68 eb  43 ef 92 7f 38 bd f8     |..?..xh.C...8..|
diff --git a/src/crypto/tls/testdata/Client-TLSv10-RSA-RC4 b/src/crypto/tls/testdata/Client-TLSv10-RSA-RC4
index 932a65a8a7..b5deaeb011 100644
--- a/src/crypto/tls/testdata/Client-TLSv10-RSA-RC4
+++ b/src/crypto/tls/testdata/Client-TLSv10-RSA-RC4
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 01 00 51 02 00 00  4d 03 01 56 9c f7 61 4b  |....Q...M..V..aK|
-00000010  82 5f d9 cb 33 ff 89 7f  5d 5f b1 5b c1 00 b2 05  |._..3...]_.[....|
-00000020  12 7b 18 af aa 8e 1f 75  fe 17 18 20 7e 95 8e dd  |.{.....u... ~...|
-00000030  04 95 97 77 cf 94 6e 2d  52 44 f6 e0 11 df ab d5  |...w..n-RD......|
-00000040  f3 65 66 66 3c c8 d0 fe  f6 01 45 85 00 05 00 00  |.eff<.....E.....|
+00000000  16 03 01 00 51 02 00 00  4d 03 01 a9 b0 bf 24 3f  |....Q...M.....$?|
+00000010  98 c6 0f 83 23 2b b6 e4  3f d5 5b 10 9a 6f b8 63  |....#+..?.[..o.c|
+00000020  4c 3c d6 4d 05 c0 08 85  f7 72 72 20 ab 85 8c ff  |L<.M.....rr ....|
+00000030  f7 bb 95 ab 69 37 3d b6  79 cb 46 ad 4e 22 e7 c6  |....i7=.y.F.N"..|
+00000040  a5 9b 72 92 32 ff a5 f7  ed dc 30 41 00 05 00 00  |..r.2.....0A....|
 00000050  05 ff 01 00 01 00 16 03  01 02 be 0b 00 02 ba 00  |................|
 00000060  02 b7 00 02 b4 30 82 02  b0 30 82 02 19 a0 03 02  |.....0...0......|
 00000070  01 02 02 09 00 85 b0 bb  a4 8a 7f b8 ca 30 0d 06  |.............0..|
@@ -70,15 +70,15 @@
 00000060  e6 bd 77 82 6f 23 b6 e0  bd a2 92 b7 3a ac e8 56  |..w.o#......:..V|
 00000070  f1 af 54 5e 46 87 e9 3b  33 e7 b8 28 b7 d6 c8 90  |..T^F..;3..(....|
 00000080  35 d4 1c 43 d1 30 6f 55  4e 0a 70 14 03 01 00 01  |5..C.0oUN.p.....|
-00000090  01 16 03 01 00 24 8e 33  a8 f4 59 cf 9a cd 8a de  |.....$.3..Y.....|
-000000a0  bc f1 0f 18 23 cb 1f 73  ee ba 95 d2 0e a3 ad 14  |....#..s........|
-000000b0  2e 96 d0 f0 be e7 f6 b2  4b 00                    |........K.|
+00000090  01 16 03 01 00 24 4d 1d  d7 8c d6 c7 65 a6 ce af  |.....$M.....e...|
+000000a0  e7 59 0d 7e dc d9 96 1c  ed 9c 57 94 84 b8 3f b5  |.Y.~......W...?.|
+000000b0  34 e1 61 a5 61 f3 5d 09  bc ff                    |4.a.a.]...|
 >>> Flow 4 (server to client)
-00000000  14 03 01 00 01 01 16 03  01 00 24 b8 0d 3b c6 6d  |..........$..;.m|
-00000010  28 52 32 cf 8c 1c ff 96  c8 8f 73 b7 7a 08 bf 9b  |(R2.......s.z...|
-00000020  56 e4 d8 0d 86 63 23 0f  07 0b 27 37 6b aa 2c     |V....c#...'7k.,|
+00000000  14 03 01 00 01 01 16 03  01 00 24 13 81 89 61 5c  |..........$...a\|
+00000010  fb 0a 9c a1 4b db 94 6b  8b 41 6e 63 d6 aa db 88  |....K..k.Anc....|
+00000020  03 b7 b5 19 b8 12 cf 5e  17 54 79 2f 03 91 7e     |.......^.Ty/..~|
 >>> Flow 5 (client to server)
-00000000  17 03 01 00 1a 55 0e 16  b2 d7 51 50 cb 1d fc 97  |.....U....QP....|
-00000010  19 f9 60 4f b6 a9 07 07  b1 a2 0a 1d f8 07 c6 15  |..`O............|
-00000020  03 01 00 16 7d 48 ec f7  ae 0e ff b3 22 22 3a cd  |....}H......"":.|
-00000030  78 be 91 a2 1d db 2d b6  c1 63                    |x.....-..c|
+00000000  17 03 01 00 1a b3 2b da  ce 45 ec b2 9d 3b 18 d9  |......+..E...;..|
+00000010  7a cb 99 ea ff 4d 91 b5  48 df 6f 8b 2f 85 c7 15  |z....M..H.o./...|
+00000020  03 01 00 16 19 1c 72 74  36 cf 22 0f a0 a7 18 96  |......rt6.".....|
+00000030  3a 67 cb 22 16 f1 a8 7b  57 37                    |:g."...{W7|
diff --git a/src/crypto/tls/testdata/Client-TLSv11-ECDHE-ECDSA-AES b/src/crypto/tls/testdata/Client-TLSv11-ECDHE-ECDSA-AES
index bbc0994c10..a4a29306cb 100644
--- a/src/crypto/tls/testdata/Client-TLSv11-ECDHE-ECDSA-AES
+++ b/src/crypto/tls/testdata/Client-TLSv11-ECDHE-ECDSA-AES
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 02 00 59 02 00 00  55 03 02 da c3 11 f5 66  |....Y...U......f|
-00000010  de 91 52 21 61 3c 08 ad  84 e0 f5 9d 24 fd a5 0e  |..R!a<......$...|
-00000020  1f be 19 ef 23 d1 ee e1  c6 48 f8 20 15 7a c3 c2  |....#....H. .z..|
-00000030  4a cc f2 11 e7 df 79 57  a6 52 cf 7e df fe 53 9f  |J.....yW.R.~..S.|
-00000040  0d 85 af c3 03 4a a7 7c  81 b7 6f 0c c0 09 00 00  |.....J.|..o.....|
+00000000  16 03 02 00 59 02 00 00  55 03 02 5a 52 92 23 05  |....Y...U..ZR.#.|
+00000010  58 68 b2 1e 77 a2 a8 16  e9 88 85 ea 38 b3 63 c2  |Xh..w.......8.c.|
+00000020  40 f8 de 37 3c d4 b9 51  11 2d d1 20 12 fd 95 b3  |@..7<..Q.-. ....|
+00000030  2a 54 40 c0 23 3a 4e 4e  f6 7b f8 77 04 6e e7 d7  |*T@.#:NN.{.w.n..|
+00000040  3b 9a 45 32 e0 af df aa  ff bf 78 8b c0 09 00 00  |;.E2......x.....|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  02 02 0e 0b 00 02 0a 00  02 07 00 02 04 30 82 02  |.............0..|
 00000070  00 30 82 01 62 02 09 00  b8 bf 2d 47 a0 d2 eb f4  |.0..b.....-G....|
@@ -48,20 +48,20 @@
 00000240  13 83 0d 94 06 bb d4 37  7a f6 ec 7a c9 86 2e dd  |.......7z..z....|
 00000250  d7 11 69 7f 85 7c 56 de  fb 31 78 2b e4 c7 78 0d  |..i..|V..1x+..x.|
 00000260  ae cb be 9e 4e 36 24 31  7b 6a 0f 39 95 12 07 8f  |....N6$1{j.9....|
-00000270  2a 16 03 02 00 d5 0c 00  00 d1 03 00 17 41 04 ee  |*............A..|
-00000280  ea 14 b0 48 80 bd 55 0b  bb 4e 9f 7d 78 cf 28 f8  |...H..U..N.}x.(.|
-00000290  e9 f6 f9 80 aa 4f ed 13  17 13 b0 f4 72 79 3c 1b  |.....O......ry<.|
-000002a0  fe ca 7f 0c 5d 70 3b bf  17 66 d2 5d fb 68 d7 93  |....]p;..f.].h..|
-000002b0  d9 1f f1 a9 d9 55 fd ec  8a da af e7 af fa 7c 00  |.....U........|.|
-000002c0  8a 30 81 87 02 42 01 c7  f6 c1 65 0f 94 71 a7 e0  |.0...B....e..q..|
-000002d0  67 1c fa 88 b8 90 9e 17  29 3b 5c 18 ad dc ff 00  |g.......);\.....|
-000002e0  1a 85 28 fa e6 43 c9 53  39 27 0c 16 19 6e c7 c2  |..(..C.S9'...n..|
-000002f0  08 b9 12 4a a9 55 ec dc  f4 8a 29 21 8f 07 c2 58  |...J.U....)!...X|
-00000300  6a 96 9f f8 d1 29 5e 92  02 41 39 b8 cf 22 8d 59  |j....)^..A9..".Y|
-00000310  57 be 4e 0e e8 1e 41 8a  0f 70 38 59 e8 43 db a0  |W.N...A..p8Y.C..|
-00000320  e8 ee 75 35 e2 bb 44 fe  49 81 df 95 5c 57 58 ad  |..u5..D.I...\WX.|
-00000330  f7 92 fa 2c ff 83 e7 24  78 b4 f3 f9 bc 76 cd 5b  |...,...$x....v.[|
-00000340  30 9a 3f 79 dd c7 cc 4f  63 a8 a2 16 03 02 00 04  |0.?y...Oc.......|
+00000270  2a 16 03 02 00 d5 0c 00  00 d1 03 00 17 41 04 c3  |*............A..|
+00000280  55 86 65 95 83 02 4b 69  6e 95 f4 52 46 83 21 86  |U.e...Kin..RF.!.|
+00000290  9e 99 cf 81 d9 b8 20 7a  87 b3 07 48 14 04 20 d9  |...... z...H.. .|
+000002a0  6c 2e 22 5a b5 b4 ef de  15 b3 08 ef 1e 18 ea 67  |l."Z...........g|
+000002b0  eb 45 fd e1 27 43 ed 41  ea 05 7e f3 f9 ee 23 00  |.E..'C.A..~...#.|
+000002c0  8a 30 81 87 02 42 00 b0  9c 06 85 83 b2 bf 42 22  |.0...B........B"|
+000002d0  6e 57 7a 31 fe a9 d9 28  be 0a a9 80 49 a2 14 c1  |nWz1...(....I...|
+000002e0  a9 99 76 b7 f9 76 d0 3c  d3 0c c7 42 34 d7 94 a9  |..v..v.<...B4...|
+000002f0  15 66 7e 6b 83 6e b2 b4  5b 22 c9 4e a0 96 db 2b  |.f~k.n..[".N...+|
+00000300  ad 77 33 1e 4a 5c 2f 2e  02 41 26 0c 1a 5a b4 07  |.w3.J\/..A&..Z..|
+00000310  95 99 ec 0b 5b 2e bb db  0e d5 26 c4 b3 eb c2 30  |....[.....&....0|
+00000320  b0 7b c1 07 97 a0 99 3f  db 4e b0 c4 b8 bb 5e be  |.{.....?.N....^.|
+00000330  2a e4 b3 a4 5c ad d1 d7  7a 2d fb ae 73 ee 0c 1e  |*...\...z-..s...|
+00000340  3b 64 e1 74 14 bc c0 1e  8b f3 26 16 03 02 00 04  |;d.t......&.....|
 00000350  0e 00 00 00                                       |....|
 >>> Flow 3 (client to server)
 00000000  16 03 02 00 46 10 00 00  42 41 04 1e 18 37 ef 0d  |....F...BA...7..|
@@ -70,21 +70,21 @@
 00000030  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000040  a6 b5 68 1a 41 03 56 6b  dc 5a 89 14 03 02 00 01  |..h.A.Vk.Z......|
 00000050  01 16 03 02 00 40 00 00  00 00 00 00 00 00 00 00  |.....@..........|
-00000060  00 00 00 00 00 00 12 74  ca 16 92 22 5d fa 99 dc  |.......t..."]...|
-00000070  e6 95 71 62 31 e0 ab 65  42 91 93 e3 f7 45 04 e1  |..qb1..eB....E..|
-00000080  d2 53 45 e6 a2 fc 3f d6  bd 0b a5 6c 08 72 c7 91  |.SE...?....l.r..|
-00000090  6e 01 d8 a0 62 b3                                 |n...b.|
+00000060  00 00 00 00 00 00 33 07  8a af e1 94 ef f9 08 3a  |......3........:|
+00000070  33 5f b3 e6 42 07 85 af  40 e2 8b 34 53 62 1a 10  |3_..B...@..4Sb..|
+00000080  bb 08 7e 75 d4 21 12 2d  54 87 33 1c 4e 13 27 72  |..~u.!.-T.3.N.'r|
+00000090  3f 9e 9f cc de 47                                 |?....G|
 >>> Flow 4 (server to client)
-00000000  14 03 02 00 01 01 16 03  02 00 40 44 71 ab 80 f6  |..........@Dq...|
-00000010  35 3a 1d 96 c0 89 b7 73  f9 21 7f c5 4d 2c 4a c3  |5:.....s.!..M,J.|
-00000020  1c 5e ab bc cb b6 5c 79  79 36 0c 60 0a 98 47 5a  |.^....\yy6.`..GZ|
-00000030  73 4c 2d d8 3e 40 a1 02  f3 bf 84 c1 9f ad 2a cf  |sL-.>@........*.|
-00000040  4e 14 6b 1b 3a e2 47 6d  e9 93 71                 |N.k.:.Gm..q|
+00000000  14 03 02 00 01 01 16 03  02 00 40 4f 47 0d 43 54  |..........@OG.CT|
+00000010  50 69 3a c8 21 a6 6e 28  78 cc 01 b4 5d eb f7 2b  |Pi:.!.n(x...]..+|
+00000020  8b 7e 26 6e cf 56 98 65  ad bf 0f a0 b4 67 13 70  |.~&n.V.e.....g.p|
+00000030  de b5 b5 91 df d6 df 8c  53 c6 54 3d 5d 98 e4 25  |........S.T=]..%|
+00000040  47 a0 0f 91 c7 08 96 17  48 bd 0f                 |G.......H..|
 >>> Flow 5 (client to server)
 00000000  17 03 02 00 30 00 00 00  00 00 00 00 00 00 00 00  |....0...........|
-00000010  00 00 00 00 00 d0 bf 47  a5 64 48 99 6d 99 2f 08  |.......G.dH.m./.|
-00000020  b8 91 61 44 43 17 b5 1e  75 57 6d 6e a4 ea b1 3d  |..aDC...uWmn...=|
-00000030  8e bf 6b ec a1 15 03 02  00 30 00 00 00 00 00 00  |..k......0......|
-00000040  00 00 00 00 00 00 00 00  00 00 dc 91 50 a0 52 5b  |............P.R[|
-00000050  8e 91 09 11 15 a2 f8 81  c7 e6 59 b6 65 f0 eb 82  |..........Y.e...|
-00000060  53 8f a5 27 08 ab ee 35  56 c1                    |S..'...5V.|
+00000010  00 00 00 00 00 4e fe 12  d7 4b d7 3f 86 5a 2c f6  |.....N...K.?.Z,.|
+00000020  86 03 2a bd 1a 98 d7 bb  9f 59 6c 6d 4d 57 b0 50  |..*......YlmMW.P|
+00000030  d6 97 7e d4 b6 15 03 02  00 30 00 00 00 00 00 00  |..~......0......|
+00000040  00 00 00 00 00 00 00 00  00 00 65 8b b5 ae 86 90  |..........e.....|
+00000050  00 4e 1e 3f bc ac ed 49  f4 5e 73 49 e6 d8 37 83  |.N.?...I.^sI..7.|
+00000060  cf 4f e5 7b 5e c9 1d c8  c9 dc                    |.O.{^.....|
diff --git a/src/crypto/tls/testdata/Client-TLSv11-ECDHE-RSA-AES b/src/crypto/tls/testdata/Client-TLSv11-ECDHE-RSA-AES
index c09c2ba7f6..103f1d8a11 100644
--- a/src/crypto/tls/testdata/Client-TLSv11-ECDHE-RSA-AES
+++ b/src/crypto/tls/testdata/Client-TLSv11-ECDHE-RSA-AES
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 02 00 59 02 00 00  55 03 02 68 ab 34 cd 47  |....Y...U..h.4.G|
-00000010  e3 86 01 81 ae 35 db af  9e 81 6b 75 d7 65 a7 f5  |.....5....ku.e..|
-00000020  36 19 89 96 43 02 a0 cf  0e 71 26 20 9a ce 25 e1  |6...C....q& ..%.|
-00000030  f7 96 ac 29 ef 92 6d 7e  9f 51 69 95 54 28 76 ce  |...)..m~.Qi.T(v.|
-00000040  b5 68 32 14 20 1d 68 84  13 ba 8d 49 c0 13 00 00  |.h2. .h....I....|
+00000000  16 03 02 00 59 02 00 00  55 03 02 e3 ed 49 27 a3  |....Y...U....I'.|
+00000010  28 c5 8c 30 27 c2 ed 57  9b f7 37 a1 6d 2b 88 c2  |(..0'..W..7.m+..|
+00000020  df a7 2d 01 01 00 9a 09  da c2 1f 20 ee 33 87 03  |..-........ .3..|
+00000030  28 93 1c 16 99 5b b1 e0  bf 87 e8 77 4a 72 c9 92  |(....[.....wJr..|
+00000040  8a bc b2 3e 24 e1 f6 e8  f4 3f a2 24 c0 13 00 00  |...>$....?.$....|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  02 02 be 0b 00 02 ba 00  02 b7 00 02 b4 30 82 02  |.............0..|
 00000070  b0 30 82 02 19 a0 03 02  01 02 02 09 00 85 b0 bb  |.0..............|
@@ -59,20 +59,20 @@
 000002f0  5f 33 c4 b6 d8 c9 75 90  96 8c 0f 52 98 b5 cd 98  |_3....u....R....|
 00000300  1f 89 20 5f f2 a0 1c a3  1b 96 94 dd a9 fd 57 e9  |.. _..........W.|
 00000310  70 e8 26 6d 71 99 9b 26  6e 38 50 29 6c 90 a7 bd  |p.&mq..&n8P)l...|
-00000320  d9 16 03 02 00 cb 0c 00  00 c7 03 00 17 41 04 4b  |.............A.K|
-00000330  a9 15 cd 11 3f c9 b3 6e  44 5f 82 4c 83 5c 72 2a  |....?..nD_.L.\r*|
-00000340  d2 2c 73 eb 1a 95 cd e8  37 b1 80 9b 4f 58 65 ea  |.,s.....7...OXe.|
-00000350  db 90 34 ca e7 55 56 f9  33 0a 0b b4 b2 3c a7 bf  |..4..UV.3....<..|
-00000360  98 fe 7b 81 31 b1 93 fd  57 22 02 40 23 49 cc 00  |..{.1...W".@#I..|
-00000370  80 89 c8 ab 3d d7 72 36  76 fb d3 da 96 8d 88 af  |....=.r6v.......|
-00000380  28 cc 5c 1e e6 10 7e 83  08 dc 04 ae 74 f2 08 22  |(.\...~.....t.."|
-00000390  6b 09 8f 0d a4 37 eb e5  6c 24 68 7d a4 15 cb 88  |k....7..l$h}....|
-000003a0  ab 17 bc ce 48 8d 30 32  fc ee 18 f3 10 09 f6 98  |....H.02........|
-000003b0  08 cc 9e 97 0a a0 3e f6  e0 7b 27 64 44 e9 dc 6b  |......>..{'dD..k|
-000003c0  20 ec 87 6f 5e 85 0d b3  0c 6c 87 15 8d 24 8a 6c  | ..o^....l...$.l|
-000003d0  26 3f 1f e1 48 7e 59 80  10 94 b0 fe f3 b0 5b 4b  |&?..H~Y.......[K|
-000003e0  72 d8 81 ac 9c 04 80 cb  53 c1 71 1a 48 c0 1d b9  |r.......S.q.H...|
-000003f0  d0 16 03 02 00 04 0e 00  00 00                    |..........|
+00000320  d9 16 03 02 00 cb 0c 00  00 c7 03 00 17 41 04 f7  |.............A..|
+00000330  75 c1 b9 58 a0 7d 50 48  e9 85 79 db 89 76 4c d7  |u..X.}PH..y..vL.|
+00000340  84 5b 94 9a 15 d8 92 32  74 d2 3e ce 76 5a bd 0e  |.[.....2t.>.vZ..|
+00000350  24 e7 a6 d0 77 5d 8e 3d  9f 94 7a ea 15 46 3c 5c  |$...w].=..z..F<\|
+00000360  61 28 76 4a ff 81 97 2b  3a 0c b7 aa b4 0e cb 00  |a(vJ...+:.......|
+00000370  80 19 00 a8 fe 0a ea 35  30 51 a3 77 37 08 68 10  |.......50Q.w7.h.|
+00000380  5a e9 07 2d 83 67 77 4c  3a 25 14 1c 5b c1 2e 80  |Z..-.gwL:%..[...|
+00000390  30 6d ba 26 c1 f9 c6 3e  fc 55 34 8c d2 9f 2b a6  |0m.&...>.U4...+.|
+000003a0  46 0c 9d 58 2c 9c 2b ce  6f 03 d7 49 4e df 21 ce  |F..X,.+.o..IN.!.|
+000003b0  3f 8b 19 fe 3e 71 23 51  c3 ec 30 c8 3e 3c 3c 50  |?...>q#Q..0.><<P|
+000003c0  da 08 52 c0 10 9f e3 4a  be e0 97 aa de 5e 13 22  |..R....J.....^."|
+000003d0  b2 77 ee 5d 2d d4 ff fb  7f c3 1e e7 51 fe fc 4b  |.w.]-.......Q..K|
+000003e0  56 5b 8f 50 ad cc 34 7a  a9 dd 24 0a d0 c7 b9 bf  |V[.P..4z..$.....|
+000003f0  1a 16 03 02 00 04 0e 00  00 00                    |..........|
 >>> Flow 3 (client to server)
 00000000  16 03 02 00 46 10 00 00  42 41 04 1e 18 37 ef 0d  |....F...BA...7..|
 00000010  19 51 88 35 75 71 b5 e5  54 5b 12 2e 8f 09 67 fd  |.Q.5uq..T[....g.|
@@ -80,21 +80,21 @@
 00000030  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000040  a6 b5 68 1a 41 03 56 6b  dc 5a 89 14 03 02 00 01  |..h.A.Vk.Z......|
 00000050  01 16 03 02 00 40 00 00  00 00 00 00 00 00 00 00  |.....@..........|
-00000060  00 00 00 00 00 00 06 53  93 2b c1 91 3f 0a fd 18  |.......S.+..?...|
-00000070  01 72 8f a5 85 82 14 76  1a a2 08 03 07 a6 e6 06  |.r.....v........|
-00000080  01 52 d8 2c af 8f ee 1e  bb 89 fd 22 d9 15 c6 43  |.R.,......."...C|
-00000090  93 1a 72 e1 fa 36                                 |..r..6|
+00000060  00 00 00 00 00 00 1e 0b  cd 40 fa 0f ed fa 55 74  |.........@....Ut|
+00000070  4e ad 10 d1 b5 e1 41 8c  c0 93 81 38 f3 83 f1 37  |N.....A....8...7|
+00000080  6a d4 6c ea ba 5b 9e 38  d3 c1 bb 41 45 fb f0 48  |j.l..[.8...AE..H|
+00000090  c1 06 31 64 e0 65                                 |..1d.e|
 >>> Flow 4 (server to client)
-00000000  14 03 02 00 01 01 16 03  02 00 40 a8 1f 59 75 6e  |..........@..Yun|
-00000010  96 02 6e 9c 56 7e 28 e8  40 e2 74 f1 fd 66 73 1a  |..n.V~(.@.t..fs.|
-00000020  62 14 33 d8 62 01 b8 77  f3 39 d5 97 6b 80 79 2e  |b.3.b..w.9..k.y.|
-00000030  ac 4f b3 b4 ed d9 f8 e8  65 86 a7 6b 35 3e 4c a5  |.O......e..k5>L.|
-00000040  9e 3f 13 bb 05 a5 84 b5  8d 69 1e                 |.?.......i.|
+00000000  14 03 02 00 01 01 16 03  02 00 40 17 d1 79 f8 e0  |..........@..y..|
+00000010  d4 40 15 85 df 4d a6 d5  60 90 1f d6 52 58 e7 ae  |.@...M..`...RX..|
+00000020  05 eb a2 ea ed c9 be ae  b5 54 39 de 05 66 27 67  |.........T9..f'g|
+00000030  59 07 03 e7 10 f9 3f da  d8 85 8b 2f 7b 33 9f f5  |Y.....?..../{3..|
+00000040  43 50 b9 9c 6e dd 01 ae  d8 c9 1d                 |CP..n......|
 >>> Flow 5 (client to server)
 00000000  17 03 02 00 30 00 00 00  00 00 00 00 00 00 00 00  |....0...........|
-00000010  00 00 00 00 00 d9 31 55  3b 39 81 1f f9 55 6a 8f  |......1U;9...Uj.|
-00000020  23 d7 ba 43 af 44 64 2e  07 0a 6a 64 6f d9 a1 e3  |#..C.Dd...jdo...|
-00000030  b3 d1 85 3d 51 15 03 02  00 30 00 00 00 00 00 00  |...=Q....0......|
-00000040  00 00 00 00 00 00 00 00  00 00 d7 e0 56 3e e6 10  |............V>..|
-00000050  6c 5e d8 8d b0 14 94 b9  e1 cf ba dd ae 0b cf 8f  |l^..............|
-00000060  4b b8 24 cc a8 c4 28 57  db a6                    |K.$...(W..|
+00000010  00 00 00 00 00 65 81 63  71 55 1c 46 8a 60 46 d9  |.....e.cqU.F.`F.|
+00000020  7d 71 a2 62 b8 a8 3b 06  3d a2 f4 53 a4 46 a8 9e  |}q.b..;.=..S.F..|
+00000030  b7 89 8a 42 ce 15 03 02  00 30 00 00 00 00 00 00  |...B.....0......|
+00000040  00 00 00 00 00 00 00 00  00 00 7a 78 a4 e7 2f 40  |..........zx../@|
+00000050  df 42 9b 76 7a 45 0a 86  40 af 3c 40 c6 69 ba e1  |.B.vzE..@.<@.i..|
+00000060  23 82 fa 44 fd 73 fc 5b  f7 b9                    |#..D.s.[..|
diff --git a/src/crypto/tls/testdata/Client-TLSv11-RSA-RC4 b/src/crypto/tls/testdata/Client-TLSv11-RSA-RC4
index b1e68e19d2..729391f68c 100644
--- a/src/crypto/tls/testdata/Client-TLSv11-RSA-RC4
+++ b/src/crypto/tls/testdata/Client-TLSv11-RSA-RC4
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 02 00 51 02 00 00  4d 03 02 92 b1 b3 e2 78  |....Q...M......x|
-00000010  cb 01 3a f7 c5 ed 3e 00  1a ff 42 9c 46 1a 74 46  |..:...>...B.F.tF|
-00000020  31 c3 d5 dd 50 51 e9 db  56 9f dc 20 55 f0 9c 99  |1...PQ..V.. U...|
-00000030  e5 eb 4e 7a 27 6f c1 89  d9 53 58 44 18 9a 49 48  |..Nz'o...SXD..IH|
-00000040  71 e3 bf 57 58 a7 20 0c  70 0e a0 f9 00 05 00 00  |q..WX. .p.......|
+00000000  16 03 02 00 51 02 00 00  4d 03 02 7e 38 ae 3c 50  |....Q...M..~8.<P|
+00000010  03 96 3d 54 2f cd 86 21  98 7f 87 43 d8 58 aa a3  |..=T/..!...C.X..|
+00000020  d5 9f e7 25 a6 ab 34 7f  10 5f 99 20 56 c5 a8 dd  |...%..4.._. V...|
+00000030  37 17 0d 51 f1 0d c4 4e  76 0f 01 26 56 c9 0c 20  |7..Q...Nv..&V.. |
+00000040  28 ef cd ac 38 ea d3 7f  6f aa 7c b8 00 05 00 00  |(...8...o.|.....|
 00000050  05 ff 01 00 01 00 16 03  02 02 be 0b 00 02 ba 00  |................|
 00000060  02 b7 00 02 b4 30 82 02  b0 30 82 02 19 a0 03 02  |.....0...0......|
 00000070  01 02 02 09 00 85 b0 bb  a4 8a 7f b8 ca 30 0d 06  |.............0..|
@@ -70,15 +70,15 @@
 00000060  e6 bd 77 82 6f 23 b6 e0  bd a2 92 b7 3a ac e8 56  |..w.o#......:..V|
 00000070  f1 af 54 5e 46 87 e9 3b  33 e7 b8 28 b7 d6 c8 90  |..T^F..;3..(....|
 00000080  35 d4 1c 43 d1 30 6f 55  4e 0a 70 14 03 02 00 01  |5..C.0oUN.p.....|
-00000090  01 16 03 02 00 24 11 c3  46 81 19 1c 3b da 7f 9d  |.....$..F...;...|
-000000a0  28 57 d5 3b 66 a9 a0 6d  46 93 15 61 06 4f 49 3d  |(W.;f..mF..a.OI=|
-000000b0  c0 2e 53 84 f2 e7 19 41  be fb                    |..S....A..|
+00000090  01 16 03 02 00 24 b9 df  85 a1 6d a7 14 b5 bc f5  |.....$....m.....|
+000000a0  c2 1d 40 fc 1e 19 f2 36  2d ec 6b 59 c5 6d ae c7  |..@....6-.kY.m..|
+000000b0  1c ad 7e a3 5b 4d 12 e5  58 5a                    |..~.[M..XZ|
 >>> Flow 4 (server to client)
-00000000  14 03 02 00 01 01 16 03  02 00 24 a3 38 57 46 99  |..........$.8WF.|
-00000010  d7 97 fc 62 46 e9 7a 91  c5 b9 b5 75 7d 13 47 eb  |...bF.z....u}.G.|
-00000020  7e be 99 a5 13 bb 6b bd  b8 09 f0 ea 7b 80 7d     |~.....k.....{.}|
+00000000  14 03 02 00 01 01 16 03  02 00 24 a3 f3 22 a8 32  |..........$..".2|
+00000010  63 c3 88 5c 0f fb 2d 47  21 0d 62 e2 db aa ed ae  |c..\..-G!.b.....|
+00000020  b6 5f e3 c8 98 fc 91 5e  04 83 cf c3 21 17 ce     |._.....^....!..|
 >>> Flow 5 (client to server)
-00000000  17 03 02 00 1a 7d ac af  16 a5 2e d6 69 58 e0 7d  |.....}......iX.}|
-00000010  88 c2 94 3b f0 55 fd 9f  30 be 8e 99 9b 6e 57 15  |...;.U..0....nW.|
-00000020  03 02 00 16 c0 45 7f 83  57 ac d2 78 c7 3f d9 a7  |.....E..W..x.?..|
-00000030  ce f9 e1 c2 cd d0 8e cd  f3 b6                    |..........|
+00000000  17 03 02 00 1a f1 e4 46  c7 14 91 4b c6 25 fd aa  |.......F...K.%..|
+00000010  5d dd 3f 61 ac 9c 79 68  bc e6 0f a1 e4 f3 73 15  |].?a..yh......s.|
+00000020  03 02 00 16 6b 8d 23 3c  99 b4 c2 23 3c 27 fd 41  |....k.#<...#<'.A|
+00000030  cc 04 e5 fc e7 f9 d9 81  0a b8                    |..........|
diff --git a/src/crypto/tls/testdata/Client-TLSv12-ALPN b/src/crypto/tls/testdata/Client-TLSv12-ALPN
index f670268844..9ecb065f09 100644
--- a/src/crypto/tls/testdata/Client-TLSv12-ALPN
+++ b/src/crypto/tls/testdata/Client-TLSv12-ALPN
@@ -1,20 +1,20 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 95 01 00 00  91 03 03 00 00 00 00 00  |................|
+00000000  16 03 01 00 99 01 00 00  95 03 03 00 00 00 00 00  |................|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 4a  |...../.5.......J|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 4e  |...../.5.......N|
 00000050  33 74 00 00 00 05 00 05  01 00 00 00 00 00 0a 00  |3t..............|
 00000060  08 00 06 00 17 00 18 00  19 00 0b 00 02 01 00 00  |................|
-00000070  0d 00 0a 00 08 04 01 04  03 02 01 02 03 ff 01 00  |................|
-00000080  01 00 00 10 00 10 00 0e  06 70 72 6f 74 6f 32 06  |.........proto2.|
-00000090  70 72 6f 74 6f 31 00 12  00 00                    |proto1....|
+00000070  0d 00 0e 00 0c 04 01 04  03 05 01 05 03 02 01 02  |................|
+00000080  03 ff 01 00 01 00 00 10  00 10 00 0e 06 70 72 6f  |.............pro|
+00000090  74 6f 32 06 70 72 6f 74  6f 31 00 12 00 00        |to2.proto1....|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 66 02 00 00  62 03 03 1b 87 98 6d 9a  |....f...b.....m.|
-00000010  f2 5c 7b 20 9c e9 e5 50  4f be 92 c6 84 6e 91 f4  |.\{ ...PO....n..|
-00000020  10 bb b3 ef 55 8f 99 00  b0 83 03 20 11 61 23 74  |....U...... .a#t|
-00000030  e7 f4 4f 62 ec ab 80 94  db 9d dc 86 b3 e2 aa 79  |..Ob...........y|
-00000040  56 9c d9 b0 0a 49 e1 44  53 52 01 96 c0 2f 00 00  |V....I.DSR.../..|
+00000000  16 03 03 00 66 02 00 00  62 03 03 56 83 34 0f 9e  |....f...b..V.4..|
+00000010  dd 02 1c 4f 4f 09 d0 2c  df e6 c1 d2 4a c0 6a e7  |...OO..,....J.j.|
+00000020  1e 65 51 c2 42 01 05 70  4a 6c 97 20 0f a8 fb d8  |.eQ.B..pJl. ....|
+00000030  2f 0f 75 21 17 f8 dd 63  28 4a 18 f6 b1 e5 6f 7c  |/.u!...c(J....o||
+00000040  1d 09 d4 13 bf 66 3a bd  c5 48 14 fc c0 2f 00 00  |.....f:..H.../..|
 00000050  1a ff 01 00 01 00 00 0b  00 04 03 00 01 02 00 10  |................|
 00000060  00 09 00 07 06 70 72 6f  74 6f 31 16 03 03 02 be  |.....proto1.....|
 00000070  0b 00 02 ba 00 02 b7 00  02 b4 30 82 02 b0 30 82  |..........0...0.|
@@ -61,19 +61,19 @@
 00000300  b6 d8 c9 75 90 96 8c 0f  52 98 b5 cd 98 1f 89 20  |...u....R...... |
 00000310  5f f2 a0 1c a3 1b 96 94  dd a9 fd 57 e9 70 e8 26  |_..........W.p.&|
 00000320  6d 71 99 9b 26 6e 38 50  29 6c 90 a7 bd d9 16 03  |mq..&n8P)l......|
-00000330  03 00 cd 0c 00 00 c9 03  00 17 41 04 bf 8e 44 e2  |..........A...D.|
-00000340  3c 20 c4 43 28 20 c8 ea  e7 1b 97 b3 37 fc 0a 93  |< .C( ......7...|
-00000350  9b 93 cb 86 08 7b 1c 42  2e a4 85 bc 82 6d 77 6a  |.....{.B.....mwj|
-00000360  1f a4 b4 11 fb f7 80 14  c6 0a 59 64 8c 0d db 6a  |..........Yd...j|
-00000370  b1 02 a6 73 fa 96 bb 55  bc 96 b8 b5 04 01 00 80  |...s...U........|
-00000380  bb 44 02 13 d1 55 6b 5f  3b 23 2c 93 8e 32 42 30  |.D...Uk_;#,..2B0|
-00000390  87 a6 11 22 84 c9 55 b3  30 b0 bd a9 7b 11 46 9d  |..."..U.0...{.F.|
-000003a0  12 e3 a3 6b 4c 3e d4 80  54 ab 2f cc 81 79 58 9d  |...kL>..T./..yX.|
-000003b0  d7 08 d7 20 f2 8e 59 61  39 cd 7b 05 e2 28 e6 a6  |... ..Ya9.{..(..|
-000003c0  3b 90 4e bf ca 54 3c 34  c4 64 c9 db 91 c3 5a 16  |;.N..T<4.d....Z.|
-000003d0  ca bf 05 94 e9 79 3a 1e  20 d6 0f 87 81 9c 2f 3a  |.....y:. ...../:|
-000003e0  46 f3 30 7b 06 79 2b 5e  50 a3 55 a9 f8 cd 29 ea  |F.0{.y+^P.U...).|
-000003f0  6b 07 a5 9b 69 ed 19 87  62 47 ba fc f8 b0 8e d5  |k...i...bG......|
+00000330  03 00 cd 0c 00 00 c9 03  00 17 41 04 85 b7 f7 7c  |..........A....||
+00000340  49 4e 97 14 07 51 bc 56  2d 3f cf 1d 29 08 ac 6a  |IN...Q.V-?..)..j|
+00000350  b4 e7 0d 62 d8 fd 4d 03  29 0d f8 6c 36 6f 4d 5f  |...b..M.)..l6oM_|
+00000360  b7 5a 8e 37 3e c2 d9 dc  f4 15 52 e9 87 71 0f e5  |.Z.7>.....R..q..|
+00000370  4e a6 88 0e 54 35 e0 8b  50 91 e1 c4 04 01 00 80  |N...T5..P.......|
+00000380  51 eb f8 d6 52 ba f5 b5  0a 22 5f 91 fe f7 ee 43  |Q...R...."_....C|
+00000390  f8 af 52 b6 27 2c fc 14  e2 fb 41 61 ff 7c b9 be  |..R.',....Aa.|..|
+000003a0  f9 78 be dc 18 32 8c 4d  ef 46 c0 5a a7 91 6a 1b  |.x...2.M.F.Z..j.|
+000003b0  47 78 46 39 47 81 8a 2d  b4 cb fd bb 44 3e a7 b7  |GxF9G..-....D>..|
+000003c0  cc 4e df 17 7b 2b 38 49  fa 9d 9f 4e cd ed f2 16  |.N..{+8I...N....|
+000003d0  03 d9 68 cf c9 5a 08 32  f8 ed 02 30 54 61 f6 c0  |..h..Z.2...0Ta..|
+000003e0  f6 78 bc ad 04 9c 8e 90  7d 3d f5 35 86 aa 6e e9  |.x......}=.5..n.|
+000003f0  a2 9a d3 86 27 9f 2d 6e  ea 6e ad 82 0e aa ef 97  |....'.-n.n......|
 00000400  16 03 03 00 04 0e 00 00  00                       |.........|
 >>> Flow 3 (client to server)
 00000000  16 03 03 00 46 10 00 00  42 41 04 1e 18 37 ef 0d  |....F...BA...7..|
@@ -81,17 +81,17 @@
 00000020  a7 24 20 3e b2 56 1c ce  97 28 5e f8 2b 2d 4f 9e  |.$ >.V...(^.+-O.|
 00000030  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000040  a6 b5 68 1a 41 03 56 6b  dc 5a 89 14 03 03 00 01  |..h.A.Vk.Z......|
-00000050  01 16 03 03 00 28 00 00  00 00 00 00 00 00 3a ea  |.....(........:.|
-00000060  e5 88 5b 86 9b e9 44 28  98 a2 2c 99 27 7d c2 02  |..[...D(..,.'}..|
-00000070  bc ee 25 1e 9b 67 d8 20  f8 92 c8 61 16 d7        |..%..g. ...a..|
+00000050  01 16 03 03 00 28 00 00  00 00 00 00 00 00 47 18  |.....(........G.|
+00000060  39 03 93 d9 5b 27 29 70  52 68 15 79 f2 60 e6 58  |9...[')pRh.y.`.X|
+00000070  d9 98 cd ce a1 8f 4d ee  2c f0 34 9f fa 73        |......M.,.4..s|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 28 6e c5 fb 62 c0  |..........(n..b.|
-00000010  f9 cf 81 6e 56 d0 36 6b  1c a3 1c 8c 0b c1 0e a1  |...nV.6k........|
-00000020  47 4f c3 73 16 99 63 88  27 95 c2 cb 23 19 99 b0  |GO.s..c.'...#...|
-00000030  94 e2 d5                                          |...|
+00000000  14 03 03 00 01 01 16 03  03 00 28 39 76 15 70 f1  |..........(9v.p.|
+00000010  73 c9 9a 1e 76 40 bc de  de 49 be 3e 10 4d 6a 42  |s...v@...I.>.MjB|
+00000020  1b 9b bd 07 6b 19 ff f9  2c 19 3c c8 e7 06 fa c8  |....k...,.<.....|
+00000030  3d 52 b4                                          |=R.|
 >>> Flow 5 (client to server)
-00000000  17 03 03 00 1e 00 00 00  00 00 00 00 01 0b ba 07  |................|
-00000010  da 95 a6 d4 72 d7 7d 3c  e8 dc 3d aa e6 99 a3 91  |....r.}<..=.....|
-00000020  df 59 26 15 03 03 00 1a  00 00 00 00 00 00 00 02  |.Y&.............|
-00000030  42 a0 eb ce 64 b4 ee a9  59 96 55 1d fd 95 fc 4f  |B...d...Y.U....O|
-00000040  27 4b                                             |'K|
+00000000  17 03 03 00 1e 00 00 00  00 00 00 00 01 14 96 ec  |................|
+00000010  f4 bb ae 45 81 0c 39 10  e2 3a 91 51 04 2c 01 a8  |...E..9..:.Q.,..|
+00000020  8b a3 25 15 03 03 00 1a  00 00 00 00 00 00 00 02  |..%.............|
+00000030  fe 1a 53 01 17 ad a1 30  0a 73 17 9f 39 b4 30 ac  |..S....0.s..9.0.|
+00000040  91 ee                                             |..|
diff --git a/src/crypto/tls/testdata/Client-TLSv12-ALPN-NoMatch b/src/crypto/tls/testdata/Client-TLSv12-ALPN-NoMatch
index b1a30b7da9..a22ffaeb49 100644
--- a/src/crypto/tls/testdata/Client-TLSv12-ALPN-NoMatch
+++ b/src/crypto/tls/testdata/Client-TLSv12-ALPN-NoMatch
@@ -1,20 +1,20 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 8e 01 00 00  8a 03 03 00 00 00 00 00  |................|
+00000000  16 03 01 00 92 01 00 00  8e 03 03 00 00 00 00 00  |................|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 43  |...../.5.......C|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 47  |...../.5.......G|
 00000050  33 74 00 00 00 05 00 05  01 00 00 00 00 00 0a 00  |3t..............|
 00000060  08 00 06 00 17 00 18 00  19 00 0b 00 02 01 00 00  |................|
-00000070  0d 00 0a 00 08 04 01 04  03 02 01 02 03 ff 01 00  |................|
-00000080  01 00 00 10 00 09 00 07  06 70 72 6f 74 6f 33 00  |.........proto3.|
-00000090  12 00 00                                          |...|
+00000070  0d 00 0e 00 0c 04 01 04  03 05 01 05 03 02 01 02  |................|
+00000080  03 ff 01 00 01 00 00 10  00 09 00 07 06 70 72 6f  |.............pro|
+00000090  74 6f 33 00 12 00 00                              |to3....|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 59 02 00 00  55 03 03 e0 60 58 e4 e3  |....Y...U...`X..|
-00000010  f6 cf a3 cb f7 01 80 18  51 41 56 4e 88 72 e3 3b  |........QAVN.r.;|
-00000020  08 f5 8b ab 1e ab 25 b7  09 aa 4d 20 1b 83 8d cf  |......%...M ....|
-00000030  3d 23 ad 39 a4 05 09 68  87 dd fb 03 05 a0 7a 33  |=#.9...h......z3|
-00000040  23 ba 44 69 b2 15 c9 38  ad ca 49 a0 c0 2f 00 00  |#.Di...8..I../..|
+00000000  16 03 03 00 59 02 00 00  55 03 03 94 d7 79 73 82  |....Y...U....ys.|
+00000010  87 7c 85 6e 8a 1b 7d bf  69 c9 98 0c 44 bd f6 78  |.|.n..}.i...D..x|
+00000020  d2 80 dc d8 7d 80 bb 91  4b d4 ed 20 fe 9f 2f 7b  |....}...K.. ../{|
+00000030  f2 1a 44 36 cd ce af f1  b5 01 8a ac 18 e4 2b 23  |..D6..........+#|
+00000040  a8 ab 1a 32 23 8b 0b e2  81 a8 0a 40 c0 2f 00 00  |...2#......@./..|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  03 02 be 0b 00 02 ba 00  02 b7 00 02 b4 30 82 02  |.............0..|
 00000070  b0 30 82 02 19 a0 03 02  01 02 02 09 00 85 b0 bb  |.0..............|
@@ -60,37 +60,37 @@
 000002f0  5f 33 c4 b6 d8 c9 75 90  96 8c 0f 52 98 b5 cd 98  |_3....u....R....|
 00000300  1f 89 20 5f f2 a0 1c a3  1b 96 94 dd a9 fd 57 e9  |.. _..........W.|
 00000310  70 e8 26 6d 71 99 9b 26  6e 38 50 29 6c 90 a7 bd  |p.&mq..&n8P)l...|
-00000320  d9 16 03 03 00 cd 0c 00  00 c9 03 00 17 41 04 c2  |.............A..|
-00000330  dd ae 98 e1 cd 1e 23 cd  da 98 6d 13 70 1e e4 3e  |......#...m.p..>|
-00000340  39 28 d6 3e 26 a1 5d ae  d7 b2 e0 d8 13 d2 4d e8  |9(.>&.].......M.|
-00000350  bb f6 22 fc 21 68 67 21  25 1c d4 1a 31 ea cd bd  |..".!hg!%...1...|
-00000360  fc 9c 67 c7 bd 2b 92 13  fc 15 28 51 41 fc 33 04  |..g..+....(QA.3.|
-00000370  01 00 80 b5 bc 74 2a f0  e7 8a 99 72 31 c6 67 23  |.....t*....r1.g#|
-00000380  d1 62 0d 00 be 5b 11 2d  30 a7 90 2c f2 e6 22 2e  |.b...[.-0..,..".|
-00000390  a5 d2 ac ad 6c 71 18 f9  69 ee 16 bf c8 cf f6 8f  |....lq..i.......|
-000003a0  5c 69 d9 5e 2f b1 25 1f  54 96 08 b7 8f e4 7e c2  |\i.^/.%.T.....~.|
-000003b0  99 8f f2 e7 a8 c2 25 fd  e7 29 a9 2a 06 69 bc 39  |......%..).*.i.9|
-000003c0  52 f5 47 14 28 24 44 df  48 6c 02 6f 28 29 9a 9c  |R.G.($D.Hl.o()..|
-000003d0  50 d9 e6 a5 43 9e 6c 42  2b 01 7a 28 1d c6 d8 e6  |P...C.lB+.z(....|
-000003e0  54 22 17 89 de db 42 17  54 e1 be 72 99 29 84 64  |T"....B.T..r.).d|
-000003f0  6e 46 e6 16 03 03 00 04  0e 00 00 00              |nF..........|
+00000320  d9 16 03 03 00 cd 0c 00  00 c9 03 00 17 41 04 7d  |.............A.}|
+00000330  75 a5 53 0b a5 4d a6 81  e0 df c4 11 c9 b5 31 ba  |u.S..M........1.|
+00000340  9f 7b 51 04 57 c6 e0 b9  b0 bc 4f bc 71 74 8a 2e  |.{Q.W.....O.qt..|
+00000350  d1 f6 39 36 94 4e c7 d3  a7 1b 2c b5 55 04 71 01  |..96.N....,.U.q.|
+00000360  9e 2b 42 1e 8b a4 40 b2  13 4f 03 1f 51 9e 5c 04  |.+B...@..O..Q.\.|
+00000370  01 00 80 68 05 c7 4a ca  df 00 85 2b 53 f7 4f c3  |...h..J....+S.O.|
+00000380  b4 0f e8 f7 b8 30 b7 36  56 65 7b 03 6a 72 f1 aa  |.....0.6Ve{.jr..|
+00000390  54 30 90 9e c7 dc fc 03  96 15 70 67 13 12 a4 f4  |T0........pg....|
+000003a0  42 f0 f9 a1 48 c0 44 44  77 0e ea fd cb b5 6e 19  |B...H.DDw.....n.|
+000003b0  89 94 a7 12 67 87 47 19  c3 00 2d c4 9b d4 dc 66  |....g.G...-....f|
+000003c0  fa ca d7 97 79 9b 28 7f  74 d4 37 c0 06 63 d4 9e  |....y.(.t.7..c..|
+000003d0  a1 53 16 5a 8e d7 a5 cc  90 4d 63 f9 0c 18 85 7f  |.S.Z.....Mc.....|
+000003e0  0e 35 3a 49 73 88 82 51  41 e5 2d 58 aa 38 3e bd  |.5:Is..QA.-X.8>.|
+000003f0  3d d8 da 16 03 03 00 04  0e 00 00 00              |=...........|
 >>> Flow 3 (client to server)
 00000000  16 03 03 00 46 10 00 00  42 41 04 1e 18 37 ef 0d  |....F...BA...7..|
 00000010  19 51 88 35 75 71 b5 e5  54 5b 12 2e 8f 09 67 fd  |.Q.5uq..T[....g.|
 00000020  a7 24 20 3e b2 56 1c ce  97 28 5e f8 2b 2d 4f 9e  |.$ >.V...(^.+-O.|
 00000030  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000040  a6 b5 68 1a 41 03 56 6b  dc 5a 89 14 03 03 00 01  |..h.A.Vk.Z......|
-00000050  01 16 03 03 00 28 00 00  00 00 00 00 00 00 b0 80  |.....(..........|
-00000060  a1 00 c5 cd cc 64 99 e1  34 04 2f c4 b4 c0 cd 51  |.....d..4./....Q|
-00000070  9e bd d3 92 9a 64 ba 05  3c 48 ac d2 ff c3        |.....d..<H....|
+00000050  01 16 03 03 00 28 00 00  00 00 00 00 00 00 a8 da  |.....(..........|
+00000060  74 a6 d0 a5 26 86 f3 5f  89 a4 af ac 9c 1a 01 1f  |t...&.._........|
+00000070  89 8a 1c fc cf 68 3e a5  a3 20 1a b3 78 af        |.....h>.. ..x.|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 28 d8 9b 4c 7c 2a  |..........(..L|*|
-00000010  89 07 f8 85 d9 da 8a 52  b3 c3 93 05 c0 36 45 e1  |.......R.....6E.|
-00000020  25 50 d8 e6 79 d8 b3 15  4c 78 bb 73 db a4 7c 46  |%P..y...Lx.s..|F|
-00000030  2b ad 2a                                          |+.*|
+00000000  14 03 03 00 01 01 16 03  03 00 28 1a f2 a9 e8 71  |..........(....q|
+00000010  b2 a6 ca 36 4a ea 55 f6  20 03 fd f7 90 c3 af 30  |...6J.U. ......0|
+00000020  d3 29 c3 d7 1b d6 4d 3e  61 55 94 0d 4e 3e 83 1a  |.)....M>aU..N>..|
+00000030  97 dd 19                                          |...|
 >>> Flow 5 (client to server)
-00000000  17 03 03 00 1e 00 00 00  00 00 00 00 01 67 aa 3d  |.............g.=|
-00000010  97 e7 5d 82 0f 87 fa be  4f d9 46 eb 8a ba f5 46  |..].....O.F....F|
-00000020  f9 d1 5a 15 03 03 00 1a  00 00 00 00 00 00 00 02  |..Z.............|
-00000030  82 0e 28 5d 0f 1f 24 dc  cc 47 12 6f 85 a4 37 ab  |..(]..$..G.o..7.|
-00000040  15 9d                                             |..|
+00000000  17 03 03 00 1e 00 00 00  00 00 00 00 01 94 5b 5e  |..............[^|
+00000010  51 a1 52 ee 19 78 78 ef  12 0d 9c 66 bf e2 48 cb  |Q.R..xx....f..H.|
+00000020  f6 00 1e 15 03 03 00 1a  00 00 00 00 00 00 00 02  |................|
+00000030  cd 5d 31 58 d9 5a 12 65  5b c6 7e 4e e2 04 e7 1d  |.]1X.Z.e[.~N....|
+00000040  b1 4c                                             |.L|
diff --git a/src/crypto/tls/testdata/Client-TLSv12-ClientCert-ECDSA-ECDSA b/src/crypto/tls/testdata/Client-TLSv12-ClientCert-ECDSA-ECDSA
index c1433602f1..1470ba7a25 100644
--- a/src/crypto/tls/testdata/Client-TLSv12-ClientCert-ECDSA-ECDSA
+++ b/src/crypto/tls/testdata/Client-TLSv12-ClientCert-ECDSA-ECDSA
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 59 02 00 00  55 03 03 6f 2d af 69 fa  |....Y...U..o-.i.|
-00000010  96 5a 48 db 6f b1 3e 33  02 be 0a 40 f8 f3 9d 65  |.ZH.o.>3...@...e|
-00000020  98 04 63 87 ce c9 da 8c  c8 40 fd 20 cc 2b 8c 8f  |..c......@. .+..|
-00000030  79 d3 b3 6e b9 8e a6 a3  e1 3b 35 f8 91 63 57 90  |y..n.....;5..cW.|
-00000040  21 70 93 9e 17 98 a5 7b  18 37 2f 8e c0 09 00 00  |!p.....{.7/.....|
+00000000  16 03 03 00 59 02 00 00  55 03 03 a5 28 60 99 bf  |....Y...U...(`..|
+00000010  c7 54 04 87 60 ad c5 32  f6 bf ed 11 47 de 4d ff  |.T..`..2....G.M.|
+00000020  99 e1 8f 88 f6 af 10 6e  29 74 0a 20 1d 39 cb e0  |.......n)t. .9..|
+00000030  a5 11 fe 8e 23 11 83 c7  a6 53 fc 97 03 9d ff 7c  |....#....S.....||
+00000040  cf 51 ba 41 64 61 38 22  5c c6 4a 04 c0 09 00 00  |.Q.Ada8"\.J.....|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  03 02 0e 0b 00 02 0a 00  02 07 00 02 04 30 82 02  |.............0..|
 00000070  00 30 82 01 62 02 09 00  b8 bf 2d 47 a0 d2 eb f4  |.0..b.....-G....|
@@ -48,20 +48,20 @@
 00000240  13 83 0d 94 06 bb d4 37  7a f6 ec 7a c9 86 2e dd  |.......7z..z....|
 00000250  d7 11 69 7f 85 7c 56 de  fb 31 78 2b e4 c7 78 0d  |..i..|V..1x+..x.|
 00000260  ae cb be 9e 4e 36 24 31  7b 6a 0f 39 95 12 07 8f  |....N6$1{j.9....|
-00000270  2a 16 03 03 00 d7 0c 00  00 d3 03 00 17 41 04 ec  |*............A..|
-00000280  19 dd 2a 42 f5 3b 56 da  f8 35 65 29 79 02 19 bb  |..*B.;V..5e)y...|
-00000290  82 b4 da 2e b0 58 6b 98  9d d4 03 18 fb 7e dd 25  |.....Xk......~.%|
-000002a0  e1 ae 6e c4 28 ff 20 5a  d6 75 0a 64 4f ad 0a c0  |..n.(. Z.u.dO...|
-000002b0  40 cd 4a c6 28 0b f0 26  36 ea 7d e4 68 67 ca 04  |@.J.(..&6.}.hg..|
-000002c0  03 00 8a 30 81 87 02 41  6a 32 0c 87 22 e5 b3 c2  |...0...Aj2.."...|
-000002d0  38 85 95 8a ce 55 4d 99  8c 2f ef 68 f5 7c 65 3a  |8....UM../.h.|e:|
-000002e0  5a 1a 52 12 02 af b5 7a  22 0e 0a 6a ad 6d 81 21  |Z.R....z"..j.m.!|
-000002f0  21 39 d1 4e f0 cc d9 8b  11 b6 44 46 75 17 58 71  |!9.N......DFu.Xq|
-00000300  de 86 2d ae f7 34 a3 2d  b3 02 42 00 fb ff 3b 91  |..-..4.-..B...;.|
-00000310  dd 84 ba 74 c6 f6 43 97  de a3 70 10 00 1e 18 29  |...t..C...p....)|
-00000320  3f 99 a8 cc 22 d9 9f d7  e6 d7 19 16 19 68 52 f8  |?..."........hR.|
-00000330  3a 55 b7 5b 4b fa a6 f2  4f f7 ce 0e 1e 86 a1 b7  |:U.[K...O.......|
-00000340  e0 c1 6e bd 2b 16 20 4e  6b a5 e7 20 14 16 03 03  |..n.+. Nk.. ....|
+00000270  2a 16 03 03 00 d7 0c 00  00 d3 03 00 17 41 04 c4  |*............A..|
+00000280  0a 40 05 84 eb 90 3c 13  d0 90 af 69 fa 5c 20 75  |.@....<....i.\ u|
+00000290  e1 9b f2 30 f7 df cc 75  2c 35 7e 38 16 99 7d 57  |...0...u,5~8..}W|
+000002a0  6d d7 f0 93 2d 1d c8 03  89 6e 52 3b 20 e5 8a 5f  |m...-....nR; .._|
+000002b0  6d ca 6e 6a ca 51 f8 a4  dc 1d ec 3e 73 c9 72 04  |m.nj.Q.....>s.r.|
+000002c0  03 00 8a 30 81 87 02 41  37 bf 0d 1d c1 9a 37 39  |...0...A7.....79|
+000002d0  4d 4a f8 17 50 5d 4c 78  d4 25 99 9d 81 48 98 a8  |MJ..P]Lx.%...H..|
+000002e0  ff 2d 3f 98 4b 9f d8 96  2b fa 37 cc e8 66 25 0e  |.-?.K...+.7..f%.|
+000002f0  d3 5e 53 c5 3b ad 17 3f  21 ce d2 45 d8 93 95 6c  |.^S.;..?!..E...l|
+00000300  25 f9 5a 10 9f 37 c8 14  a6 02 42 00 e6 bd 9a 89  |%.Z..7....B.....|
+00000310  8e 73 40 f4 90 e6 d8 e2  98 51 10 23 fb 98 e5 47  |.s@......Q.#...G|
+00000320  0c 2a 7a 2f 02 66 a8 20  e4 cb 4f ba 14 1d 9e 3a  |.*z/.f. ..O....:|
+00000330  2f 09 47 44 02 e0 9f 30  21 71 f0 99 09 de 23 d2  |/.GD...0!q....#.|
+00000340  f5 f0 b2 93 70 a3 8f 79  b9 4f 88 0b 35 16 03 03  |....p..y.O..5...|
 00000350  00 2e 0d 00 00 26 03 01  02 40 00 1e 06 01 06 02  |.....&...@......|
 00000360  06 03 05 01 05 02 05 03  04 01 04 02 04 03 03 01  |................|
 00000370  03 02 03 03 02 01 02 02  02 03 00 00 0e 00 00 00  |................|
@@ -103,32 +103,32 @@
 00000220  51 88 35 75 71 b5 e5 54  5b 12 2e 8f 09 67 fd a7  |Q.5uq..T[....g..|
 00000230  24 20 3e b2 56 1c ce 97  28 5e f8 2b 2d 4f 9e f1  |$ >.V...(^.+-O..|
 00000240  07 9f 6c 4b 5b 83 56 e2  32 42 e9 58 b6 d7 49 a6  |..lK[.V.2B.X..I.|
-00000250  b5 68 1a 41 03 56 6b dc  5a 89 16 03 03 00 91 0f  |.h.A.Vk.Z.......|
-00000260  00 00 8d 04 03 00 89 30  81 86 02 41 2e 15 7c e7  |.......0...A..|.|
-00000270  f3 7c 50 ee d1 d9 3c 7a  12 e2 e0 94 9c 2a cf 7b  |.|P...<z.....*.{|
-00000280  d3 4a 1e d1 5a 4a be 62  da d2 88 a2 36 04 51 67  |.J..ZJ.b....6.Qg|
-00000290  88 61 2d ee 87 f8 9b d0  cb b8 a6 80 55 0c 61 45  |.a-.........U.aE|
-000002a0  6c 2a f8 01 cb 38 7a 09  e1 0a 52 0f 7a 02 41 3f  |l*...8z...R.z.A?|
-000002b0  ae 8e 30 b9 2e c2 47 54  e4 4c bd e9 c0 c1 3d 10  |..0...GT.L....=.|
-000002c0  4b 95 32 ca 0d 3e 83 f6  9c 64 db 37 21 17 b4 9a  |K.2..>...d.7!...|
-000002d0  34 09 2a ba 2f 80 cf c1  dd 3f 2f 50 02 bf ce a8  |4.*./....?/P....|
-000002e0  e5 f6 cc 61 76 58 4d d1  1d 26 e1 82 66 69 ef 55  |...avXM..&..fi.U|
-000002f0  14 03 03 00 01 01 16 03  03 00 40 00 00 00 00 00  |..........@.....|
-00000300  00 00 00 00 00 00 00 00  00 00 00 4c 18 de 1b ca  |...........L....|
-00000310  a6 e5 8b a1 69 0f 39 f5  85 61 e5 b9 44 12 03 76  |....i.9..a..D..v|
-00000320  fc 9b 73 b7 53 1c 1c 82  84 28 98 7e 8e 1f c2 1b  |..s.S....(.~....|
-00000330  d1 e3 aa 19 33 f6 3c 69  3b 66 c0                 |....3.<i;f.|
+00000250  b5 68 1a 41 03 56 6b dc  5a 89 16 03 03 00 92 0f  |.h.A.Vk.Z.......|
+00000260  00 00 8e 05 03 00 8a 30  81 87 02 42 00 cc a4 ad  |.......0...B....|
+00000270  0b ff 09 40 8f 2c a6 37  72 1d f7 d2 19 74 85 ad  |...@.,.7r....t..|
+00000280  ac 33 b0 b8 5b 56 39 cf  b0 ef 46 68 94 39 4c d0  |.3..[V9...Fh.9L.|
+00000290  f4 97 32 10 99 36 c5 95  c8 14 23 37 78 46 5c a9  |..2..6....#7xF\.|
+000002a0  20 95 65 47 ff 54 02 f1  aa 1d d7 bc 39 2d 02 41  | .eG.T......9-.A|
+000002b0  2e f9 d6 8c e8 c5 a9 6f  10 4f d6 5f 4e 88 e9 71  |.......o.O._N..q|
+000002c0  23 5b 6f b8 ab 19 d3 dd  ec f3 32 e3 3b fa 41 a2  |#[o.......2.;.A.|
+000002d0  e8 ae dc 27 8d 4e 79 f4  47 ef c9 8f bf 0b 41 3b  |...'.Ny.G.....A;|
+000002e0  94 16 cb 8f 1e b5 f3 4e  6e 42 46 35 1a 0c ca 79  |.......NnBF5...y|
+000002f0  4b 14 03 03 00 01 01 16  03 03 00 40 00 00 00 00  |K..........@....|
+00000300  00 00 00 00 00 00 00 00  00 00 00 00 64 1c d9 9f  |............d...|
+00000310  34 ec c2 74 76 7a 9f cf  95 19 be 8d 6a 2f 25 96  |4..tvz......j/%.|
+00000320  df de 18 ca 0e c9 d4 2f  e4 b0 34 10 5b 72 7a 18  |......./..4.[rz.|
+00000330  5c 64 d7 fc 2e 1b 28 10  ae a6 31 e9              |\d....(...1.|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 40 b8 46 3c e2 4c  |..........@.F<.L|
-00000010  63 30 a7 77 0f 9e 0a 89  0b 47 62 a6 6b e2 75 48  |c0.w.....Gb.k.uH|
-00000020  7f df a7 f0 19 9e 79 ed  df fb be 19 f3 11 29 e9  |......y.......).|
-00000030  db 32 05 1c 7d a6 09 c6  d3 7b 53 76 6b 4a b7 80  |.2..}....{SvkJ..|
-00000040  03 33 7d 13 fb 17 51 e1  ca 8a 2e                 |.3}...Q....|
+00000000  14 03 03 00 01 01 16 03  03 00 40 27 6f 24 a3 0c  |..........@'o$..|
+00000010  6d d7 68 4a fb 43 b0 97  02 6c 22 7e 2f a1 f1 7a  |m.hJ.C...l"~/..z|
+00000020  37 bf 38 82 dc a0 83 24  01 4b c0 4f 15 e1 7c 4c  |7.8....$.K.O..|L|
+00000030  d4 cd b8 e2 71 af f5 20  7d f9 4a 48 4b f0 a1 f3  |....q.. }.JHK...|
+00000040  7b 02 29 18 c0 87 a5 dd  c4 73 8e                 |{.)......s.|
 >>> Flow 5 (client to server)
 00000000  17 03 03 00 30 00 00 00  00 00 00 00 00 00 00 00  |....0...........|
-00000010  00 00 00 00 00 1b 3b d7  04 0d 4b 39 bd 4f 92 e4  |......;...K9.O..|
-00000020  1a c4 bc c8 5a 71 f7 5b  1d 23 55 fb 6e 96 58 09  |....Zq.[.#U.n.X.|
-00000030  d2 eb 03 86 dd 15 03 03  00 30 00 00 00 00 00 00  |.........0......|
-00000040  00 00 00 00 00 00 00 00  00 00 f1 99 7b 4c 35 1c  |............{L5.|
-00000050  4b 2d c4 24 d8 1e 7f c9  23 00 ac 18 53 23 82 3f  |K-.$....#...S#.?|
-00000060  0a d8 4d f3 04 7a 6f 2f  89 2c                    |..M..zo/.,|
+00000010  00 00 00 00 00 bf 7a e1  23 0d d0 13 6e 96 81 6d  |......z.#...n..m|
+00000020  32 56 0f 75 7e 01 88 5f  6d e6 d6 ca ec 3c 17 e9  |2V.u~.._m....<..|
+00000030  44 a9 c0 1c a4 15 03 03  00 30 00 00 00 00 00 00  |D........0......|
+00000040  00 00 00 00 00 00 00 00  00 00 76 be 7a 77 29 01  |..........v.zw).|
+00000050  8e 13 02 66 81 43 a0 55  03 35 22 09 de ea 52 bb  |...f.C.U.5"...R.|
+00000060  51 cc c1 09 0e 9b 4d bd  94 85                    |Q.....M...|
diff --git a/src/crypto/tls/testdata/Client-TLSv12-ClientCert-ECDSA-RSA b/src/crypto/tls/testdata/Client-TLSv12-ClientCert-ECDSA-RSA
index 8ef6950c1a..95c5782ab0 100644
--- a/src/crypto/tls/testdata/Client-TLSv12-ClientCert-ECDSA-RSA
+++ b/src/crypto/tls/testdata/Client-TLSv12-ClientCert-ECDSA-RSA
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 51 02 00 00  4d 03 03 32 90 e3 9d cf  |....Q...M..2....|
-00000010  f8 30 76 3f 11 04 cb c3  da 3f d7 61 27 24 04 1d  |.0v?.....?.a'$..|
-00000020  94 1f ef c6 ad 5c 1c 2a  53 6e b0 20 cd 13 4d e0  |.....\.*Sn. ..M.|
-00000030  4d 61 22 48 06 34 04 b0  fd 6b 6f 15 71 3f 29 01  |Ma"H.4...ko.q?).|
-00000040  9f 55 87 02 e2 b8 05 f1  be cc f6 81 00 05 00 00  |.U..............|
+00000000  16 03 03 00 51 02 00 00  4d 03 03 79 e8 35 e3 d2  |....Q...M..y.5..|
+00000010  c0 5e 39 d1 46 da 9c 94  56 20 e2 06 d6 9b f6 dd  |.^9.F...V ......|
+00000020  4f 7a c1 e8 34 a1 9f 8b  c2 e1 fb 20 66 9c 5a 9a  |Oz..4...... f.Z.|
+00000030  3d 22 ab 8e d8 81 03 94  68 a0 6c 72 d8 23 0b 4b  |="......h.lr.#.K|
+00000040  fe 9d c7 49 a7 7c bd fa  b5 7a 5e 5b 00 05 00 00  |...I.|...z^[....|
 00000050  05 ff 01 00 01 00 16 03  03 02 be 0b 00 02 ba 00  |................|
 00000060  02 b7 00 02 b4 30 82 02  b0 30 82 02 19 a0 03 02  |.....0...0......|
 00000070  01 02 02 09 00 85 b0 bb  a4 8a 7f b8 ca 30 0d 06  |.............0..|
@@ -104,26 +104,25 @@
 00000260  ce 39 4c 9c 86 00 08 c2  4b e2 c6 ec 2f f7 ce e6  |.9L.....K.../...|
 00000270  bd 77 82 6f 23 b6 e0 bd  a2 92 b7 3a ac e8 56 f1  |.w.o#......:..V.|
 00000280  af 54 5e 46 87 e9 3b 33  e7 b8 28 b7 d6 c8 90 35  |.T^F..;3..(....5|
-00000290  d4 1c 43 d1 30 6f 55 4e  0a 70 16 03 03 00 93 0f  |..C.0oUN.p......|
-000002a0  00 00 8f 04 03 00 8b 30  81 88 02 42 01 52 b2 5e  |.......0...B.R.^|
-000002b0  b5 12 bc fa 34 5c f3 b1  1c 84 e8 de eb a8 a5 18  |....4\..........|
-000002c0  d0 bd 39 28 5a 84 d2 c9  de 1b 46 77 76 13 a3 61  |..9(Z.....Fwv..a|
-000002d0  55 4e 34 10 27 9d e2 e1  91 eb e7 5e bf da 9b 0e  |UN4.'......^....|
-000002e0  2c 9b 9a 16 2b ab 51 68  43 66 3c 89 c5 25 02 42  |,...+.QhCf<..%.B|
-000002f0  01 11 ec e6 12 4c e4 ca  14 f3 7a c6 99 df a6 89  |.....L....z.....|
-00000300  55 df 22 f4 b1 e0 af a4  e3 b4 fd 1d e9 a4 6b 92  |U."...........k.|
-00000310  10 3d de 36 23 91 34 bd  b4 77 bc c0 27 aa fe c4  |.=.6#.4..w..'...|
-00000320  5a af 88 84 4c 34 8a c5  03 66 53 3b fd 2a 71 0e  |Z...L4...fS;.*q.|
-00000330  02 55 14 03 03 00 01 01  16 03 03 00 24 32 df 2c  |.U..........$2.,|
-00000340  14 17 49 c2 40 49 b2 80  34 80 28 a0 47 7b 99 5d  |..I.@I..4.(.G{.]|
-00000350  13 19 29 bb 4b 7c 48 b5  01 1b 58 63 a3 58 5b 55  |..).K|H...Xc.X[U|
-00000360  b7                                                |.|
+00000290  d4 1c 43 d1 30 6f 55 4e  0a 70 16 03 03 00 92 0f  |..C.0oUN.p......|
+000002a0  00 00 8e 05 03 00 8a 30  81 87 02 41 19 c7 50 06  |.......0...A..P.|
+000002b0  42 82 f9 e5 ec 0b f7 65  7e b1 19 53 5f 23 ab 19  |B......e~..S_#..|
+000002c0  54 08 ec d2 a7 22 dd 83  7c 97 76 59 a5 6b f4 1d  |T...."..|.vY.k..|
+000002d0  92 86 34 2d ce 71 bb 01  d2 8a 67 0e a8 fb 51 e4  |..4-.q....g...Q.|
+000002e0  69 9c 27 23 74 b9 fd 6f  b6 5e 48 a0 cc 02 42 01  |i.'#t..o.^H...B.|
+000002f0  50 97 b7 95 14 f4 a6 f2  95 63 17 38 59 a1 51 95  |P........c.8Y.Q.|
+00000300  1e bc 99 fb fd 82 8b ab  cb 4d 8e 17 a9 f8 e9 c2  |.........M......|
+00000310  9b 93 15 02 50 e6 c2 05  54 e7 8a ec 6f 93 1f 79  |....P...T...o..y|
+00000320  8d 67 e7 2d d6 65 ab 97  fd be 20 97 bd 6b c4 fc  |.g.-.e.... ..k..|
+00000330  02 14 03 03 00 01 01 16  03 03 00 24 24 df 52 6e  |...........$$.Rn|
+00000340  c1 35 48 fe 60 77 28 69  36 fe 96 a1 72 db a2 f5  |.5H.`w(i6...r...|
+00000350  d0 b7 c3 d9 67 e5 ee f2  d9 18 bf f0 35 80 06 c2  |....g.......5...|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 24 e0 42 ea b0 f9  |..........$.B...|
-00000010  b7 48 36 8b 2f 72 c7 32  93 06 12 23 6b 9c f6 5d  |.H6./r.2...#k..]|
-00000020  d5 8b b2 3c 67 38 7c d3  2b d2 c1 a5 e3 a3 49     |...<g8|.+.....I|
+00000000  14 03 03 00 01 01 16 03  03 00 24 40 5b dc 01 59  |..........$@[..Y|
+00000010  33 6e 61 5a 6d fc c8 a5  f5 00 9b 55 77 c5 e6 f2  |3naZm......Uw...|
+00000020  c6 5c b6 2f 94 3c 72 5b  b5 0c 3e 78 88 e6 44     |.\./.<r[..>x..D|
 >>> Flow 5 (client to server)
-00000000  17 03 03 00 1a ca b5 3d  bf 33 a7 35 22 e2 46 54  |.......=.3.5".FT|
-00000010  48 1b 25 63 ae de 0a 6b  86 26 13 bf 92 33 ed 15  |H.%c...k.&...3..|
-00000020  03 03 00 16 7f 9c f0 10  f5 38 aa 5e 8d d5 f9 97  |.........8.^....|
-00000030  95 15 f8 cf 27 d6 53 d7  81 13                    |....'.S...|
+00000000  17 03 03 00 1a cd 2f 11  b1 3a e4 1c 31 95 9b c4  |....../..:..1...|
+00000010  37 20 9f 03 d3 45 a4 15  e1 09 1e 0c f6 5d d3 15  |7 ...E.......]..|
+00000020  03 03 00 16 d7 f6 a1 d0  ad 41 69 73 c0 40 22 f2  |.........Ais.@".|
+00000030  5f e8 c3 50 f9 35 fc 59  e0 3a                    |_..P.5.Y.:|
diff --git a/src/crypto/tls/testdata/Client-TLSv12-ClientCert-RSA-AES256-GCM-SHA384 b/src/crypto/tls/testdata/Client-TLSv12-ClientCert-RSA-AES256-GCM-SHA384
index 30de85fb35..52e3befe61 100644
--- a/src/crypto/tls/testdata/Client-TLSv12-ClientCert-RSA-AES256-GCM-SHA384
+++ b/src/crypto/tls/testdata/Client-TLSv12-ClientCert-RSA-AES256-GCM-SHA384
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 59 02 00 00  55 03 03 c1 99 f4 77 ba  |....Y...U.....w.|
-00000010  f5 46 ef 26 6d 0d e2 57  6f 04 28 01 4e 69 d8 e0  |.F.&m..Wo.(.Ni..|
-00000020  2f 70 03 fe 77 b9 d1 7b  fc 49 ed 20 e2 0f 35 19  |/p..w..{.I. ..5.|
-00000030  ae 5a 66 04 be cc 60 d3  4f 6d ce b2 25 7f 25 24  |.Zf...`.Om..%.%$|
-00000040  31 23 d8 40 bf 78 77 4d  fa 11 22 3d c0 30 00 00  |1#.@.xwM.."=.0..|
+00000000  16 03 03 00 59 02 00 00  55 03 03 74 fe 19 af 4b  |....Y...U..t...K|
+00000010  f3 d8 92 62 5a df 90 2c  cc 09 fd 79 45 26 cd 52  |...bZ..,...yE&.R|
+00000020  9a e6 da 16 99 fe 1d 91  79 a7 a0 20 b3 13 e9 03  |........y.. ....|
+00000030  52 23 5f f0 55 59 f1 9e  00 a7 77 97 90 ed 2b fb  |R#_.UY....w...+.|
+00000040  9c ab fe b1 db ea 16 95  95 68 b0 e9 c0 30 00 00  |.........h...0..|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  03 02 be 0b 00 02 ba 00  02 b7 00 02 b4 30 82 02  |.............0..|
 00000070  b0 30 82 02 19 a0 03 02  01 02 02 09 00 85 b0 bb  |.0..............|
@@ -59,20 +59,20 @@
 000002f0  5f 33 c4 b6 d8 c9 75 90  96 8c 0f 52 98 b5 cd 98  |_3....u....R....|
 00000300  1f 89 20 5f f2 a0 1c a3  1b 96 94 dd a9 fd 57 e9  |.. _..........W.|
 00000310  70 e8 26 6d 71 99 9b 26  6e 38 50 29 6c 90 a7 bd  |p.&mq..&n8P)l...|
-00000320  d9 16 03 03 00 cd 0c 00  00 c9 03 00 17 41 04 2b  |.............A.+|
-00000330  31 48 64 07 93 c0 be 1d  68 24 fc 3a e9 ab fa 89  |1Hd.....h$.:....|
-00000340  5f 30 31 4f 39 bf c5 a4  90 40 2f c1 f3 83 a6 2a  |_01O9....@/....*|
-00000350  00 aa d5 d3 4e 8b ac 3f  4f d6 a2 e5 e6 3b a7 75  |....N..?O....;.u|
-00000360  75 6d 9a de fa 86 ba b8  e5 c0 64 a0 a6 24 8e 04  |um........d..$..|
-00000370  01 00 80 0b 10 7f 53 50  56 f1 0d 66 42 b3 6a ab  |......SPV..fB.j.|
-00000380  8b 47 e5 c2 95 01 3b 1d  e6 00 43 3e 5e 1e 15 27  |.G....;...C>^..'|
-00000390  9c cb eb 71 8a 57 50 29  5d 46 5d a6 b1 66 13 a6  |...q.WP)]F]..f..|
-000003a0  59 0a 0d 8b a1 6f 8b 56  fd 6e 42 df 11 16 00 3c  |Y....o.V.nB....<|
-000003b0  e7 d4 10 6d 03 63 47 25  f5 fa 5d ae b9 67 fd 06  |...m.cG%..]..g..|
-000003c0  e0 c3 8d c3 62 d4 72 18  0b eb 8a c2 3e 40 35 fc  |....b.r.....>@5.|
-000003d0  ec 6f e1 52 95 4f b8 52  4c 8e 97 67 bc 63 9a 37  |.o.R.O.RL..g.c.7|
-000003e0  df 89 2b ae 42 88 b6 f7  5b 31 84 47 44 e2 d8 c2  |..+.B...[1.GD...|
-000003f0  79 a8 b0 16 03 03 00 2e  0d 00 00 26 03 01 02 40  |y..........&...@|
+00000320  d9 16 03 03 00 cd 0c 00  00 c9 03 00 17 41 04 22  |.............A."|
+00000330  84 e9 5e 6e 35 92 a3 83  73 0a d6 0d 1a c1 4d ab  |..^n5...s.....M.|
+00000340  1f ab c2 dc 3f 53 a5 7d  38 c0 92 a4 82 e1 3c c5  |....?S.}8.....<.|
+00000350  24 60 20 a5 3b c5 65 ba  9c f1 b9 a5 b9 c2 70 73  |$` .;.e.......ps|
+00000360  19 74 a6 d1 0f 75 b4 75  e0 e8 60 20 e9 23 fe 04  |.t...u.u..` .#..|
+00000370  01 00 80 92 e0 56 3f 48  0d 10 23 48 b5 95 b6 91  |.....V?H..#H....|
+00000380  3e 8a 2e c7 02 e2 85 0e  59 c8 03 24 d9 1a 1a 25  |>.......Y..$...%|
+00000390  8e 12 bb 0b 83 ac 51 36  81 3f bc 0e be b9 3b 1d  |......Q6.?....;.|
+000003a0  67 56 21 4d 24 36 84 05  61 e7 70 60 d5 8e ae 97  |gV!M$6..a.p`....|
+000003b0  b8 3a d3 b1 94 72 52 cd  b0 0d dd 46 b1 15 3b 58  |.:...rR....F..;X|
+000003c0  c1 a4 63 2c 4c 31 f9 c7  4f 27 c1 0f f0 24 36 72  |..c,L1..O'...$6r|
+000003d0  e0 f8 51 12 86 c2 13 ed  6b 84 a8 15 c3 d0 39 55  |..Q.....k.....9U|
+000003e0  a4 60 50 88 c9 1e 60 60  aa 8d a5 31 3e 35 c3 f8  |.`P...``...1>5..|
+000003f0  2c 90 1c 16 03 03 00 2e  0d 00 00 26 03 01 02 40  |,..........&...@|
 00000400  00 1e 06 01 06 02 06 03  05 01 05 02 05 03 04 01  |................|
 00000410  04 02 04 03 03 01 03 02  03 03 02 01 02 02 02 03  |................|
 00000420  00 00 0e 00 00 00                                 |......|
@@ -114,26 +114,26 @@
 00000220  a7 24 20 3e b2 56 1c ce  97 28 5e f8 2b 2d 4f 9e  |.$ >.V...(^.+-O.|
 00000230  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000240  a6 b5 68 1a 41 03 56 6b  dc 5a 89 16 03 03 00 88  |..h.A.Vk.Z......|
-00000250  0f 00 00 84 04 01 00 80  0a 86 16 61 b0 61 19 af  |...........a.a..|
-00000260  0e 42 fc ec 44 c2 2b dd  27 cc 9a ee d1 a8 64 7c  |.B..D.+.'.....d||
-00000270  ac 69 55 22 3b b2 ba 56  c0 22 53 af 11 be cf f0  |.iU";..V."S.....|
-00000280  90 d1 0e 72 51 d0 f2 4e  cd e0 d2 d6 a0 2f 91 46  |...rQ..N...../.F|
-00000290  fa bd 97 b5 a6 ef 66 2e  5e 15 e2 89 df b0 ea 0e  |......f.^.......|
-000002a0  67 c4 8c 7e a1 4f 9a 00  dc 32 f9 d1 cd 72 ea 1f  |g..~.O...2...r..|
-000002b0  c6 6a 20 54 a2 0f e8 32  50 4e f6 b6 79 70 4c bb  |.j T...2PN..ypL.|
-000002c0  68 8f a8 5a 46 49 a6 54  b6 83 53 df 5f 2b 00 cb  |h..ZFI.T..S._+..|
-000002d0  09 36 86 f1 21 6b bb 98  14 03 03 00 01 01 16 03  |.6..!k..........|
-000002e0  03 00 28 00 00 00 00 00  00 00 00 af 07 a0 f1 0b  |..(.............|
-000002f0  cb 36 97 2c 38 96 e4 02  7c 4d 66 db d0 72 2c 00  |.6.,8...|Mf..r,.|
-00000300  2d ea 21 0a 55 7e 98 9d  65 9a 18                 |-.!.U~..e..|
+00000250  0f 00 00 84 05 01 00 80  33 bb 8e 67 64 03 e7 7e  |........3..gd..~|
+00000260  be a5 b1 bc cf 7a 07 24  01 17 c3 3d 4b 72 dd c3  |.....z.$...=Kr..|
+00000270  64 a7 36 e8 49 ab b6 87  ce d6 af 9e 07 22 76 e8  |d.6.I........"v.|
+00000280  0d 44 a3 36 c9 eb a4 49  85 cf 72 67 e8 2a a7 5b  |.D.6...I..rg.*.[|
+00000290  d3 f2 46 af 53 48 c6 13  f7 0b 5b 9c c7 4d 3e 05  |..F.SH....[..M>.|
+000002a0  3c 0f 69 a7 40 3a e8 70  04 01 1c 29 b2 42 0f 5f  |<.i.@:.p...).B._|
+000002b0  1c d5 b7 5c c2 17 07 7f  bd a2 b3 9a 95 81 51 24  |...\..........Q$|
+000002c0  54 5c 42 d6 a4 76 c0 d7  54 d2 11 54 bf fd dc a0  |T\B..v..T..T....|
+000002d0  ee 95 26 64 59 a0 fc 51  14 03 03 00 01 01 16 03  |..&dY..Q........|
+000002e0  03 00 28 00 00 00 00 00  00 00 00 af f4 8a be d9  |..(.............|
+000002f0  ff f1 44 e4 41 ab 9b b3  d8 b0 3d 3f 6b c5 1d b6  |..D.A.....=?k...|
+00000300  1d 9e 35 f5 20 f4 2a af  e8 35 77                 |..5. .*..5w|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 28 27 8b bb 41 ea  |..........('..A.|
-00000010  84 0b 2b d3 d8 1b 13 7c  7c 9d fd 8d 2d 8e ed 2b  |..+....||...-..+|
-00000020  1f 32 d5 8d 61 e1 bd 7a  74 59 51 a9 b9 85 6f ae  |.2..a..ztYQ...o.|
-00000030  34 1f b1                                          |4..|
+00000000  14 03 03 00 01 01 16 03  03 00 28 ff 0d 47 63 2b  |..........(..Gc+|
+00000010  bd 00 3a ad 82 e3 a7 b3  b0 84 4a 26 f4 30 78 20  |..:.......J&.0x |
+00000020  80 f2 2b 15 98 61 1c cb  8b 17 67 8a 11 96 aa 93  |..+..a....g.....|
+00000030  68 f7 fb                                          |h..|
 >>> Flow 5 (client to server)
-00000000  17 03 03 00 1e 00 00 00  00 00 00 00 01 0c f2 76  |...............v|
-00000010  e3 1c 31 7e bd 51 b4 4a  a8 82 d1 b6 64 51 5f 17  |..1~.Q.J....dQ_.|
-00000020  fc 28 5d 15 03 03 00 1a  00 00 00 00 00 00 00 02  |.(].............|
-00000030  14 1c ec a4 e3 2f 16 d9  22 94 ad be 2a 82 0a 68  |...../.."...*..h|
-00000040  31 d4                                             |1.|
+00000000  17 03 03 00 1e 00 00 00  00 00 00 00 01 a6 8d 7b  |...............{|
+00000010  99 5e a2 e1 95 bb 5f e4  01 f4 0e 20 52 b4 64 4e  |.^...._.... R.dN|
+00000020  86 b1 3f 15 03 03 00 1a  00 00 00 00 00 00 00 02  |..?.............|
+00000030  61 98 eb d0 7c ac bd 00  ac 7a e1 32 20 3e 81 b6  |a...|....z.2 >..|
+00000040  9d d5                                             |..|
diff --git a/src/crypto/tls/testdata/Client-TLSv12-ClientCert-RSA-ECDSA b/src/crypto/tls/testdata/Client-TLSv12-ClientCert-RSA-ECDSA
index 29ebfee51b..23bf29d776 100644
--- a/src/crypto/tls/testdata/Client-TLSv12-ClientCert-RSA-ECDSA
+++ b/src/crypto/tls/testdata/Client-TLSv12-ClientCert-RSA-ECDSA
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 59 02 00 00  55 03 03 ee af 52 7b c4  |....Y...U....R{.|
-00000010  c3 fd 78 e4 02 10 21 66  91 e8 be 88 2c 57 60 ef  |..x...!f....,W`.|
-00000020  44 06 ad 74 61 9e 62 cd  12 e9 b8 20 71 18 ff 58  |D..ta.b.... q..X|
-00000030  5c 5b dd 4c dd de 33 43  ac 1f 6f c0 d4 8e c9 40  |\[.L..3C..o....@|
-00000040  34 4a 96 00 4c 53 b4 32  65 17 00 a9 c0 09 00 00  |4J..LS.2e.......|
+00000000  16 03 03 00 59 02 00 00  55 03 03 b3 7f 4e e7 11  |....Y...U....N..|
+00000010  6d bc 56 ec 9c a8 61 08  d6 5a 2a 42 7b f1 94 0a  |m.V...a..Z*B{...|
+00000020  29 35 8b 7e 23 a0 6c 59  23 cf 39 20 84 09 b6 5b  |)5.~#.lY#.9 ...[|
+00000030  2f 46 80 3b 26 92 fd 81  e9 24 8c e2 b8 64 a2 03  |/F.;&....$...d..|
+00000040  3a 68 c3 7b 44 f8 28 41  e2 d3 6c 7c c0 09 00 00  |:h.{D.(A..l|....|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  03 02 0e 0b 00 02 0a 00  02 07 00 02 04 30 82 02  |.............0..|
 00000070  00 30 82 01 62 02 09 00  b8 bf 2d 47 a0 d2 eb f4  |.0..b.....-G....|
@@ -48,20 +48,20 @@
 00000240  13 83 0d 94 06 bb d4 37  7a f6 ec 7a c9 86 2e dd  |.......7z..z....|
 00000250  d7 11 69 7f 85 7c 56 de  fb 31 78 2b e4 c7 78 0d  |..i..|V..1x+..x.|
 00000260  ae cb be 9e 4e 36 24 31  7b 6a 0f 39 95 12 07 8f  |....N6$1{j.9....|
-00000270  2a 16 03 03 00 d7 0c 00  00 d3 03 00 17 41 04 bd  |*............A..|
-00000280  9c e8 70 51 83 c4 06 84  7a a6 0d 03 e3 00 57 bd  |..pQ....z.....W.|
-00000290  d4 20 68 3b 96 6d 23 18  66 b3 a5 21 66 ef 99 de  |. h;.m#.f..!f...|
-000002a0  41 77 78 f5 d7 3b 0d fb  0e 87 85 1d 93 3e 2a 40  |Awx..;.......>*@|
-000002b0  fd 2c b0 02 6d 5c e7 97  d6 98 55 ff 38 ed 72 04  |.,..m\....U.8.r.|
-000002c0  03 00 8a 30 81 87 02 41  6d e1 1b f8 7b 7b 00 67  |...0...Am...{{.g|
-000002d0  ed 9d 5d 2d c9 75 b1 41  3b b5 03 e6 b5 7e 9e 1d  |..]-.u.A;....~..|
-000002e0  c9 88 c7 a1 da f8 e9 87  52 8a 37 92 02 89 45 5c  |........R.7...E\|
-000002f0  94 d1 4d 1d 36 a1 f0 79  76 18 d3 43 53 23 2c 3f  |..M.6..yv..CS#,?|
-00000300  41 c9 d9 16 90 5c 98 e6  33 02 42 01 e5 56 d3 3c  |A....\..3.B..V.<|
-00000310  6a d9 4e 78 6d 03 2a 93  f2 b9 3e 39 be 36 61 bb  |j.Nxm.*...>9.6a.|
-00000320  54 3f 3f a7 10 db 31 c6  46 13 d6 6a fb 36 93 23  |T??...1.F..j.6.#|
-00000330  a6 40 28 e0 70 69 6e 3f  2b 75 15 69 4f 30 b8 ea  |.@(.pin?+u.iO0..|
-00000340  96 0c 83 c0 c3 78 69 9c  95 07 79 e6 54 16 03 03  |.....xi...y.T...|
+00000270  2a 16 03 03 00 d7 0c 00  00 d3 03 00 17 41 04 0f  |*............A..|
+00000280  4d b0 41 d4 dc 6b 8a 85  52 eb eb 18 4a 8f a7 e6  |M.A..k..R...J...|
+00000290  24 52 e5 86 be 57 d7 0a  e7 23 84 a8 a9 6c 96 08  |$R...W...#...l..|
+000002a0  4b f7 47 32 79 d9 df 81  f6 05 40 63 3b 14 67 3b  |K.G2y.....@c;.g;|
+000002b0  ea 01 a0 0d 43 1a 36 29  b3 51 7a e4 af 1b 67 04  |....C.6).Qz...g.|
+000002c0  03 00 8a 30 81 87 02 42  01 8e 57 8a b8 b7 5b 2f  |...0...B..W...[/|
+000002d0  9c 31 74 d8 7d 68 d7 6e  83 73 5f fb d0 cd de 66  |.1t.}h.n.s_....f|
+000002e0  60 fa 0a 0a 15 0b 30 3b  08 b6 f1 3e 4f 20 13 62  |`.....0;...>O .b|
+000002f0  b5 ff 86 81 dc 42 a1 4c  af c8 ff b3 24 81 d8 e1  |.....B.L....$...|
+00000300  d1 09 0c 32 11 92 5e dd  3f 87 02 41 76 a7 29 48  |...2..^.?..Av.)H|
+00000310  52 68 1c 72 4d d5 39 bf  fa 61 ec b2 27 ce 10 4e  |Rh.rM.9..a..'..N|
+00000320  86 12 3d 1e 04 9c 11 b7  b4 0c cf 98 9d 01 c3 93  |..=.............|
+00000330  cf 83 9e 92 9a ca fd 8f  b1 9f 1b 20 c4 fb a4 46  |........... ...F|
+00000340  60 fc fd d5 33 b0 8f b5  b5 c8 a4 70 c5 16 03 03  |`...3......p....|
 00000350  00 2e 0d 00 00 26 03 01  02 40 00 1e 06 01 06 02  |.....&...@......|
 00000360  06 03 05 01 05 02 05 03  04 01 04 02 04 03 03 01  |................|
 00000370  03 02 03 03 02 01 02 02  02 03 00 00 0e 00 00 00  |................|
@@ -103,31 +103,31 @@
 00000220  a7 24 20 3e b2 56 1c ce  97 28 5e f8 2b 2d 4f 9e  |.$ >.V...(^.+-O.|
 00000230  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000240  a6 b5 68 1a 41 03 56 6b  dc 5a 89 16 03 03 00 88  |..h.A.Vk.Z......|
-00000250  0f 00 00 84 04 01 00 80  2a a8 4b 5b 57 08 92 95  |........*.K[W...|
-00000260  cd a7 5d 95 18 2e 2e ef  83 84 bf 7c c2 ae 44 16  |..]........|..D.|
-00000270  bc 51 ec 00 ae a0 1d 1b  0c 59 d6 0d 22 7f 12 bd  |.Q.......Y.."...|
-00000280  c6 ed 8f 71 51 9c 56 2a  10 fe 9d 22 c6 ae 8f 14  |...qQ.V*..."....|
-00000290  1e b1 a6 0b f2 14 38 6d  7f 52 4a 7b 3b 56 84 8f  |......8m.RJ{;V..|
-000002a0  08 56 e8 07 ff 10 79 41  3b e5 ed 1e 67 db 9c 9f  |.V....yA;...g...|
-000002b0  c2 01 e7 c1 56 8f bf 27  02 f9 8a 4f cb 02 24 39  |....V..'...O..$9|
-000002c0  7e c4 c7 02 62 42 72 c4  7a eb ce d3 48 72 7e 6d  |~...bBr.z...Hr~m|
-000002d0  40 0e d6 ea 6f 6f 11 bb  14 03 03 00 01 01 16 03  |@...oo..........|
+00000250  0f 00 00 84 05 01 00 80  02 19 16 cc 97 ad 70 20  |..............p |
+00000260  bd 64 63 dd b6 81 a0 16  b3 46 4b 42 ff 21 58 2c  |.dc......FKB.!X,|
+00000270  bb 2b 4c e1 4e d7 49 4d  5c 7c 63 32 3e ef e6 ad  |.+L.N.IM\|c2>...|
+00000280  85 3f ab b4 5c 2a 37 76  8b 28 56 08 4f 08 b9 51  |.?..\*7v.(V.O..Q|
+00000290  71 14 07 27 47 45 11 a0  03 cf 72 7d 67 ef 31 8d  |q..'GE....r}g.1.|
+000002a0  e7 db 36 76 b1 b3 f4 bf  aa 6c c4 56 94 35 71 e1  |..6v.....l.V.5q.|
+000002b0  dd 88 6d 15 90 c8 70 ad  d8 95 55 42 9b c1 45 19  |..m...p...UB..E.|
+000002c0  36 ce 87 c6 fd 94 8a d4  98 6e ec 18 d5 da 59 54  |6........n....YT|
+000002d0  80 a7 8c 90 ae 55 20 1c  14 03 03 00 01 01 16 03  |.....U .........|
 000002e0  03 00 40 00 00 00 00 00  00 00 00 00 00 00 00 00  |..@.............|
-000002f0  00 00 00 4a 5f 25 86 84  c5 50 31 5c 96 ae dc 56  |...J_%...P1\...V|
-00000300  de 30 a3 39 8d 82 e9 5a  fa bb a9 64 ec 63 16 55  |.0.9...Z...d.c.U|
-00000310  2f 2d ac f2 cb 38 b0 47  d0 b3 54 0e be 01 4d 7f  |/-...8.G..T...M.|
-00000320  57 4c 62                                          |WLb|
+000002f0  00 00 00 58 fe bc 5c ba  b2 a9 96 77 2f 95 c9 10  |...X..\....w/...|
+00000300  fd 6d fc 6a 88 8c df 82  c3 a4 3d cc 28 f4 bf 7d  |.m.j......=.(..}|
+00000310  4a f8 3d 97 36 e5 a0 76  92 94 da dd cc f5 e4 0e  |J.=.6..v........|
+00000320  7a c4 2c                                          |z.,|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 40 ae da 9b fe 9c  |..........@.....|
-00000010  ce f2 2c 5a 44 68 8b 1c  fc d6 6b 7c 63 bf dd 18  |..,ZDh....k|c...|
-00000020  8e 4a 1e bd 24 3f 60 1f  e8 26 2b a2 a0 2e f1 8f  |.J..$?`..&+.....|
-00000030  b2 a7 a9 eb f0 17 4a a7  79 e4 ae 6b 12 ba 7e c5  |......J.y..k..~.|
-00000040  1d 8f 10 46 cd 47 9a e6  35 46 8f                 |...F.G..5F.|
+00000000  14 03 03 00 01 01 16 03  03 00 40 81 ab 5a 66 a8  |..........@..Zf.|
+00000010  0f a5 d3 07 00 66 45 1f  31 a9 ef f7 a0 d9 23 46  |.....fE.1.....#F|
+00000020  f0 3e 50 18 99 e3 5a bd  eb b7 1d 81 d5 95 d5 ee  |.>P...Z.........|
+00000030  21 31 41 4b 19 92 b5 95  36 da 21 c0 4a 2a a0 1c  |!1AK....6.!.J*..|
+00000040  a3 9f 8e a0 6f 9d 37 5e  12 11 03                 |....o.7^...|
 >>> Flow 5 (client to server)
 00000000  17 03 03 00 30 00 00 00  00 00 00 00 00 00 00 00  |....0...........|
-00000010  00 00 00 00 00 bf 73 92  0b 5d 45 c3 0f 23 f0 8f  |......s..]E..#..|
-00000020  35 a1 96 f6 5b 32 4d 2a  a7 4e da 47 f1 4d 3f 39  |5...[2M*.N.G.M?9|
-00000030  7b 72 06 86 ca 15 03 03  00 30 00 00 00 00 00 00  |{r.......0......|
-00000040  00 00 00 00 00 00 00 00  00 00 dc 0f ca 4c 33 ef  |.............L3.|
-00000050  56 e6 93 69 26 08 e4 d9  43 9f d7 cd d7 69 eb 5f  |V..i&...C....i._|
-00000060  c7 af 4a b7 73 52 0e 66  10 e5                    |..J.sR.f..|
+00000010  00 00 00 00 00 a9 51 94  19 72 ab 9f 3e 97 5e 99  |......Q..r..>.^.|
+00000020  2c ec 13 48 3e 10 54 5f  8a 85 88 4d 1a a8 f5 ed  |,..H>.T_...M....|
+00000030  c3 4f a9 59 a3 15 03 03  00 30 00 00 00 00 00 00  |.O.Y.....0......|
+00000040  00 00 00 00 00 00 00 00  00 00 25 00 6d 2f a0 f6  |..........%.m/..|
+00000050  ce 8a 30 ba 53 da 97 c6  11 f3 d2 f3 9e 66 d6 dd  |..0.S........f..|
+00000060  19 f3 ee 07 03 d3 e6 f1  30 32                    |........02|
diff --git a/src/crypto/tls/testdata/Client-TLSv12-ClientCert-RSA-RSA b/src/crypto/tls/testdata/Client-TLSv12-ClientCert-RSA-RSA
index dc5f32ef3c..ff79aa236c 100644
--- a/src/crypto/tls/testdata/Client-TLSv12-ClientCert-RSA-RSA
+++ b/src/crypto/tls/testdata/Client-TLSv12-ClientCert-RSA-RSA
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 51 02 00 00  4d 03 03 84 42 cd 34 94  |....Q...M...B.4.|
-00000010  d7 b0 b6 b3 7d ae 2a de  73 a7 3a 28 5e e1 24 2d  |....}.*.s.:(^.$-|
-00000020  b7 80 d9 5c f7 7d 3c 0b  c3 7b b2 20 99 e0 4d c8  |...\.}<..{. ..M.|
-00000030  dd d8 7c 56 26 04 9d 0b  ea 6b 8a e7 ee db 02 53  |..|V&....k.....S|
-00000040  0c 7f 81 a9 52 48 79 d4  f8 c5 3e 99 00 05 00 00  |....RHy...>.....|
+00000000  16 03 03 00 51 02 00 00  4d 03 03 b3 b2 22 69 e4  |....Q...M...."i.|
+00000010  1a a1 56 94 26 0c 43 b7  89 0c 34 ce dc 5a c8 ca  |..V.&.C...4..Z..|
+00000020  e2 42 92 5c 75 9a b3 22  22 64 38 20 6d 2c 26 0b  |.B.\u..""d8 m,&.|
+00000030  34 b6 b8 20 36 e2 58 e5  ee 1f e2 9f a0 75 f6 d9  |4.. 6.X......u..|
+00000040  0c e4 39 ce 3c 8e 2e f8  e8 d1 a2 16 00 05 00 00  |..9.<...........|
 00000050  05 ff 01 00 01 00 16 03  03 02 be 0b 00 02 ba 00  |................|
 00000060  02 b7 00 02 b4 30 82 02  b0 30 82 02 19 a0 03 02  |.....0...0......|
 00000070  01 02 02 09 00 85 b0 bb  a4 8a 7f b8 ca 30 0d 06  |.............0..|
@@ -104,24 +104,24 @@
 00000260  e6 bd 77 82 6f 23 b6 e0  bd a2 92 b7 3a ac e8 56  |..w.o#......:..V|
 00000270  f1 af 54 5e 46 87 e9 3b  33 e7 b8 28 b7 d6 c8 90  |..T^F..;3..(....|
 00000280  35 d4 1c 43 d1 30 6f 55  4e 0a 70 16 03 03 00 88  |5..C.0oUN.p.....|
-00000290  0f 00 00 84 04 01 00 80  07 27 0a e8 a0 27 2d 2e  |.........'...'-.|
-000002a0  9d 2d 7e 99 6f 09 64 0a  45 72 72 a8 77 46 8e 1b  |.-~.o.d.Err.wF..|
-000002b0  6f 08 73 d8 09 a6 cb df  4c 0b 7d 68 ac a7 59 81  |o.s.....L.}h..Y.|
-000002c0  bd 37 a9 61 b9 cc 8c ea  19 99 35 f0 c9 4e 4a 9a  |.7.a......5..NJ.|
-000002d0  46 51 75 c5 9f 2c 3b b7  4c 2e 60 77 5e fb 8b 9d  |FQu..,;.L.`w^...|
-000002e0  dd 95 88 b1 08 5d e5 12  f3 56 72 31 fb a4 05 d3  |.....]...Vr1....|
-000002f0  49 6a 65 a1 64 91 7b 1a  f5 d6 36 16 ca 66 c5 b8  |Ije.d.{...6..f..|
-00000300  9a 5e 11 dc 67 d3 a8 0e  e9 dc a7 b6 12 71 34 eb  |.^..g........q4.|
-00000310  28 94 90 ac 43 b5 a7 3b  14 03 03 00 01 01 16 03  |(...C..;........|
-00000320  03 00 24 b0 f0 38 df 6f  54 60 28 61 75 2f 4b 95  |..$..8.oT`(au/K.|
-00000330  9c 91 40 cb 57 f2 dd 9c  4f b7 ad c2 ad 14 cc fc  |..@.W...O.......|
-00000340  27 e6 3c 9a a5 65 5f                              |'.<..e_|
+00000290  0f 00 00 84 05 01 00 80  01 24 8d bb 05 61 2d 29  |.........$...a-)|
+000002a0  12 11 90 f5 57 21 be b7  29 76 55 63 94 8e 7b 4d  |....W!..)vUc..{M|
+000002b0  3b 3d 89 5b 1f b9 e1 8c  36 68 6f 31 21 50 af e4  |;=.[....6ho1!P..|
+000002c0  9f ca a5 68 55 b9 eb 36  75 3a 0c be 11 30 28 c8  |...hU..6u:...0(.|
+000002d0  8b 82 93 9a 71 37 4d 4e  4f d2 0c 2f 13 36 ad c3  |....q7MNO../.6..|
+000002e0  df 8a 1b 59 b2 f9 8b a7  74 63 75 4a f4 9d e0 6b  |...Y....tcuJ...k|
+000002f0  42 02 5a a9 6e a4 a8 24  d3 23 f7 09 ee b0 dc c4  |B.Z.n..$.#......|
+00000300  6f 87 58 72 e7 e3 87 b3  6b 15 ba 7f dd 9b 93 91  |o.Xr....k.......|
+00000310  5b 21 a0 31 31 bd 15 b5  14 03 03 00 01 01 16 03  |[!.11...........|
+00000320  03 00 24 fc 0e 7c e8 3e  8b b5 dc c9 3d 38 61 a1  |..$..|.>....=8a.|
+00000330  24 d6 77 1f 06 1f 30 32  ba dd 05 68 45 f1 4f 0d  |$.w...02...hE.O.|
+00000340  2e 24 09 ad c1 e5 b7                              |.$.....|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 24 27 e5 9c 2c d2  |..........$'..,.|
-00000010  7f 81 83 0b 26 af a4 46  27 46 48 5c ea f3 ef e7  |....&..F'FH\....|
-00000020  ef cc f9 a7 90 80 57 b5  4a 45 37 0e ea 30 fd     |......W.JE7..0.|
+00000000  14 03 03 00 01 01 16 03  03 00 24 d7 b6 b3 0a e6  |..........$.....|
+00000010  86 9a 25 e4 38 de d0 57  ff 93 0b f4 de 76 3d 00  |..%.8..W.....v=.|
+00000020  64 35 cf 70 f6 ea 74 2d  b0 71 2d 92 e2 df eb     |d5.p..t-.q-....|
 >>> Flow 5 (client to server)
-00000000  17 03 03 00 1a 0f 6f ac  25 a6 30 90 68 48 08 ed  |......o.%.0.hH..|
-00000010  48 5f 65 c6 de 24 05 60  17 13 43 e6 11 fc 9f 15  |H_e..$.`..C.....|
-00000020  03 03 00 16 69 87 86 b0  6d 15 a1 c7 eb d5 bd 65  |....i...m......e|
-00000030  95 f5 2d 73 0c 29 fb 05  1b 02                    |..-s.)....|
+00000000  17 03 03 00 1a db bd 43  12 7c b5 83 b5 18 9d 6a  |.......C.|.....j|
+00000010  70 3f 5a eb cb d0 ba d4  03 3e a0 7b 25 f0 41 15  |p?Z......>.{%.A.|
+00000020  03 03 00 16 f8 f2 a3 27  a5 c7 25 d9 6c 08 b1 96  |.......'..%.l...|
+00000030  38 22 38 df 16 fb e2 9f  61 a3                    |8"8.....a.|
diff --git a/src/crypto/tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES b/src/crypto/tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES
index 2e848f511a..e700e16352 100644
--- a/src/crypto/tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES
+++ b/src/crypto/tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 59 02 00 00  55 03 03 ca f8 62 4c b9  |....Y...U....bL.|
-00000010  28 58 c1 01 26 1f 47 88  6a d4 60 88 f0 f2 91 58  |(X..&.G.j.`....X|
-00000020  35 c5 46 fa 13 f2 6e 32  05 f4 d9 20 bd bb 47 e3  |5.F...n2... ..G.|
-00000030  a6 82 53 69 26 3f ac f4  66 5f 09 ad cb 2f 43 a2  |..Si&?..f_.../C.|
-00000040  33 61 71 28 d2 70 3c 0e  79 8c ea 5b c0 09 00 00  |3aq(.p<.y..[....|
+00000000  16 03 03 00 59 02 00 00  55 03 03 21 9b eb 15 24  |....Y...U..!...$|
+00000010  46 b6 c1 85 f5 be c5 0d  e2 6b 60 bc ee 73 b1 fb  |F........k`..s..|
+00000020  34 6f f0 b8 f0 9e 1c 26  a4 4b 0f 20 cb 2b 84 a2  |4o.....&.K. .+..|
+00000030  cb a5 48 70 fe 84 25 b0  16 20 14 a1 83 21 fc f9  |..Hp..%.. ...!..|
+00000040  82 fc 9e 1a d1 3b 56 69  ab c5 0e 2c c0 09 00 00  |.....;Vi...,....|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  03 02 0e 0b 00 02 0a 00  02 07 00 02 04 30 82 02  |.............0..|
 00000070  00 30 82 01 62 02 09 00  b8 bf 2d 47 a0 d2 eb f4  |.0..b.....-G....|
@@ -48,21 +48,21 @@
 00000240  13 83 0d 94 06 bb d4 37  7a f6 ec 7a c9 86 2e dd  |.......7z..z....|
 00000250  d7 11 69 7f 85 7c 56 de  fb 31 78 2b e4 c7 78 0d  |..i..|V..1x+..x.|
 00000260  ae cb be 9e 4e 36 24 31  7b 6a 0f 39 95 12 07 8f  |....N6$1{j.9....|
-00000270  2a 16 03 03 00 d7 0c 00  00 d3 03 00 17 41 04 69  |*............A.i|
-00000280  25 60 5e 4e fd 7e b0 5f  f3 37 2e c9 ae b0 70 5d  |%`^N.~._.7....p]|
-00000290  91 5b 05 cf fa a8 4d c6  f2 db 75 ad 8b b1 b1 00  |.[....M...u.....|
-000002a0  80 5a 63 f5 86 ba e0 4c  44 84 59 cc d5 54 1a 30  |.Zc....LD.Y..T.0|
-000002b0  ce 62 75 1d 3c 10 62 03  d1 f7 cd ed 3a 17 e7 04  |.bu.<.b.....:...|
-000002c0  03 00 8a 30 81 87 02 41  77 66 49 e5 a6 f7 28 6a  |...0...AwfI...(j|
-000002d0  45 90 42 7b c7 8b 11 7c  db 5e db 9a d4 30 e0 e2  |E.B{...|.^...0..|
-000002e0  ce 9d f4 40 be fd da c2  f4 64 75 df 99 16 55 5a  |...@.....du...UZ|
-000002f0  f9 87 7c 54 bb c6 b1 0c  83 40 63 b5 91 57 e0 73  |..|T.....@c..W.s|
-00000300  48 1e d5 2d 4b 22 68 c9  1a 02 42 01 ee cd dd c4  |H..-K"h...B.....|
-00000310  d3 73 8f ef a2 4f ac 3d  cd f1 f1 6e 88 c1 69 49  |.s...O.=...n..iI|
-00000320  cf 81 60 31 ae cd d3 49  d3 56 3f dd d2 5d 25 07  |..`1...I.V?..]%.|
-00000330  09 19 85 98 97 7d 3b c6  35 e2 64 44 bc fd 4d 83  |.....};.5.dD..M.|
-00000340  13 fc 04 5f 00 fd 45 60  10 81 bf e8 e6 16 03 03  |..._..E`........|
-00000350  00 04 0e 00 00 00                                 |......|
+00000270  2a 16 03 03 00 d8 0c 00  00 d4 03 00 17 41 04 b6  |*............A..|
+00000280  3f 37 33 68 cb 79 c0 86  f4 9d 12 ac c4 9d 8c 9b  |?73h.y..........|
+00000290  59 1c d4 a9 01 9f 2d cb  80 24 02 ec e0 ff d1 8c  |Y.....-..$......|
+000002a0  bd 82 67 3f 47 58 1a 2e  6b 61 f6 8e 4e 27 7f 49  |..g?GX..ka..N'.I|
+000002b0  b5 45 f1 0b 9a 33 ff 53  ac 65 e2 82 7a 18 5c 04  |.E...3.S.e..z.\.|
+000002c0  03 00 8b 30 81 88 02 42  00 e1 2d ff 5d e7 77 f1  |...0...B..-.].w.|
+000002d0  12 d9 e4 c2 4d cd 9c b5  ee e4 fd 21 b2 d8 53 a9  |....M......!..S.|
+000002e0  42 e7 c5 9b 51 c3 59 37  a5 08 d4 e6 29 12 c5 56  |B...Q.Y7....)..V|
+000002f0  b8 fe f0 bb 77 87 a3 ee  09 b0 8c cd 1c 39 9e b5  |....w........9..|
+00000300  d9 15 63 53 cb d7 f1 55  5b 48 02 42 01 19 10 8a  |..cS...U[H.B....|
+00000310  7a ee 95 b1 77 44 d4 a3  bf d1 f3 f1 b0 d8 c7 7e  |z...wD.........~|
+00000320  42 c0 83 04 f5 f7 9c c0  ce 6a 98 47 9d 21 29 84  |B........j.G.!).|
+00000330  c8 be 6b 67 4e fc c6 26  ec 63 df 00 33 e6 d2 f7  |..kgN..&.c..3...|
+00000340  34 93 85 9b 1b 0f e0 89  42 b6 0b 94 1b 80 16 03  |4.......B.......|
+00000350  03 00 04 0e 00 00 00                              |.......|
 >>> Flow 3 (client to server)
 00000000  16 03 03 00 46 10 00 00  42 41 04 1e 18 37 ef 0d  |....F...BA...7..|
 00000010  19 51 88 35 75 71 b5 e5  54 5b 12 2e 8f 09 67 fd  |.Q.5uq..T[....g.|
@@ -70,21 +70,21 @@
 00000030  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000040  a6 b5 68 1a 41 03 56 6b  dc 5a 89 14 03 03 00 01  |..h.A.Vk.Z......|
 00000050  01 16 03 03 00 40 00 00  00 00 00 00 00 00 00 00  |.....@..........|
-00000060  00 00 00 00 00 00 00 8b  09 4b 28 ff 39 db 11 e8  |.........K(.9...|
-00000070  34 c3 65 8f 40 36 b6 b1  e3 61 6f 39 4f 4a 3d ae  |4.e.@6...ao9OJ=.|
-00000080  66 91 05 cb a0 38 ff fa  25 07 fc 23 33 ca f7 ae  |f....8..%..#3...|
-00000090  2d ec b9 d3 0c ee                                 |-.....|
+00000060  00 00 00 00 00 00 50 73  9c 9f a8 d7 78 ac 06 14  |......Ps....x...|
+00000070  8f ae fc fb ef 7d 99 db  b7 c9 91 dd f2 fe da 1b  |.....}..........|
+00000080  aa 9e 7d e4 5c 2f 5f dd  74 aa fe 03 51 e7 cd 98  |..}.\/_.t...Q...|
+00000090  e9 21 19 c9 6f 59                                 |.!..oY|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 40 6d 9e 2d 70 be  |..........@m.-p.|
-00000010  88 57 ca 0b 29 d4 dc e2  47 6d b4 67 d8 79 e9 86  |.W..)...Gm.g.y..|
-00000020  9b 1c 60 37 35 e8 e8 4a  ce 9a 79 b8 ac 88 b9 28  |..`75..J..y....(|
-00000030  38 ed 16 9a ae 24 8f 35  88 f0 dc ab 91 ef 3b c2  |8....$.5......;.|
-00000040  1a 06 d6 21 df 77 62 c4  36 86 85                 |...!.wb.6..|
+00000000  14 03 03 00 01 01 16 03  03 00 40 47 18 b5 1b 75  |..........@G...u|
+00000010  b8 a3 63 ab 77 d3 47 cb  14 26 b4 88 fe 15 db 22  |..c.w.G..&....."|
+00000020  76 3b 25 d3 68 8e f2 a7  d5 03 2b 82 7b b1 0f 10  |v;%.h.....+.{...|
+00000030  49 6a 3d 95 d0 4b 55 0e  14 eb bb a7 34 bb 57 b3  |Ij=..KU.....4.W.|
+00000040  5d fb 7e 15 80 5a fa f3  3a df 90                 |].~..Z..:..|
 >>> Flow 5 (client to server)
 00000000  17 03 03 00 30 00 00 00  00 00 00 00 00 00 00 00  |....0...........|
-00000010  00 00 00 00 00 8d 64 6c  05 87 7d 17 08 7c d4 f0  |......dl..}..|..|
-00000020  86 42 ad 22 a7 05 07 97  6f ad 8e 1a c0 80 fd 91  |.B."....o.......|
-00000030  3d 0e fc da ad 15 03 03  00 30 00 00 00 00 00 00  |=........0......|
-00000040  00 00 00 00 00 00 00 00  00 00 0d b1 ff 41 76 5f  |.............Av_|
-00000050  95 6e b2 0e 1f 8c ae 54  91 b4 aa 05 7c 5b cc 90  |.n.....T....|[..|
-00000060  64 80 92 66 f4 5a 48 98  5e 65                    |d..f.ZH.^e|
+00000010  00 00 00 00 00 70 74 e2  60 fc 3a 7a b7 5e 16 07  |.....pt.`.:z.^..|
+00000020  22 92 07 fe 92 53 c4 43  1b 8f 94 07 84 48 2b 50  |"....S.C.....H+P|
+00000030  ab 1d 6d 49 ed 15 03 03  00 30 00 00 00 00 00 00  |..mI.....0......|
+00000040  00 00 00 00 00 00 00 00  00 00 ce a8 ba 91 0b e4  |................|
+00000050  8c 38 23 9b 8b 2c 0a 0c  63 79 61 f4 b6 25 f7 41  |.8#..,..cya..%.A|
+00000060  04 9f b0 8f e0 e5 24 44  2f e9                    |......$D/.|
diff --git a/src/crypto/tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES-GCM b/src/crypto/tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES-GCM
index 48d4ce902d..607ecdcb24 100644
--- a/src/crypto/tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES-GCM
+++ b/src/crypto/tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES-GCM
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 59 02 00 00  55 03 03 cc 2d 9e fe 46  |....Y...U...-..F|
-00000010  a5 dc a6 93 4e 58 ff 13  04 cd 5a fb eb 0f 6f c2  |....NX....Z...o.|
-00000020  46 58 19 c1 38 4b ed 3c  3a d4 c9 20 96 e6 c7 ee  |FX..8K.<:.. ....|
-00000030  b5 6a 98 e7 f1 18 92 b4  f3 ab 0e d4 ac f2 02 4b  |.j.............K|
-00000040  bf 93 cc bf 3d 42 72 6a  cd c8 b6 76 c0 2b 00 00  |....=Brj...v.+..|
+00000000  16 03 03 00 59 02 00 00  55 03 03 91 8a 4f 94 29  |....Y...U....O.)|
+00000010  32 fa 66 7a 7f b8 a7 04  5c 34 b9 7e 12 83 35 1f  |2.fz....\4.~..5.|
+00000020  93 b0 af e0 9f 71 07 5e  2f d7 ca 20 52 dc 0d e7  |.....q.^/.. R...|
+00000030  f8 16 db 90 9a 78 2f 03  0b f0 ae a7 2f c6 b4 4c  |.....x/...../..L|
+00000040  62 e7 de 32 d5 68 61 f3  07 e4 60 d2 c0 2b 00 00  |b..2.ha...`..+..|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  03 02 0e 0b 00 02 0a 00  02 07 00 02 04 30 82 02  |.............0..|
 00000070  00 30 82 01 62 02 09 00  b8 bf 2d 47 a0 d2 eb f4  |.0..b.....-G....|
@@ -48,20 +48,20 @@
 00000240  13 83 0d 94 06 bb d4 37  7a f6 ec 7a c9 86 2e dd  |.......7z..z....|
 00000250  d7 11 69 7f 85 7c 56 de  fb 31 78 2b e4 c7 78 0d  |..i..|V..1x+..x.|
 00000260  ae cb be 9e 4e 36 24 31  7b 6a 0f 39 95 12 07 8f  |....N6$1{j.9....|
-00000270  2a 16 03 03 00 d8 0c 00  00 d4 03 00 17 41 04 4b  |*............A.K|
-00000280  42 a6 35 4b d4 eb d8 9c  08 38 7a 50 3f 24 33 16  |B.5K.....8zP?$3.|
-00000290  10 d9 16 cd 2f e8 7a 83  a4 f2 09 aa 7c 2c 61 de  |..../.z.....|,a.|
-000002a0  e0 b6 20 22 b0 cf f6 c6  2a e9 da 4b 55 b8 13 a0  |.. "....*..KU...|
-000002b0  94 16 33 dd 46 32 7a 7b  6e 0b 43 96 00 68 40 04  |..3.F2z{n.C..h@.|
-000002c0  03 00 8b 30 81 88 02 42  01 66 b1 9f aa 18 59 d6  |...0...B.f....Y.|
-000002d0  2a 37 2f 68 de 21 69 bd  c2 70 a8 12 1e 6e 8d b3  |*7/h.!i..p...n..|
-000002e0  06 87 16 21 c9 ad 3f 94  23 ea 15 ce c1 ed cc 37  |...!..?.#......7|
-000002f0  4e 0a 75 62 24 31 d6 8c  57 38 05 f0 46 09 ba 2d  |N.ub$1..W8..F..-|
-00000300  f0 a3 f5 de cb 0a 7f 8a  8a bc 02 42 01 64 e5 d7  |...........B.d..|
-00000310  5b f3 14 9d c0 77 a5 00  ed aa 6b d2 48 42 16 fe  |[....w....k.HB..|
-00000320  d1 b5 13 df e1 71 6b 48  9a a0 9a 7d 35 79 ef 4b  |.....qkH...}5y.K|
-00000330  eb a4 a0 05 ce 43 05 62  d9 58 73 34 fd 03 d8 24  |.....C.b.Xs4...$|
-00000340  d8 9b 95 cd cd 7b f1 00  a5 96 f0 8a 66 48 16 03  |.....{......fH..|
+00000270  2a 16 03 03 00 d8 0c 00  00 d4 03 00 17 41 04 26  |*............A.&|
+00000280  c1 67 14 4b 9e b0 45 8c  27 bf a3 a2 78 5b 56 ad  |.g.K..E.'...x[V.|
+00000290  d1 21 56 53 df 86 e9 91  de e3 f9 5d e6 f6 5d 79  |.!VS.......]..]y|
+000002a0  11 8b 60 f9 c2 9a c6 3f  6b 72 cd 7c d7 0e 13 64  |..`....?kr.|...d|
+000002b0  af e8 9f 40 35 e6 fb 04  0c 60 aa 19 61 dd 24 04  |...@5....`..a.$.|
+000002c0  03 00 8b 30 81 88 02 42  00 9d e1 02 5d 8b b1 45  |...0...B....]..E|
+000002d0  e5 c7 b6 94 27 df 36 31  fd 5e 47 fe c8 0f 5f 17  |....'.61.^G..._.|
+000002e0  b1 92 56 76 29 45 3d 90  be 91 6e 2c a7 b2 e1 33  |..Vv)E=...n,...3|
+000002f0  3b f9 3c bb 80 58 c2 d8  a8 59 82 16 dc 9e dd 60  |;.<..X...Y.....`|
+00000300  ff 82 b9 0c 5a ca ff f3  02 2c 02 42 00 a4 c0 d3  |....Z....,.B....|
+00000310  aa 1d 69 52 c0 06 fa 93  e8 50 da a4 2f 72 c9 4a  |..iR.....P../r.J|
+00000320  2c 43 7f 95 05 f7 7a f3  4a 2e 2d ce 13 be 80 40  |,C....z.J.-....@|
+00000330  a4 3b b2 f0 73 8d f1 d4  7b a3 ff 01 e1 58 71 31  |.;..s...{....Xq1|
+00000340  fc d8 2f b3 ef 62 2e b7  ac f5 c4 bc b8 68 16 03  |../..b.......h..|
 00000350  03 00 04 0e 00 00 00                              |.......|
 >>> Flow 3 (client to server)
 00000000  16 03 03 00 46 10 00 00  42 41 04 1e 18 37 ef 0d  |....F...BA...7..|
@@ -69,17 +69,17 @@
 00000020  a7 24 20 3e b2 56 1c ce  97 28 5e f8 2b 2d 4f 9e  |.$ >.V...(^.+-O.|
 00000030  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000040  a6 b5 68 1a 41 03 56 6b  dc 5a 89 14 03 03 00 01  |..h.A.Vk.Z......|
-00000050  01 16 03 03 00 28 00 00  00 00 00 00 00 00 c0 1c  |.....(..........|
-00000060  10 ee 8d 98 b4 78 2d 7f  84 48 6d 6b 35 96 1d 4e  |.....x-..Hmk5..N|
-00000070  8c 00 13 a9 ca 35 50 9a  8c d5 07 63 95 54        |.....5P....c.T|
+00000050  01 16 03 03 00 28 00 00  00 00 00 00 00 00 83 cf  |.....(..........|
+00000060  ef 50 c2 e7 da b9 74 7f  1c e0 b8 fb dc 39 c9 98  |.P....t......9..|
+00000070  0c a3 7d 8c c6 fa 6f f2  ee 44 a0 a0 03 18        |..}...o..D....|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 28 3b 0b 13 c6 82  |..........(;....|
-00000010  d3 83 a9 bc b7 64 b5 e6  17 16 58 99 5d f1 b1 c0  |.....d....X.]...|
-00000020  dd bf 62 e4 c6 76 7a 4a  fc fe ba 1b 9a 3e 63 5c  |..b..vzJ.....>c\|
-00000030  86 cd f5                                          |...|
+00000000  14 03 03 00 01 01 16 03  03 00 28 73 c4 48 24 3d  |..........(s.H$=|
+00000010  8f 5f f3 8c fc fd 63 be  64 39 d5 56 67 bd d7 c4  |._....c.d9.Vg...|
+00000020  0d 57 88 1a 45 a6 f3 ad  11 b2 5a 41 58 33 f3 d3  |.W..E.....ZAX3..|
+00000030  58 fa 21                                          |X.!|
 >>> Flow 5 (client to server)
-00000000  17 03 03 00 1e 00 00 00  00 00 00 00 01 e2 da ed  |................|
-00000010  5b ad 71 ad 0f e0 7b 60  4f dc 27 68 ad 9d 06 08  |[.q...{`O.'h....|
-00000020  85 3a 35 15 03 03 00 1a  00 00 00 00 00 00 00 02  |.:5.............|
-00000030  7b ed 30 41 50 99 97 df  49 c3 54 dc 38 e7 5b a2  |{.0AP...I.T.8.[.|
-00000040  f5 f4                                             |..|
+00000000  17 03 03 00 1e 00 00 00  00 00 00 00 01 65 5e 55  |.............e^U|
+00000010  32 be 00 77 6e 1d 8e 8f  95 33 24 3d 7a c2 b0 3f  |2..wn....3$=z..?|
+00000020  ca aa 97 15 03 03 00 1a  00 00 00 00 00 00 00 02  |................|
+00000030  b2 71 6e 42 6a 0d cf c9  ac 14 a4 b5 9c c9 71 60  |.qnBj.........q`|
+00000040  d7 c2                                             |..|
diff --git a/src/crypto/tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES256-GCM-SHA384 b/src/crypto/tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES256-GCM-SHA384
index ea7cdd3fba..df2f7376de 100644
--- a/src/crypto/tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES256-GCM-SHA384
+++ b/src/crypto/tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES256-GCM-SHA384
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 59 02 00 00  55 03 03 e2 3e 94 5f bb  |....Y...U...>._.|
-00000010  e3 2e d6 77 2d 3d 54 34  01 cd eb 6a 76 f8 b4 51  |...w-=T4...jv..Q|
-00000020  a8 12 2f b4 92 d7 9e 7a  7b 6b 1b 20 3a 78 82 12  |../....z{k. :x..|
-00000030  b0 be 0a c8 85 4a 48 c1  9c cc c0 5d a7 94 bb 35  |.....JH....]...5|
-00000040  8a 9f 8d df e2 d2 9f 68  a8 27 60 08 c0 2c 00 00  |.......h.'`..,..|
+00000000  16 03 03 00 59 02 00 00  55 03 03 11 50 81 a7 ef  |....Y...U...P...|
+00000010  3f bd a5 a9 41 11 e6 86  b2 a3 d8 bf 29 c3 d4 f4  |?...A.......)...|
+00000020  b6 20 2d cb 94 1b 0e dd  99 d1 0b 20 78 92 23 31  |. -........ x.#1|
+00000030  e3 fc 99 67 1f fd f3 2a  fc 9c 4c 74 6e 32 e4 f8  |...g...*..Ltn2..|
+00000040  ed 6d 2e 6d ad a9 a9 bf  63 27 7e 44 c0 2c 00 00  |.m.m....c'~D.,..|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  03 02 0e 0b 00 02 0a 00  02 07 00 02 04 30 82 02  |.............0..|
 00000070  00 30 82 01 62 02 09 00  b8 bf 2d 47 a0 d2 eb f4  |.0..b.....-G....|
@@ -48,38 +48,38 @@
 00000240  13 83 0d 94 06 bb d4 37  7a f6 ec 7a c9 86 2e dd  |.......7z..z....|
 00000250  d7 11 69 7f 85 7c 56 de  fb 31 78 2b e4 c7 78 0d  |..i..|V..1x+..x.|
 00000260  ae cb be 9e 4e 36 24 31  7b 6a 0f 39 95 12 07 8f  |....N6$1{j.9....|
-00000270  2a 16 03 03 00 d8 0c 00  00 d4 03 00 17 41 04 e1  |*............A..|
-00000280  40 a0 30 8f 36 c0 5e 71  a7 ea 45 ba 35 af a8 d9  |@.0.6.^q..E.5...|
-00000290  6d c7 94 a5 bc 8d ea 0d  da 99 45 1d ce eb 91 79  |m.........E....y|
-000002a0  95 d1 a5 13 17 3f a9 16  db e2 0b 7a e9 90 be b4  |.....?.....z....|
-000002b0  de c5 e1 ea 3b 65 70 96  9e 42 50 3d a9 d4 96 04  |....;ep..BP=....|
-000002c0  03 00 8b 30 81 88 02 42  01 99 d1 c4 12 5c 99 6f  |...0...B.....\.o|
-000002d0  5b eb fa 54 ba cb 92 56  92 01 3a 93 21 40 61 b3  |[..T...V..:.!@a.|
-000002e0  8f f4 0c 6a 83 cf 4d 3c  b3 95 c3 2b 65 e2 24 c8  |...j..M<...+e.$.|
-000002f0  8e 01 1e 1e 6a c6 10 6b  73 fd d3 ce f3 fe 30 0f  |....j..ks.....0.|
-00000300  99 94 e8 75 e6 2f a4 90  48 dd 02 42 00 a9 44 3a  |...u./..H..B..D:|
-00000310  a7 db 78 16 80 01 7d 83  7f 9f 92 ba c1 73 08 08  |..x...}......s..|
-00000320  85 de b2 79 96 9a 04 28  b8 27 ea 0e 7d d1 ae 50  |...y...(.'..}..P|
-00000330  c3 bb 8c a4 b9 d6 ab 5b  78 dd 23 b2 a8 ae 09 23  |.......[x.#....#|
-00000340  2c 58 8d 30 97 03 e1 3a  64 e0 ef a4 f4 cc 16 03  |,X.0...:d.......|
-00000350  03 00 04 0e 00 00 00                              |.......|
+00000270  2a 16 03 03 00 d7 0c 00  00 d3 03 00 17 41 04 fc  |*............A..|
+00000280  e6 25 27 3c 76 10 a8 9e  d3 a4 a8 68 31 06 85 fc  |.%'<v......h1...|
+00000290  35 2a 76 b3 ad 08 c5 70  ed 3d 61 e0 29 cc 47 52  |5*v....p.=a.).GR|
+000002a0  68 21 ab 48 19 f9 28 ba  54 8c 56 8e b0 7d 55 7f  |h!.H..(.T.V..}U.|
+000002b0  75 f5 42 38 61 ff e2 06  98 1a ae fc bc a0 3a 04  |u.B8a.........:.|
+000002c0  03 00 8a 30 81 87 02 42  01 0c b2 7f c9 d3 1b 83  |...0...B........|
+000002d0  1e 24 a3 d7 1c 81 f0 02  ae ed 42 6f e9 d9 91 4d  |.$........Bo...M|
+000002e0  16 5f aa 8e 5a de 3b 00  0e e6 2d fb 05 30 f3 cf  |._..Z.;...-..0..|
+000002f0  31 a2 ec 99 87 ea 42 03  0a 57 82 e5 12 27 98 8a  |1.....B..W...'..|
+00000300  c6 56 4b 9a 0b d7 37 5f  46 50 02 41 57 61 13 3c  |.VK...7_FP.AWa.<|
+00000310  48 d0 b3 b0 d5 21 72 49  80 7b d7 ef 8f 0d a0 c5  |H....!rI.{......|
+00000320  88 a1 5d ca 61 6d fb 8b  51 15 5d e5 a2 61 c4 78  |..].am..Q.]..a.x|
+00000330  8f d9 e3 78 df 7d a0 8f  0c c0 cc 18 36 41 e6 bb  |...x.}......6A..|
+00000340  6d e3 9d 04 c2 c4 d0 66  35 45 9a 08 b2 16 03 03  |m......f5E......|
+00000350  00 04 0e 00 00 00                                 |......|
 >>> Flow 3 (client to server)
 00000000  16 03 03 00 46 10 00 00  42 41 04 1e 18 37 ef 0d  |....F...BA...7..|
 00000010  19 51 88 35 75 71 b5 e5  54 5b 12 2e 8f 09 67 fd  |.Q.5uq..T[....g.|
 00000020  a7 24 20 3e b2 56 1c ce  97 28 5e f8 2b 2d 4f 9e  |.$ >.V...(^.+-O.|
 00000030  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000040  a6 b5 68 1a 41 03 56 6b  dc 5a 89 14 03 03 00 01  |..h.A.Vk.Z......|
-00000050  01 16 03 03 00 28 00 00  00 00 00 00 00 00 a6 fe  |.....(..........|
-00000060  72 48 b3 1e e8 9e 33 87  a9 0d d4 b3 bd 43 8b e6  |rH....3......C..|
-00000070  b7 b0 d6 79 0e ec f3 71  29 a4 82 fb f4 ba        |...y...q).....|
+00000050  01 16 03 03 00 28 00 00  00 00 00 00 00 00 a3 3f  |.....(.........?|
+00000060  be 65 91 cd fe 37 43 e0  ea 6f 15 9d c2 aa 6a 02  |.e...7C..o....j.|
+00000070  20 b8 bc b5 c8 9a 1c d4  c4 e5 9b 2e 39 e7        | ...........9.|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 28 bd 25 17 61 fd  |..........(.%.a.|
-00000010  a4 8c c6 a3 c9 ed 39 9e  bb 29 05 5c fc 67 43 ed  |......9..).\.gC.|
-00000020  2d 76 89 b6 4b 1e 58 68  da ad 91 14 9c fe ba 43  |-v..K.Xh.......C|
-00000030  c3 72 70                                          |.rp|
+00000000  14 03 03 00 01 01 16 03  03 00 28 7c b7 1f 13 9e  |..........(|....|
+00000010  21 d2 eb db 32 fc 36 d0  53 e1 11 04 ce d0 61 33  |!...2.6.S.....a3|
+00000020  1e 30 3d 91 c3 6a 0d 98  55 f5 e0 5c ca 77 fa 72  |.0=..j..U..\.w.r|
+00000030  63 6a be                                          |cj.|
 >>> Flow 5 (client to server)
-00000000  17 03 03 00 1e 00 00 00  00 00 00 00 01 0d 17 75  |...............u|
-00000010  aa f3 99 28 d9 e7 44 71  d1 bc d3 bc 9a 9f ac ad  |...(..Dq........|
-00000020  f3 02 07 15 03 03 00 1a  00 00 00 00 00 00 00 02  |................|
-00000030  0f 43 fe d9 b2 66 3e b4  76 69 15 bd 8a 3e 3d b1  |.C...f>.vi...>=.|
-00000040  84 61                                             |.a|
+00000000  17 03 03 00 1e 00 00 00  00 00 00 00 01 d9 db db  |................|
+00000010  4b 3a ae 5c a4 dc 96 33  ed b5 a0 70 64 1f 96 2f  |K:.\...3...pd../|
+00000020  b6 cd 1e 15 03 03 00 1a  00 00 00 00 00 00 00 02  |................|
+00000030  18 a0 d1 98 a6 71 c9 56  36 bd 1a 46 4b 5b 45 29  |.....q.V6..FK[E)|
+00000040  1f dd                                             |..|
diff --git a/src/crypto/tls/testdata/Client-TLSv12-ECDHE-RSA-AES b/src/crypto/tls/testdata/Client-TLSv12-ECDHE-RSA-AES
index 8c1a4c513a..994ebb1e37 100644
--- a/src/crypto/tls/testdata/Client-TLSv12-ECDHE-RSA-AES
+++ b/src/crypto/tls/testdata/Client-TLSv12-ECDHE-RSA-AES
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 59 02 00 00  55 03 03 43 a9 87 d8 4b  |....Y...U..C...K|
-00000010  c5 5a 79 e5 79 a5 1c ce  dd 2a fa a6 7d 7e 84 16  |.Zy.y....*..}~..|
-00000020  43 ea 7d 54 17 a4 9a 61  3b cd 1a 20 f5 22 8d 59  |C.}T...a;.. .".Y|
-00000030  2f f2 a7 8b 41 a4 3a 1a  f1 1c 17 4c 97 19 d9 31  |/...A.:....L...1|
-00000040  b1 d6 a9 02 b6 78 58 0d  54 f1 83 f7 c0 13 00 00  |.....xX.T.......|
+00000000  16 03 03 00 59 02 00 00  55 03 03 e6 ae 89 0d 22  |....Y...U......"|
+00000010  e5 e0 cd 57 a3 ca 71 4f  17 2f 64 77 f8 30 89 ef  |...W..qO./dw.0..|
+00000020  e8 19 70 ac dd 2c c5 9f  84 7d 1d 20 1c 59 3c fe  |..p..,...}. .Y<.|
+00000030  a9 ec 10 dd 38 3b 43 fe  6b 09 e5 e4 83 d9 7a 78  |....8;C.k.....zx|
+00000040  86 08 33 da 9b e1 09 d8  c9 07 34 19 c0 13 00 00  |..3.......4.....|
 00000050  0d ff 01 00 01 00 00 0b  00 04 03 00 01 02 16 03  |................|
 00000060  03 02 be 0b 00 02 ba 00  02 b7 00 02 b4 30 82 02  |.............0..|
 00000070  b0 30 82 02 19 a0 03 02  01 02 02 09 00 85 b0 bb  |.0..............|
@@ -59,20 +59,20 @@
 000002f0  5f 33 c4 b6 d8 c9 75 90  96 8c 0f 52 98 b5 cd 98  |_3....u....R....|
 00000300  1f 89 20 5f f2 a0 1c a3  1b 96 94 dd a9 fd 57 e9  |.. _..........W.|
 00000310  70 e8 26 6d 71 99 9b 26  6e 38 50 29 6c 90 a7 bd  |p.&mq..&n8P)l...|
-00000320  d9 16 03 03 00 cd 0c 00  00 c9 03 00 17 41 04 53  |.............A.S|
-00000330  a6 ea d2 0d 76 bf ec f8  50 3d aa 86 19 49 57 65  |....v...P=...IWe|
-00000340  b0 4e 52 7e f8 c1 e8 93  13 7b 2e cb e5 51 38 3c  |.NR~.....{...Q8<|
-00000350  8e 49 ac 6a 56 8a 38 09  f4 d4 ba c9 ef 5f 57 55  |.I.jV.8......_WU|
-00000360  d7 b8 5e 46 7b ba f0 08  d0 7f be b0 c7 49 56 04  |..^F{........IV.|
-00000370  01 00 80 a6 82 86 48 1c  4d 73 31 89 16 3e 62 a6  |......H.Ms1..>b.|
-00000380  8f 70 3b 9a f3 80 1f 99  f8 f8 f4 5b b0 37 c2 82  |.p;........[.7..|
-00000390  2f c0 e1 52 48 98 a2 71  d5 8e 65 29 1c d2 af ef  |/..RH..q..e)....|
-000003a0  b2 2b 55 90 ca db 8d 99  f8 b0 66 62 c4 19 d0 fa  |.+U.......fb....|
-000003b0  78 75 63 5a d7 21 51 99  41 c4 ac 1e 78 07 1d ee  |xucZ.!Q.A...x...|
-000003c0  1a 54 06 d0 a0 41 f6 03  75 29 4c 61 9d cc f3 96  |.T...A..u)La....|
-000003d0  a4 9b 1a 3f 0c 43 32 44  fe 32 25 71 9c 2e 04 79  |...?.C2D.2%q...y|
-000003e0  ec d5 bb 05 f0 c5 a6 f1  cf 27 d4 9b 44 59 11 90  |.........'..DY..|
-000003f0  28 0e f3 16 03 03 00 04  0e 00 00 00              |(...........|
+00000320  d9 16 03 03 00 cd 0c 00  00 c9 03 00 17 41 04 77  |.............A.w|
+00000330  87 a7 ad f6 f8 34 82 05  ef bb 14 6d c7 8b 7b 2a  |.....4.....m..{*|
+00000340  4d ca 41 65 58 3c 83 fa  4d ce 0c 74 46 85 fe 38  |M.AeX<..M..tF..8|
+00000350  95 80 ee 7c c2 bf f2 be  a3 c6 bf f3 aa 07 23 40  |...|..........#@|
+00000360  7e cc 74 4a 4e 2e 69 af  6b e0 42 8a fc 41 be 04  |~.tJN.i.k.B..A..|
+00000370  01 00 80 99 ed a8 3a ef  93 1b 4c 17 80 9e cc eb  |......:...L.....|
+00000380  da 39 fb c8 9a 73 e1 96  20 3e 41 fa 8b 1a b1 68  |.9...s.. >A....h|
+00000390  cd 47 bc 4b 7b 0c 14 da  87 d3 36 09 5e 37 33 88  |.G.K{.....6.^73.|
+000003a0  7f 88 07 87 46 ec e5 72  a8 59 92 07 fa 4d 02 dc  |....F..r.Y...M..|
+000003b0  bf 3a f5 e4 77 0b a6 85  ce 43 ee 1b 90 30 7f ec  |.:..w....C...0..|
+000003c0  88 79 f8 88 59 af 6b 7f  2d 88 de 92 cd c8 36 cf  |.y..Y.k.-.....6.|
+000003d0  ba b9 08 6a c4 3d d7 9a  48 50 e1 67 d0 62 a5 b3  |...j.=..HP.g.b..|
+000003e0  b0 5f 2e 16 ee 4d 7d a2  cf d9 93 19 89 b7 64 0f  |._...M}.......d.|
+000003f0  0f 8e 3d 16 03 03 00 04  0e 00 00 00              |..=.........|
 >>> Flow 3 (client to server)
 00000000  16 03 03 00 46 10 00 00  42 41 04 1e 18 37 ef 0d  |....F...BA...7..|
 00000010  19 51 88 35 75 71 b5 e5  54 5b 12 2e 8f 09 67 fd  |.Q.5uq..T[....g.|
@@ -80,21 +80,21 @@
 00000030  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000040  a6 b5 68 1a 41 03 56 6b  dc 5a 89 14 03 03 00 01  |..h.A.Vk.Z......|
 00000050  01 16 03 03 00 40 00 00  00 00 00 00 00 00 00 00  |.....@..........|
-00000060  00 00 00 00 00 00 06 2c  27 d7 55 ab 75 1f fe 03  |.......,'.U.u...|
-00000070  c3 43 d0 c0 39 84 90 01  89 35 44 c6 fe b5 12 36  |.C..9....5D....6|
-00000080  af 05 9e 06 c7 3b a5 70  5c 2b 18 e6 ae ae c4 ae  |.....;.p\+......|
-00000090  17 b7 45 a0 1f ee                                 |..E...|
+00000060  00 00 00 00 00 00 f2 20  58 ec f1 88 a6 26 79 9d  |....... X....&y.|
+00000070  2e 9b 02 b5 5e da e2 c1  c5 8d c8 93 6f 6d 07 4e  |....^.......om.N|
+00000080  fa dd ee cb b1 ae c7 3b  09 b2 cc 64 7a cd 98 91  |.......;...dz...|
+00000090  cb f8 3c 34 3b ed                                 |..<4;.|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 40 c2 48 45 2f 74  |..........@.HE/t|
-00000010  66 b2 02 32 69 fd 6d 53  48 51 9c 8f d1 ab c1 77  |f..2i.mSHQ.....w|
-00000020  e1 4f 5e 32 2b e0 e4 5d  20 df e2 27 5b a9 e8 cd  |.O^2+..] ..'[...|
-00000030  37 13 de 44 37 f5 f1 41  ca cf 1d 8c 6c ba 18 42  |7..D7..A....l..B|
-00000040  0c 75 58 56 12 b7 4f 74  20 d0 86                 |.uXV..Ot ..|
+00000000  14 03 03 00 01 01 16 03  03 00 40 4c a1 8d bd 49  |..........@L...I|
+00000010  33 d3 72 fb 2f 23 7e 11  29 fc d2 ff 9b 67 30 c8  |3.r./#~.)....g0.|
+00000020  be c1 bc 51 6e 92 a5 f4  9d e3 b3 f9 d2 d4 c4 a5  |...Qn...........|
+00000030  83 23 90 b3 17 00 35 18  c5 ef 8b 18 a3 cf ed 9d  |.#....5.........|
+00000040  a9 52 c9 11 0a c9 55 c2  76 df 78                 |.R....U.v.x|
 >>> Flow 5 (client to server)
 00000000  17 03 03 00 30 00 00 00  00 00 00 00 00 00 00 00  |....0...........|
-00000010  00 00 00 00 00 ed ea 3d  21 7c 55 33 01 80 a9 b8  |.......=!|U3....|
-00000020  49 6f 35 82 ce a4 6b 55  fe f2 56 5f 81 9c b6 dc  |Io5...kU..V_....|
-00000030  cb 59 f8 07 7c 15 03 03  00 30 00 00 00 00 00 00  |.Y..|....0......|
-00000040  00 00 00 00 00 00 00 00  00 00 2f 4d af 27 33 c1  |........../M.'3.|
-00000050  03 0e 8b da 39 13 96 81  4d d5 7b 9f c8 1a 1b d4  |....9...M.{.....|
-00000060  48 26 7f 28 af db 16 c5  73 c3                    |H&.(....s.|
+00000010  00 00 00 00 00 60 40 d0  bf 8f ef 05 2b 89 d7 bb  |.....`@.....+...|
+00000020  27 d0 1f b2 cf c3 ff 8e  be 69 16 a9 b3 03 e8 3c  |'........i.....<|
+00000030  30 1d 58 39 4a 15 03 03  00 30 00 00 00 00 00 00  |0.X9J....0......|
+00000040  00 00 00 00 00 00 00 00  00 00 de 61 51 a1 3c fc  |...........aQ.<.|
+00000050  1c 7b e6 f2 7d e0 aa 80  2d 9c e9 22 09 5c dd 8a  |.{..}...-..".\..|
+00000060  55 cc c4 77 34 97 05 88  98 d3                    |U..w4.....|
diff --git a/src/crypto/tls/testdata/Client-TLSv12-RSA-RC4 b/src/crypto/tls/testdata/Client-TLSv12-RSA-RC4
index a773a6c7fb..73e34c0ce3 100644
--- a/src/crypto/tls/testdata/Client-TLSv12-RSA-RC4
+++ b/src/crypto/tls/testdata/Client-TLSv12-RSA-RC4
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 51 02 00 00  4d 03 03 25 65 74 38 24  |....Q...M..%et8$|
-00000010  ce 00 73 69 2f cf 04 3f  da 53 08 71 e6 e8 a8 b6  |..si/..?.S.q....|
-00000020  96 2b 92 24 9f e4 a1 58  d3 18 43 20 81 8a ee 32  |.+.$...X..C ...2|
-00000030  97 36 93 b8 69 15 4e b1  44 e1 33 6c 27 e9 80 91  |.6..i.N.D.3l'...|
-00000040  03 dc ac 34 42 f7 19 17  cf 6e 09 2c 00 05 00 00  |...4B....n.,....|
+00000000  16 03 03 00 51 02 00 00  4d 03 03 e8 ae 4c 97 41  |....Q...M....L.A|
+00000010  78 0f 08 84 d4 4a 80 6d  a2 e1 d0 67 40 8f 01 8b  |x....J.m...g@...|
+00000020  20 54 cb 28 16 52 04 fd  3c c2 84 20 30 96 f0 51  | T.(.R..<.. 0..Q|
+00000030  72 86 6a d8 47 b9 47 e3  a4 ad 97 77 a9 77 1a f9  |r.j.G.G....w.w..|
+00000040  ba 63 33 32 4f 43 09 1c  e1 bd 1b 3b 00 05 00 00  |.c32OC.....;....|
 00000050  05 ff 01 00 01 00 16 03  03 02 be 0b 00 02 ba 00  |................|
 00000060  02 b7 00 02 b4 30 82 02  b0 30 82 02 19 a0 03 02  |.....0...0......|
 00000070  01 02 02 09 00 85 b0 bb  a4 8a 7f b8 ca 30 0d 06  |.............0..|
@@ -70,15 +70,15 @@
 00000060  e6 bd 77 82 6f 23 b6 e0  bd a2 92 b7 3a ac e8 56  |..w.o#......:..V|
 00000070  f1 af 54 5e 46 87 e9 3b  33 e7 b8 28 b7 d6 c8 90  |..T^F..;3..(....|
 00000080  35 d4 1c 43 d1 30 6f 55  4e 0a 70 14 03 03 00 01  |5..C.0oUN.p.....|
-00000090  01 16 03 03 00 24 ea 4e  a7 e2 1c ca 46 6c bd 6f  |.....$.N....Fl.o|
-000000a0  ca 8d ab a6 46 a1 62 84  4d 30 90 39 d6 ac 54 8b  |....F.b.M0.9..T.|
-000000b0  f0 c6 70 e9 bb cc 58 b9  fb fb                    |..p...X...|
+00000090  01 16 03 03 00 24 54 8c  7f 71 03 7c 98 e5 97 65  |.....$T..q.|...e|
+000000a0  51 13 b2 9d 4a b8 c9 c1  e6 11 1b 50 c8 1b c0 46  |Q...J......P...F|
+000000b0  a7 cb 13 97 92 a0 51 d4  a9 e5                    |......Q...|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 24 4d 7b 4f b2 49  |..........$M{O.I|
-00000010  36 f6 22 81 64 e4 20 c4  ea 3d 40 9e 4d 3c 7a 0e  |6.".d. ..=@.M<z.|
-00000020  02 7c d8 5e d0 be de 9b  29 89 ff a3 95 44 75     |.|.^....)....Du|
+00000000  14 03 03 00 01 01 16 03  03 00 24 37 ca ae 55 79  |..........$7..Uy|
+00000010  e7 0a 70 55 1e d1 76 61  57 46 d2 c0 d0 ed 3d 70  |..pU..vaWF....=p|
+00000020  1f 02 f2 06 5b 3e 50 ec  13 4b 67 e2 7c bd 45     |....[>P..Kg.|.E|
 >>> Flow 5 (client to server)
-00000000  17 03 03 00 1a 47 65 1e  de 1f a2 78 6c 3b eb 74  |.....Ge....xl;.t|
-00000010  9b 5d 13 70 93 e0 fc 6f  a0 f8 12 e2 db f1 dd 15  |.].p...o........|
-00000020  03 03 00 16 df 6e 02 d7  30 ba 51 0f dd bb c6 8f  |.....n..0.Q.....|
-00000030  11 35 53 f7 18 0a 19 ed  5b e6                    |.5S.....[.|
+00000000  17 03 03 00 1a c4 13 68  ec e0 38 a1 07 35 da d7  |.......h..8..5..|
+00000010  c4 6b f9 5c ed a7 8a cb  96 7a 22 7c ca a5 30 15  |.k.\.....z"|..0.|
+00000020  03 03 00 16 f7 a7 8d 41  b0 c1 4b 61 60 b0 b2 ed  |.......A..Ka`...|
+00000030  4a ab c3 54 d5 20 eb 67  b7 8f                    |J..T. .g..|
diff --git a/src/crypto/tls/testdata/Client-TLSv12-SCT b/src/crypto/tls/testdata/Client-TLSv12-SCT
index 32a36a48b9..826c9f0a57 100644
--- a/src/crypto/tls/testdata/Client-TLSv12-SCT
+++ b/src/crypto/tls/testdata/Client-TLSv12-SCT
@@ -1,19 +1,19 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 7d 01 00 00  79 03 03 00 00 00 00 00  |....}...y.......|
+00000000  16 03 01 00 81 01 00 00  7d 03 03 00 00 00 00 00  |........}.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 1e c0 2f  |.............../|
 00000030  c0 2b c0 30 c0 2c c0 11  c0 07 c0 13 c0 09 c0 14  |.+.0.,..........|
-00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 32  |...../.5.......2|
+00000040  c0 0a 00 05 00 2f 00 35  c0 12 00 0a 01 00 00 36  |...../.5.......6|
 00000050  00 05 00 05 01 00 00 00  00 00 0a 00 08 00 06 00  |................|
-00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0a 00  |................|
-00000070  08 04 01 04 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-00000080  00 00                                             |..|
+00000060  17 00 18 00 19 00 0b 00  02 01 00 00 0d 00 0e 00  |................|
+00000070  0c 04 01 04 03 05 01 05  03 02 01 02 03 ff 01 00  |................|
+00000080  01 00 00 12 00 00                                 |......|
 >>> Flow 2 (server to client)
-00000000  16 03 03 01 c6 02 00 01  c2 03 03 c5 e7 69 ed ec  |.............i..|
-00000010  04 42 ea 6f 62 65 ea f8  64 18 86 e6 53 a4 77 df  |.B.obe..d...S.w.|
-00000020  05 04 4d c3 2f 5b 06 60  48 71 4f 20 cf e0 a3 b2  |..M./[.`HqO ....|
-00000030  8d b0 d0 b3 54 0b 0f 5d  38 53 5e 65 49 a9 31 40  |....T..]8S^eI.1@|
-00000040  fb 3d 66 97 f5 f0 69 21  b4 12 f0 62 c0 2f 00 01  |.=f...i!...b./..|
+00000000  16 03 03 01 c6 02 00 01  c2 03 03 1b f6 69 c1 c2  |.............i..|
+00000010  36 77 72 32 69 95 c9 e7  db 9b 5d bd 59 ba 08 02  |6wr2i.....].Y...|
+00000020  1e 76 11 c4 8e 49 08 22  8e 8a 5a 20 44 ec d9 13  |.v...I."..Z D...|
+00000030  23 ad 05 45 48 29 00 c6  11 3d 5a 5c a1 ee 34 2b  |#..EH)...=Z\..4+|
+00000040  58 ef 34 5b 7e 42 08 84  23 66 56 ee c0 2f 00 01  |X.4[~B..#fV../..|
 00000050  7a ff 01 00 01 00 00 0b  00 04 03 00 01 02 00 12  |z...............|
 00000060  01 69 01 67 00 75 00 a4  b9 09 90 b4 18 58 14 87  |.i.g.u.......X..|
 00000070  bb 13 a2 cc 67 70 0a 3c  35 98 04 f9 1b df b8 e3  |....gp.<5.......|
@@ -82,19 +82,19 @@
 00000460  b6 d8 c9 75 90 96 8c 0f  52 98 b5 cd 98 1f 89 20  |...u....R...... |
 00000470  5f f2 a0 1c a3 1b 96 94  dd a9 fd 57 e9 70 e8 26  |_..........W.p.&|
 00000480  6d 71 99 9b 26 6e 38 50  29 6c 90 a7 bd d9 16 03  |mq..&n8P)l......|
-00000490  03 00 cd 0c 00 00 c9 03  00 17 41 04 bf b8 6a b3  |..........A...j.|
-000004a0  44 4e 6e e9 2a 43 8b 00  fc a6 04 7e 66 35 d5 21  |DNn.*C.....~f5.!|
-000004b0  1a 83 e6 24 13 67 4c 83  0c a9 85 eb 41 a7 5e ed  |...$.gL.....A.^.|
-000004c0  50 e4 db 17 4a b7 e9 74  ed 19 b2 2e e4 b9 32 13  |P...J..t......2.|
-000004d0  56 76 2d 55 a7 ae 81 6e  15 5b 0e 05 04 01 00 80  |Vv-U...n.[......|
-000004e0  06 5c 4b a2 ad ce 81 19  b0 24 c8 81 e6 2f 59 c7  |.\K......$.../Y.|
-000004f0  64 bb dc e6 d6 79 45 b5  f8 d7 43 70 93 f3 8a 77  |d....yE...Cp...w|
-00000500  77 8b af c5 b9 e2 77 6b  eb cf eb 94 58 14 c1 2f  |w.....wk....X../|
-00000510  81 ea 60 1b c0 db 4e 99  d8 10 54 00 e1 e3 85 f5  |..`...N...T.....|
-00000520  aa e6 ac ab 86 20 3a b0  33 8d c2 07 b2 d6 0d f6  |..... :.3.......|
-00000530  1f 7a 02 76 3c da 41 b2  53 8e 18 f4 66 1e bb f9  |.z.v<.A.S...f...|
-00000540  91 0a fe ed eb 99 b9 ad  a7 44 90 a2 10 a6 5d 84  |.........D....].|
-00000550  7f 92 a6 0b 27 7d 01 03  c3 57 d9 58 bf 90 ec 37  |....'}...W.X...7|
+00000490  03 00 cd 0c 00 00 c9 03  00 17 41 04 d7 61 5b 05  |..........A..a[.|
+000004a0  de 22 d3 3d 00 72 a5 be  0a c1 76 94 a1 34 41 6e  |.".=.r....v..4An|
+000004b0  55 f2 74 91 d2 6f 5c 47  87 c8 4b eb ab ab 10 b9  |U.t..o\G..K.....|
+000004c0  f9 0a bc 63 03 5f 90 5b  e3 6f e1 44 97 cc bf d2  |...c._.[.o.D....|
+000004d0  e8 0d f5 9c 2e 9d 07 2c  b2 00 90 0b 04 01 00 80  |.......,........|
+000004e0  67 3d c7 73 42 b9 b2 fd  4b dd 02 57 87 95 20 75  |g=.sB...K..W.. u|
+000004f0  da c1 e7 d3 33 09 01 5d  e9 32 d7 20 7f 92 a9 dd  |....3..].2. ....|
+00000500  bb 17 c5 ee f2 07 b2 04  1d 5e 1f c2 41 66 3f 14  |.........^..Af?.|
+00000510  90 cd 84 ac 49 46 04 3e  ce 89 7d 79 42 2a 8c 56  |....IF.>..}yB*.V|
+00000520  93 d3 9c 3b 57 38 9e 91  af 62 ad 86 40 29 3d 46  |...;W8...b..@)=F|
+00000530  c7 cc f4 3f a1 7d ee 53  3d 94 1c 85 b9 1d a9 5f  |...?.}.S=......_|
+00000540  10 8e ee 38 5e 98 5d 39  31 79 83 cd f9 02 a8 a9  |...8^.]91y......|
+00000550  b8 82 21 33 40 ed 27 54  a3 6e 64 cb e9 ce dd e1  |..!3@.'T.nd.....|
 00000560  16 03 03 00 04 0e 00 00  00                       |.........|
 >>> Flow 3 (client to server)
 00000000  16 03 03 00 46 10 00 00  42 41 04 1e 18 37 ef 0d  |....F...BA...7..|
@@ -102,17 +102,17 @@
 00000020  a7 24 20 3e b2 56 1c ce  97 28 5e f8 2b 2d 4f 9e  |.$ >.V...(^.+-O.|
 00000030  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
 00000040  a6 b5 68 1a 41 03 56 6b  dc 5a 89 14 03 03 00 01  |..h.A.Vk.Z......|
-00000050  01 16 03 03 00 28 00 00  00 00 00 00 00 00 ab 8b  |.....(..........|
-00000060  08 8d 0a 63 b6 d8 21 87  b1 eb 4a 62 1d be 9d 7b  |...c..!...Jb...{|
-00000070  c7 ce 44 41 46 a5 4a 13  51 af 45 b0 1c 78        |..DAF.J.Q.E..x|
+00000050  01 16 03 03 00 28 00 00  00 00 00 00 00 00 60 0e  |.....(........`.|
+00000060  49 99 7a 9f 28 6e 46 03  a8 fd 0e b7 ed bb 9c ba  |I.z.(nF.........|
+00000070  07 9c 4d cc 26 2b c2 70  a0 26 38 a0 f2 a0        |..M.&+.p.&8...|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 28 67 bb 82 15 33  |..........(g...3|
-00000010  ac ab 9f be af d4 2e 62  1f bd 93 b1 97 30 9c df  |.......b.....0..|
-00000020  67 b8 23 b8 8e 34 ac d3  94 6d 9c 73 d2 8c 6b ee  |g.#..4...m.s..k.|
-00000030  06 a0 78                                          |..x|
+00000000  14 03 03 00 01 01 16 03  03 00 28 d2 ef 8f f4 7b  |..........(....{|
+00000010  7a 9b c8 98 a4 36 f2 be  61 46 0e af f4 6f 63 71  |z....6..aF...ocq|
+00000020  6e bd 87 ea 1b f2 95 ad  36 7d a3 52 7f b2 b6 45  |n.......6}.R...E|
+00000030  3f 0b 62                                          |?.b|
 >>> Flow 5 (client to server)
-00000000  17 03 03 00 1e 00 00 00  00 00 00 00 01 15 e7 c6  |................|
-00000010  74 39 dd 9f 8d 4b f0 da  1a 4a a4 96 90 d5 5f a9  |t9...K...J...._.|
-00000020  c9 4a bf 15 03 03 00 1a  00 00 00 00 00 00 00 02  |.J..............|
-00000030  9f d2 a2 2c b6 dd 78 35  78 d4 5e 81 bc 39 0d 20  |...,..x5x.^..9. |
-00000040  2e 56                                             |.V|
+00000000  17 03 03 00 1e 00 00 00  00 00 00 00 01 53 a1 85  |.............S..|
+00000010  ce 3c c1 64 39 80 fb db  67 ec 48 20 7f e9 82 f4  |.<.d9...g.H ....|
+00000020  2d 69 0a 15 03 03 00 1a  00 00 00 00 00 00 00 02  |-i..............|
+00000030  ab 78 11 1b 80 55 23 db  07 c5 7f c3 5e 19 d8 b3  |.x...U#.....^...|
+00000040  f8 c6                                             |..|
diff --git a/src/crypto/tls/testdata/Server-TLSv12-ALPN b/src/crypto/tls/testdata/Server-TLSv12-ALPN
index ee6bb729ee..6c7521edcc 100644
--- a/src/crypto/tls/testdata/Server-TLSv12-ALPN
+++ b/src/crypto/tls/testdata/Server-TLSv12-ALPN
@@ -1,7 +1,7 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 01 6b 01 00 01  67 03 03 e4 b0 a0 f0 85  |....k...g.......|
-00000010  a5 8c 96 5d 78 c5 a5 f4  f2 d5 01 68 5c f3 c5 7d  |...]x......h\..}|
-00000020  00 d9 7c 0d b6 ca b4 6c  c0 0e 79 00 00 b6 c0 30  |..|....l..y....0|
+00000000  16 03 01 01 6b 01 00 01  67 03 03 8c 16 4a 54 65  |....k...g....JTe|
+00000010  9f cf 83 7e 6c da 46 9c  79 cd 7f 67 29 e2 55 af  |...~l.F.y..g).U.|
+00000020  c2 d3 24 7b f6 a1 ea 96  43 95 8b 00 00 b6 c0 30  |..${....C......0|
 00000030  c0 2c c0 28 c0 24 c0 14  c0 0a 00 a5 00 a3 00 a1  |.,.(.$..........|
 00000040  00 9f 00 6b 00 6a 00 69  00 68 00 39 00 38 00 37  |...k.j.i.h.9.8.7|
 00000050  00 36 00 88 00 87 00 86  00 85 c0 32 c0 2e c0 2a  |.6.........2...*|
@@ -76,40 +76,40 @@
 00000320  35 75 71 b5 e5 54 5b 12  2e 8f 09 67 fd a7 24 20  |5uq..T[....g..$ |
 00000330  3e b2 56 1c ce 97 28 5e  f8 2b 2d 4f 9e f1 07 9f  |>.V...(^.+-O....|
 00000340  6c 4b 5b 83 56 e2 32 42  e9 58 b6 d7 49 a6 b5 68  |lK[.V.2B.X..I..h|
-00000350  1a 41 03 56 6b dc 5a 89  04 01 00 80 b6 f9 b6 2b  |.A.Vk.Z........+|
-00000360  15 b8 ef 70 37 61 64 f3  f3 a5 d9 da ce 13 b5 e1  |...p7ad.........|
-00000370  0b 24 eb 11 a7 df 86 a9  ef 88 ef af 17 7d 02 56  |.$...........}.V|
-00000380  ec 59 32 c9 5c 06 a4 ce  10 c7 6f 6a f3 e0 43 6a  |.Y2.\.....oj..Cj|
-00000390  02 99 f4 7b 14 65 dc a5  a0 af 10 3e a8 40 35 2b  |...{.e.....>.@5+|
-000003a0  c6 a1 31 b6 26 e9 89 0f  06 61 6f 2e 6c f4 70 69  |..1.&....ao.l.pi|
-000003b0  e5 01 80 3d fe 4d 59 ad  cb 2f b8 c1 df 5f 36 f7  |...=.MY../..._6.|
-000003c0  cc a6 31 84 61 c0 e8 c5  95 37 9c e6 0d 2b 78 0c  |..1.a....7...+x.|
-000003d0  45 cf 69 5d fa 3a 8b 31  ea 22 60 31 16 03 03 00  |E.i].:.1."`1....|
+00000350  1a 41 03 56 6b dc 5a 89  05 01 00 80 a5 67 1e 1a  |.A.Vk.Z......g..|
+00000360  58 c6 60 8f d8 74 60 56  f2 7d 60 2d 46 fe e2 a2  |X.`..t`V.}`-F...|
+00000370  cd 0f 07 fb 66 38 e6 99  84 ad f9 d2 b0 00 8a 6f  |....f8.........o|
+00000380  aa 07 95 6b 38 dc a5 a7  29 8e 1a fb f2 50 1c 64  |...k8...)....P.d|
+00000390  e5 c0 c6 c0 90 33 d4 ab  0b 42 0a e5 c9 89 4a 0c  |.....3...B....J.|
+000003a0  00 32 b6 2e 45 e0 5d d5  23 09 29 68 99 43 c3 cb  |.2..E.].#.)h.C..|
+000003b0  4b 5c 0a a2 b3 ac 64 65  76 c6 25 ee 7e 3e 27 d9  |K\....dev.%.~>'.|
+000003c0  91 f6 5b 33 cb e4 ce 74  52 2a c2 d1 d3 e0 44 7d  |..[3...tR*....D}|
+000003d0  a1 4f 15 ad 83 29 3a c6  9f 87 22 6d 16 03 03 00  |.O...):..."m....|
 000003e0  04 0e 00 00 00                                    |.....|
 >>> Flow 3 (client to server)
-00000000  16 03 03 00 46 10 00 00  42 41 04 8d 5a 5d 91 04  |....F...BA..Z]..|
-00000010  79 46 1b f1 12 3f d5 ca  57 18 5f 4d 71 d9 eb f8  |yF...?..W._Mq...|
-00000020  90 f6 ed 75 b9 0c 2b 6e  67 cb 3a ae cc 6d 61 af  |...u..+ng.:..ma.|
-00000030  30 87 1b a6 21 d6 90 16  84 b0 65 3d 7f cc 96 ed  |0...!.....e=....|
-00000040  9e 68 38 e5 10 27 c3 23  48 40 f9 14 03 03 00 01  |.h8..'.#H@......|
-00000050  01 16 03 03 00 28 7b a4  d0 fd 15 36 9b 1f 6e 4f  |.....({....6..nO|
-00000060  a9 d7 61 3f 58 93 5e 1b  10 be a1 8c c9 2f 39 74  |..a?X.^....../9t|
-00000070  23 9a 1e ba 5b 3b e7 f0  32 b7 14 2e ae 0b        |#...[;..2.....|
+00000000  16 03 03 00 46 10 00 00  42 41 04 cb 9a 95 ae 57  |....F...BA.....W|
+00000010  6e 67 8a 10 30 60 b4 2c  9e f7 18 bb d1 ad 09 96  |ng..0`.,........|
+00000020  02 e3 48 b1 a3 b8 7d 29  42 2b f7 68 f6 8e 2c f8  |..H...})B+.h..,.|
+00000030  b7 12 5c 9c 08 2a b5 8a  13 b2 4c 08 62 e0 83 c0  |..\..*....L.b...|
+00000040  4a 42 6e 5a 35 24 85 2f  58 6c 8c 14 03 03 00 01  |JBnZ5$./Xl......|
+00000050  01 16 03 03 00 28 3f b4  ed a5 a6 03 e0 db 72 cf  |.....(?.......r.|
+00000060  a7 c1 a1 32 93 38 8c c4  9d c7 07 44 8d 83 78 5f  |...2.8.....D..x_|
+00000070  c1 07 5c 0e b1 a9 5f e3  6d e7 6e 2d 5f d8        |..\..._.m.n-_.|
 >>> Flow 4 (server to client)
 00000000  16 03 03 00 82 04 00 00  7e 00 00 00 00 00 78 50  |........~.....xP|
 00000010  46 ad c1 db a8 38 86 7b  2b bb fd d0 c3 42 3e 00  |F....8.{+....B>.|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 94  |................|
-00000030  6f ec 80 83 61 dc ee 0e  43 06 28 f4 47 1a d7 25  |o...a...C.(.G..%|
-00000040  f2 fa 66 d5 81 21 51 81  a8 47 2d a5 db e1 f2 84  |..f..!Q..G-.....|
-00000050  ea 55 da 3e cf 97 fd 7e  63 68 50 e3 2d 48 5a 58  |.U.>...~chP.-HZX|
-00000060  77 36 a2 9f 3f 33 94 65  de 9e e6 65 22 6f 1d c8  |w6..?3.e...e"o..|
-00000070  46 80 2d 0b 83 41 5e c6  20 f6 c3 22 5f bb 7a 9b  |F.-..A^. .."_.z.|
-00000080  28 07 9c 5e b7 30 35 14  03 03 00 01 01 16 03 03  |(..^.05.........|
-00000090  00 28 00 00 00 00 00 00  00 00 4a 1c a6 1e 78 e1  |.(........J...x.|
-000000a0  4c 58 56 f5 6e 78 ae 11  7a dc 93 65 4b 46 6e b8  |LXV.nx..z..eKFn.|
-000000b0  b6 2e 42 bc 71 81 61 3c  14 95 17 03 03 00 25 00  |..B.q.a<......%.|
-000000c0  00 00 00 00 00 00 01 6e  af 22 60 44 9b 18 e7 21  |.......n."`D...!|
-000000d0  d9 c3 8d 48 8c 94 f1 aa  cc 9d a4 11 ba b7 f2 0f  |...H............|
-000000e0  a2 91 e6 50 15 03 03 00  1a 00 00 00 00 00 00 00  |...P............|
-000000f0  02 65 58 88 05 97 4a 2a  72 f5 03 da 53 24 4c b0  |.eX...J*r...S$L.|
-00000100  01 4e 02                                          |.N.|
+00000030  6f ec 80 83 61 69 c5 a3  b0 d3 be 06 98 78 ef 8e  |o...ai.......x..|
+00000040  7e 7c 3a 28 a1 54 e5 e3  51 bf f1 ef 57 0a fd b9  |~|:(.T..Q...W...|
+00000050  fb 02 61 ed 27 2b cf fc  0c d9 eb 7a 9e 79 a5 02  |..a.'+.....z.y..|
+00000060  8a 84 f2 26 b2 33 94 03  f7 13 3c da f7 16 f1 f5  |...&.3....<.....|
+00000070  74 95 9d d2 20 05 ab d3  cb 62 af 5a 97 d1 99 bd  |t... ....b.Z....|
+00000080  e5 70 48 36 73 bf 2e 14  03 03 00 01 01 16 03 03  |.pH6s...........|
+00000090  00 28 00 00 00 00 00 00  00 00 fd fc dc fd c2 ee  |.(..............|
+000000a0  29 c8 b9 87 fc d1 fc ae  8b 71 24 20 75 35 eb a9  |)........q$ u5..|
+000000b0  df 54 72 2c 6e 53 f7 9b  25 c9 17 03 03 00 25 00  |.Tr,nS..%.....%.|
+000000c0  00 00 00 00 00 00 01 91  5a 43 e7 eb f1 72 f5 fa  |........ZC...r..|
+000000d0  6d c0 c1 63 47 2e c9 11  d7 20 2d db 0c 98 08 46  |m..cG.... -....F|
+000000e0  7b c8 d7 0e 15 03 03 00  1a 00 00 00 00 00 00 00  |{...............|
+000000f0  02 a0 60 01 85 aa 70 e8  3a ff 89 fc 06 ac 58 a1  |..`...p.:.....X.|
+00000100  43 6e ba                                          |Cn.|
diff --git a/src/crypto/tls/testdata/Server-TLSv12-ALPN-NoMatch b/src/crypto/tls/testdata/Server-TLSv12-ALPN-NoMatch
index b651b32d39..40c2b01537 100644
--- a/src/crypto/tls/testdata/Server-TLSv12-ALPN-NoMatch
+++ b/src/crypto/tls/testdata/Server-TLSv12-ALPN-NoMatch
@@ -1,7 +1,7 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 01 6b 01 00 01  67 03 03 5e 66 c4 02 7c  |....k...g..^f..||
-00000010  69 7f ec ce e5 14 b3 60  04 60 2b d3 72 84 c7 a0  |i......`.`+.r...|
-00000020  fe 3e 8e fa 91 cc e8 e3  43 17 c6 00 00 b6 c0 30  |.>......C......0|
+00000000  16 03 01 01 6b 01 00 01  67 03 03 0e ea ae 76 69  |....k...g.....vi|
+00000010  53 2e 97 2f e1 d5 74 fb  93 5c 6a 5a 65 bd 15 c5  |S../..t..\jZe...|
+00000020  7d 41 4c 5e 71 9a 46 9f  cc 59 0a 00 00 b6 c0 30  |}AL^q.F..Y.....0|
 00000030  c0 2c c0 28 c0 24 c0 14  c0 0a 00 a5 00 a3 00 a1  |.,.(.$..........|
 00000040  00 9f 00 6b 00 6a 00 69  00 68 00 39 00 38 00 37  |...k.j.i.h.9.8.7|
 00000050  00 36 00 88 00 87 00 86  00 85 c0 32 c0 2e c0 2a  |.6.........2...*|
@@ -75,40 +75,40 @@
 00000310  19 51 88 35 75 71 b5 e5  54 5b 12 2e 8f 09 67 fd  |.Q.5uq..T[....g.|
 00000320  a7 24 20 3e b2 56 1c ce  97 28 5e f8 2b 2d 4f 9e  |.$ >.V...(^.+-O.|
 00000330  f1 07 9f 6c 4b 5b 83 56  e2 32 42 e9 58 b6 d7 49  |...lK[.V.2B.X..I|
-00000340  a6 b5 68 1a 41 03 56 6b  dc 5a 89 04 01 00 80 b6  |..h.A.Vk.Z......|
-00000350  8d 11 b1 57 9b 22 02 26  1c 03 f3 35 a7 4b 5b 31  |...W.".&...5.K[1|
-00000360  c9 db b4 80 83 10 d2 00  e8 d8 65 95 4a 0d 76 69  |..........e.J.vi|
-00000370  c5 1c fb 01 78 08 c0 08  fc b0 cd 9f 81 e9 e1 8e  |....x...........|
-00000380  a3 55 2d 40 1a 73 e9 7c  90 13 a7 13 0f 90 a1 45  |.U-@.s.|.......E|
-00000390  af 89 e6 7a 6b 88 3a a0  57 13 63 d7 d5 86 5f bd  |...zk.:.W.c..._.|
-000003a0  5a 1a 11 4e 9d 57 27 fe  c9 fc d2 73 bc 28 b1 d5  |Z..N.W'....s.(..|
-000003b0  74 6f 87 34 f1 f4 5b 48  be 4d 0b 4d 3a 51 c5 5d  |to.4..[H.M.M:Q.]|
-000003c0  c4 3c cd ad a8 72 0a 2d  f8 0f 8b 0d 12 2e cf 16  |.<...r.-........|
+00000340  a6 b5 68 1a 41 03 56 6b  dc 5a 89 05 01 00 80 b3  |..h.A.Vk.Z......|
+00000350  74 f2 d1 0e 38 f2 b2 92  da 2c 48 c7 3f 6a d3 02  |t...8....,H.?j..|
+00000360  60 58 11 9c 08 e4 4c a5  89 c6 94 10 2d 74 3d f4  |`X....L.....-t=.|
+00000370  fd 0b 5b 5c ec 9c 89 00  da db 11 84 28 0f ca 43  |..[\........(..C|
+00000380  6a a7 f7 9c b0 2f 7d a8  6a c5 a1 d1 64 0a a2 04  |j..../}.j...d...|
+00000390  36 3f eb f1 cd d6 91 bc  45 fd e9 7c ac ff 9e 49  |6?......E..|...I|
+000003a0  e3 f1 f4 64 d7 ed 6c 0b  ac a7 7e d8 16 8d d6 d8  |...d..l...~.....|
+000003b0  01 d1 24 ef b7 db 47 ed  42 b1 4f a3 89 ac ad 74  |..$...G.B.O....t|
+000003c0  c1 fe 29 9a 59 78 b6 cb  c2 07 32 76 8b 8f 5c 16  |..).Yx....2v..\.|
 000003d0  03 03 00 04 0e 00 00 00                           |........|
 >>> Flow 3 (client to server)
-00000000  16 03 03 00 46 10 00 00  42 41 04 73 0a f7 32 32  |....F...BA.s..22|
-00000010  5b 54 d6 e6 16 a0 92 bb  80 ec 8d db 02 8f a9 9d  |[T..............|
-00000020  92 3d 20 88 a8 f5 3c 29  a9 81 89 92 aa 62 2a b9  |.= ...<).....b*.|
-00000030  65 ba f1 ec b6 17 45 7b  ff bd 91 f6 55 d5 ce 42  |e.....E{....U..B|
-00000040  dd ea bd d3 72 26 3f 42  9b e5 8a 14 03 03 00 01  |....r&?B........|
-00000050  01 16 03 03 00 28 a1 e8  8e 47 c3 4f d7 f4 e0 9e  |.....(...G.O....|
-00000060  8e ed 74 5c 68 fc 9c 79  59 80 ad ff 75 7d 1f 3e  |..t\h..yY...u}.>|
-00000070  c6 71 13 6d 7b 74 93 e0  2a ed 72 50 82 28        |.q.m{t..*.rP.(|
+00000000  16 03 03 00 46 10 00 00  42 41 04 3a 5c 78 52 d4  |....F...BA.:\xR.|
+00000010  63 c4 7d 04 76 71 2a db  9d c2 f7 71 10 4c d3 2f  |c.}.vq*....q.L./|
+00000020  35 9e 35 21 93 d0 ca 00  e7 35 ca 8d 18 d8 ad 07  |5.5!.....5......|
+00000030  9b ca e2 34 bf 84 5e 2a  51 08 01 98 66 5d 5a 94  |...4..^*Q...f]Z.|
+00000040  28 06 b4 bd 2b 47 05 16  d1 15 04 14 03 03 00 01  |(...+G..........|
+00000050  01 16 03 03 00 28 db 5d  dd 42 7a 90 10 bd 7d c9  |.....(.].Bz...}.|
+00000060  ab d5 9b a9 28 03 13 b9  c7 8d fa 49 81 3d 14 a2  |....(......I.=..|
+00000070  f5 b1 14 d9 26 52 ee 29  15 b5 3c d9 d6 a6        |....&R.)..<...|
 >>> Flow 4 (server to client)
 00000000  16 03 03 00 82 04 00 00  7e 00 00 00 00 00 78 50  |........~.....xP|
 00000010  46 ad c1 db a8 38 86 7b  2b bb fd d0 c3 42 3e 00  |F....8.{+....B>.|
 00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 94  |................|
-00000030  6f ec 80 83 61 8c 66 55  28 dd e7 39 69 93 65 58  |o...a.fU(..9i.eX|
-00000040  2d f8 ea 03 85 3f 6c 41  70 94 7b 9c ae 2f 64 59  |-....?lAp.{../dY|
-00000050  f3 3f 24 b6 73 ca c8 b7  37 cb a1 99 74 0b aa a9  |.?$.s...7...t...|
-00000060  36 dd 48 40 1c 33 94 27  94 ad 50 97 70 0d 62 a5  |6.H@.3.'..P.p.b.|
-00000070  59 25 41 73 8d da 23 b0  14 05 e9 28 e4 54 93 35  |Y%As..#....(.T.5|
-00000080  09 82 47 3e bf ec 82 14  03 03 00 01 01 16 03 03  |..G>............|
-00000090  00 28 00 00 00 00 00 00  00 00 d0 5f 0a c1 1c 03  |.(........._....|
-000000a0  fc 10 1b 5c 60 9f 04 8b  53 47 8d 28 e2 85 3c de  |...\`...SG.(..<.|
-000000b0  63 39 22 e6 4b 50 52 23  f4 4a 17 03 03 00 25 00  |c9".KPR#.J....%.|
-000000c0  00 00 00 00 00 00 01 98  89 b4 fc 10 11 b7 54 e7  |..............T.|
-000000d0  8d a5 61 38 f6 9b b7 35  e6 bb b2 d3 48 93 76 3f  |..a8...5....H.v?|
-000000e0  ea ba 9b 65 15 03 03 00  1a 00 00 00 00 00 00 00  |...e............|
-000000f0  02 64 0e 5b 3f 19 64 1e  22 ca 4c 81 43 d6 54 34  |.d.[?.d.".L.C.T4|
-00000100  d9 80 09                                          |...|
+00000030  6f ec 80 83 61 32 9c da  f8 14 9d 56 31 08 89 38  |o...a2.....V1..8|
+00000040  f5 fc dc 73 bf c6 bc 1d  48 7c 64 41 71 7c b7 2b  |...s....H|dAq|.+|
+00000050  4a b5 2f d5 1b bf 21 e0  56 29 bd e9 e5 d0 80 ab  |J./...!.V)......|
+00000060  d1 d9 d9 81 77 33 94 45  2e 27 4c 22 e3 2b 1f 33  |....w3.E.'L".+.3|
+00000070  96 86 9d 0c 70 ad 1e 56  50 14 11 b6 b1 40 7e f5  |....p..VP....@~.|
+00000080  44 27 70 61 52 d0 66 14  03 03 00 01 01 16 03 03  |D'paR.f.........|
+00000090  00 28 00 00 00 00 00 00  00 00 5a e0 b2 53 80 89  |.(........Z..S..|
+000000a0  40 81 02 bc 62 d0 83 7f  fb 95 52 98 4d 2d 7f 70  |@...b.....R.M-.p|
+000000b0  2e 76 43 2b 60 3c fd 4b  0e e4 17 03 03 00 25 00  |.vC+`<.K......%.|
+000000c0  00 00 00 00 00 00 01 e9  04 b5 f5 92 e7 ac 20 e5  |.............. .|
+000000d0  1c 88 5c c3 c4 21 87 cf  3a 81 04 2e 50 70 c7 20  |..\..!..:...Pp. |
+000000e0  3b e5 e7 21 15 03 03 00  1a 00 00 00 00 00 00 00  |;..!............|
+000000f0  02 8a 92 dd 25 70 1b 32  86 22 d0 29 79 ff 06 f4  |....%p.2.".)y...|
+00000100  c3 82 9f                                          |...|
diff --git a/src/crypto/tls/testdata/Server-TLSv12-CipherSuiteCertPreferenceECDSA b/src/crypto/tls/testdata/Server-TLSv12-CipherSuiteCertPreferenceECDSA
index cc06d5f838..160bf83db5 100644
--- a/src/crypto/tls/testdata/Server-TLSv12-CipherSuiteCertPreferenceECDSA
+++ b/src/crypto/tls/testdata/Server-TLSv12-CipherSuiteCertPreferenceECDSA
@@ -1,7 +1,7 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 01 61 01 00 01  5d 03 03 47 c5 84 0f 55  |....a...]..G...U|
-00000010  83 4d 4a 1c 48 51 15 e4  74 72 84 70 2f 24 e9 ab  |.MJ.HQ..tr.p/$..|
-00000020  42 1e 01 e1 85 27 2f b5  c1 43 14 00 00 c4 c0 30  |B....'/..C.....0|
+00000000  16 03 01 01 53 01 00 01  4f 03 03 0b 19 5d 5b 51  |....S...O....][Q|
+00000010  85 cc 1a 6b 6e 46 0d 63  07 9e 68 f0 36 e1 50 1e  |...knF.c..h.6.P.|
+00000020  e0 f5 28 24 ab 7e bf 5a  4d 4b f6 00 00 b6 c0 30  |..($.~.ZMK.....0|
 00000030  c0 2c c0 28 c0 24 c0 14  c0 0a 00 a5 00 a3 00 a1  |.,.(.$..........|
 00000040  00 9f 00 6b 00 6a 00 69  00 68 00 39 00 38 00 37  |...k.j.i.h.9.8.7|
 00000050  00 36 00 88 00 87 00 86  00 85 c0 32 c0 2e c0 2a  |.6.........2...*|
@@ -13,15 +13,14 @@
 000000b0  00 3c 00 2f 00 96 00 41  00 07 c0 11 c0 07 c0 0c  |.<./...A........|
 000000c0  c0 02 00 05 00 04 c0 12  c0 08 00 16 00 13 00 10  |................|
 000000d0  00 0d c0 0d c0 03 00 0a  00 15 00 12 00 0f 00 0c  |................|
-000000e0  00 09 00 14 00 11 00 0e  00 0b 00 08 00 06 00 03  |................|
-000000f0  00 ff 02 01 00 00 6f 00  0b 00 04 03 00 01 02 00  |......o.........|
-00000100  0a 00 3a 00 38 00 0e 00  0d 00 19 00 1c 00 0b 00  |..:.8...........|
-00000110  0c 00 1b 00 18 00 09 00  0a 00 1a 00 16 00 17 00  |................|
-00000120  08 00 06 00 07 00 14 00  15 00 04 00 05 00 12 00  |................|
-00000130  13 00 01 00 02 00 03 00  0f 00 10 00 11 00 0d 00  |................|
-00000140  20 00 1e 06 01 06 02 06  03 05 01 05 02 05 03 04  | ...............|
-00000150  01 04 02 04 03 03 01 03  02 03 03 02 01 02 02 02  |................|
-00000160  03 00 0f 00 01 01                                 |......|
+000000e0  00 09 00 ff 02 01 00 00  6f 00 0b 00 04 03 00 01  |........o.......|
+000000f0  02 00 0a 00 3a 00 38 00  0e 00 0d 00 19 00 1c 00  |....:.8.........|
+00000100  0b 00 0c 00 1b 00 18 00  09 00 0a 00 1a 00 16 00  |................|
+00000110  17 00 08 00 06 00 07 00  14 00 15 00 04 00 05 00  |................|
+00000120  12 00 13 00 01 00 02 00  03 00 0f 00 10 00 11 00  |................|
+00000130  0d 00 20 00 1e 06 01 06  02 06 03 05 01 05 02 05  |.. .............|
+00000140  03 04 01 04 02 04 03 03  01 03 02 03 03 02 01 02  |................|
+00000150  02 02 03 00 0f 00 01 01                           |........|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 31 02 00 00  2d 03 03 00 00 00 00 00  |....1...-.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
@@ -64,38 +63,38 @@
 00000260  75 71 b5 e5 54 5b 12 2e  8f 09 67 fd a7 24 20 3e  |uq..T[....g..$ >|
 00000270  b2 56 1c ce 97 28 5e f8  2b 2d 4f 9e f1 07 9f 6c  |.V...(^.+-O....l|
 00000280  4b 5b 83 56 e2 32 42 e9  58 b6 d7 49 a6 b5 68 1a  |K[.V.2B.X..I..h.|
-00000290  41 03 56 6b dc 5a 89 04  03 00 8a 30 81 87 02 42  |A.Vk.Z.....0...B|
-000002a0  00 e5 db 39 b2 73 2b 4b  19 66 d6 d6 de d2 ed ae  |...9.s+K.f......|
-000002b0  0c ac 74 96 12 b2 e0 87  73 7c 63 18 8c 58 3f 56  |..t.....s|c..X?V|
-000002c0  4c fe 0f a5 2d b9 b8 1c  7d 4d 49 b9 ca f0 52 01  |L...-...}MI...R.|
-000002d0  12 e2 a9 54 9f 4d ab b7  93 71 3c 1b 96 b0 87 8b  |...T.M...q<.....|
-000002e0  87 c3 02 41 79 c3 50 88  2f 9a b8 a3 f0 14 63 ee  |...Ay.P./.....c.|
-000002f0  d6 76 dd d4 1d 1c ce 4c  ba 53 40 ac 01 d9 62 a7  |.v.....L.S@...b.|
-00000300  bc ee 66 67 fc da f4 b3  0f fd 50 5d 31 0e 2d 41  |..fg......P]1.-A|
-00000310  64 d5 51 30 a3 0e ee 20  f9 9d 0e 11 df 68 a6 f4  |d.Q0... .....h..|
-00000320  54 d4 54 7a 05 16 03 03  00 04 0e 00 00 00        |T.Tz..........|
+00000290  41 03 56 6b dc 5a 89 05  03 00 8a 30 81 87 02 42  |A.Vk.Z.....0...B|
+000002a0  01 c0 83 f1 6b 74 4d 1f  f5 51 d3 df 44 27 ee 1b  |....ktM..Q..D'..|
+000002b0  32 e8 93 a5 e5 9c c7 df  8e 82 bf c1 0a 4a 52 df  |2............JR.|
+000002c0  b8 f3 53 15 88 a1 c0 ae  0a b6 f9 35 ca 6f 52 a1  |..S........5.oR.|
+000002d0  de 45 5d 4d 96 6e 9e b6  10 a1 e8 8d 2b 93 e3 9d  |.E]M.n......+...|
+000002e0  85 30 02 41 6d 41 10 65  8a d3 fe a7 9c 4e 06 a4  |.0.AmA.e.....N..|
+000002f0  8e aa 9f af e8 ec 49 f1  2c 2b 72 62 df 2f d7 ef  |......I.,+rb./..|
+00000300  da b1 b2 a3 d6 29 dc 7a  8b 11 b7 28 01 f2 6e 89  |.....).z...(..n.|
+00000310  20 dc f6 44 65 56 00 b2  4d c5 46 54 ea a4 09 bc  | ..DeV..M.FT....|
+00000320  23 94 d3 52 c1 16 03 03  00 04 0e 00 00 00        |#..R..........|
 >>> Flow 3 (client to server)
-00000000  16 03 03 00 46 10 00 00  42 41 04 00 a1 de 66 1d  |....F...BA....f.|
-00000010  05 57 3b d2 0e 5f ba 4d  e9 b7 93 0a 3e bd 25 98  |.W;.._.M....>.%.|
-00000020  76 a4 8a c9 d3 c8 04 85  f6 8d 4f 3e 32 4c 25 cb  |v.........O>2L%.|
-00000030  b5 57 86 b5 04 9d f6 ba  f3 17 c8 43 cb eb 8b d0  |.W.........C....|
-00000040  ed 99 23 c7 4d 63 95 e2  cd 52 ba 14 03 03 00 01  |..#.Mc...R......|
-00000050  01 16 03 03 00 40 33 b4  f5 4a 64 88 ef dc b6 e5  |.....@3..Jd.....|
-00000060  b6 1e 40 3e 64 5a 2c 11  97 69 4c b6 7a 4c 9a 8a  |..@>dZ,..iL.zL..|
-00000070  71 f2 60 e9 39 db 96 2a  a3 33 1b 7f 43 15 8b 99  |q.`.9..*.3..C...|
-00000080  0b 52 c2 92 86 fe 57 0d  da fe 62 44 89 ce 65 4f  |.R....W...bD..eO|
-00000090  a5 8d 29 8e 10 50                                 |..)..P|
+00000000  16 03 03 00 46 10 00 00  42 41 04 a0 ef 6e 6e 4f  |....F...BA...nnO|
+00000010  3f ac d1 89 57 cf 8e da  25 46 b5 50 51 68 bc 06  |?...W...%F.PQh..|
+00000020  6a b6 0b a5 82 c3 3d c3  d2 d6 70 ac 32 35 bf 62  |j.....=...p.25.b|
+00000030  e9 6f 8f a6 8b 89 68 04  a3 57 0b 7b 2b 33 a3 01  |.o....h..W.{+3..|
+00000040  b1 7e d3 7b 04 6c 68 b8  bc da ff 14 03 03 00 01  |.~.{.lh.........|
+00000050  01 16 03 03 00 40 04 25  dd 22 f7 7a 2b 55 0d f9  |.....@.%.".z+U..|
+00000060  cc 9c 3d 59 bc 4b 99 86  99 5f c2 75 fd 62 d7 6e  |..=Y.K..._.u.b.n|
+00000070  78 89 90 af 61 59 0f d3  7b 1a 3f 3b 87 09 b5 7c  |x...aY..{.?;...||
+00000080  fd 75 cc 5c f0 41 80 03  8c 7a 1d b0 50 34 32 95  |.u.\.A...z..P42.|
+00000090  8d 74 95 f9 54 cc                                 |.t..T.|
 >>> Flow 4 (server to client)
 00000000  14 03 03 00 01 01 16 03  03 00 40 00 00 00 00 00  |..........@.....|
-00000010  00 00 00 00 00 00 00 00  00 00 00 29 56 67 0c 28  |...........)Vg.(|
-00000020  ca 74 e1 ae c6 e2 30 3b  f2 8b f0 fd c2 eb 11 c0  |.t....0;........|
-00000030  0e 50 eb d8 4e de e3 32  6b 69 77 d8 d7 bd 94 30  |.P..N..2kiw....0|
-00000040  1e bf 03 f0 31 98 d8 07  c0 27 4b 17 03 03 00 40  |....1....'K....@|
+00000010  00 00 00 00 00 00 00 00  00 00 00 bf e6 3e cf 4a  |.............>.J|
+00000020  ab 55 af 47 2b fe 01 8e  4a 9e 95 e5 39 16 b1 17  |.U.G+...J...9...|
+00000030  66 93 20 80 5a e9 cc f1  16 79 4f 37 20 60 40 c7  |f. .Z....yO7 `@.|
+00000040  c3 91 28 14 9d 35 02 72  df 66 17 17 03 03 00 40  |..(..5.r.f.....@|
 00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000060  97 7f df af a3 9e cc a1  64 5f ab 91 8a 6f fd 19  |........d_...o..|
-00000070  be 94 95 6d bb de 12 a9  54 10 b5 95 f3 68 77 73  |...m....T....hws|
-00000080  14 09 b7 3b ca b8 88 6d  fd 0a 2d 24 c1 94 ce ce  |...;...m..-$....|
+00000060  ac 56 df 2e 4d 72 cb cf  8a 5e e7 36 8b 12 12 f3  |.V..Mr...^.6....|
+00000070  f8 31 9a 81 b9 2a 75 00  7f c7 2c 3b 86 bf 54 ac  |.1...*u...,;..T.|
+00000080  76 97 d8 e2 c5 a4 d3 2d  15 64 5e 8a 0e c9 46 f5  |v......-.d^...F.|
 00000090  15 03 03 00 30 00 00 00  00 00 00 00 00 00 00 00  |....0...........|
-000000a0  00 00 00 00 00 04 6d b7  9e 15 51 c7 f8 de ab d0  |......m...Q.....|
-000000b0  a0 45 7f 4f bc 59 73 45  e9 a8 b1 0e 9b c3 36 c7  |.E.O.YsE......6.|
-000000c0  cb db 55 19 db                                    |..U..|
+000000a0  00 00 00 00 00 9e e7 4b  50 d0 7c a9 dd 0c 3f 9b  |.......KP.|...?.|
+000000b0  04 c9 f5 f0 88 e3 84 c0  69 05 c2 c0 83 43 5a 8c  |........i....CZ.|
+000000c0  be e4 c4 35 f0                                    |...5.|
diff --git a/src/crypto/tls/testdata/Server-TLSv12-CipherSuiteCertPreferenceRSA b/src/crypto/tls/testdata/Server-TLSv12-CipherSuiteCertPreferenceRSA
index 0d9bb0c8b7..f25f3e79e2 100644
--- a/src/crypto/tls/testdata/Server-TLSv12-CipherSuiteCertPreferenceRSA
+++ b/src/crypto/tls/testdata/Server-TLSv12-CipherSuiteCertPreferenceRSA
@@ -1,7 +1,7 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 01 61 01 00 01  5d 03 03 17 83 43 01 d8  |....a...]....C..|
-00000010  14 04 ed 55 41 35 99 cd  f6 50 e6 47 10 60 7d d9  |...UA5...P.G.`}.|
-00000020  d1 f4 0f a1 bf 27 ab 0c  44 56 a5 00 00 c4 c0 30  |.....'..DV.....0|
+00000000  16 03 01 01 53 01 00 01  4f 03 03 66 97 e7 64 f3  |....S...O..f..d.|
+00000010  e7 d2 ba ba 31 f5 d6 ce  50 c7 48 2e 80 48 f1 1f  |....1...P.H..H..|
+00000020  6a a0 f1 da 7b 7b 45 ac  ad e9 73 00 00 b6 c0 30  |j...{{E...s....0|
 00000030  c0 2c c0 28 c0 24 c0 14  c0 0a 00 a5 00 a3 00 a1  |.,.(.$..........|
 00000040  00 9f 00 6b 00 6a 00 69  00 68 00 39 00 38 00 37  |...k.j.i.h.9.8.7|
 00000050  00 36 00 88 00 87 00 86  00 85 c0 32 c0 2e c0 2a  |.6.........2...*|
@@ -13,15 +13,14 @@
 000000b0  00 3c 00 2f 00 96 00 41  00 07 c0 11 c0 07 c0 0c  |.<./...A........|
 000000c0  c0 02 00 05 00 04 c0 12  c0 08 00 16 00 13 00 10  |................|
 000000d0  00 0d c0 0d c0 03 00 0a  00 15 00 12 00 0f 00 0c  |................|
-000000e0  00 09 00 14 00 11 00 0e  00 0b 00 08 00 06 00 03  |................|
-000000f0  00 ff 02 01 00 00 6f 00  0b 00 04 03 00 01 02 00  |......o.........|
-00000100  0a 00 3a 00 38 00 0e 00  0d 00 19 00 1c 00 0b 00  |..:.8...........|
-00000110  0c 00 1b 00 18 00 09 00  0a 00 1a 00 16 00 17 00  |................|
-00000120  08 00 06 00 07 00 14 00  15 00 04 00 05 00 12 00  |................|
-00000130  13 00 01 00 02 00 03 00  0f 00 10 00 11 00 0d 00  |................|
-00000140  20 00 1e 06 01 06 02 06  03 05 01 05 02 05 03 04  | ...............|
-00000150  01 04 02 04 03 03 01 03  02 03 03 02 01 02 02 02  |................|
-00000160  03 00 0f 00 01 01                                 |......|
+000000e0  00 09 00 ff 02 01 00 00  6f 00 0b 00 04 03 00 01  |........o.......|
+000000f0  02 00 0a 00 3a 00 38 00  0e 00 0d 00 19 00 1c 00  |....:.8.........|
+00000100  0b 00 0c 00 1b 00 18 00  09 00 0a 00 1a 00 16 00  |................|
+00000110  17 00 08 00 06 00 07 00  14 00 15 00 04 00 05 00  |................|
+00000120  12 00 13 00 01 00 02 00  03 00 0f 00 10 00 11 00  |................|
+00000130  0d 00 20 00 1e 06 01 06  02 06 03 05 01 05 02 05  |.. .............|
+00000140  03 04 01 04 02 04 03 03  01 03 02 03 03 02 01 02  |................|
+00000150  02 02 03 00 0f 00 01 01                           |........|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 31 02 00 00  2d 03 03 00 00 00 00 00  |....1...-.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
@@ -75,38 +74,38 @@
 00000310  75 71 b5 e5 54 5b 12 2e  8f 09 67 fd a7 24 20 3e  |uq..T[....g..$ >|
 00000320  b2 56 1c ce 97 28 5e f8  2b 2d 4f 9e f1 07 9f 6c  |.V...(^.+-O....l|
 00000330  4b 5b 83 56 e2 32 42 e9  58 b6 d7 49 a6 b5 68 1a  |K[.V.2B.X..I..h.|
-00000340  41 03 56 6b dc 5a 89 04  01 00 80 7f 65 76 11 35  |A.Vk.Z......ev.5|
-00000350  e1 9c c6 0c 21 41 d6 b4  22 2f a3 02 57 5c 40 5c  |....!A.."/..W\@\|
-00000360  2e 0c 5f 07 01 d1 78 29  a3 7b 65 37 1c c6 51 a8  |.._...x).{e7..Q.|
-00000370  e1 70 b4 73 9a cf 37 73  c8 ce 7c 8b 60 9e 0f e4  |.p.s..7s..|.`...|
-00000380  d7 2e 2a a8 fd 5a 0c 8a  e7 e0 4c ca 0b 28 6d ea  |..*..Z....L..(m.|
-00000390  39 da 9f ac 6c 23 f0 c6  fe 21 a8 ad fb e8 c9 6d  |9...l#...!.....m|
-000003a0  96 86 75 4d 88 f0 e8 71  e0 dc 32 b9 81 f9 f3 fe  |..uM...q..2.....|
-000003b0  64 e1 34 62 dc e2 0a 21  a3 7e 70 0d b0 f3 9d 13  |d.4b...!.~p.....|
-000003c0  5c 81 58 24 97 a9 fb 1d  99 60 a7 16 03 03 00 04  |\.X$.....`......|
+00000340  41 03 56 6b dc 5a 89 05  01 00 80 32 97 6b fe 26  |A.Vk.Z.....2.k.&|
+00000350  2f 9d b8 7d 5e cd 30 1b  24 e8 e5 d7 fd 35 7b 7b  |/..}^.0.$....5{{|
+00000360  43 23 64 ea 69 a8 30 7d  72 f4 bf 02 f5 6d bd 7e  |C#d.i.0}r....m.~|
+00000370  52 98 a2 a8 f4 43 6e 9f  bc 02 2e 5f 08 21 6e b2  |R....Cn...._.!n.|
+00000380  63 d7 63 4a b8 74 57 52  6c 04 a1 b1 1d 2c 1b ab  |c.cJ.tWRl....,..|
+00000390  ff ba e8 cf 04 eb 18 66  4d 4b 62 b8 27 e3 24 9b  |.......fMKb.'.$.|
+000003a0  5f 73 19 dc 5c 20 75 c5  e3 09 bc 00 34 75 c8 fe  |_s..\ u.....4u..|
+000003b0  b2 83 83 0f 0a b3 64 d7  52 97 d2 34 54 cf 54 88  |......d.R..4T.T.|
+000003c0  fa d7 0b cf 56 91 de 96  2f 35 de 16 03 03 00 04  |....V.../5......|
 000003d0  0e 00 00 00                                       |....|
 >>> Flow 3 (client to server)
-00000000  16 03 03 00 46 10 00 00  42 41 04 27 9e 27 b7 bf  |....F...BA.'.'..|
-00000010  b1 a9 b0 5b 7d 1c 9a 02  51 6e 03 ba 60 5a a2 50  |...[}...Qn..`Z.P|
-00000020  17 a6 2a e4 02 cd 6f ed  a2 97 49 49 0c 36 70 53  |..*...o...II.6pS|
-00000030  ce 0c 79 49 14 55 9a 7f  a6 0a 10 65 4f e4 c6 10  |..yI.U.....eO...|
-00000040  c2 31 68 5c 0e 5c ab 8a  a8 1c 52 14 03 03 00 01  |.1h\.\....R.....|
-00000050  01 16 03 03 00 40 25 59  40 9e 5b 9a d5 95 a1 59  |.....@%Y@.[....Y|
-00000060  d4 1d ea 0c 02 d1 66 29  c2 d5 d4 24 7a c7 9e 47  |......f)...$z..G|
-00000070  f7 79 a1 5f 72 fb c8 10  61 81 e8 e3 fb 16 7e 30  |.y._r...a.....~0|
-00000080  e2 cc 95 d2 24 2a 0f 94  96 b6 0a 27 1a 87 c9 36  |....$*.....'...6|
-00000090  c7 b4 e9 21 d1 94                                 |...!..|
+00000000  16 03 03 00 46 10 00 00  42 41 04 f8 15 aa a4 68  |....F...BA.....h|
+00000010  80 59 4e 9f b5 d5 3c e5  da 4b 89 36 bf 26 cb 69  |.YN...<..K.6.&.i|
+00000020  e8 99 d8 a5 3e af 1c ac  b6 bc c9 dd c5 0b 7e d8  |....>.........~.|
+00000030  c6 6a 41 80 8d cd 1a 06  23 cd 5a db ec 67 77 fe  |.jA.....#.Z..gw.|
+00000040  e6 cc 6f bb ea b6 5d e7  03 c9 45 14 03 03 00 01  |..o...]...E.....|
+00000050  01 16 03 03 00 40 7d 9d  03 ca 10 11 dc 09 60 23  |.....@}.......`#|
+00000060  25 db b3 d2 98 2c 37 9e  d1 de 45 01 3e d7 90 ff  |%....,7...E.>...|
+00000070  48 df 65 3f 75 d6 50 21  38 c4 df 0d 24 04 33 54  |H.e?u.P!8...$.3T|
+00000080  4f 3b 95 80 a6 ab 63 07  83 5b a0 e8 68 60 95 03  |O;....c..[..h`..|
+00000090  6d 33 6e dd 88 56                                 |m3n..V|
 >>> Flow 4 (server to client)
 00000000  14 03 03 00 01 01 16 03  03 00 40 00 00 00 00 00  |..........@.....|
-00000010  00 00 00 00 00 00 00 00  00 00 00 fe 1d f1 25 18  |..............%.|
-00000020  dd 7a 1e 10 f0 86 7f 75  74 44 a5 89 92 c8 21 ff  |.z.....utD....!.|
-00000030  b8 1b bf 79 3f 19 8e 12  04 65 58 a7 e5 96 52 3a  |...y?....eX...R:|
-00000040  15 af 57 d8 9e 46 6f 3f  0d 89 67 17 03 03 00 40  |..W..Fo?..g....@|
+00000010  00 00 00 00 00 00 00 00  00 00 00 74 52 26 02 91  |...........tR&..|
+00000020  cb 32 d9 03 3f c3 cb 31  71 19 64 8f 12 96 87 22  |.2..?..1q.d...."|
+00000030  ae da 10 2d 7d 37 d0 38  e3 b8 8d 21 ea 44 c4 3c  |...-}7.8...!.D.<|
+00000040  36 ea 0a 38 07 37 ea a2  c3 e8 02 17 03 03 00 40  |6..8.7.........@|
 00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000060  1b fb 13 e3 c0 eb 94 bb  4f e1 9e 47 6a ce 9b 6c  |........O..Gj..l|
-00000070  03 2f bf 0b 2f 08 36 48  b2 00 26 ab fb cc 3c 2f  |./../.6H..&...</|
-00000080  8d 99 82 86 a1 b7 15 04  f0 59 97 d7 50 61 1c a1  |.........Y..Pa..|
+00000060  24 49 ee a7 14 10 1d f9  93 9f 03 63 ab ff 54 9a  |$I.........c..T.|
+00000070  9d 26 3d 0d d1 3d ca 5b  ff 69 c8 17 89 fb 7c d2  |.&=..=.[.i....|.|
+00000080  4b a6 cd d6 91 e3 89 10  1a 6d f4 f5 ae bc 6e 96  |K........m....n.|
 00000090  15 03 03 00 30 00 00 00  00 00 00 00 00 00 00 00  |....0...........|
-000000a0  00 00 00 00 00 95 ed 23  80 9e f5 f2 37 ac 2d 50  |.......#....7.-P|
-000000b0  3d 30 de 68 be 25 c0 72  cc c9 2d 80 41 82 f7 0e  |=0.h.%.r..-.A...|
-000000c0  2e 86 0e 07 41                                    |....A|
+000000a0  00 00 00 00 00 1f 11 a1  c3 1d 1b d0 63 09 77 2f  |............c.w/|
+000000b0  1a 6a 2c 7b cc f5 01 74  4a a4 81 36 a8 70 c6 96  |.j,{...tJ..6.p..|
+000000c0  fa 12 8e dc bf                                    |.....|
diff --git a/src/crypto/tls/testdata/Server-TLSv12-ClientAuthRequestedAndECDSAGiven b/src/crypto/tls/testdata/Server-TLSv12-ClientAuthRequestedAndECDSAGiven
index 76a77060b4..048d10b59e 100644
--- a/src/crypto/tls/testdata/Server-TLSv12-ClientAuthRequestedAndECDSAGiven
+++ b/src/crypto/tls/testdata/Server-TLSv12-ClientAuthRequestedAndECDSAGiven
@@ -1,7 +1,7 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 5b 01 00 00  57 03 03 3b 02 c7 94 b7  |....[...W..;....|
-00000010  61 d9 c9 d4 1f 4e 9a a0  73 77 d7 6b 4f 42 af 97  |a....N..sw.kOB..|
-00000020  3c 12 f8 10 38 c7 3d 56  11 a3 09 00 00 04 00 05  |<...8.=V........|
+00000000  16 03 01 00 5b 01 00 00  57 03 03 54 2a 20 9e ee  |....[...W..T* ..|
+00000010  10 ae 28 a1 a8 5a fd 71  a8 f7 23 35 24 60 dd 25  |..(..Z.q..#5$`.%|
+00000020  c6 fe 46 f6 b3 9d 09 0f  5f 0f af 00 00 04 00 05  |..F....._.......|
 00000030  00 ff 02 01 00 00 29 00  0d 00 20 00 1e 06 01 06  |......)... .....|
 00000040  02 06 03 05 01 05 02 05  03 04 01 04 02 04 03 03  |................|
 00000050  01 03 02 03 03 02 01 02  02 02 03 00 0f 00 01 01  |................|
@@ -53,9 +53,9 @@
 000002c0  50 56 5c d5 82 5a 2d 5a  5f 33 c4 b6 d8 c9 75 90  |PV\..Z-Z_3....u.|
 000002d0  96 8c 0f 52 98 b5 cd 98  1f 89 20 5f f2 a0 1c a3  |...R...... _....|
 000002e0  1b 96 94 dd a9 fd 57 e9  70 e8 26 6d 71 99 9b 26  |......W.p.&mq..&|
-000002f0  6e 38 50 29 6c 90 a7 bd  d9 16 03 03 00 13 0d 00  |n8P)l...........|
-00000300  00 0f 02 01 40 00 08 04  01 04 03 02 01 02 03 00  |....@...........|
-00000310  00 16 03 03 00 04 0e 00  00 00                    |..........|
+000002f0  6e 38 50 29 6c 90 a7 bd  d9 16 03 03 00 17 0d 00  |n8P)l...........|
+00000300  00 13 02 01 40 00 0c 04  01 04 03 05 01 05 03 02  |....@...........|
+00000310  01 02 03 00 00 16 03 03  00 04 0e 00 00 00        |..............|
 >>> Flow 3 (client to server)
 00000000  16 03 03 02 0a 0b 00 02  06 00 02 03 00 02 00 30  |...............0|
 00000010  82 01 fc 30 82 01 5e 02  09 00 9a 30 84 6c 26 35  |...0..^....0.l&5|
@@ -90,33 +90,33 @@
 000001e0  be e8 91 b3 da 1a f5 5d  a3 23 f5 26 8b 45 70 8d  |.......].#.&.Ep.|
 000001f0  65 62 9b 7e 01 99 3d 18  f6 10 9a 38 61 9b 2e 57  |eb.~..=....8a..W|
 00000200  e4 fa cc b1 8a ce e2 23  a0 87 f0 e1 67 51 eb 16  |.......#....gQ..|
-00000210  03 03 00 86 10 00 00 82  00 80 ba 08 cf e6 45 d3  |..............E.|
-00000220  24 3f 4a 7e 0d 68 5f ed  5d a2 0e ad fa 41 6c 71  |$?J~.h_.]....Alq|
-00000230  43 ce 20 cf 12 c2 e1 45  78 9c 00 0b 69 f5 5f b1  |C. ....Ex...i._.|
-00000240  45 48 27 32 51 44 d8 cd  3b dc 78 1b df ee 82 68  |EH'2QD..;.x....h|
-00000250  3e 1e 26 bf e5 8d 8f 0a  6c 62 a0 f0 47 65 50 8d  |>.&.....lb..GeP.|
-00000260  2c 9a 80 bb 0a 2b e4 14  25 c6 2c 86 17 67 1b e8  |,....+..%.,..g..|
-00000270  ca 89 78 79 00 a2 d8 0e  b1 02 49 28 12 a3 a1 46  |..xy......I(...F|
-00000280  bb 6c 59 bf 59 4b 5b 48  0c 24 38 ee 7f 9f fd dd  |.lY.YK[H.$8.....|
-00000290  62 07 41 0c 5a bd 29 a4  3a ef 16 03 03 00 93 0f  |b.A.Z.).:.......|
-000002a0  00 00 8f 04 03 00 8b 30  81 88 02 42 00 9d ee a7  |.......0...B....|
-000002b0  23 08 8d 08 61 7a 5c 97  0a 6b 3e 65 3f 1e d2 36  |#...az\..k>e?..6|
-000002c0  4e 25 27 96 8f 92 08 b8  da 69 f9 3d 1e 77 88 dc  |N%'......i.=.w..|
-000002d0  33 3e 5f c5 eb 40 16 ab  32 3e c6 f5 a5 9f 42 22  |3>_..@..2>....B"|
-000002e0  f6 56 86 1f e0 95 c8 83  2d 5a c9 b9 79 b2 02 42  |.V......-Z..y..B|
-000002f0  01 2d 43 06 1d 79 3b ca  84 b2 81 21 51 01 4e 3b  |.-C..y;....!Q.N;|
-00000300  9d 5a b2 c5 87 e4 ea f9  08 2e bb 28 cc 9f a6 c6  |.Z.........(....|
-00000310  f7 6a 5c 2a f0 c8 02 33  ba 56 ea bc 3b ac 97 bc  |.j\*...3.V..;...|
-00000320  4b d0 e0 19 18 14 a6 8c  d5 60 05 b3 a2 20 7f c3  |K........`... ..|
-00000330  24 f9 14 03 03 00 01 01  16 03 03 00 24 99 58 7b  |$...........$.X{|
-00000340  e7 5d 19 95 f0 8b d5 86  7d 87 19 03 98 24 3d e8  |.]......}....$=.|
-00000350  cc c0 79 58 f9 81 b8 6c  fb d6 ed a4 84 96 13 b7  |..yX...l........|
-00000360  d0                                                |.|
+00000210  03 03 00 86 10 00 00 82  00 80 51 0a a7 21 d3 f5  |..........Q..!..|
+00000220  f2 16 ba b1 a0 15 58 ef  d6 a1 cd 03 fe b6 95 84  |......X.........|
+00000230  35 c4 c1 0b d2 8a 01 af  3d 01 15 29 1d 2d 1e c9  |5.......=..).-..|
+00000240  12 0e df 49 87 8a 3a 67  c3 6a a6 04 10 3d 45 e4  |...I..:g.j...=E.|
+00000250  cb d3 aa 37 29 5a 45 6f  f4 20 8c 85 9d 1b 0e 95  |...7)ZEo. ......|
+00000260  f4 0e 03 e5 0f 85 fc e1  20 3e 0f 44 f9 8e fe 28  |........ >.D...(|
+00000270  65 2b ae 12 18 72 26 dd  22 96 31 81 27 dd f7 69  |e+...r&.".1.'..i|
+00000280  b4 90 93 a4 0c f5 b6 f8  73 f3 85 f5 c5 03 1d 74  |........s......t|
+00000290  1a 83 e0 5c 77 bc 41 00  85 bc 16 03 03 00 93 0f  |...\w.A.........|
+000002a0  00 00 8f 04 03 00 8b 30  81 88 02 42 01 33 86 47  |.......0...B.3.G|
+000002b0  4d 91 1a 71 e5 64 25 f2  0b 88 14 34 8d ca e5 d0  |M..q.d%....4....|
+000002c0  09 5b b7 c0 c2 e5 2c 0d  05 36 ee cc 11 1b 6a 8b  |.[....,..6....j.|
+000002d0  ff 15 0c 7f c2 c4 8d 4a  13 33 2f fa ba c9 ae 58  |.......J.3/....X|
+000002e0  97 5a 96 17 e3 df 69 f1  d4 a6 23 7a ef a0 02 42  |.Z....i...#z...B|
+000002f0  01 2a 94 f3 db 84 42 64  85 5b 31 27 c2 72 c2 24  |.*....Bd.[1'.r.$|
+00000300  74 b0 78 e6 ba 09 3d 9f  83 2d 28 29 12 c4 ac 8b  |t.x...=..-()....|
+00000310  e0 32 d2 30 2e 06 53 15  85 3c 29 a9 a5 13 98 93  |.2.0..S..<).....|
+00000320  f4 76 02 96 6a 60 3f 0f  ad 85 b7 66 49 03 c1 2a  |.v..j`?....fI..*|
+00000330  bc 86 14 03 03 00 01 01  16 03 03 00 24 fc e5 8a  |............$...|
+00000340  f9 82 bd 89 d7 db e3 53  09 85 01 cc bc 25 93 96  |.......S.....%..|
+00000350  d3 74 c7 e9 15 f3 e1 f9  01 6e 77 08 92 39 69 b5  |.t.......nw..9i.|
+00000360  43                                                |C|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 24 50 c9 ae 5b 73  |..........$P..[s|
-00000010  ce 45 98 b1 88 74 25 bd  18 6c 08 aa e4 7c 39 0b  |.E...t%..l...|9.|
-00000020  d3 e9 c2 29 fe a1 fd 0e  46 80 63 0a a0 b2 55 17  |...)....F.c...U.|
-00000030  03 03 00 21 89 28 af 50  62 c3 63 39 5b 13 03 45  |...!.(.Pb.c9[..E|
-00000040  48 c9 3c 74 93 1a 01 47  ec 28 0b 7d 37 1d 15 48  |H.<t...G.(.}7..H|
-00000050  ac eb dc 62 04 15 03 03  00 16 f6 84 ba 7b 57 9d  |...b.........{W.|
-00000060  b5 c7 d4 01 cd 04 8a d3  5a c9 c0 72 61 12 3f a1  |........Z..ra.?.|
+00000000  14 03 03 00 01 01 16 03  03 00 24 55 7c a6 2d 0a  |..........$U|.-.|
+00000010  bb c0 bb cb 23 91 93 e6  83 d3 c2 17 fa 2f d8 fa  |....#......../..|
+00000020  3c 1a e2 50 af f8 e4 97  4b e2 0c 3d 60 cc b0 17  |<..P....K..=`...|
+00000030  03 03 00 21 8d b8 db 0d  4c 1d 99 93 b8 65 dc db  |...!....L....e..|
+00000040  1b ff 77 29 a5 41 34 23  e4 24 43 a1 3f 5e 5f b2  |..w).A4#.$C.?^_.|
+00000050  35 49 6e 1c 94 15 03 03  00 16 37 ed 78 ef 5d c6  |5In.......7.x.].|
+00000060  32 1d 72 1e 2f 02 84 f0  c7 1f 89 83 00 e6 3b a5  |2.r./.........;.|
diff --git a/src/crypto/tls/testdata/Server-TLSv12-ClientAuthRequestedAndGiven b/src/crypto/tls/testdata/Server-TLSv12-ClientAuthRequestedAndGiven
index 45e384f226..2b5b711f77 100644
--- a/src/crypto/tls/testdata/Server-TLSv12-ClientAuthRequestedAndGiven
+++ b/src/crypto/tls/testdata/Server-TLSv12-ClientAuthRequestedAndGiven
@@ -1,7 +1,7 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 5b 01 00 00  57 03 03 23 82 04 e6 b7  |....[...W..#....|
-00000010  a4 1e 2c 61 ae c0 cd ef  d3 2a 30 0b d7 19 88 16  |..,a.....*0.....|
-00000020  e3 af 68 6c 45 83 df f5  02 b0 43 00 00 04 00 05  |..hlE.....C.....|
+00000000  16 03 01 00 5b 01 00 00  57 03 03 de ba cc 44 30  |....[...W.....D0|
+00000010  69 67 7f 91 d6 08 2c d0  1f 5c 60 d5 a5 76 c7 15  |ig....,..\`..v..|
+00000020  fd fd 83 a0 20 b3 63 c1  ed 06 d3 00 00 04 00 05  |.... .c.........|
 00000030  00 ff 02 01 00 00 29 00  0d 00 20 00 1e 06 01 06  |......)... .....|
 00000040  02 06 03 05 01 05 02 05  03 04 01 04 02 04 03 03  |................|
 00000050  01 03 02 03 03 02 01 02  02 02 03 00 0f 00 01 01  |................|
@@ -53,9 +53,9 @@
 000002c0  50 56 5c d5 82 5a 2d 5a  5f 33 c4 b6 d8 c9 75 90  |PV\..Z-Z_3....u.|
 000002d0  96 8c 0f 52 98 b5 cd 98  1f 89 20 5f f2 a0 1c a3  |...R...... _....|
 000002e0  1b 96 94 dd a9 fd 57 e9  70 e8 26 6d 71 99 9b 26  |......W.p.&mq..&|
-000002f0  6e 38 50 29 6c 90 a7 bd  d9 16 03 03 00 13 0d 00  |n8P)l...........|
-00000300  00 0f 02 01 40 00 08 04  01 04 03 02 01 02 03 00  |....@...........|
-00000310  00 16 03 03 00 04 0e 00  00 00                    |..........|
+000002f0  6e 38 50 29 6c 90 a7 bd  d9 16 03 03 00 17 0d 00  |n8P)l...........|
+00000300  00 13 02 01 40 00 0c 04  01 04 03 05 01 05 03 02  |....@...........|
+00000310  01 02 03 00 00 16 03 03  00 04 0e 00 00 00        |..............|
 >>> Flow 3 (client to server)
 00000000  16 03 03 01 fb 0b 00 01  f7 00 01 f4 00 01 f1 30  |...............0|
 00000010  82 01 ed 30 82 01 58 a0  03 02 01 02 02 01 00 30  |...0..X........0|
@@ -89,32 +89,32 @@
 000001d0  8b ec ab 67 be c8 64 b0  11 50 46 58 17 6b 99 1c  |...g..d..PFX.k..|
 000001e0  d3 1d fc 06 f1 0e e5 96  a8 0c f9 78 20 b7 44 18  |...........x .D.|
 000001f0  51 8d 10 7e 4f 94 67 df  a3 4e 70 73 8e 90 91 85  |Q..~O.g..Nps....|
-00000200  16 03 03 00 86 10 00 00  82 00 80 a9 2f ef 94 68  |............/..h|
-00000210  e5 de 70 a0 f6 ef 70 e6  db 01 69 b1 0b e6 ee 21  |..p...p...i....!|
-00000220  48 e0 39 28 4d 19 61 b4  67 9d e6 a1 c5 93 49 b4  |H.9(M.a.g.....I.|
-00000230  5c ed 60 72 1a 01 aa b3  21 18 47 20 f0 0b cd e7  |\.`r....!.G ....|
-00000240  68 fa ca 35 65 86 06 42  9c 36 45 f3 36 42 17 88  |h..5e..B.6E.6B..|
-00000250  9f 0b 0b 99 35 28 d4 98  a3 86 4d 55 0b d0 2c 31  |....5(....MU..,1|
-00000260  64 d6 ce e4 50 a5 4e d6  a4 4b 9c b8 d2 4a 35 61  |d...P.N..K...J5a|
-00000270  0d f0 28 ad 96 91 59 04  5c 55 5a 0b 2d 12 a1 d1  |..(...Y.\UZ.-...|
-00000280  60 e8 55 a2 90 55 9a 55  ad 1d 05 16 03 03 00 88  |`.U..U.U........|
-00000290  0f 00 00 84 04 01 00 80  0f 8a 5c 80 aa 8e d3 c9  |..........\.....|
-000002a0  2c 97 a1 0b 0c 54 b4 66  4e 92 59 89 4e 3b 58 71  |,....T.fN.Y.N;Xq|
-000002b0  e0 d7 5a 5a 85 90 de 1e  b2 61 1b 0b f1 a2 1c d6  |..ZZ.....a......|
-000002c0  02 44 da 1e 10 fd 41 62  3f 11 13 0f 59 43 40 cb  |.D....Ab?...YC@.|
-000002d0  f4 6a e4 c9 a7 f4 20 be  d2 8c ac cb b9 24 40 51  |.j.... ......$@Q|
-000002e0  a9 83 c5 a9 34 b2 16 e2  4a 7b 0f d1 df a0 fc 15  |....4...J{......|
-000002f0  85 89 0c f7 5a bc bb c6  90 da e2 81 c3 c5 4d 58  |....Z.........MX|
-00000300  f3 04 73 8f ab 03 39 e5  88 52 bd 3a bd ca 0a 09  |..s...9..R.:....|
-00000310  23 36 68 dc b3 2b 1b 07  14 03 03 00 01 01 16 03  |#6h..+..........|
-00000320  03 00 24 64 3e ca cf ab  6e 8b 5e 2d bb b0 09 55  |..$d>...n.^-...U|
-00000330  68 c6 88 08 25 15 fc a5  6c 95 9a d8 b4 58 f9 a3  |h...%...l....X..|
-00000340  55 a0 92 c2 08 72 1c                              |U....r.|
+00000200  16 03 03 00 86 10 00 00  82 00 80 6c 19 7b fb 96  |...........l.{..|
+00000210  52 57 c1 8b 78 72 4b 67  c9 66 ce 61 71 6c 83 90  |RW..xrKg.f.aql..|
+00000220  56 90 fc bc 40 41 12 30  bf 3f 20 58 75 3d 31 45  |V...@A.0.? Xu=1E|
+00000230  67 61 57 fc 0f 48 1d e1  a4 ec 75 4d bc e3 09 62  |gaW..H....uM...b|
+00000240  98 8e 40 cb 53 cb 97 31  32 b7 20 f3 dd 5d 29 62  |..@.S..12. ..])b|
+00000250  90 18 94 98 84 d8 42 34  fc a4 35 80 55 46 32 a1  |......B4..5.UF2.|
+00000260  6f 0e d2 33 c3 53 6a 46  87 74 fd 68 15 35 b8 c4  |o..3.SjF.t.h.5..|
+00000270  2b da b4 55 9c 6e 87 94  01 6a 72 12 8a 01 8a 37  |+..U.n...jr....7|
+00000280  ac 5b d7 55 27 40 58 fc  0d 30 12 16 03 03 00 88  |.[.U'@X..0......|
+00000290  0f 00 00 84 04 01 00 80  06 71 c6 af f8 53 b9 eb  |.........q...S..|
+000002a0  9a 99 44 fa 65 dc af cc  69 b4 cf 10 fc b0 f2 33  |..D.e...i......3|
+000002b0  da 8a 3f cb f1 8d 51 ae  90 7d f3 02 57 0e ea b9  |..?...Q..}..W...|
+000002c0  37 2d 2e dc ad 89 44 04  4f 21 04 44 54 9f 9e 92  |7-....D.O!.DT...|
+000002d0  7e b7 4c 53 b8 3c 89 c0  c1 1e f7 df cc c6 2f 76  |~.LS.<......../v|
+000002e0  be 91 bc a0 4d c7 e1 df  9d 19 e3 0d ab 17 e4 d4  |....M...........|
+000002f0  c3 4c 75 e2 71 5c a3 df  9a 17 82 38 2a 4b f8 ae  |.Lu.q\.....8*K..|
+00000300  ad 13 a7 f3 13 f8 72 78  49 fe 80 d9 bd 77 a3 48  |......rxI....w.H|
+00000310  43 a7 76 00 15 1a 14 5d  14 03 03 00 01 01 16 03  |C.v....]........|
+00000320  03 00 24 1d 80 33 0a 75  ae d5 13 d5 46 f9 89 3d  |..$..3.u....F..=|
+00000330  15 95 f2 c5 2d c5 e0 7f  cc 6e d7 36 9f 72 d6 74  |....-....n.6.r.t|
+00000340  7b c1 4f ed 89 ff c1                              |{.O....|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 24 4e b8 9c fd 56  |..........$N...V|
-00000010  81 68 9d 5a 41 5c 53 f9  10 a5 d0 8e 93 79 4e 87  |.h.ZA\S......yN.|
-00000020  f8 92 09 09 0f ea 04 08  e8 14 e1 8a 0b f8 23 17  |..............#.|
-00000030  03 03 00 21 1f 22 bc 5a  ce d7 5e ca c4 d3 be f5  |...!.".Z..^.....|
-00000040  d4 f6 4e b9 aa 10 be d3  b6 a9 ad 3e f5 f6 69 fd  |..N........>..i.|
-00000050  23 a8 cd e2 4d 15 03 03  00 16 29 1d 72 73 aa 62  |#...M.....).rs.b|
-00000060  c7 ac 8b 19 8f 72 27 b2  12 ac ce 72 2c c4 47 19  |.....r'....r,.G.|
+00000000  14 03 03 00 01 01 16 03  03 00 24 6c f7 56 21 17  |..........$l.V!.|
+00000010  3d d6 ad 06 34 a6 0d a0  22 b6 26 38 a2 b2 39 52  |=...4...".&8..9R|
+00000020  8a cb 0e 5b b2 f6 32 b2  da 71 8a 72 13 40 f2 17  |...[..2..q.r.@..|
+00000030  03 03 00 21 69 bc 35 92  9c 17 4d aa ce 85 35 35  |...!i.5...M...55|
+00000040  98 8e c3 ff fd 36 9b 47  dd a7 85 8a 20 05 05 b8  |.....6.G.... ...|
+00000050  87 31 66 41 a0 15 03 03  00 16 e9 28 e0 39 fe da  |.1fA.......(.9..|
+00000060  b1 0a c3 22 cf 9e 33 60  b9 52 18 ad 03 c8 ee 6b  |..."..3`.R.....k|
diff --git a/src/crypto/tls/testdata/Server-TLSv12-ClientAuthRequestedNotGiven b/src/crypto/tls/testdata/Server-TLSv12-ClientAuthRequestedNotGiven
index d4e5447b4d..698409cd1c 100644
--- a/src/crypto/tls/testdata/Server-TLSv12-ClientAuthRequestedNotGiven
+++ b/src/crypto/tls/testdata/Server-TLSv12-ClientAuthRequestedNotGiven
@@ -1,7 +1,7 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 5b 01 00 00  57 03 03 d7 96 89 ca 52  |....[...W......R|
-00000010  d3 5b 27 58 b9 d2 4a 09  ce 09 7a 0f ee ea fc be  |.['X..J...z.....|
-00000020  04 8b 05 15 5b ab 26 52  88 72 51 00 00 04 00 05  |....[.&R.rQ.....|
+00000000  16 03 01 00 5b 01 00 00  57 03 03 72 1e c6 5e 14  |....[...W..r..^.|
+00000010  4d 88 9c 2c 6e fb bb bb  37 26 f7 0f 06 d5 e8 aa  |M..,n...7&......|
+00000020  53 e0 df d0 de 81 f8 33  b1 86 ff 00 00 04 00 05  |S......3........|
 00000030  00 ff 02 01 00 00 29 00  0d 00 20 00 1e 06 01 06  |......)... .....|
 00000040  02 06 03 05 01 05 02 05  03 04 01 04 02 04 03 03  |................|
 00000050  01 03 02 03 03 02 01 02  02 02 03 00 0f 00 01 01  |................|
@@ -53,28 +53,28 @@
 000002c0  50 56 5c d5 82 5a 2d 5a  5f 33 c4 b6 d8 c9 75 90  |PV\..Z-Z_3....u.|
 000002d0  96 8c 0f 52 98 b5 cd 98  1f 89 20 5f f2 a0 1c a3  |...R...... _....|
 000002e0  1b 96 94 dd a9 fd 57 e9  70 e8 26 6d 71 99 9b 26  |......W.p.&mq..&|
-000002f0  6e 38 50 29 6c 90 a7 bd  d9 16 03 03 00 13 0d 00  |n8P)l...........|
-00000300  00 0f 02 01 40 00 08 04  01 04 03 02 01 02 03 00  |....@...........|
-00000310  00 16 03 03 00 04 0e 00  00 00                    |..........|
+000002f0  6e 38 50 29 6c 90 a7 bd  d9 16 03 03 00 17 0d 00  |n8P)l...........|
+00000300  00 13 02 01 40 00 0c 04  01 04 03 05 01 05 03 02  |....@...........|
+00000310  01 02 03 00 00 16 03 03  00 04 0e 00 00 00        |..............|
 >>> Flow 3 (client to server)
 00000000  16 03 03 00 07 0b 00 00  03 00 00 00 16 03 03 00  |................|
-00000010  86 10 00 00 82 00 80 2a  d6 5e 1d 41 2f 3e 28 16  |.......*.^.A/>(.|
-00000020  59 0e af 65 a4 10 24 a0  cb 7b cb c5 4d f2 5b 61  |Y..e..$..{..M.[a|
-00000030  48 b2 13 26 0c 6e 7f 8d  7a fc cf 40 7c 1f 9b ca  |H..&.n..z..@|...|
-00000040  e2 2e 62 ba e0 54 be b4  3b b4 93 20 87 e9 55 58  |..b..T..;.. ..UX|
-00000050  b7 e3 8f 16 d0 9b 92 09  c3 37 fb 90 75 0d b1 34  |.........7..u..4|
-00000060  2c 2f da 8e 91 a2 54 a8  23 82 35 06 a6 37 98 d7  |,/....T.#.5..7..|
-00000070  54 13 35 48 3c bb db 5e  02 30 5d e6 76 ac 72 bd  |T.5H<..^.0].v.r.|
-00000080  40 da 41 62 0a 6c c1 4a  bc 4d c2 e0 19 2c 0a d0  |@.Ab.l.J.M...,..|
-00000090  02 be ca 74 9d fe f0 14  03 03 00 01 01 16 03 03  |...t............|
-000000a0  00 24 69 1d 39 5e 3d 56  c4 a9 69 be 15 e3 3f 54  |.$i.9^=V..i...?T|
-000000b0  59 cf 24 b1 6b 02 cf e3  88 89 e2 61 1e 28 a2 ac  |Y.$.k......a.(..|
-000000c0  cb e0 e2 26 d7 eb                                 |...&..|
+00000010  86 10 00 00 82 00 80 5b  13 f1 87 cb 3b f1 72 32  |.......[....;.r2|
+00000020  a0 24 fd ea 6a b1 de 7d  54 4a ff a5 b0 01 8f de  |.$..j..}TJ......|
+00000030  95 d1 a9 7f d4 1d 97 0f  52 cb 9b 60 5d cb 37 d0  |........R..`].7.|
+00000040  37 eb 8f 2b c6 08 86 b7  d2 87 8e 12 78 af a8 a3  |7..+........x...|
+00000050  a5 35 cc b7 33 25 60 9a  cb 4e b9 b9 51 e0 4c 69  |.5..3%`..N..Q.Li|
+00000060  7b 2f 68 39 9e 40 c0 0c  77 4f 04 f5 47 7f 45 55  |{/h9.@..wO..G.EU|
+00000070  e9 90 f1 9e df 11 4a af  9f cc 7e 96 31 d7 b4 d2  |......J...~.1...|
+00000080  bb 0d 03 56 9b 97 4e 40  53 af 2d c0 2a f9 29 8e  |...V..N@S.-.*.).|
+00000090  82 d0 f7 9a 89 59 5f 14  03 03 00 01 01 16 03 03  |.....Y_.........|
+000000a0  00 24 d1 27 e7 27 e2 a4  81 4e 02 be 66 7e 78 44  |.$.'.'...N..f~xD|
+000000b0  ee 40 84 f7 fa 17 ad 6e  99 5c 48 df bb c0 94 f5  |.@.....n.\H.....|
+000000c0  a2 c6 30 6d 2d 08                                 |..0m-.|
 >>> Flow 4 (server to client)
-00000000  14 03 03 00 01 01 16 03  03 00 24 30 d5 30 a5 a9  |..........$0.0..|
-00000010  c2 4d 71 23 01 6d d2 86  fa 08 77 a0 c2 a8 06 f9  |.Mq#.m....w.....|
-00000020  76 af e2 60 cd a8 8a c9  ee 7c 47 70 02 e6 04 17  |v..`.....|Gp....|
-00000030  03 03 00 21 a8 23 bf 89  d0 ec 14 17 8b 13 1f 66  |...!.#.........f|
-00000040  83 f8 b3 6b ce 70 ba 77  ab 04 6e b5 38 76 bc 4c  |...k.p.w..n.8v.L|
-00000050  b3 a2 ed 67 9a 15 03 03  00 16 1d c3 b9 d1 e5 39  |...g...........9|
-00000060  d8 1e f8 49 46 49 6c 58  57 fc c7 07 0f 10 94 c7  |...IFIlXW.......|
+00000000  14 03 03 00 01 01 16 03  03 00 24 41 b5 43 2a 5c  |..........$A.C*\|
+00000010  f5 f6 e1 b5 a2 cc 1c c8  86 ae cc a2 0c c4 6b 73  |..............ks|
+00000020  ab 3d 91 09 04 6d e0 18  af 85 dd 90 9a eb 44 17  |.=...m........D.|
+00000030  03 03 00 21 74 b4 fd cb  c4 7b 81 67 76 18 0f b3  |...!t....{.gv...|
+00000040  b7 3f 30 2f c9 86 23 f1  79 38 ef 0c da 52 b7 ab  |.?0/..#.y8...R..|
+00000050  f7 9a ca 27 73 15 03 03  00 16 37 2b 19 cc bd f9  |...'s.....7+....|
+00000060  cd 14 30 21 4f c0 45 e9  e7 ac 7c c4 93 51 f6 aa  |..0!O.E...|..Q..|
diff --git a/src/crypto/tls/testdata/Server-TLSv12-ECDHE-ECDSA-AES b/src/crypto/tls/testdata/Server-TLSv12-ECDHE-ECDSA-AES
index 0e480be437..3b7238ad29 100644
--- a/src/crypto/tls/testdata/Server-TLSv12-ECDHE-ECDSA-AES
+++ b/src/crypto/tls/testdata/Server-TLSv12-ECDHE-ECDSA-AES
@@ -1,7 +1,7 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 a1 01 00 00  9d 03 03 eb 02 58 55 90  |.............XU.|
-00000010  a0 ba 80 52 28 a5 36 35  ee 6d eb e1 b0 d3 5d 89  |...R(.65.m....].|
-00000020  e8 2d a3 5e b1 83 e8 2f  00 f2 1e 00 00 04 c0 0a  |.-.^.../........|
+00000000  16 03 01 00 a1 01 00 00  9d 03 03 0f b7 07 5f c7  |.............._.|
+00000010  18 b8 39 6d 92 b3 90 ed  bf 5c 48 7c 6a 56 ee e9  |..9m.....\H|jV..|
+00000020  7a 5b 5f 71 a4 f0 7f 47  57 73 78 00 00 04 c0 0a  |z[_q...GWsx.....|
 00000030  00 ff 02 01 00 00 6f 00  0b 00 04 03 00 01 02 00  |......o.........|
 00000040  0a 00 3a 00 38 00 0e 00  0d 00 19 00 1c 00 0b 00  |..:.8...........|
 00000050  0c 00 1b 00 18 00 09 00  0a 00 1a 00 16 00 17 00  |................|
@@ -47,43 +47,43 @@
 00000210  0e bd 3f a3 8c 25 c1 33  13 83 0d 94 06 bb d4 37  |..?..%.3.......7|
 00000220  7a f6 ec 7a c9 86 2e dd  d7 11 69 7f 85 7c 56 de  |z..z......i..|V.|
 00000230  fb 31 78 2b e4 c7 78 0d  ae cb be 9e 4e 36 24 31  |.1x+..x.....N6$1|
-00000240  7b 6a 0f 39 95 12 07 8f  2a 16 03 03 00 d7 0c 00  |{j.9....*.......|
-00000250  00 d3 03 00 17 41 04 1e  18 37 ef 0d 19 51 88 35  |.....A...7...Q.5|
+00000240  7b 6a 0f 39 95 12 07 8f  2a 16 03 03 00 d8 0c 00  |{j.9....*.......|
+00000250  00 d4 03 00 17 41 04 1e  18 37 ef 0d 19 51 88 35  |.....A...7...Q.5|
 00000260  75 71 b5 e5 54 5b 12 2e  8f 09 67 fd a7 24 20 3e  |uq..T[....g..$ >|
 00000270  b2 56 1c ce 97 28 5e f8  2b 2d 4f 9e f1 07 9f 6c  |.V...(^.+-O....l|
 00000280  4b 5b 83 56 e2 32 42 e9  58 b6 d7 49 a6 b5 68 1a  |K[.V.2B.X..I..h.|
-00000290  41 03 56 6b dc 5a 89 04  03 00 8a 30 81 87 02 41  |A.Vk.Z.....0...A|
-000002a0  68 cb cd c0 12 5e 1e b3  cc d9 47 e7 b5 11 5e be  |h....^....G...^.|
-000002b0  74 5b 90 93 3f 4c 07 20  a1 94 50 bb 23 82 fc 5b  |t[..?L. ..P.#..[|
-000002c0  78 87 a3 a1 fe 7c 6f 84  93 8f b8 f7 2e 56 65 85  |x....|o......Ve.|
-000002d0  1d 9e 8e 52 b0 89 b0 a7  66 58 98 55 30 64 94 91  |...R....fX.U0d..|
-000002e0  8e 02 42 01 3d 74 eb a4  64 9e 7c 8b 05 57 5c f7  |..B.=t..d.|..W\.|
-000002f0  fe a7 58 f4 21 7b 75 ea  51 1e 1c be 80 4e 00 d1  |..X.!{u.Q....N..|
-00000300  06 80 58 90 c2 f3 47 da  22 8b a2 6b f0 2e 34 d0  |..X...G."..k..4.|
-00000310  1a 84 54 87 62 96 b9 2c  91 9f 3f 93 24 df 6c a3  |..T.b..,..?.$.l.|
-00000320  77 1f d2 e4 30 16 03 03  00 04 0e 00 00 00        |w...0.........|
+00000290  41 03 56 6b dc 5a 89 05  03 00 8b 30 81 88 02 42  |A.Vk.Z.....0...B|
+000002a0  00 d3 cf 21 cd 3c 2e 11  f5 f8 1d c8 c1 57 4b f8  |...!.<.......WK.|
+000002b0  1a c0 2b 1d 47 0f 2d a5  ac a1 c8 83 5d 76 87 05  |..+.G.-.....]v..|
+000002c0  2b 0d 36 d5 57 9f b9 8a  a0 a2 94 67 6a cd 29 db  |+.6.W......gj.).|
+000002d0  04 b0 6b 06 d9 f7 17 9f  1c 60 92 e7 4e 50 48 7f  |..k......`..NPH.|
+000002e0  dc d0 02 42 01 56 fd 38  bd 05 a5 16 6d 91 d1 ce  |...B.V.8....m...|
+000002f0  bb 8c 45 b2 76 2f 92 9c  8b 94 57 7d de 53 8b 7b  |..E.v/....W}.S.{|
+00000300  80 26 6c 4a 43 4b a6 c9  46 49 08 ab c7 57 f3 d9  |.&lJCK..FI...W..|
+00000310  fa 1d 55 fe 91 de 8a 0d  8b d1 44 96 87 85 cb 02  |..U.......D.....|
+00000320  76 9c 00 ad 5f b8 16 03  03 00 04 0e 00 00 00     |v..._..........|
 >>> Flow 3 (client to server)
-00000000  16 03 03 00 46 10 00 00  42 41 04 04 12 72 83 8c  |....F...BA...r..|
-00000010  55 75 c4 34 48 5d d4 e3  9a 34 54 46 83 2f 69 36  |Uu.4H]...4TF./i6|
-00000020  e2 98 65 4d d2 b3 d4 6e  35 93 42 80 02 bd 26 a4  |..eM...n5.B...&.|
-00000030  ca 53 8d 50 c8 78 ec e3  0d 68 31 12 11 fe 76 52  |.S.P.x...h1...vR|
-00000040  0d 2f 63 76 43 74 5b 55  bd 9a 01 14 03 03 00 01  |./cvCt[U........|
-00000050  01 16 03 03 00 40 5f b8  b6 b9 cd 93 37 67 53 6f  |.....@_.....7gSo|
-00000060  cd 2d c6 c2 92 28 d6 ab  b7 31 ab 75 99 c8 83 7d  |.-...(...1.u...}|
-00000070  99 69 03 2d 52 6f ae 06  ec 34 05 fc 3b dd d0 0b  |.i.-Ro...4..;...|
-00000080  22 4a 84 cd 86 6c 11 10  3d 0d 9c 0f c8 c9 24 a6  |"J...l..=.....$.|
-00000090  f3 e6 e7 87 31 13                                 |....1.|
+00000000  16 03 03 00 46 10 00 00  42 41 04 0b dc ea 22 05  |....F...BA....".|
+00000010  44 c2 09 47 65 31 3b 0b  e1 05 1a 87 8c 2d 3b 56  |D..Ge1;......-;V|
+00000020  49 34 27 3e d6 3b 93 e2  12 7f 5d 7b dc 85 c8 96  |I4'>.;....]{....|
+00000030  4c 8c f9 18 6f 15 cf db  6e 2c 14 6a c9 dd 1c 70  |L...o...n,.j...p|
+00000040  7e 05 c4 17 71 76 df 10  ee 8c b1 14 03 03 00 01  |~...qv..........|
+00000050  01 16 03 03 00 40 ff 12  88 36 3c 00 17 d1 b9 41  |.....@...6<....A|
+00000060  7a 12 25 94 4c 90 65 62  d8 09 ab f9 b4 ee c3 de  |z.%.L.eb........|
+00000070  46 2f cb ee 18 76 4f 76  8e dd 89 fc 7a 21 3b 5f  |F/...vOv....z!;_|
+00000080  ff ac 1c 03 aa be 96 82  82 ea 2e 22 2a 80 b3 86  |..........."*...|
+00000090  38 e4 4d 90 91 46                                 |8.M..F|
 >>> Flow 4 (server to client)
 00000000  14 03 03 00 01 01 16 03  03 00 40 00 00 00 00 00  |..........@.....|
-00000010  00 00 00 00 00 00 00 00  00 00 00 a9 71 da 7a 3d  |............q.z=|
-00000020  c1 17 da fa 05 ac ed a6  79 79 31 67 83 de 86 92  |........yy1g....|
-00000030  de 7e 6f 5c dc d7 e8 29  df 51 15 a1 6f 38 84 a5  |.~o\...).Q..o8..|
-00000040  a6 e4 f2 56 8a cc bf ad  f4 b8 0c 17 03 03 00 40  |...V...........@|
+00000010  00 00 00 00 00 00 00 00  00 00 00 e5 c1 f0 6a db  |..............j.|
+00000020  05 98 ed 33 94 73 7f 13  7f 78 17 7f d1 9e c5 a7  |...3.s...x......|
+00000030  62 7f 85 14 2c 7d b2 8e  ef 75 a9 df 92 cc 22 20  |b...,}...u...." |
+00000040  66 08 85 22 d3 ea 5c 4c  4c c8 d7 17 03 03 00 40  |f.."..\LL......@|
 00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000060  b1 a6 a1 eb f4 26 ef e9  25 7d c8 b5 a5 4b dc c8  |.....&..%}...K..|
-00000070  32 58 d6 c3 94 e7 f7 20  10 9e a1 db 10 db e4 42  |2X..... .......B|
-00000080  3c c5 26 e7 70 f2 d7 f0  38 10 a7 63 61 22 1b 57  |<.&.p...8..ca".W|
+00000060  f2 20 07 d2 13 ca ed 01  c9 7b 91 14 01 2c 08 f5  |. .......{...,..|
+00000070  8a 69 94 bc 19 9a d9 65  6b 15 04 b4 45 17 ec 6f  |.i.....ek...E..o|
+00000080  85 de 31 dc a2 de 8b 4d  53 57 66 4a 29 21 5a 20  |..1....MSWfJ)!Z |
 00000090  15 03 03 00 30 00 00 00  00 00 00 00 00 00 00 00  |....0...........|
-000000a0  00 00 00 00 00 29 ea 96  ea 08 88 6c 5d 67 91 f7  |.....).....l]g..|
-000000b0  31 8e b8 3a 9a d5 87 2a  81 2f 80 fb 7f b5 80 03  |1..:...*./......|
-000000c0  9c 8b 7e 39 7b                                    |..~9{|
+000000a0  00 00 00 00 00 55 15 f7  89 8d 75 57 7e 92 db ec  |.....U....uW~...|
+000000b0  32 ec 07 5c 83 32 36 59  61 f1 9d a6 7a eb 76 c1  |2..\.26Ya...z.v.|
+000000c0  c7 96 3f 4d 0a                                    |..?M.|
diff --git a/src/crypto/tls/testdata/Server-TLSv12-RSA-AES-GCM b/src/crypto/tls/testdata/Server-TLSv12-RSA-AES-GCM
index 0ddfe022f2..f499d528f5 100644
--- a/src/crypto/tls/testdata/Server-TLSv12-RSA-AES-GCM
+++ b/src/crypto/tls/testdata/Server-TLSv12-RSA-AES-GCM
@@ -1,15 +1,15 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 9c 01 00 00  98 03 03 53 04 f1 30 73  |...........S..0s|
-00000010  a1 ea 8c d2 90 1c c6 d6  0d 3c af 58 21 65 90 25  |.........<.X!e.%|
-00000020  5e fa f4 27 22 65 c9 68  90 b9 04 00 00 04 c0 2f  |^..'"e.h......./|
-00000030  00 ff 01 00 00 6b 00 0b  00 04 03 00 01 02 00 0a  |.....k..........|
-00000040  00 34 00 32 00 0e 00 0d  00 19 00 0b 00 0c 00 18  |.4.2............|
-00000050  00 09 00 0a 00 16 00 17  00 08 00 06 00 07 00 14  |................|
-00000060  00 15 00 04 00 05 00 12  00 13 00 01 00 02 00 03  |................|
-00000070  00 0f 00 10 00 11 00 0d  00 22 00 20 06 01 06 02  |.........". ....|
-00000080  06 03 05 01 05 02 05 03  04 01 04 02 04 03 03 01  |................|
-00000090  03 02 03 03 02 01 02 02  02 03 01 01 00 0f 00 01  |................|
-000000a0  01                                                |.|
+00000000  16 03 01 00 a1 01 00 00  9d 03 03 9a bc 85 2d 9c  |..............-.|
+00000010  c3 b2 9a c4 2e 4d 2a 49  04 5f 0e 39 9a bd 17 d9  |.....M*I._.9....|
+00000020  1f 5e 07 82 2e 86 03 79  e5 b0 35 00 00 04 c0 2f  |.^.....y..5..../|
+00000030  00 ff 02 01 00 00 6f 00  0b 00 04 03 00 01 02 00  |......o.........|
+00000040  0a 00 3a 00 38 00 0e 00  0d 00 19 00 1c 00 0b 00  |..:.8...........|
+00000050  0c 00 1b 00 18 00 09 00  0a 00 1a 00 16 00 17 00  |................|
+00000060  08 00 06 00 07 00 14 00  15 00 04 00 05 00 12 00  |................|
+00000070  13 00 01 00 02 00 03 00  0f 00 10 00 11 00 0d 00  |................|
+00000080  20 00 1e 06 01 06 02 06  03 05 01 05 02 05 03 04  | ...............|
+00000090  01 04 02 04 03 03 01 03  02 03 03 02 01 02 02 02  |................|
+000000a0  03 00 0f 00 01 01                                 |......|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 31 02 00 00  2d 03 03 00 00 00 00 00  |....1...-.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
@@ -63,31 +63,31 @@
 00000310  75 71 b5 e5 54 5b 12 2e  8f 09 67 fd a7 24 20 3e  |uq..T[....g..$ >|
 00000320  b2 56 1c ce 97 28 5e f8  2b 2d 4f 9e f1 07 9f 6c  |.V...(^.+-O....l|
 00000330  4b 5b 83 56 e2 32 42 e9  58 b6 d7 49 a6 b5 68 1a  |K[.V.2B.X..I..h.|
-00000340  41 03 56 6b dc 5a 89 04  01 00 80 a2 54 61 84 29  |A.Vk.Z......Ta.)|
-00000350  3e 97 4b 97 9a 9f 5c c0  49 6d 86 d2 79 8e 95 a1  |>.K...\.Im..y...|
-00000360  0a 5a 36 73 34 bb 05 73  35 47 e1 2b 5d f3 ef 36  |.Z6s4..s5G.+]..6|
-00000370  a8 32 e2 7e ef aa 3f 1f  b3 64 60 d4 06 2e 98 e3  |.2.~..?..d`.....|
-00000380  11 e2 60 3c d6 20 17 63  b2 6f a0 cd 21 01 2b 4e  |..`<. .c.o..!.+N|
-00000390  b2 a8 55 04 39 37 5c 6c  71 66 4d a3 eb 1b 83 67  |..U.97\lqfM....g|
-000003a0  6b 15 a0 56 9a f1 a2 79  92 29 ce 58 3c 10 4d 65  |k..V...y.).X<.Me|
-000003b0  1f 22 e3 ea d8 74 aa 01  7e ca f3 89 23 41 4d bd  |."...t..~...#AM.|
-000003c0  df 77 4e 59 54 97 74 ad  07 ea c0 16 03 03 00 04  |.wNYT.t.........|
+00000340  41 03 56 6b dc 5a 89 05  01 00 80 ba cb 00 ec a3  |A.Vk.Z..........|
+00000350  0f 9b 9b 0a f8 5c 6f 46  b4 93 a9 de 47 35 43 62  |.....\oF....G5Cb|
+00000360  06 d5 19 36 25 80 7c 81  3a df 01 6e f1 8f 50 4f  |...6%.|.:..n..PO|
+00000370  23 ee 1e 13 47 c6 9b 1c  3d 5f e3 8b 60 c3 f1 c4  |#...G...=_..`...|
+00000380  4b 36 4c 3c 71 bb 5c 0d  17 38 3a da 8c 3b c7 48  |K6L<q.\..8:..;.H|
+00000390  a4 c2 fa c5 3c ff 5d cc  76 41 dc 21 b9 6e ba 12  |....<.].vA.!.n..|
+000003a0  d2 21 21 f1 7e 9b f3 10  dd 57 de 50 a8 3f ab da  |.!!.~....W.P.?..|
+000003b0  53 14 97 25 d1 36 f0 9d  42 e9 9f 87 12 8c e5 19  |S..%.6..B.......|
+000003c0  f9 f4 96 3a 70 37 c9 4a  7f ce af 16 03 03 00 04  |...:p7.J........|
 000003d0  0e 00 00 00                                       |....|
 >>> Flow 3 (client to server)
-00000000  16 03 03 00 46 10 00 00  42 41 04 45 65 ce f7 b9  |....F...BA.Ee...|
-00000010  52 e3 fb 13 db 91 f2 65  43 84 57 f5 1a 19 a0 e6  |R......eC.W.....|
-00000020  89 2d bb 2c 83 6b 62 f6  6f 1f 26 ae 59 67 bd dc  |.-.,.kb.o.&.Yg..|
-00000030  c4 9e 0b dc 7d 6e f8 6b  95 8c 61 47 3d cd d1 df  |....}n.k..aG=...|
-00000040  82 45 30 81 c3 a3 49 5d  85 59 70 14 03 03 00 01  |.E0...I].Yp.....|
-00000050  01 16 03 03 00 28 3f aa  85 33 f9 c6 95 a0 56 ff  |.....(?..3....V.|
-00000060  1c f1 5a ba 6e 41 50 0c  ab 92 e1 e2 8e 89 1c f1  |..Z.nAP.........|
-00000070  fa 54 1b f1 f5 00 01 12  6d c4 96 78 b6 87        |.T......m..x..|
+00000000  16 03 03 00 46 10 00 00  42 41 04 e3 f4 0a 79 25  |....F...BA....y%|
+00000010  6a a9 07 ae 8f 18 74 f3  0b e9 b1 0f da 35 58 4b  |j.....t......5XK|
+00000020  91 ca d7 58 46 39 51 a2  ef 9a c0 ec e6 b2 e5 27  |...XF9Q........'|
+00000030  97 7e 45 fd b8 1f 72 8d  ee 9b 58 82 45 2f e5 f4  |.~E...r...X.E/..|
+00000040  dd d5 cb ad f8 ac 4d 53  39 92 b9 14 03 03 00 01  |......MS9.......|
+00000050  01 16 03 03 00 28 b8 f7  4e 1a 2f d7 5b c9 6c ab  |.....(..N./.[.l.|
+00000060  bc 90 ce d0 dd 58 68 ff  43 00 55 23 25 e1 4b 33  |.....Xh.C.U#%.K3|
+00000070  d4 60 96 88 df f2 23 dd  b0 a9 f1 5b 91 73        |.`....#....[.s|
 >>> Flow 4 (server to client)
 00000000  14 03 03 00 01 01 16 03  03 00 28 00 00 00 00 00  |..........(.....|
-00000010  00 00 00 94 5c be 46 05  d6 d0 b0 3a 56 dc 2c 10  |....\.F....:V.,.|
-00000020  0f 6f 5d 33 33 7f a5 4e  74 84 bf 63 87 c4 f4 49  |.o]33..Nt..c...I|
-00000030  bc 6b ab 17 03 03 00 25  00 00 00 00 00 00 00 01  |.k.....%........|
-00000040  7e 4f f9 ae ae fe 6b a0  4a f8 0f 0b b4 b6 65 b6  |~O....k.J.....e.|
-00000050  be 24 5f 94 6d d1 db 54  11 07 b9 ce 01 15 03 03  |.$_.m..T........|
-00000060  00 1a 00 00 00 00 00 00  00 02 a8 1c d6 62 ac fd  |.............b..|
-00000070  77 ba 23 92 5d 34 f1 17  c7 e1 1c 99              |w.#.]4......|
+00000010  00 00 00 2c 58 45 b5 85  96 2b 55 45 3c ff 4e 46  |...,XE...+UE<.NF|
+00000020  75 96 8e c2 44 24 24 3c  bc 24 e7 fb a4 b1 5b b3  |u...D$$<.$....[.|
+00000030  b6 9a e6 17 03 03 00 25  00 00 00 00 00 00 00 01  |.......%........|
+00000040  89 60 e2 59 3a ab 37 21  89 95 ef c6 1d fb 55 4d  |.`.Y:.7!......UM|
+00000050  9b ba b5 55 2b 11 81 5c  d3 56 26 84 be 15 03 03  |...U+..\.V&.....|
+00000060  00 1a 00 00 00 00 00 00  00 02 66 4c a5 50 b7 7b  |..........fL.P.{|
+00000070  20 60 08 0f 80 33 84 b2  f4 e4 81 d4              | `...3......|
diff --git a/src/crypto/tls/testdata/Server-TLSv12-RSA-AES256-GCM-SHA384 b/src/crypto/tls/testdata/Server-TLSv12-RSA-AES256-GCM-SHA384
index 1c979c3fc0..a8aaf5f5d9 100644
--- a/src/crypto/tls/testdata/Server-TLSv12-RSA-AES256-GCM-SHA384
+++ b/src/crypto/tls/testdata/Server-TLSv12-RSA-AES256-GCM-SHA384
@@ -1,14 +1,15 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 9a 01 00 00  96 03 03 37 7c 30 6d df  |...........7|0m.|
-00000010  4d 94 90 04 59 df ec 01  11 77 29 b6 4f 95 50 ef  |M...Y....w).O.P.|
-00000020  ca d0 0f f4 a6 35 98 3b  ee 16 72 00 00 04 c0 30  |.....5.;..r....0|
-00000030  00 ff 01 00 00 69 00 0b  00 04 03 00 01 02 00 0a  |.....i..........|
-00000040  00 34 00 32 00 0e 00 0d  00 19 00 0b 00 0c 00 18  |.4.2............|
-00000050  00 09 00 0a 00 16 00 17  00 08 00 06 00 07 00 14  |................|
-00000060  00 15 00 04 00 05 00 12  00 13 00 01 00 02 00 03  |................|
-00000070  00 0f 00 10 00 11 00 0d  00 20 00 1e 06 01 06 02  |......... ......|
-00000080  06 03 05 01 05 02 05 03  04 01 04 02 04 03 03 01  |................|
-00000090  03 02 03 03 02 01 02 02  02 03 00 0f 00 01 01     |...............|
+00000000  16 03 01 00 a1 01 00 00  9d 03 03 77 d9 ce 2c 4d  |...........w..,M|
+00000010  da 71 bb b0 04 5f e1 29  ea 23 9f 21 2d cb 0b 75  |.q..._.).#.!-..u|
+00000020  be 29 65 df 8b a1 50 3f  14 a8 c0 00 00 04 c0 30  |.)e...P?.......0|
+00000030  00 ff 02 01 00 00 6f 00  0b 00 04 03 00 01 02 00  |......o.........|
+00000040  0a 00 3a 00 38 00 0e 00  0d 00 19 00 1c 00 0b 00  |..:.8...........|
+00000050  0c 00 1b 00 18 00 09 00  0a 00 1a 00 16 00 17 00  |................|
+00000060  08 00 06 00 07 00 14 00  15 00 04 00 05 00 12 00  |................|
+00000070  13 00 01 00 02 00 03 00  0f 00 10 00 11 00 0d 00  |................|
+00000080  20 00 1e 06 01 06 02 06  03 05 01 05 02 05 03 04  | ...............|
+00000090  01 04 02 04 03 03 01 03  02 03 03 02 01 02 02 02  |................|
+000000a0  03 00 0f 00 01 01                                 |......|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 31 02 00 00  2d 03 03 00 00 00 00 00  |....1...-.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
@@ -62,31 +63,31 @@
 00000310  75 71 b5 e5 54 5b 12 2e  8f 09 67 fd a7 24 20 3e  |uq..T[....g..$ >|
 00000320  b2 56 1c ce 97 28 5e f8  2b 2d 4f 9e f1 07 9f 6c  |.V...(^.+-O....l|
 00000330  4b 5b 83 56 e2 32 42 e9  58 b6 d7 49 a6 b5 68 1a  |K[.V.2B.X..I..h.|
-00000340  41 03 56 6b dc 5a 89 04  01 00 80 4f 66 0e d5 7f  |A.Vk.Z.....Of...|
-00000350  a8 99 4d dc 5b a7 b0 32  67 b2 8a 2e ca 90 58 f0  |..M.[..2g.....X.|
-00000360  8d f1 fd 74 c1 3c 84 28  9d 25 7e 0a 61 f8 90 2d  |...t.<.(.%~.a..-|
-00000370  99 f3 90 c9 26 ab a7 d2  38 87 e1 2b 12 6e 93 17  |....&...8..+.n..|
-00000380  3c 2f 11 8c d8 67 73 11  68 b9 d0 a7 ad 44 83 72  |</...gs.h....D.r|
-00000390  fc e4 6b ce 7f 02 7e 33  89 4b f3 dc 30 42 c0 4b  |..k...~3.K..0B.K|
-000003a0  2b 29 eb e6 1c 43 bb a7  27 b9 3e f4 76 ec 69 4d  |+)...C..'.>.v.iM|
-000003b0  df 49 d4 f6 b4 ac f6 0b  1d d1 68 61 30 b1 52 07  |.I........ha0.R.|
-000003c0  a5 6d 31 5e 13 24 8c 32  cd 76 57 16 03 03 00 04  |.m1^.$.2.vW.....|
+00000340  41 03 56 6b dc 5a 89 05  01 00 80 3f a6 7f 45 a0  |A.Vk.Z.....?..E.|
+00000350  a7 43 d0 8a 4b 50 39 77  c3 61 eb 88 73 02 de 5c  |.C..KP9w.a..s..\|
+00000360  4d 57 45 80 c1 ee 31 be  bc ca 70 48 a1 a5 6c 40  |MWE...1...pH..l@|
+00000370  de 54 4f dd e2 2d d8 7a  4c 68 f0 fe 28 28 ec 45  |.TO..-.zLh..((.E|
+00000380  45 79 c6 f6 68 9d 5f b8  eb 76 0b 53 72 76 6f a7  |Ey..h._..v.Srvo.|
+00000390  00 9b 18 ba 85 ad f3 10  3d cf 08 9c 63 b2 84 4f  |........=...c..O|
+000003a0  57 b6 b6 d8 3e ec c3 76  22 9e cf 31 d5 4c 68 f1  |W...>..v"..1.Lh.|
+000003b0  f3 a5 61 8a df b1 78 0f  14 9d 57 ef a8 d6 3b f5  |..a...x...W...;.|
+000003c0  a4 77 dd aa 5f e3 8b 2b  cf d2 64 16 03 03 00 04  |.w.._..+..d.....|
 000003d0  0e 00 00 00                                       |....|
 >>> Flow 3 (client to server)
-00000000  16 03 03 00 46 10 00 00  42 41 04 08 73 d7 79 87  |....F...BA..s.y.|
-00000010  39 45 dd 69 33 71 a0 48  a0 8b 6e 2f 99 dc a1 4f  |9E.i3q.H..n/...O|
-00000020  21 ca 70 b3 98 fe cc 5a  94 04 1b 8d 4d a4 46 24  |!.p....Z....M.F$|
-00000030  c6 61 bd e1 49 92 83 8d  ea 22 fb b1 43 90 24 7e  |.a..I...."..C.$~|
-00000040  d0 e5 4b cb c3 8a 41 f7  fd d1 9f 14 03 03 00 01  |..K...A.........|
-00000050  01 16 03 03 00 28 e3 99  f0 d3 65 4e 29 dd d6 eb  |.....(....eN)...|
-00000060  c0 b3 f9 e2 8b bb 68 61  b2 7f 63 db de fb ae d2  |......ha..c.....|
-00000070  94 b7 45 9b 34 cb a4 26  3f 04 92 34 02 89        |..E.4..&?..4..|
+00000000  16 03 03 00 46 10 00 00  42 41 04 eb 6a bc 30 f6  |....F...BA..j.0.|
+00000010  ef 35 bb 4d 35 31 34 93  27 59 d9 6a fc e4 6c ac  |.5.M514.'Y.j..l.|
+00000020  fe 23 c9 b4 88 66 98 15  a3 84 dc 53 95 ea bb 43  |.#...f.....S...C|
+00000030  16 dc 03 5e 4a 83 d2 47  32 a0 2d ad 56 40 bd 24  |...^J..G2.-.V@.$|
+00000040  ad 47 af fa f3 d7 50 d3  b5 02 67 14 03 03 00 01  |.G....P...g.....|
+00000050  01 16 03 03 00 28 8c 86  3b 84 aa 50 d3 e6 bf c9  |.....(..;..P....|
+00000060  c6 03 4b c5 07 ac 12 96  88 95 64 92 0d 0c d9 8f  |..K.......d.....|
+00000070  11 2f e2 9e 32 e8 2b 4e  a7 1a 88 0a a5 f6        |./..2.+N......|
 >>> Flow 4 (server to client)
 00000000  14 03 03 00 01 01 16 03  03 00 28 00 00 00 00 00  |..........(.....|
-00000010  00 00 00 5e 63 30 5d 4d  2b 87 3f 7b 9c 06 2e 44  |...^c0]M+.?{...D|
-00000020  92 c5 d0 e8 07 fa 9f db  a7 2c dc ec 16 78 bd 37  |.........,...x.7|
-00000030  8a f7 24 17 03 03 00 25  00 00 00 00 00 00 00 01  |..$....%........|
-00000040  0b af 29 75 f0 67 6b 78  8c 3a 65 44 53 25 9e d5  |..)u.gkx.:eDS%..|
-00000050  8e 7e 24 5f c9 95 a1 3e  63 d2 52 09 32 15 03 03  |.~$_...>c.R.2...|
-00000060  00 1a 00 00 00 00 00 00  00 02 0b f2 f7 93 57 b3  |..............W.|
-00000070  5b 19 fd e7 a1 0f e9 41  ca f5 74 17              |[......A..t.|
+00000010  00 00 00 ac 6a 42 ae b7  31 ba 00 dd 82 2f 54 ad  |....jB..1..../T.|
+00000020  85 f6 77 2a 3c 68 24 e6  f5 4b 0e 80 4f 4c 60 04  |..w*<h$..K..OL`.|
+00000030  ac c3 a7 17 03 03 00 25  00 00 00 00 00 00 00 01  |.......%........|
+00000040  00 9a 15 f2 55 01 5f 18  c2 da 14 e8 50 a7 4f 4f  |....U._.....P.OO|
+00000050  4a d4 e2 21 86 4d 25 d9  11 4a 6d d2 1c 15 03 03  |J..!.M%..Jm.....|
+00000060  00 1a 00 00 00 00 00 00  00 02 a6 d4 e9 f9 cd 9a  |................|
+00000070  07 4f 7c 50 ef 6a dd 10  35 8c 43 e9              |.O|P.j..5.C.|
