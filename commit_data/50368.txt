commit a91e976fd2cc6f1c156877eae40262d7e47c745c
Author: Michael Anthony Knyszek <mknyszek@google.com>
Date:   Mon Oct 18 23:12:16 2021 +0000

    runtime: retype mheap.reclaimIndex as atomic.Uint64
    
    [git-generate]
    cd src/runtime
    mv export_test.go export.go
    GOROOT=$(dirname $(dirname $PWD)) rf '
      add mheap.reclaimIndex \
    // reclaimIndex is the page index in allArenas of next page to \
    // reclaim. Specifically, it refers to page (i % \
    // pagesPerArena) of arena allArenas[i / pagesPerArena]. \
    // \
    // If this is >= 1<<63, the page reclaimer is done scanning \
    // the page marks. \
    reclaimIndex_ atomic.Uint64
      ex {
        import "runtime/internal/atomic"
    
        var t mheap
        var v, w uint64
        var d int64
    
        t.reclaimIndex -> t.reclaimIndex_.Load()
        t.reclaimIndex = v -> t.reclaimIndex_.Store(v)
        atomic.Load64(&t.reclaimIndex) -> t.reclaimIndex_.Load()
        atomic.LoadAcq64(&t.reclaimIndex) -> t.reclaimIndex_.LoadAcquire()
        atomic.Store64(&t.reclaimIndex, v) -> t.reclaimIndex_.Store(v)
        atomic.StoreRel64(&t.reclaimIndex, v) -> t.reclaimIndex_.StoreRelease(v)
        atomic.Cas64(&t.reclaimIndex, v, w) -> t.reclaimIndex_.CompareAndSwap(v, w)
        atomic.Xchg64(&t.reclaimIndex, v) -> t.reclaimIndex_.Swap(v)
        atomic.Xadd64(&t.reclaimIndex, d) -> t.reclaimIndex_.Add(d)
      }
      rm mheap.reclaimIndex
      mv mheap.reclaimIndex_ mheap.reclaimIndex
    '
    mv export.go export_test.go
    
    Change-Id: I1d619e3ac032285b5f7eb6c563a5188c8e36d089
    Reviewed-on: https://go-review.googlesource.com/c/go/+/356711
    Reviewed-by: Austin Clements <austin@google.com>
    Trust: Michael Knyszek <mknyszek@google.com>

 src/runtime/mgc.go   |  2 +-
 src/runtime/mheap.go | 10 ++++------
 2 files changed, 5 insertions(+), 7 deletions(-)
