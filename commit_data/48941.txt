commit 4bb0847b088eb3eb6122a18a87e1ca7756281dcc
Author: Matthew Dempsky <mdempsky@google.com>
Date:   Fri Jun 25 11:07:28 2021 -0700

    cmd/compile,runtime: change unsafe.Slice((*T)(nil), 0) to return []T(nil)
    
    This CL removes the unconditional OCHECKNIL check added in
    walkUnsafeSlice by instead passing it as a pointer to
    runtime.unsafeslice, and hiding the check behind a `len == 0` check.
    
    While here, this CL also implements checkptr functionality for
    unsafe.Slice and disallows use of unsafe.Slice with //go:notinheap
    types.
    
    Updates #46742.
    
    Change-Id: I743a445ac124304a4d7322a7fe089c4a21b9a655
    Reviewed-on: https://go-review.googlesource.com/c/go/+/331070
    Run-TryBot: Matthew Dempsky <mdempsky@google.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Trust: Matthew Dempsky <mdempsky@google.com>
    Reviewed-by: Keith Randall <khr@golang.org>

 src/cmd/compile/internal/typecheck/builtin.go      |  5 +++--
 .../compile/internal/typecheck/builtin/runtime.go  |  5 +++--
 src/cmd/compile/internal/typecheck/func.go         |  7 ++++++
 src/cmd/compile/internal/walk/builtin.go           | 26 ++++++++--------------
 src/runtime/checkptr.go                            | 21 ++++++++++++++++-
 src/runtime/checkptr_test.go                       |  2 ++
 src/runtime/slice.go                               | 24 +++++++++++++++++---
 src/runtime/testdata/testprog/checkptr.go          | 13 +++++++++++
 test/unsafebuiltins.go                             |  7 ++++--
 9 files changed, 83 insertions(+), 27 deletions(-)
