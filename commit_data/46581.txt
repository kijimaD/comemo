commit 9a19481acb93114948503d935e10f6985ff15843
Author: David Chase <drchase@google.com>
Date:   Wed Dec 30 12:05:57 2020 -0500

    [dev.regabi] cmd/compile: make ordering for InvertFlags more stable
    
    Current many architectures use a rule along the lines of
    
    // Canonicalize the order of arguments to comparisons - helps with CSE.
    ((CMP|CMPW) x y) && x.ID > y.ID => (InvertFlags ((CMP|CMPW) y x))
    
    to normalize comparisons as much as possible for CSE.  Replace the
    ID comparison with something less variable across compiler changes.
    This helps avoid spurious failures in some of the codegen-comparison
    tests (though the current choice of comparison is sensitive to Op
    ordering).
    
    Two tests changed to accommodate modified instruction choice.
    
    Change-Id: Ib35f450bd2bae9d4f9f7838ceaf7ec682bcf1e1a
    Reviewed-on: https://go-review.googlesource.com/c/go/+/280155
    Trust: David Chase <drchase@google.com>
    Run-TryBot: David Chase <drchase@google.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Cherry Zhang <cherryyz@google.com>

 src/cmd/compile/internal/ssa/gen/386.rules   |  2 +-
 src/cmd/compile/internal/ssa/gen/AMD64.rules |  2 +-
 src/cmd/compile/internal/ssa/gen/ARM.rules   |  2 +-
 src/cmd/compile/internal/ssa/gen/ARM64.rules |  2 +-
 src/cmd/compile/internal/ssa/gen/PPC64.rules |  2 +-
 src/cmd/compile/internal/ssa/gen/S390X.rules |  2 +-
 src/cmd/compile/internal/ssa/rewrite.go      | 12 ++++++++++++
 src/cmd/compile/internal/ssa/rewrite386.go   | 12 ++++++------
 src/cmd/compile/internal/ssa/rewriteAMD64.go | 16 ++++++++--------
 src/cmd/compile/internal/ssa/rewriteARM.go   |  4 ++--
 src/cmd/compile/internal/ssa/rewriteARM64.go |  8 ++++----
 src/cmd/compile/internal/ssa/rewritePPC64.go | 16 ++++++++--------
 src/cmd/compile/internal/ssa/rewriteS390X.go | 16 ++++++++--------
 test/codegen/condmove.go                     |  6 +++---
 test/codegen/spectre.go                      |  4 ++--
 15 files changed, 59 insertions(+), 47 deletions(-)
