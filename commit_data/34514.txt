commit 96cdacb9717271126eb60de3d8410c9cecd67b28
Author: Michael Munday <mike.munday@ibm.com>
Date:   Fri Oct 27 09:45:45 2017 -0400

    cmd/asm, cmd/compile: optimize math.Abs and math.Copysign on s390x
    
    This change adds three new instructions:
    
    - LPDFR: load positive (math.Abs(x))
    - LNDFR: load negative (-math.Abs(x))
    - CPSDR: copy sign (math.Copysign(x, y))
    
    By making use of GPR <-> FPR moves we can now compile math.Abs and
    math.Copysign to these instructions using SSA rules.
    
    This CL also adds new rules to merge address generation into combined
    load operations. This makes GPR <-> FPR move matching more reliable.
    
    name                 old time/op  new time/op  delta
    Copysign             1.85ns ± 0%  1.40ns ± 1%  -24.65%  (p=0.000 n=8+10)
    Abs                  1.58ns ± 1%  0.73ns ± 1%  -53.64%  (p=0.000 n=10+10)
    
    The geo mean improvement for all math package benchmarks was 4.6%.
    
    Change-Id: I0cec35c5c1b3fb45243bf666b56b57faca981bc9
    Reviewed-on: https://go-review.googlesource.com/73950
    Run-TryBot: Michael Munday <mike.munday@ibm.com>
    Reviewed-by: Keith Randall <khr@golang.org>

 src/cmd/asm/internal/asm/testdata/s390x.s    |    3 +
 src/cmd/compile/internal/gc/asm_test.go      |   64 +
 src/cmd/compile/internal/s390x/ssa.go        |    7 +-
 src/cmd/compile/internal/ssa/gen/S390X.rules |   81 +-
 src/cmd/compile/internal/ssa/gen/S390XOps.go |    5 +
 src/cmd/compile/internal/ssa/opGen.go        |   71 +
 src/cmd/compile/internal/ssa/rewriteS390X.go | 1922 ++++++++++++++++++++++++--
 src/cmd/internal/obj/s390x/a.out.go          |    3 +
 src/cmd/internal/obj/s390x/anames.go         |    3 +
 src/cmd/internal/obj/s390x/asmz.go           |   10 +
 10 files changed, 2035 insertions(+), 134 deletions(-)
