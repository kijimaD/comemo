commit 3df078fc74a550168440d5afd5f9a9204b77f0f9
Author: Michael Anthony Knyszek <mknyszek@google.com>
Date:   Mon Dec 9 19:07:40 2024 +0000

    runtime: add new GODEBUG checkfinalizer
    
    This new debug mode detects cleanup/finalizer leaks using checkmark
    mode. It runs a partial GC using only specials as roots. If the GC can
    find a path from one of these roots back to the object the special is
    attached to, then the object might never be reclaimed. (The cycle could
    be broken in the future, but it's almost certainly a bug.)
    
    This debug mode is very barebones. It contains no type information and
    no stack location for where the finalizer or cleanup was created.
    
    For #72949.
    
    Change-Id: Ibffd64c1380b51f281950e4cfe61f677385d42a5
    Reviewed-on: https://go-review.googlesource.com/c/go/+/634599
    Reviewed-by: Carlos Amedee <carlos@golang.org>
    Reviewed-by: Michael Pratt <mpratt@google.com>
    LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
    Auto-Submit: Michael Knyszek <mknyszek@google.com>

 src/runtime/gc_test.go                           |  14 +++
 src/runtime/mcheckmark.go                        | 141 +++++++++++++++++++++--
 src/runtime/mgc.go                               |  30 ++---
 src/runtime/mgcmark.go                           |  50 ++++----
 src/runtime/mheap.go                             |   2 +-
 src/runtime/runtime1.go                          |   2 +
 src/runtime/testdata/testprog/checkfinalizers.go |  50 ++++++++
 7 files changed, 237 insertions(+), 52 deletions(-)
