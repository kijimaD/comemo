commit 147a21456e2b2255d1c7e487cb9f53386791c357
Author: Mikio Hara <mikioh.mikioh@gmail.com>
Date:   Thu May 15 06:39:15 2014 +0900

    test: fix flakey test case for issue 4388
    
    Seems like we need to drag the stack for <autogenerated>:1 on Plan 9.
    
    See http://build.golang.org/log/283b996102b833dd81c58301d78aceaa4fe9838b.
    
    LGTM=rsc
    R=rsc
    CC=golang-codereviews
    https://golang.org/cl/95390043
---
 test/fixedbugs/issue4388.go | 12 +++++++++---
 1 file changed, 9 insertions(+), 3 deletions(-)

diff --git a/test/fixedbugs/issue4388.go b/test/fixedbugs/issue4388.go
index c8c53b7103..2e052e138d 100644
--- a/test/fixedbugs/issue4388.go
+++ b/test/fixedbugs/issue4388.go
@@ -43,8 +43,14 @@ func checkLine(n int) {
 	if err := recover(); err == nil {
 		panic("did not panic")
 	}
-	_, file, line, _ := runtime.Caller(n)
-	if file != "<autogenerated>" || line != 1 {
-		panic(fmt.Sprintf("expected <autogenerated>:1 have %s:%d", file, line))
+	var file string
+	var line int
+	for i := 1; i <= n; i++ {
+		_, file, line, _ = runtime.Caller(i)
+		if file != "<autogenerated>" || line != 1 {
+			continue
+		}
+		return
 	}
+	panic(fmt.Sprintf("expected <autogenerated>:1 have %s:%d", file, line))
 }
