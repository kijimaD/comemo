commit 48d899dcdbed4534ed942f7ec2917cf86b18af22
Author: Andy Pan <panjf2000@gmail.com>
Date:   Sun Feb 4 14:50:42 2024 +0800

    net/http: reject requests with invalid Content-Length headers
    
    According to RFC 9110 and RFC 9112, invalid "Content-Length" headers
    might involve request smuggling or response splitting, which could
    also cause security failures. Currently, `net/http` ignores all
    "Content-Length" headers when there is a "Transfer-Encoding" header and
    forward the message anyway while other mainstream HTTP implementations
    such as Apache Tomcat, Nginx, HAProxy, Node.js, Deno, Tornado, etc. reject
    invalid Content-Length headers regardless of the presence of a
    "Transfer-Encoding" header and only forward chunked-encoding messages
    with either valid "Content-Length" headers or no "Content-Length" headers.
    
    Fixes #65505
    
    Change-Id: I73af2ee0785137e56c7546a4cce4a5c5c348dbc5
    Reviewed-on: https://go-review.googlesource.com/c/go/+/561075
    LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
    Reviewed-by: Bryan Mills <bcmills@google.com>
    Reviewed-by: Damien Neil <dneil@google.com>

 src/net/http/readrequest_test.go | 16 +++++++++++++++
 src/net/http/serve_test.go       |  6 ++++++
 src/net/http/transfer.go         | 42 ++++++++++++++++++++++------------------
 3 files changed, 45 insertions(+), 19 deletions(-)
