commit a371fa5e7042ee5d07b18045aefa8e9c4bfd4efa
Author: Than McIntosh <thanm@google.com>
Date:   Tue Dec 27 14:34:11 2022 -0500

    cmd/covdata: relax mode clash policy for selected operations
    
    Relax the policy on counter mode clashes in certain cases for "go tool
    covdata" operations. Specifically, when generating 'percent',
    'pkglist' or 'func' reports, we only care about whether a given
    statement is executed, thus counter mode clashes are irrelevant; there
    is no need to report clashes for these ops.
    
    Example:
    
      $ go build -covermode=count -o myprog.count.exe myprog
      $ go build -covermode=set -o myprog.set.exe myprog
      $ GOCOVERDIR=dir1 ./myprog.count.exe
      ...
      $ GOCOVERDIR=dir2 ./myprog.set.exe
      ...
      $ go tool covdata percent i=dir1,dir2
      error: counter mode clash while reading meta-data file dir2/covmeta.1a0cd0c8ccab07d3179f0ac3dd98159a: previous file had count, new file has set
      $
    
    With this patch the command above will "do the right thing" and work
    properly, and in addition merges using the "-pcombine" flag will also
    operate with relaxed rules. Note that textfmt operations still require
    inputs with consistent coverage modes.
    
    Change-Id: I01e97530d9780943c99b399d03d4cfff05aafd8c
    Reviewed-on: https://go-review.googlesource.com/c/go/+/495440
    TryBot-Result: Gopher Robot <gobot@golang.org>
    Reviewed-by: David Chase <drchase@google.com>
    Run-TryBot: Than McIntosh <thanm@google.com>

 src/cmd/covdata/dump.go                    |  8 ++++++
 src/cmd/covdata/merge.go                   |  2 ++
 src/cmd/covdata/tool_test.go               | 20 ++++++++++++---
 src/internal/coverage/cmerge/merge.go      | 41 +++++++++++++++++++++++-------
 src/internal/coverage/cmerge/merge_test.go | 19 +++++++++++---
 5 files changed, 75 insertions(+), 15 deletions(-)
