commit c3495058786a3c05699f0d4a39ecc7df39e58897
Author: LE Manh Cuong <cuong.manhle.vn@gmail.com>
Date:   Sun Apr 7 13:56:58 2019 +0700

    os: fix RemoveAll hangs on large directory
    
    golang.org/cl/121255 added close and re-open the directory when looping, prevent
    us from missing some if previous iteration deleted files.
    
    The CL introdued a bug. If we can not delete all entries in one request,
    the looping never exits, causing RemoveAll hangs.
    
    To fix that, simply discard the entries if we can not delete all of them
    in one iteration, then continue reading entries and delete them.
    
    Also make sure removeall_at return first error it encounters.
    
    Fixes #29921
    
    Change-Id: I8ec3a4c822d8d2d95d9f1ab71547879da395bc4a
    Reviewed-on: https://go-review.googlesource.com/c/go/+/171099
    Run-TryBot: Ian Lance Taylor <iant@golang.org>
    TryBot-Result: Gobot Gobot <gobot@golang.org>
    Reviewed-by: Ian Lance Taylor <iant@golang.org>

 src/os/export_test.go    |  1 +
 src/os/path.go           |  3 +++
 src/os/removeall_at.go   | 48 ++++++++++++++++++++++++++++++++----------------
 src/os/removeall_noat.go | 40 ++++++++++++++++++++++++++++------------
 src/os/removeall_test.go | 46 ++++++++++++++++++++++++++++++++++++++++++++++
 5 files changed, 110 insertions(+), 28 deletions(-)
