commit 5a4f0b6f1e6d3c022ee30884590526ab7d3f580b
Author: hopehook <hopehook.com@gmail.com>
Date:   Tue Apr 12 17:46:36 2022 +0800

    runtime: don't discard value from panic while panicking
    
    In issue #17671, there are a endless loop if printing
    the panic value panics, CL 30358 has fixed that.
    
    As issue #52257 pointed out, above change should not
    discard the value from panic while panicking.
    
    With this CL, when we recover from a panic in error.Error()
    or stringer.String(), and the recovered value is string,
    then we can print it normally.
    
    Fixes #52257
    
    Change-Id: Icfcc4a1a390635de405eea04904b4607ae9e3055
    Reviewed-on: https://go-review.googlesource.com/c/go/+/399874
    Run-TryBot: Ian Lance Taylor <iant@golang.org>
    TryBot-Result: Gopher Robot <gobot@golang.org>
    Reviewed-by: Ian Lance Taylor <iant@google.com>
    Auto-Submit: Ian Lance Taylor <iant@google.com>
    Reviewed-by: Dmitri Shuralyov <dmitshur@golang.org>
    Reviewed-by: Dmitri Shuralyov <dmitshur@google.com>

 src/runtime/crash_test.go              | 44 ++++++++++++++++++++
 src/runtime/panic.go                   | 10 ++++-
 src/runtime/testdata/testprog/crash.go | 73 ++++++++++++++++++++++++++++++++++
 3 files changed, 125 insertions(+), 2 deletions(-)
