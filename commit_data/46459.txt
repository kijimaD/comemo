commit 68e6fa4f6852b4ef0fe61789618c093f4e2185c9
Author: Matthew Dempsky <mdempsky@google.com>
Date:   Thu Dec 31 23:45:36 2020 -0800

    [dev.regabi] cmd/compile: fix package-initialization order
    
    This CL fixes package initialization order by creating the init task
    before the general deadcode-removal pass.
    
    It also changes noder to emit zero-initialization assignments (i.e.,
    OAS with nil RHS) for package-block variables, so that initOrder can
    tell the variables still need initialization. To allow this, we need
    to also extend the static-init code to recognize zero-initialization
    assignments.
    
    This doesn't pass toolstash -cmp, because it reorders some package
    initialization routines.
    
    Fixes #43444.
    
    Change-Id: I0da7996a62c85e15e97ce965298127e075390a7e
    Reviewed-on: https://go-review.googlesource.com/c/go/+/280976
    Trust: Matthew Dempsky <mdempsky@google.com>
    Run-TryBot: Matthew Dempsky <mdempsky@google.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Cuong Manh Le <cuong.manhle.vn@gmail.com>

 src/cmd/compile/internal/gc/main.go          | 10 +++---
 src/cmd/compile/internal/noder/noder.go      | 52 ++++++++++------------------
 src/cmd/compile/internal/pkginit/init.go     |  4 +++
 src/cmd/compile/internal/staticinit/sched.go | 16 +++++++--
 test/fixedbugs/issue43444.go                 | 28 +++++++++++++++
 test/fixedbugs/issue43444.out                |  1 +
 6 files changed, 70 insertions(+), 41 deletions(-)
