commit e6c973198d9f8e68e4dce8637e2d1492032ce939
Author: Matthew Dempsky <mdempsky@google.com>
Date:   Sat Dec 26 18:56:36 2020 -0800

    [dev.regabi] cmd/compile: stop mangling SelectorExpr.Sel for ODOTMETH
    
    ODOTMETH is unique among SelectorExpr expressions, in that Sel gets
    mangled so that it no longer has the original identifier that was
    selected (e.g., just "Foo"), but instead the qualified symbol name for
    the selected method (e.g., "pkg.Type.Foo"). This is rarely useful, and
    instead results in a lot of compiler code needing to worry about
    undoing this change.
    
    This CL changes ODOTMETH to leave the original symbol in place. The
    handful of code locations where the mangled symbol name is actually
    wanted are updated to use ir.MethodExprName(n).Sym() or (equivalently)
    ir.MethodExprName(n).Func.Sym() instead.
    
    Historically, the compiler backend has mistakenly used types.Syms
    where it should have used ir.Name/ir.Funcs. And this change in
    particular may risk breaking something, as the SelectorExpr.Sel will
    no longer point at a symbol that uniquely identifies the called
    method. However, I expect CL 280294 (desugar OCALLMETH into OCALLFUNC)
    to have substantially reduced this risk, as ODOTMETH expressions are
    now replaced entirely earlier in the compiler.
    
    Passes toolstash -cmp.
    
    Change-Id: If3c9c3b7df78ea969f135840574cf89e1d263876
    Reviewed-on: https://go-review.googlesource.com/c/go/+/280436
    Trust: Matthew Dempsky <mdempsky@google.com>
    Run-TryBot: Matthew Dempsky <mdempsky@google.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Cuong Manh Le <cuong.manhle.vn@gmail.com>

 src/cmd/compile/internal/inline/inl.go          | 24 ++++++++++----------
 src/cmd/compile/internal/ir/fmt.go              |  4 ++--
 src/cmd/compile/internal/typecheck/expr.go      |  8 +++----
 src/cmd/compile/internal/typecheck/func.go      | 29 ++++++-------------------
 src/cmd/compile/internal/typecheck/iexport.go   | 22 ++++++-------------
 src/cmd/compile/internal/typecheck/typecheck.go |  1 -
 src/cmd/compile/internal/types/fmt.go           | 14 ++++--------
 test/fixedbugs/issue31053.dir/main.go           |  6 ++---
 8 files changed, 38 insertions(+), 70 deletions(-)
