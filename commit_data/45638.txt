commit d1efaed17a7a4bf4b2dd8a8f975069dfd8251ca4
Author: Michael Matloob <matloob@golang.org>
Date:   Mon Nov 2 19:19:12 2020 +0000

    cmd/go: support cgo files in overlays
    
    This is a roll-forward of golang.org/cl/262618, which was reverted in
    golang.org/cl/267037. The only differences between this CL and the
    original are the three calls to fflush from the C files in
    build_overlay.txt, to guarantee that the string we're expecting is
    actually written out.
    
    This requires rewriting the paths of the files passed to the cgo tool
    toolchain to use the overlaid paths instead of the disk paths of
    files. Because the directories of the overlaid paths don't exist in
    general, the cgo tool have been updated to run in base.Cwd instead of
    the package directory.
    
    For #39958
    
    Change-Id: If7e5e057c62c0c22ddb724f9fe650902fc5f4832
    Reviewed-on: https://go-review.googlesource.com/c/go/+/267197
    Reviewed-by: Bryan C. Mills <bcmills@google.com>
    Trust: Michael Matloob <matloob@golang.org>

 src/cmd/go/internal/work/exec.go                  | 48 +++++++++++--
 src/cmd/go/internal/work/gc.go                    |  9 ++-
 src/cmd/go/testdata/script/build_overlay.txt      | 83 ++++++++++++++++++++++-
 src/cmd/go/testdata/script/build_trimpath_cgo.txt | 28 ++++++++
 4 files changed, 156 insertions(+), 12 deletions(-)
