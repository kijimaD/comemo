commit 6939659a085de15ba7e08ebe0c8864616ba21b76
Author: Russ Cox <rsc@golang.org>
Date:   Fri Oct 28 10:57:14 2022 -0400

    net: unify CNAME handling across ports
    
    Unix and Windows differ in how they handle LookupCNAME(name).
    
    If name exists in DNS with an A or AAAA record but no CNAME,
    then on all operating systems and in the pure Go resolver,
    LookupCNAME returns the name associated with the A/AAAA record
    (the original name).
    
    TestLookupCNAME has been testing this, because www.google.com
    has no CNAME. I think it did at one point, but not anymore, and the
    tests are still passing. Also added google.com as a test, since
    top-level domains are disallowed from having CNAMEs.
    
    If name exists in DNS with a CNAME record pointing to a record that
    does not exist or that has no A or AAAA record,
    then Windows has always reported the CNAME value,
    but Unix-based systems and the pure Go resolver have reported
    a failure instead. cname-to-txt.go4.org is an test record that is
    a CNAME to a non-A/AAAA target (the target only has a TXT record).
    
    This CL changes the Unix-based systems and the pure Go resolver
    to match the Windows behavior, allowing LookupCNAME to succeed
    whenever a CNAME exists.
    
    TestLookupCNAME nows tests the new behavior by looking up
    cname-to-txt.go4.org (run by bradfitz).
    
    Fixes #50101.
    
    Change-Id: Ieff5026c8535760e6313c7a41ebd5ff24de6d9be
    Reviewed-on: https://go-review.googlesource.com/c/go/+/446179
    Run-TryBot: Russ Cox <rsc@golang.org>
    Auto-Submit: Russ Cox <rsc@golang.org>
    TryBot-Result: Gopher Robot <gobot@golang.org>
    Reviewed-by: Ian Lance Taylor <iant@google.com>

 src/internal/syscall/unix/asm_darwin.s  |  9 +++++
 src/internal/syscall/unix/net_darwin.go | 45 ++++++++++++++++++++++
 src/net/cgo_unix.go                     | 68 +++++++++++++++++++++++++--------
 src/net/cgo_unix_cgo.go                 |  1 -
 src/net/cgo_unix_cgo_res.go             | 38 ++++++++++++++++++
 src/net/cgo_unix_cgo_resn.go            | 39 +++++++++++++++++++
 src/net/cgo_unix_syscall.go             | 34 ++++++++++-------
 src/net/dnsclient_unix.go               | 32 +++++++++++++---
 src/net/dnsclient_unix_test.go          |  4 ++
 src/net/lookup.go                       | 12 ++++++
 src/net/lookup_test.go                  |  2 +
 11 files changed, 249 insertions(+), 35 deletions(-)
