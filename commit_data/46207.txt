commit 4c2d66f642286647b640bced33581e8b1665bfe8
Author: Matthew Dempsky <mdempsky@google.com>
Date:   Sun Dec 13 10:35:20 2020 -0800

    [dev.regabi] cmd/compile: use ir.Ident for imported identifiers
    
    This CL substantially reworks how imported declarations are handled,
    and fixes a number of issues with dot imports. In particular:
    
    1. It eliminates the stub ir.Name declarations that are created
    upfront during import-declaration processing, allowing this to be
    deferred to when the declarations are actually needed. (Eventually,
    this can be deferred even further so we never have to create ir.Names
    w/ ONONAME, but this CL is already invasive/subtle enough.)
    
    2. During noding, we now use ir.Idents to represent uses of imported
    declarations, including of dot-imported declarations.
    
    3. Unused dot imports are now reported after type checking, so that we
    can correctly distinguish whether composite literal keys are a simple
    identifier (struct literals) or expressions (array/slice/map literals)
    and whether it might be a use of a dot-imported declaration.
    
    4. It changes the "redeclared" error messages to report the previous
    position information in the same style as other compiler error
    messages that reference other source lines.
    
    Passes buildall w/ toolstash -cmp.
    
    Fixes #6428.
    Fixes #43164.
    Fixes #43167.
    Updates #42990.
    
    Change-Id: I40a0a780ec40daf5700fbc3cfeeb7300e1055981
    Reviewed-on: https://go-review.googlesource.com/c/go/+/277713
    Run-TryBot: Matthew Dempsky <mdempsky@google.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Russ Cox <rsc@golang.org>
    Trust: Matthew Dempsky <mdempsky@google.com>

 src/cmd/compile/internal/gc/dcl.go            | 13 +++----
 src/cmd/compile/internal/gc/iimport.go        | 35 +++++++++----------
 src/cmd/compile/internal/gc/init.go           |  4 +--
 src/cmd/compile/internal/gc/main.go           |  9 +++--
 src/cmd/compile/internal/gc/noder.go          |  2 +-
 src/cmd/compile/internal/gc/subr.go           | 50 ++++++++++++++++++---------
 src/cmd/compile/internal/gc/typecheck.go      | 48 ++++++++++++++-----------
 src/cmd/compile/internal/ir/name.go           |  3 +-
 src/cmd/compile/internal/types/sizeof_test.go |  2 +-
 src/cmd/compile/internal/types/sym.go         |  3 +-
 test/fixedbugs/bug462.go                      |  4 +--
 test/fixedbugs/issue20415.go                  |  6 ++--
 test/fixedbugs/issue43164.dir/a.go            | 13 +++++++
 test/fixedbugs/issue43164.dir/b.go            | 11 ++++++
 test/fixedbugs/issue43164.go                  |  7 ++++
 test/fixedbugs/issue43167.go                  | 13 +++++++
 test/fixedbugs/issue6428.go                   | 15 ++++++++
 17 files changed, 159 insertions(+), 79 deletions(-)
