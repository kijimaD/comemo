commit 0ebd5a8de05823109263bef31b38be8c29d2cd54
Author: Ian Lance Taylor <iant@golang.org>
Date:   Mon Jun 21 14:48:54 2021 -0700

    cmd/go: update ToolTags based on GOARCH value
    
    The build.Context ToolTags value is set based on the set of enabled
    experiments, which in turn depends on GOARCH. Before this CL the set
    of experiments was being set based on GOARCH in the environment.
    That is normally fine, but fails with cmd/go when somebody has run
    "go env -w GOARCH=val"; in that case cmd/go changes its GOARCH value
    after initialization. The new GOARCH value was affect the set of
    enabled experiments, which can affect the ToolTags value. With this
    CL, we update ToolTags in cmd/go based on the GOARCH value it is using.
    
    This is a pretty ugly fix. We should do something cleaner for 1.18.
    
    Fixes #46815
    
    Change-Id: Ie9416781a168248813c3da8afdc257acdd3fef7e
    Reviewed-on: https://go-review.googlesource.com/c/go/+/329930
    Trust: Ian Lance Taylor <iant@golang.org>
    Run-TryBot: Ian Lance Taylor <iant@golang.org>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Matthew Dempsky <mdempsky@google.com>

 src/cmd/go/internal/cfg/cfg.go                 |  8 +++++++
 src/cmd/go/testdata/script/env_cross_build.txt | 29 ++++++++++++++++++++++++++
 src/internal/buildcfg/exp.go                   | 13 +++++++++---
 3 files changed, 47 insertions(+), 3 deletions(-)
