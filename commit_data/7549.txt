commit 690291a2c008ec4adf754a394437f1e9f6d46aba
Author: Russ Cox <rsc@golang.org>
Date:   Wed Feb 23 14:47:42 2011 -0500

    runtime: pass to signal handler value of g at time of signal
    
    The existing code assumed that signals only arrived
    while executing on the goroutine stack (g == m->curg),
    not while executing on the scheduler stack (g == m->g0).
    
    Most of the signal handling trampolines correctly saved
    and restored g already, but the sighandler C code did not
    have access to it.
    
    Some rewriting of assembly to make the various
    implementations as similar as possible.
    
    Will need to change Windows too but I don't
    understand how sigtramp gets called there.
    
    R=r
    CC=golang-dev
    https://golang.org/cl/4203042

 src/pkg/runtime/darwin/386/signal.c    |  9 ++++----
 src/pkg/runtime/darwin/386/sys.s       | 29 +++++++++++------------
 src/pkg/runtime/darwin/amd64/signal.c  |  9 ++++----
 src/pkg/runtime/darwin/amd64/sys.s     | 19 ++++++++-------
 src/pkg/runtime/freebsd/386/signal.c   |  9 ++++----
 src/pkg/runtime/freebsd/386/sys.s      | 42 +++++++++++++++++++---------------
 src/pkg/runtime/freebsd/amd64/signal.c |  9 ++++----
 src/pkg/runtime/freebsd/amd64/sys.s    | 24 +++++++++++++++----
 src/pkg/runtime/linux/386/signal.c     |  9 ++++----
 src/pkg/runtime/linux/386/sys.s        |  7 +++---
 src/pkg/runtime/linux/amd64/signal.c   |  9 ++++----
 src/pkg/runtime/linux/amd64/sys.s      | 10 ++++----
 src/pkg/runtime/linux/arm/signal.c     |  9 ++++----
 src/pkg/runtime/linux/arm/sys.s        | 13 +++++++++++
 14 files changed, 120 insertions(+), 87 deletions(-)
