commit 0f099a4bc569e32fbddefb8e3de6b59cf6d1959d
Author: Austin Clements <austin@google.com>
Date:   Wed Apr 19 14:01:05 2023 -0400

    runtime, cmd: rationalize StackLimit and StackGuard
    
    The current definitions of StackLimit and StackGuard only indirectly
    specify the NOSPLIT stack limit and duplicate a literal constant
    (928). Currently, they define the stack guard delta, and from there
    compute the NOSPLIT limit.
    
    Rationalize these by defining a new constant, abi.StackNosplitBase,
    which consolidates and directly specifies the NOSPLIT stack limit (in
    the default case). From this we then compute the stack guard delta,
    inverting the relationship between these two constants. While we're
    here, we rename StackLimit to StackNosplit to make it clearer what's
    being limited.
    
    This change does not affect the values of these constants in the
    default configuration. It does slightly change how
    StackGuardMultiplier values other than 1 affect the constants, but
    this multiplier is a pretty rough heuristic anyway.
    
                        before after
    stackNosplit           800   800
    _StackGuard            928   928
    stackNosplit -race    1728  1600
    _StackGuard -race     1856  1728
    
    For #59670.
    
    Change-Id: Ia94094c5e47897e7c088d24b4a5e33f5c2768db5
    Reviewed-on: https://go-review.googlesource.com/c/go/+/486976
    Auto-Submit: Austin Clements <austin@google.com>
    Run-TryBot: Austin Clements <austin@google.com>
    Reviewed-by: Cherry Mui <cherryyz@google.com>
    TryBot-Result: Gopher Robot <gobot@golang.org>

 src/cmd/internal/objabi/stack.go       | 15 +++------------
 src/cmd/link/internal/ld/stackcheck.go |  2 +-
 src/internal/abi/stack.go              |  8 ++++++++
 src/runtime/preempt.go                 |  2 +-
 src/runtime/stack.go                   | 19 +++++++++----------
 test/nosplit.go                        | 13 +++----------
 6 files changed, 25 insertions(+), 34 deletions(-)
