commit cc4e6160a78742bba6ac8e9be225cd7a58da7a60
Author: Josh Bleecher Snyder <josharian@gmail.com>
Date:   Thu Feb 11 10:49:55 2021 -0800

    net: use mid-stack inlining with ReadFromUDP to avoid an allocation
    
    This commit rewrites ReadFromUDP to be mid-stack inlined
    and pass a UDPAddr for lower layers to fill in.
    
    This lets performance-sensitive clients avoid an allocation.
    It requires some care on their part to prevent the UDPAddr
    from escaping, but it is now possible.
    The UDPAddr trivially does not escape in the benchmark,
    as it is immediately discarded.
    
    name                  old time/op    new time/op    delta
    WriteToReadFromUDP-8    17.2µs ± 6%    17.1µs ± 5%     ~     (p=0.387 n=9+9)
    
    name                  old alloc/op   new alloc/op   delta
    WriteToReadFromUDP-8      112B ± 0%       64B ± 0%  -42.86%  (p=0.000 n=10+10)
    
    name                  old allocs/op  new allocs/op  delta
    WriteToReadFromUDP-8      3.00 ± 0%      2.00 ± 0%  -33.33%  (p=0.000 n=10+10)
    
    Updates #43451
    
    Co-authored-by: Filippo Valsorda <filippo@golang.org>
    Change-Id: I1f9d2ab66bd7e4eff07fe39000cfa0b45717bd13
    Reviewed-on: https://go-review.googlesource.com/c/go/+/291509
    Run-TryBot: Filippo Valsorda <filippo@golang.org>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Josh Bleecher Snyder <josharian@gmail.com>
    Reviewed-by: Jason A. Donenfeld <Jason@zx2c4.com>
    Trust: Filippo Valsorda <filippo@golang.org>
    Trust: Josh Bleecher Snyder <josharian@gmail.com>
    Trust: Jason A. Donenfeld <Jason@zx2c4.com>

 src/cmd/compile/internal/test/inl_test.go |  5 ++++-
 src/net/udpsock.go                        | 22 +++++++++++++---------
 src/net/udpsock_plan9.go                  |  7 ++++---
 src/net/udpsock_posix.go                  |  7 +++----
 src/net/udpsock_test.go                   | 21 +++++++++++++++++++++
 5 files changed, 45 insertions(+), 17 deletions(-)
