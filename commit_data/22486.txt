commit 2f98bac3107d3dee4f546055e790cf0076454c80
Author: Nigel Tao <nigeltao@golang.org>
Date:   Mon Apr 13 13:25:28 2015 +1000

    image/jpeg: don't assume that an ensureNBits failure implies that we can
    call unreadByteStuffedByte.
    
    If ensureNBits was due to an io.EOF that was translated to
    jpeg.errShortHuffmanData, then we may have read no bytes, so there is no
    byte-stuffed-byte to unread.
    
    Fixes #10387
    
    Change-Id: I39a3842590c6cef2aa48943288d52f603338b44d
    Reviewed-on: https://go-review.googlesource.com/8841
    Reviewed-by: Rob Pike <r@golang.org>

 src/image/jpeg/reader.go      | 16 +++-------------
 src/image/jpeg/reader_test.go | 20 ++++++++++++++++++++
 2 files changed, 23 insertions(+), 13 deletions(-)
