commit 3c090019172afd4517360606efc50750d3e278fa
Author: David Chase <drchase@google.com>
Date:   Fri May 6 17:05:02 2016 -0700

    cmd/compile: correct sparseSet probes in regalloc to avoid index error
    
    In regalloc, a sparse map is preallocated for later use by
    spill-in-loop sinking.  However, variables (spills) are added
    during register allocation before spill sinking, and a map
    query involving any of these new variables will index out of
    bounds in the map.
    
    To fix:
    1) fix the queries to use s.orig[v.ID].ID instead, to ensure
    proper indexing.  Note that s.orig will be nil for values
    that are not eligible for spilling (like memory and flags).
    
    2) add a test.
    
    Fixes #15585.
    
    Change-Id: I8f2caa93b132a0f2a9161d2178320d5550583075
    Reviewed-on: https://go-review.googlesource.com/22911
    Reviewed-by: Keith Randall <khr@golang.org>
    Run-TryBot: David Chase <drchase@google.com>
    TryBot-Result: Gobot Gobot <gobot@golang.org>

 src/cmd/compile/internal/ssa/regalloc.go | 15 +++++++----
 test/fixedbugs/issue15585.go             | 45 ++++++++++++++++++++++++++++++++
 2 files changed, 55 insertions(+), 5 deletions(-)
