commit e7f2e5697ac8b9b6ebfb3e0d059a8c318b4709eb
Author: Andy Pan <panjf2000@gmail.com>
Date:   Sun Aug 14 02:29:33 2022 +0800

    encoding/json: give it a chance to put encodeState back in pool when error occurs
    
    name                       old time/op    new time/op    delta
    CodeEncoderError-10           688µs ± 8%     496µs ±15%   -27.92%  (p=0.000 n=10+9)
    CodeMarshalError-10           747µs ± 6%     546µs ± 4%   -26.86%  (p=0.000 n=10+10)
    MarshalBytesError/32-10       284µs ± 2%     273µs ± 1%    -3.84%  (p=0.000 n=10+10)
    MarshalBytesError/256-10      281µs ± 2%     278µs ± 4%      ~     (p=0.053 n=9+10)
    MarshalBytesError/4096-10     290µs ± 1%     279µs ± 3%    -3.52%  (p=0.000 n=10+10)
    
    name                       old speed      new speed      delta
    CodeEncoderError-10        2.83GB/s ± 8%  3.84GB/s ±20%   +36.03%  (p=0.000 n=10+10)
    CodeMarshalError-10        2.60GB/s ± 5%  3.56GB/s ± 4%   +36.61%  (p=0.000 n=10+10)
    
    name                       old alloc/op   new alloc/op   delta
    CodeEncoderError-10          4.05MB ± 1%    0.00MB ± 1%  -100.00%  (p=0.000 n=10+9)
    CodeMarshalError-10          6.05MB ± 0%    1.99MB ± 1%   -67.13%  (p=0.000 n=10+10)
    MarshalBytesError/32-10      66.0kB ± 0%     0.2kB ± 0%   -99.67%  (p=0.000 n=9+8)
    MarshalBytesError/256-10     50.1kB ± 0%     0.9kB ± 0%   -98.23%  (p=0.000 n=9+9)
    MarshalBytesError/4096-10    87.4kB ± 0%     7.5kB ± 0%   -91.47%  (p=0.000 n=8+10)
    
    name                       old allocs/op  new allocs/op  delta
    CodeEncoderError-10            25.0 ± 0%       4.0 ± 0%   -84.00%  (p=0.000 n=9+10)
    CodeMarshalError-10            27.0 ± 0%       6.0 ± 0%   -77.78%  (p=0.000 n=10+10)
    MarshalBytesError/32-10        18.0 ± 0%       5.0 ± 0%   -72.22%  (p=0.000 n=10+10)
    MarshalBytesError/256-10       17.0 ± 0%       6.0 ± 0%   -64.71%  (p=0.000 n=10+10)
    MarshalBytesError/4096-10      16.0 ± 0%       6.0 ± 0%   -62.50%  (p=0.000 n=10+10)
    
    Change-Id: I48070bb05f55707251c694e40d2570403bbf61f8
    Reviewed-on: https://go-review.googlesource.com/c/go/+/423694
    Auto-Submit: Ian Lance Taylor <iant@google.com>
    Reviewed-by: Daniel Martí <mvdan@mvdan.cc>
    Run-TryBot: Ian Lance Taylor <iant@google.com>
    Reviewed-by: Ian Lance Taylor <iant@google.com>
    Reviewed-by: David Chase <drchase@google.com>
    TryBot-Result: Gopher Robot <gobot@golang.org>

 src/encoding/json/bench_test.go  | 100 +++++++++++++++++++++++++++++++++++++++
 src/encoding/json/encode.go      |   3 +-
 src/encoding/json/encode_test.go |  36 ++++++++++++++
 src/encoding/json/stream.go      |   4 +-
 src/encoding/json/stream_test.go |  38 +++++++++++++++
 5 files changed, 178 insertions(+), 3 deletions(-)
