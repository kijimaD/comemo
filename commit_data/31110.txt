commit ce3ee7cdae9059a2cfb1a801a34712f413afb211
Author: Josh Bleecher Snyder <josharian@gmail.com>
Date:   Tue Apr 11 15:15:04 2017 -0700

    cmd/internal/obj: stop storing Text flags in From3
    
    Prior to this CL, flags such as NOSPLIT
    on ATEXT Progs were stored in From3.Offset.
    Some but not all of those flags were also
    duplicated into From.Sym.Attribute.
    
    This CL migrates all of those flags into
    From.Sym.Attribute and stops creating a From3.
    
    A side-effect of this is that printing an
    ATEXT Prog can no longer simply dump From3.Offset.
    That's kind of good, since the raw flag value
    wasn't very informative anyway, but it did
    necessitate a bunch of updates to the cmd/asm tests.
    
    The reason I'm doing this work now is that
    avoiding storing flags in both From.Sym and From3.Offset
    simplifies some other changes to fix the data
    race first described in CL 40254.
    
    This CL almost passes toolstash-check -all.
    The only changes are in cases where the assembler
    has decided that a function's flags may be altered,
    e.g. to make a function with no calls in it NOSPLIT.
    Prior to this CL, that information was not printed.
    
    Sample before:
    
    "".Ctz64 t=1 size=63 args=0x10 locals=0x0
            0x0000 00000 (/Users/josh/go/tip/src/runtime/internal/sys/intrinsics.go:35)     TEXT    "".Ctz64(SB), $0-16
            0x0000 00000 (/Users/josh/go/tip/src/runtime/internal/sys/intrinsics.go:35)     FUNCDATA        $0, gclocals·f207267fbf96a0178e8758c6e3e0ce28(SB)
    
    Sample after:
    
    "".Ctz64 t=1 nosplit size=63 args=0x10 locals=0x0
            0x0000 00000 (/Users/josh/go/tip/src/runtime/internal/sys/intrinsics.go:35)     TEXT    "".Ctz64(SB), NOSPLIT, $0-16
            0x0000 00000 (/Users/josh/go/tip/src/runtime/internal/sys/intrinsics.go:35)     FUNCDATA        $0, gclocals·f207267fbf96a0178e8758c6e3e0ce28(SB)
    
    Observe the additional "nosplit" in the first line
    and the additional "NOSPLIT" in the second line.
    
    Updates #15756
    
    Change-Id: I5c59bd8f3bdc7c780361f801d94a261f0aef3d13
    Reviewed-on: https://go-review.googlesource.com/40495
    Run-TryBot: Josh Bleecher Snyder <josharian@gmail.com>
    Reviewed-by: Brad Fitzpatrick <bradfitz@golang.org>
    TryBot-Result: Gobot Gobot <gobot@golang.org>

 misc/nacl/testzip.proto                      |  2 ++
 src/cmd/asm/internal/asm/asm.go              |  6 +---
 src/cmd/asm/internal/asm/endtoend_test.go    |  5 +++
 src/cmd/asm/internal/asm/testdata/386.s      |  4 ++-
 src/cmd/asm/internal/asm/testdata/amd64.s    |  4 ++-
 src/cmd/asm/internal/asm/testdata/amd64enc.s |  4 ++-
 src/cmd/asm/internal/asm/testdata/arm.s      |  4 ++-
 src/cmd/asm/internal/asm/testdata/arm64.s    |  4 ++-
 src/cmd/asm/internal/asm/testdata/mips.s     |  4 ++-
 src/cmd/asm/internal/asm/testdata/mips64.s   |  4 ++-
 src/cmd/asm/internal/asm/testdata/ppc64.s    |  4 ++-
 src/cmd/asm/internal/asm/testdata/s390x.s    |  8 +++--
 src/cmd/compile/internal/gc/gsubr.go         | 18 +++++-----
 src/cmd/internal/obj/arm/obj5.go             |  8 ++---
 src/cmd/internal/obj/arm64/obj7.go           |  6 ++--
 src/cmd/internal/obj/link.go                 | 53 +++++++++++++++++++++++-----
 src/cmd/internal/obj/mips/obj0.go            |  8 ++---
 src/cmd/internal/obj/plist.go                | 18 ++++------
 src/cmd/internal/obj/ppc64/obj9.go           | 16 ++++-----
 src/cmd/internal/obj/s390x/objz.go           | 16 ++++-----
 src/cmd/internal/obj/util.go                 | 16 ++++++---
 src/cmd/internal/obj/x86/obj6.go             | 16 ++++-----
 22 files changed, 145 insertions(+), 83 deletions(-)
