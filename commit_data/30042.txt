commit bf9c71cb434a730679f54a3a87c2e9e36ec400d0
Author: Austin Clements <austin@google.com>
Date:   Wed Oct 19 18:27:39 2016 -0400

    runtime: make morestack less subtle
    
    morestack writes the context pointer to gobuf.ctxt, but since
    morestack is written in assembly (and has to be very careful with
    state), it does *not* invoke the requisite write barrier for this
    write. Instead, we patch this up later, in newstack, where we invoke
    an explicit write barrier for ctxt.
    
    This already requires some subtle reasoning, and it's going to get a
    lot hairier with the hybrid barrier.
    
    Fix this by simplifying the whole mechanism. Instead of writing
    gobuf.ctxt in morestack, just pass the value of the context register
    to newstack and let it write it to gobuf.ctxt. This is a normal Go
    pointer write, so it gets the normal Go write barrier. No subtle
    reasoning required.
    
    Updates #17503.
    
    Change-Id: Ia6bf8459bfefc6828f53682ade32c02412e4db63
    Reviewed-on: https://go-review.googlesource.com/31550
    Run-TryBot: Austin Clements <austin@google.com>
    TryBot-Result: Gobot Gobot <gobot@golang.org>
    Reviewed-by: Cherry Zhang <cherryyz@google.com>

 src/runtime/asm_386.s      |  4 +++-
 src/runtime/asm_amd64.s    |  4 +++-
 src/runtime/asm_amd64p32.s |  4 +++-
 src/runtime/asm_arm.s      |  5 ++++-
 src/runtime/asm_arm64.s    |  4 +++-
 src/runtime/asm_mips64x.s  |  6 +++++-
 src/runtime/asm_ppc64x.s   |  4 +++-
 src/runtime/asm_s390x.s    |  6 +++++-
 src/runtime/stack.go       | 21 ++++++++++-----------
 9 files changed, 39 insertions(+), 19 deletions(-)
