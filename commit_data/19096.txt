commit e9347c781be66056bbc724f4d70d4b8b9bc0288c
Author: Rui Ueyama <ruiu@google.com>
Date:   Thu Apr 10 18:44:44 2014 +0400

    sync: fix spurious wakeup from WaitGroup.Wait
    
    There is a race condition that causes spurious wakeup from Wait
    in the following case:
    
     G1: decrement wg.counter, observe the counter is now 0
         (should unblock goroutines queued *at this moment*)
     G2: increment wg.counter
     G2: call Wait() to add itself to the wait queue
     G1: acquire wg.m, unblock all waiting goroutines
    
    In the last step G2 is spuriously woken up by G1.
    Fixes #7734.
    
    LGTM=rsc, dvyukov
    R=dvyukov, 0xjnml, rsc
    CC=golang-codereviews
    https://golang.org/cl/85580043

 src/pkg/sync/waitgroup.go      | 10 ++++++----
 src/pkg/sync/waitgroup_test.go | 26 ++++++++++++++++++++++++++
 2 files changed, 32 insertions(+), 4 deletions(-)
