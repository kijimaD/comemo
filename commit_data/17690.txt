commit 0f3ea75020cf7dda64805fe9aeef26be60cf16cd
Author: Brad Fitzpatrick <bradfitz@golang.org>
Date:   Mon Sep 23 19:57:19 2013 -0700

    encoding/json: don't cache value addressability when building first encoder
    
    newTypeEncoder (called once per type and then cached) was
    looking at the first value seen of that type's addressability
    and caching the encoder decision.  If the first value seen was
    addressable and a future one wasn't, it would panic.
    
    Instead, introduce a new wrapper encoder type that checks
    CanAddr at runtime.
    
    Fixes #6458
    
    R=golang-dev, rsc
    CC=golang-dev
    https://golang.org/cl/13839045

 src/pkg/encoding/json/encode.go      | 117 ++++++++++++++++++++---------------
 src/pkg/encoding/json/encode_test.go |  24 +++++++
 2 files changed, 90 insertions(+), 51 deletions(-)
