commit 5331e7e9df017374a05a66497fd367e165b8aaf5
Author: Ian Lance Taylor <iant@golang.org>
Date:   Tue May 9 14:34:16 2017 -0700

    cmd/internal/obj, cmd/link: fix st_other field on PPC64
    
    In PPC64 ELF files, the st_other field indicates the number of
    prologue instructions between the global and local entry points.
    We add the instructions in the compiler and assembler if -shared is used.
    We were assuming that the instructions were present when building a
    c-archive or PIE or doing dynamic linking, on the assumption that those
    are the cases where the go tool would be building with -shared.
    That assumption fails when using some other tool, such as Bazel,
    that does not necessarily use -shared in exactly the same way.
    
    This CL records in the object file whether a symbol was compiled
    with -shared (this will be the same for all symbols in a given compilation)
    and uses that information when setting the st_other field.
    
    Fixes #20290.
    
    Change-Id: Ib2b77e16aef38824871102e3c244fcf04a86c6ea
    Reviewed-on: https://go-review.googlesource.com/43051
    Run-TryBot: Ian Lance Taylor <iant@golang.org>
    TryBot-Result: Gobot Gobot <gobot@golang.org>
    Reviewed-by: Michael Hudson-Doyle <michael.hudson@canonical.com>
    Reviewed-by: Matthew Dempsky <mdempsky@google.com>

 misc/cgo/testcarchive/carchive_test.go | 134 ++++++++++++++++++++-------------
 src/cmd/internal/goobj/read.go         |   2 +-
 src/cmd/internal/obj/objfile.go        |   3 +
 src/cmd/internal/obj/ppc64/obj9.go     |   5 ++
 src/cmd/internal/objabi/doc.go         |   1 +
 src/cmd/link/internal/ld/link.go       |   4 +
 src/cmd/link/internal/ld/objfile.go    |   3 +
 src/cmd/link/internal/ld/symtab.go     |   5 +-
 8 files changed, 101 insertions(+), 56 deletions(-)
