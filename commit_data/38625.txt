commit af1bfe0aa39091a4103bd29d8659f6267aad9df0
Author: Austin Clements <austin@google.com>
Date:   Thu Nov 1 12:25:41 2018 -0400

    runtime: correct ABI information for all functions
    
    There are three cases where we don't currently have the visibility to
    get the ABIs of runtime symbols right, which this CL fixes:
    
    1. For Go functions referenced from non-Go code in other packages.
       This is runtime.morestackc (which is referenced from function
       prologues) and a few syscall symbols. For these we need to generate
       ABI0 wrappers, so this CL adds dummy calls in the assembly code to
       force wrapper generation. There are many other cross-package
       references to runtime and runtime/internal/atomic, but these are
       handled specially by cmd/go.
    
    2. For calls generated by the compiler to runtime Go functions, there
       are a few symbols that aren't declared in builtins.go because we've
       never needed their type information before. Now we at least need
       their ABI information, so these are added to builtins.go.
    
    3. For calls generated by the compiler to runtime assembly functions,
       the compiler is going to assume the internal ABI is available, so
       we add Go stubs to the runtime to trigger wrapper generation. For
       these we're probably going to want to provide internal ABI
       definitions directly in the assembly for performance, but for now
       the ABIs are the same so it doesn't matter.
    
    For #27539.
    
    Change-Id: I9c224e7408d2ef4dd9b0e4c9d7e962ddfe111245
    Reviewed-on: https://go-review.googlesource.com/c/146822
    Run-TryBot: Austin Clements <austin@google.com>
    TryBot-Result: Gobot Gobot <gobot@golang.org>
    Reviewed-by: Keith Randall <khr@golang.org>
    Reviewed-by: Michael Knyszek <mknyszek@google.com>

 src/cmd/vet/all/whitelist/386.txt |  3 ---
 src/runtime/asm.s                 |  8 ++++++++
 src/runtime/os_nacl.go            |  9 +++++++++
 src/runtime/race.go               |  4 ++++
 src/runtime/stubs_386.go          |  8 ++++++++
 src/syscall/asm_windows.s         | 11 +++++++++++
 6 files changed, 40 insertions(+), 3 deletions(-)
