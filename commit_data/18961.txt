commit f8c350873c94baaf53b9c1c2b6ddfb463172c3de
Author: Dmitriy Vyukov <dvyukov@google.com>
Date:   Wed Mar 26 15:11:36 2014 +0400

    runtime: fix yet another race in bgsweep
    Currently it's possible that bgsweep finishes before all spans
    have been swept (we only know that sweeping of all spans has *started*).
    In such case bgsweep may fail wake up runfinq goroutine when it needs to.
    finq may still be nil at this point, but some finalizers may be queued later.
    Make bgsweep to wait for sweeping to *complete*, then it can decide
    whether it needs to wake up runfinq for sure.
    Update #7533
    
    LGTM=rsc
    R=rsc
    CC=golang-codereviews
    https://golang.org/cl/75960043

 src/pkg/runtime/malloc.goc |  1 +
 src/pkg/runtime/malloc.h   |  4 +++
 src/pkg/runtime/mgc0.c     | 75 ++++++++++++++++++++++++----------------------
 src/pkg/runtime/proc.c     |  2 ++
 4 files changed, 47 insertions(+), 35 deletions(-)
