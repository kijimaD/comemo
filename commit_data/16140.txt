commit 5bb3a66a973ea87494b9197091e8c1f122080627
Author: RÃ©my Oudompheng <oudomphe@phare.normalesup.org>
Date:   Mon Apr 8 23:46:54 2013 +0200

    sync, sync/atomic: do not corrupt race detector after a nil dereference.
    
    The race detector uses a global lock to analyze atomic
    operations. A panic in the middle of the code leaves the
    lock acquired.
    
    Similarly, the sync package may leave the race detectro
    inconsistent when methods are called on nil pointers.
    
    R=golang-dev, r, minux.ma, dvyukov, rsc, adg
    CC=golang-dev
    https://golang.org/cl/7981043

 src/pkg/runtime/race/testdata/atomic_test.go | 19 +++++++++++++++++++
 src/pkg/runtime/race/testdata/sync_test.go   | 19 +++++++++++++++++++
 src/pkg/sync/atomic/race.go                  | 15 +++++++++++++++
 src/pkg/sync/cond.go                         |  3 +++
 src/pkg/sync/mutex.go                        |  1 +
 src/pkg/sync/rwmutex.go                      |  4 ++++
 src/pkg/sync/waitgroup.go                    |  2 ++
 7 files changed, 63 insertions(+)
