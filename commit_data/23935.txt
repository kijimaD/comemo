commit 77082481d48c8cd8ea93328f9ab962092fe0183f
Author: Dmitry Vyukov <dvyukov@google.com>
Date:   Thu May 7 12:33:45 2015 +0300

    runtime/race: make test more robust
    
    The test is flaky on builders lately. I don't see any issues other than
    usage of very small sleeps. So increase the sleeps. Also take opportunity
    to refactor the code.
    On my machine this change significantly reduces failure rate with GOMAXPROCS=2.
    I can't reproduce the failure with GOMAXPROCS=1.
    
    Fixes #10726
    
    Change-Id: Iea6f10cf3ce1be5c112a2375d51c13687a8ab4c9
    Reviewed-on: https://go-review.googlesource.com/9803
    Reviewed-by: Austin Clements <austin@google.com>

 src/runtime/race/testdata/sync_test.go | 74 +++++++++++++---------------------
 1 file changed, 27 insertions(+), 47 deletions(-)
