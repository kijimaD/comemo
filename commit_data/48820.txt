commit d68a8d0f27bb3599b49cacd119d7ac3202248050
Author: Jason A. Donenfeld <Jason@zx2c4.com>
Date:   Fri Dec 10 17:23:08 2021 +0100

    crypto/rand: batch and buffer calls to getrandom/getentropy
    
    We're using bufio to batch reads of /dev/urandom to 4k, but we weren't
    doing the same on newer platforms with getrandom/getentropy. Since the
    overhead is the same for these -- one syscall -- we should batch reads
    of these into the same 4k buffer. While we're at it, we can simplify a
    lot of the constant dispersal.
    
    This also adds a new test case to make sure the buffering works as
    desired.
    
    Change-Id: I7297d4aa795c00712e6484b841cef8650c2be4ef
    Reviewed-on: https://go-review.googlesource.com/c/go/+/370894
    Reviewed-by: Filippo Valsorda <valsorda@google.com>
    Run-TryBot: Jason Donenfeld <Jason@zx2c4.com>
    Auto-Submit: Jason Donenfeld <Jason@zx2c4.com>
    TryBot-Result: Gopher Robot <gobot@golang.org>
    Reviewed-by: Ian Lance Taylor <iant@google.com>

 src/crypto/rand/rand_batched_test.go               | 50 ++++++++++++++++---
 src/crypto/rand/rand_dragonfly.go                  |  9 ----
 src/crypto/rand/rand_freebsd.go                    |  9 ----
 src/crypto/rand/rand_getentropy.go                 | 20 +-------
 .../rand/{rand_batched.go => rand_getrandom.go}    | 40 ++++++++-------
 src/crypto/rand/rand_linux.go                      | 14 ------
 src/crypto/rand/rand_solaris.go                    | 10 ----
 src/crypto/rand/rand_unix.go                       | 57 ++++++++++++++++++++--
 8 files changed, 120 insertions(+), 89 deletions(-)
