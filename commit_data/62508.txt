commit 574a9fa60e593154fbbe64f992b7e6656e3ab0b7
Author: Daniel McCarney <daniel@binaryparadox.net>
Date:   Wed Feb 26 15:59:25 2025 -0500

    crypto/tls: reject TLS 1.3 compat session ID in TLS 1.2
    
    If we weren't resuming an existing session, and we constructed a TLS 1.3
    compatible client hello, ensure the server doesn't echo back the
    made up compatibility session ID if we end up handshaking for TLS 1.2.
    
    As part of an effort to make the initial stages of a TLS 1.3 handshake
    compatible with TLS 1.2 middleboxes, TLS 1.3 requires that the client
    hello contain a non-empty legacy_session_id value. For anti-ossification
    purposes it's recommended this ID be randomly generated. This is the
    strategy the crypto/tls package takes.
    
    When we follow this approach, but then end up negotiating TLS 1.2, the
    server should not have echoed back that random ID to us. It's impossible
    for the server to have had a session with a matching ID and so it is
    misbehaving and it's prudent for our side to abort the handshake.
    
    See RFC 8446 Section 4.1.2 for more detail:
      https://www.rfc-editor.org/rfc/rfc8446#section-4.1.2
    
    Adopting this behaviour allows un-ignoring the BoGo
    EchoTLS13CompatibilitySessionID testcase.
    
    Updates #72006
    
    Change-Id: I1e52075177a13a7aa103b45498eae38d8a4c34b9
    Reviewed-on: https://go-review.googlesource.com/c/go/+/652997
    LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
    Reviewed-by: Roland Shoemaker <roland@golang.org>
    Reviewed-by: Junyang Shao <shaojunyang@google.com>
    Reviewed-by: Filippo Valsorda <filippo@golang.org>

 src/crypto/tls/bogo_config.json    |  1 -
 src/crypto/tls/handshake_client.go | 13 +++++++++++++
 2 files changed, 13 insertions(+), 1 deletion(-)
