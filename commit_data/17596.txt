commit 439f9397fc3ef260a74a64e0b0efb071a066b321
Author: Russ Cox <rsc@golang.org>
Date:   Fri Sep 13 14:19:23 2013 -0400

    runtime: avoid inconsistent goroutine state in profiler
    
    Because profiling signals can arrive at any time, we must
    handle the case where a profiling signal arrives halfway
    through a goroutine switch. Luckily, although there is much
    to think through, very little needs to change.
    
    Fixes #6000.
    Fixes #6015.
    
    R=golang-dev, dvyukov
    CC=golang-dev
    https://golang.org/cl/13421048

 src/pkg/runtime/arch_386.h          |   1 +
 src/pkg/runtime/arch_amd64.h        |   1 +
 src/pkg/runtime/arch_arm.h          |   1 +
 src/pkg/runtime/export_test.c       |  13 ++++
 src/pkg/runtime/export_test.go      |   2 +
 src/pkg/runtime/pprof/pprof_test.go | 116 +++++++++++++++++++++++++++---------
 src/pkg/runtime/proc.c              |  77 +++++++++++++++++++++++-
 src/pkg/runtime/runtime_test.go     |  43 +++++++++++++
 8 files changed, 225 insertions(+), 29 deletions(-)
