commit 2933c451a06ee0f97a698d1383cfbda988374137
Author: Robert Findley <rfindley@google.com>
Date:   Fri Sep 10 10:23:23 2021 -0400

    go/types: merge Named type loading and expansion
    
    Named type expansion and loading were conceptually similar: a mechanism
    for lazily resolving type information in a concurrency-safe manner.
    Unify them into a 'resolve' method, that delegates to a resolver func to
    produce type parameters, underlying, and methods.
    
    By leveraging the sync.Once field on Named for instance expansion, we
    get closer to making instance expansion concurrency-safe, and remove the
    requirement that instPos guard instantiation. This will be cleaned up
    in a follow-up CL.
    
    This also fixes #47887 by causing substituted type instances to be
    expanded (in the old code, this could be fixed by setting instPos when
    substituting).
    
    For #47910
    Fixes #47887
    
    Change-Id: Ifc52a420dde76e3a46ce494fea9bd289bc8aca4c
    Reviewed-on: https://go-review.googlesource.com/c/go/+/349410
    Trust: Robert Findley <rfindley@google.com>
    Run-TryBot: Robert Findley <rfindley@google.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Robert Griesemer <gri@golang.org>

 src/go/types/decl.go                           |   4 +-
 src/go/types/instantiate.go                    |   3 +-
 src/go/types/lookup.go                         |   2 +-
 src/go/types/named.go                          | 114 ++++++++++---------------
 src/go/types/object.go                         |  16 +++-
 src/go/types/signature.go                      |   2 +-
 src/go/types/subst.go                          |  39 +++++----
 src/go/types/testdata/fixedbugs/issue47887.go2 |  28 ++++++
 src/go/types/type.go                           |   2 +-
 9 files changed, 114 insertions(+), 96 deletions(-)
