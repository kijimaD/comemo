commit a1646595e63cc0bf7f566bb9b657f826cbda22a1
Author: Jay Conrod <jayconrod@google.com>
Date:   Thu Dec 17 17:25:42 2020 -0500

    [dev.fuzz] cmd/go: implement -fuzztime flag and support cancellation
    
    fuzz.CoordinateFuzzing and RunFuzzWorker now accept a context.Context
    parameter. They should terminate gracefully when the context is
    cancelled. The worker should exit quickly without processing more
    inputs. The coordinator should save interesting inputs to the cache.
    
    The testing package can't import context directly, so it provides a
    timeout argument to testdeps.CoordinateFuzzing instead. The testdeps
    wrapper sets the timeout and installs an interrupt handler (for SIGINT
    on POSIX and the equivalent on Windows) that cancels the context when
    ^C is pressed.
    
    Note that on POSIX platforms, pressing ^C causes the shell to deliver
    SIGINT to all processes in the active group: so 'go test', the
    coordinator, and the workers should all react to that. On Windows,
    pressing ^C only interrupts 'go test'. We may want to look at that
    separately.
    
    Change-Id: I924d3be2905f9685dae82ff3c047ca3d6b5e2357
    Reviewed-on: https://go-review.googlesource.com/c/go/+/279487
    Run-TryBot: Jay Conrod <jayconrod@google.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Katie Hockman <katie@golang.org>
    Trust: Katie Hockman <katie@golang.org>
    Trust: Jay Conrod <jayconrod@google.com>

 src/cmd/go/internal/test/flagdefs.go               |  1 +
 src/cmd/go/internal/test/genflags.go               |  2 +-
 src/cmd/go/internal/test/testflag.go               |  1 +
 src/cmd/go/testdata/script/test_fuzz.txt           |  6 +-
 src/cmd/go/testdata/script/test_fuzz_cache.txt     |  2 +-
 src/cmd/go/testdata/script/test_fuzz_fuzztime.txt  | 27 +++++++++
 src/cmd/go/testdata/script/test_fuzz_match.txt     |  6 +-
 src/cmd/go/testdata/script/test_fuzz_mutate.txt    |  2 +-
 .../go/testdata/script/test_fuzz_mutate_crash.txt  |  6 +-
 src/internal/fuzz/fuzz.go                          | 35 +++++------
 src/internal/fuzz/worker.go                        | 70 ++++++++++++++++------
 src/testing/fuzz.go                                |  6 +-
 src/testing/internal/testdeps/deps.go              | 49 ++++++++++++++-
 src/testing/testing.go                             | 32 ++++++----
 14 files changed, 181 insertions(+), 64 deletions(-)
