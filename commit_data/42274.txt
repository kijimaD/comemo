commit b4ecafc986268d171776603537d40c8dff3fae61
Author: Keith Randall <khr@golang.org>
Date:   Mon May 4 09:50:20 2020 -0700

    cmd/compile: restrict bit test rewrite rules
    
    The {AND,OR,XOR}const ops can only take an int32 as an argument.
    Make sure that when rewriting a BTx op to one of these, the result
    has no high-order bits.
    
    Fixes #38746
    
    Change-Id: Ia7c5f76952329f60974bc033c29a5433610f3b28
    Reviewed-on: https://go-review.googlesource.com/c/go/+/231977
    Run-TryBot: Keith Randall <khr@golang.org>
    TryBot-Result: Gobot Gobot <gobot@golang.org>
    Reviewed-by: Josh Bleecher Snyder <josharian@gmail.com>

 src/cmd/compile/internal/ssa/gen/AMD64.rules |  39 ++++--
 src/cmd/compile/internal/ssa/rewriteAMD64.go | 186 ++++++++++++++++-----------
 test/fixedbugs/issue38746.go                 |  17 +++
 3 files changed, 155 insertions(+), 87 deletions(-)
