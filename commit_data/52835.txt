commit 14cf82aa37ec33012ca48febd83fb16e1178beee
Author: qmuntal <quimmuntal@gmail.com>
Date:   Tue Jan 17 08:15:33 2023 +0100

    cmd/link: generate .pdata PE section
    
    This CL adds a .pdata section to the PE file generated by the Go linker.
    
    The .pdata section is a standard section [1] that contains an array of
    function table entries that are used for stack unwinding.
    The table entries layout is taken from [2].
    
    This CL just generates the table entries without any unwinding
    information, which is enough to start doing some E2E tests
    between the Go linker and the Win32 APIs.
    
    The goal of the .pdata table is to allow Windows retrieve
    unwind information for a function at a given PC. It does so by doing
    a binary search on the table, looking for an entry that meets
    BeginAddress >= PC < EndAddress.
    
    Each table entry takes 12 bytes and only non-leaf functions with
    frame pointer needs an entry on the .pdata table.
    The result is that PE binaries will be ~0.7% bigger due to the unwind
    information, a reasonable amount considering the benefits in
    debuggability.
    
    Updates #57302
    
    [1] https://learn.microsoft.com/en-us/windows/win32/debug/pe-format#the-pdata-section
    [2] https://learn.microsoft.com/en-us/cpp/build/exception-handling-x64#struct-runtime_function
    
    Change-Id: If675d10c64452946dbab76709da20569651e3e9f
    Reviewed-on: https://go-review.googlesource.com/c/go/+/461738
    TryBot-Result: Gopher Robot <gobot@golang.org>
    Reviewed-by: Alex Brainman <alex.brainman@gmail.com>
    Reviewed-by: Than McIntosh <thanm@google.com>
    Run-TryBot: Quim Muntal <quimmuntal@gmail.com>
    Reviewed-by: Cherry Mui <cherryyz@google.com>

 src/cmd/link/internal/ld/asmb.go                 |  4 ++
 src/cmd/link/internal/ld/data.go                 | 39 +++++++++++++++
 src/cmd/link/internal/ld/lib.go                  |  3 +-
 src/cmd/link/internal/ld/pe.go                   | 30 ++++++++++-
 src/cmd/link/internal/ld/seh.go                  | 54 ++++++++++++++++++++
 src/cmd/link/internal/loader/loader.go           | 10 ++++
 src/cmd/link/internal/sym/symkind.go             |  1 +
 src/cmd/link/internal/sym/symkind_string.go      |  5 +-
 src/internal/syscall/windows/syscall_windows.go  |  2 +
 src/internal/syscall/windows/zsyscall_windows.go |  7 +++
 src/runtime/defs_windows_386.go                  |  3 ++
 src/runtime/defs_windows_amd64.go                |  1 +
 src/runtime/defs_windows_arm.go                  |  3 ++
 src/runtime/defs_windows_arm64.go                |  1 +
 src/runtime/export_windows_test.go               | 16 ++++++
 src/runtime/runtime-seh_windows_test.go          | 63 ++++++++++++++++++++++++
 16 files changed, 237 insertions(+), 5 deletions(-)
