commit 5993251c015dfa1e905bdf44bdb41572387edf90
Author: Russ Cox <rsc@golang.org>
Date:   Wed Nov 8 10:58:58 2017 -0500

    cmd/go: implement per-package asmflags, gcflags, ldflags, gccgoflags
    
    It has always been problematic that there was no way to specify
    tool flags that applied only to the build of certain packages;
    it was only to specify flags for all packages being built.
    The usual workaround was to install all dependencies of something,
    then build just that one thing with different flags. Since the
    dependencies appeared to be up-to-date, they were not rebuilt
    with the different flags. The new content-based staleness
    (up-to-date) checks see through this trick, because they detect
    changes in flags. This forces us to address the underlying problem
    of providing a way to specify per-package flags.
    
    The solution is to allow -gcflags=pattern=flags, which means
    that flags apply to packages matching pattern, in addition to the
    usual -gcflags=flags, which is now redefined to apply only to
    the packages named on the command line.
    
    See #22527 for discussion and rationale.
    
    Fixes #22527.
    
    Change-Id: I6716bed69edc324767f707b5bbf3aaa90e8e7302
    Reviewed-on: https://go-review.googlesource.com/76551
    Run-TryBot: Russ Cox <rsc@golang.org>
    Reviewed-by: David Crawshaw <crawshaw@golang.org>

 src/cmd/compile/internal/gc/inl_test.go    |   2 +-
 src/cmd/compile/internal/gc/ssa_test.go    |  42 +--------
 src/cmd/compile/internal/ssa/debug_test.go |   8 +-
 src/cmd/dist/build.go                      |   4 +-
 src/cmd/dist/buildtool.go                  |   3 +
 src/cmd/dist/test.go                       |   2 +-
 src/cmd/go/alldocs.go                      |  43 ++++++---
 src/cmd/go/go_test.go                      |  24 ++++-
 src/cmd/go/internal/cfg/cfg.go             |   1 -
 src/cmd/go/internal/load/flag.go           | 119 +++++++++++++++++++++++++
 src/cmd/go/internal/load/flag_test.go      | 135 +++++++++++++++++++++++++++++
 src/cmd/go/internal/load/pkg.go            |  55 +++++++++---
 src/cmd/go/internal/load/search.go         |  47 ++++++++++
 src/cmd/go/internal/work/action.go         |  18 +++-
 src/cmd/go/internal/work/build.go          |  51 +++++++----
 src/cmd/go/internal/work/exec.go           |  21 +++--
 src/cmd/go/internal/work/gc.go             |  16 ++--
 src/cmd/go/internal/work/gccgo.go          |  12 +--
 src/cmd/go/internal/work/init.go           |  45 ++++------
 src/cmd/internal/goobj/goobj_test.go       |   2 +-
 src/cmd/link/internal/ld/dwarf_test.go     |   2 +-
 src/runtime/crash_test.go                  |   4 +-
 src/runtime/race/output_test.go            |   4 +-
 src/runtime/runtime-gdb_test.go            |   4 +-
 src/runtime/runtime-lldb_test.go           |   2 +-
 test/inline_callers.go                     |   2 +-
 26 files changed, 508 insertions(+), 160 deletions(-)
