commit 04572fa29ba689dcdd098cc6b7f84307bf1e171b
Author: Matthew Dempsky <mdempsky@google.com>
Date:   Fri Jul 2 21:02:30 2021 -0700

    cmd/compile: use BMI1 instructions for GOAMD64=v3 and higher
    
    BMI1 includes four instructions (ANDN, BLSI, BLSMSK, BLSR) that are
    easy to peephole optimize, and which GCC always seems to favor using
    when available and applicable.
    
    Updates #45453.
    
    Change-Id: I0274184057058f5c579e5bc3ea9c414396d3cf46
    Reviewed-on: https://go-review.googlesource.com/c/go/+/351130
    Run-TryBot: Matthew Dempsky <mdempsky@google.com>
    Trust: Matthew Dempsky <mdempsky@google.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Keith Randall <khr@golang.org>

 src/cmd/compile/internal/amd64/ssa.go        |  17 +++
 src/cmd/compile/internal/ssa/gen/AMD64.rules |   7 ++
 src/cmd/compile/internal/ssa/gen/AMD64Ops.go |  10 ++
 src/cmd/compile/internal/ssa/opGen.go        | 122 +++++++++++++++++++
 src/cmd/compile/internal/ssa/rewriteAMD64.go | 175 +++++++++++++++++++++++++++
 test/codegen/bmi.go                          |  47 +++++++
 6 files changed, 378 insertions(+)
