commit d8f0a229b5036e42b7bc5371c32c302cead9b635
Author: Daniel Theophanes <kardianos@gmail.com>
Date:   Fri Jan 24 06:40:49 2020 -0800

    database/sql: prevent Tx statement from committing after rollback
    
    It was possible for a Tx that was aborted for rollback
    asynchronously to execute a query after the rollback had completed
    on the database, which often would auto commit the query outside
    of the transaction.
    
    By W-locking the tx.closemu prior to issuing the rollback
    connection it ensures any Tx query either fails or finishes
    on the Tx, and never after the Tx has rolled back.
    
    Fixes #34775
    Fixes #32942
    
    Change-Id: I017b7932082f2f4ead70bae08b61ed9068ac1d01
    Reviewed-on: https://go-review.googlesource.com/c/go/+/216240
    Reviewed-by: Emmanuel Odeke <emm.odeke@gmail.com>

 src/database/sql/fakedb_test.go | 39 +++++++++++++++++++++--
 src/database/sql/sql.go         | 40 ++++++++++++++++++------
 src/database/sql/sql_test.go    | 69 +++++++++++++++++++++++++++++++++++++++++
 3 files changed, 136 insertions(+), 12 deletions(-)
