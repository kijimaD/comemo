commit 5ec7395afc5756e9334f969fcc8b538c83857634
Author: Michael Anthony Knyszek <mknyszek@google.com>
Date:   Fri Mar 15 22:15:37 2024 +0000

    runtime: push down systemstack requirement for tracer where possible
    
    Currently lots of functions require systemstack because the trace buffer
    might get flushed, but that will already switch to the systemstack for
    the most critical bits (grabbing trace.lock). That means a lot of this
    code is non-preemptible when it doesn't need to be. We've seen this
    cause problems at scale, when dumping very large numbers of stacks at
    once, for example.
    
    Change-Id: I88340091a3c43f0513b5601ef5199c946aa56ed7
    Reviewed-on: https://go-review.googlesource.com/c/go/+/572095
    Auto-Submit: Michael Knyszek <mknyszek@google.com>
    LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
    Reviewed-by: David Chase <drchase@google.com>

 src/runtime/trace2.go       | 20 ++++++++++----------
 src/runtime/trace2cpu.go    | 15 ++++++---------
 src/runtime/trace2stack.go  | 13 +++++--------
 src/runtime/trace2string.go | 25 ++++++++++++-------------
 4 files changed, 33 insertions(+), 40 deletions(-)
