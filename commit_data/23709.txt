commit 7529314ed37fdb94af2a25405edcb26ccb243b8e
Author: Austin Clements <austin@google.com>
Date:   Fri Jun 5 11:07:21 2015 -0400

    runtime: use correct SP when installing stack barriers
    
    Currently the stack barriers are installed at the next frame boundary
    after gp.sched.sp + 1024*2^n for n=0,1,2,... However, when a G is in a
    system call, we set gp.sched.sp to 0, which causes stack barriers to
    be installed at *every* frame. This easily overflows the slice we've
    reserved for storing the stack barrier information, and causes a
    "slice bounds out of range" panic in gcInstallStackBarrier.
    
    Fix this by using gp.syscallsp instead of gp.sched.sp if it's
    non-zero. This is the same logic that gentraceback uses to determine
    the current SP.
    
    Fixes #11049.
    
    Change-Id: Ie40eeee5bec59b7c1aa715a7c17aa63b1f1cf4e8
    Reviewed-on: https://go-review.googlesource.com/10755
    Reviewed-by: Russ Cox <rsc@golang.org>

 src/runtime/mgcmark.go | 13 +++++++++----
 1 file changed, 9 insertions(+), 4 deletions(-)
