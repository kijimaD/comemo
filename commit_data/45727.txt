commit 1c7650aa93bd53b7df0bbb34693fc5a16d9f67af
Author: Tobias Klauser <tklauser@distanz.ch>
Date:   Mon Nov 9 11:25:38 2020 +0100

    internal/poll: use copy_file_range only on Linux kernel >= 5.3
    
    https://man7.org/linux/man-pages/man2/copy_file_range.2.html#VERSIONS states:
    
      A major rework of the kernel implementation occurred in 5.3.  Areas
      of the API that weren't clearly defined were clarified and the API
      bounds are much more strictly checked than on earlier kernels.
      Applications should target the behaviour and requirements of 5.3
      kernels.
    
    Rather than attempting to detect the file system for source and
    destination files (which means two additional statfs syscalls) and skip
    copy_file_range in case of known defects (e.g. CIFS -> CIFS), just
    assume copy_file_range to be broken on kernels < 5.3.
    
    Fixes #42400
    
    Change-Id: I3a531296182c1d6e341772cc9d2be5bf83e52575
    Reviewed-on: https://go-review.googlesource.com/c/go/+/268338
    Trust: Tobias Klauser <tobias.klauser@gmail.com>
    Run-TryBot: Tobias Klauser <tobias.klauser@gmail.com>
    TryBot-Result: Go Bot <gobot@golang.org>
    Reviewed-by: Ian Lance Taylor <iant@golang.org>

 src/internal/poll/copy_file_range_linux.go | 49 ++++++++++++++++++++++++++++--
 1 file changed, 47 insertions(+), 2 deletions(-)
