commit ea2376fcea0be75c856ebd199c0ad0f98192d406
Author: Brad Fitzpatrick <bradfitz@golang.org>
Date:   Fri Jul 22 22:51:05 2016 +0000

    net/http: make Transport.RoundTrip return raw Conn.Read error on peek failure
    
    From at least Go 1.4 to Go 1.6, Transport.RoundTrip would return the
    error value from net.Conn.Read directly when the initial Read (1 byte
    Peek) failed while reading the HTTP response, if a request was
    outstanding. While never a documented or tested promise, Go 1.7 changed the
    behavior (starting at https://golang.org/cl/23160).
    
    This restores the old behavior and adds a test (but no documentation
    promises yet) while keeping the fix for spammy logging reported in #15446.
    
    This looks larger than it is: it just changes errServerClosedConn from
    a variable to a type, where the type preserves the underlying
    net.Conn.Read error, for unwrapping later in Transport.RoundTrip.
    
    Fixes #16465
    
    Change-Id: I6fa018991221e93c0cfe3e4129cb168fbd98bd27
    Reviewed-on: https://go-review.googlesource.com/25153
    Reviewed-by: Andrew Gerrand <adg@golang.org>
    Reviewed-by: Ian Lance Taylor <iant@golang.org>
    Run-TryBot: Brad Fitzpatrick <bradfitz@golang.org>
    TryBot-Result: Gobot Gobot <gobot@golang.org>

 src/net/http/transport.go               | 47 ++++++++++++++++++++++++++++-----
 src/net/http/transport_internal_test.go |  9 +++++--
 src/net/http/transport_test.go          | 39 +++++++++++++++++++++++++++
 3 files changed, 87 insertions(+), 8 deletions(-)
