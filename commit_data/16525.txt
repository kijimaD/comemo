commit 0f4897ae1a99d5c9de78c33c7b0963e71960c678
Author: Dmitriy Vyukov <dvyukov@google.com>
Date:   Mon Jun 10 22:38:58 2013 +0400

    sync: improve race instrumentation of WaitGroup
    Do not synchronize Add(1) with Wait().
    Imitate read on first Add(1) and write on Wait(),
    it allows to catch common misuses of WaitGroup:
    - Add() called in the additional goroutine itself
    - incorrect reuse of WaitGroup with multiple waiters
    
    R=golang-dev, iant
    CC=golang-dev
    https://golang.org/cl/10093044

 src/pkg/runtime/race/testdata/waitgroup_test.go | 128 +++++++++++++++++++++++-
 src/pkg/sync/race.go                            |   8 ++
 src/pkg/sync/race0.go                           |   6 ++
 src/pkg/sync/waitgroup.go                       |  26 ++++-
 4 files changed, 160 insertions(+), 8 deletions(-)
