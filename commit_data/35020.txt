commit 185e6094fd968b35b80e56aad1286c66bb2cc261
Merge: c36033a379 a032f74bf0
Author: Russ Cox <rsc@golang.org>
Date:   Wed Dec 6 00:35:28 2017 -0500

    [dev.boringcrypto] all: merge master (nearly Go 1.10 beta 1) into dev.boringcrypto
    
    This is a git merge of master into dev.boringcrypto.
    
    The branch was previously based on release-branch.go1.9,
    so there are a handful of spurious conflicts that would
    also arise if trying to merge master into release-branch.go1.9
    (which we never do). Those have all been resolved by taking
    the original file from master, discarding any Go 1.9-specific
    edits.
    
    all.bash passes on darwin/amd64, which is to say without
    actually using BoringCrypto.
    
    Go 1.10-related fixes to BoringCrypto itself will be in a followup CL.
    This CL is just the merge.
    
    Change-Id: I4c97711fec0fb86761913dcde28d25c001246c35

 .github/CODE_OF_CONDUCT.md                         |     3 +
 .github/ISSUE_TEMPLATE                             |     5 +-
 .gitignore                                         |     6 +
 api/except.txt                                     |     2 +
 api/next.txt                                       |   641 +
 doc/articles/wiki/final-noclosure.go               |     3 +-
 doc/articles/wiki/final-noerror.go                 |     3 +-
 doc/articles/wiki/final-parsetemplate.go           |     3 +-
 doc/articles/wiki/final-template.go                |     3 +-
 doc/articles/wiki/final-test.patch                 |    63 +-
 doc/articles/wiki/final.go                         |     3 +-
 doc/articles/wiki/http-sample.go                   |     3 +-
 doc/articles/wiki/index.html                       |     8 +-
 doc/articles/wiki/notemplate.go                    |     3 +-
 doc/articles/wiki/part2.go                         |     3 +-
 doc/articles/wiki/part3-errorhandling.go           |     3 +-
 doc/articles/wiki/part3.go                         |     3 +-
 doc/asm.html                                       |     6 +
 doc/contrib.html                                   |     1 +
 doc/contribute.html                                |    33 +-
 doc/debugging_with_gdb.html                        |     4 +-
 doc/devel/release.html                             |    10 +
 doc/diagnostics.html                               |   439 +
 doc/docs.html                                      |    49 +-
 doc/editors.html                                   |     8 +-
 doc/editors/{gogland.png => goland.png}            |   Bin
 doc/effective_go.html                              |     8 +-
 doc/gccgo_install.html                             |    15 +-
 doc/go1.10.html                                    |  1240 +
 doc/go1.9.html                                     |     5 +
 doc/go_faq.html                                    |    47 +
 doc/go_spec.html                                   |   241 +-
 doc/help.html                                      |     9 +-
 doc/install-source.html                            |    13 +-
 doc/install.html                                   |     4 +-
 doc/progs/run.go                                   |     7 -
 misc/cgo/errors/errors_test.go                     |   161 +
 misc/cgo/errors/issue13635.go                      |    24 -
 misc/cgo/errors/{ptr.go => ptr_test.go}            |   198 +-
 misc/cgo/errors/{ => src}/err1.go                  |     0
 misc/cgo/errors/{ => src}/err2.go                  |     0
 misc/cgo/errors/{ => src}/err3.go                  |     0
 misc/cgo/errors/src/err4.go                        |    15 +
 misc/cgo/errors/{ => src}/issue11097a.go           |     0
 misc/cgo/errors/{ => src}/issue11097b.go           |     0
 misc/cgo/errors/{ => src}/issue13129.go            |     2 +-
 misc/cgo/errors/{ => src}/issue13423.go            |     0
 misc/cgo/errors/src/issue13467.go                  |    15 +
 misc/cgo/errors/src/issue13635.go                  |    24 +
 misc/cgo/errors/{ => src}/issue13830.go            |     0
 misc/cgo/errors/{ => src}/issue14669.go            |     0
 misc/cgo/errors/{ => src}/issue16116.go            |     0
 misc/cgo/errors/{ => src}/issue16591.go            |     0
 misc/cgo/errors/{ => src}/issue18452.go            |     4 +-
 misc/cgo/errors/{ => src}/issue18889.go            |     0
 misc/cgo/errors/{ => src}/issue7757.go             |     0
 misc/cgo/errors/{ => src}/issue8442.go             |     0
 misc/cgo/errors/src/long_double_size.go            |    16 +
 misc/cgo/errors/{ => src}/malloc.go                |     0
 misc/cgo/errors/test.bash                          |    75 -
 misc/cgo/life/main.go                              |     5 +-
 misc/cgo/stdio/chain.go                            |     2 +-
 misc/cgo/stdio/fib.go                              |     2 +-
 misc/cgo/stdio/hello.go                            |     2 +-
 misc/cgo/test/cgo_test.go                          |     5 +
 misc/cgo/test/issue18720.go                        |    30 +-
 misc/cgo/test/issue19832.go                        |    16 +
 misc/cgo/test/issue20910.c                         |    19 +
 misc/cgo/test/issue20910.go                        |    19 +
 misc/cgo/test/issue21809.go                        |    45 +
 misc/cgo/test/issue21897.go                        |    56 +
 misc/cgo/test/issue21897b.go                       |    13 +
 misc/cgo/test/issue22958.go                        |    24 +
 misc/cgo/test/issue6907.go                         |    33 +
 misc/cgo/test/issue6907export.go                   |    30 +
 misc/cgo/test/issue6907export_c.c                  |    11 +
 misc/cgo/test/issue7978.go                         |     9 +-
 misc/cgo/testcarchive/carchive_test.go             |    28 +-
 misc/cgo/testcshared/cshared_test.go               |   479 +
 misc/cgo/testcshared/src/p/p.go                    |     1 +
 misc/cgo/testcshared/test.bash                     |   193 -
 misc/cgo/testplugin/src/host/host.go               |    32 +-
 misc/cgo/testplugin/src/issue18584/main.go         |    23 +
 misc/cgo/testplugin/src/issue18584/plugin.go       |    19 +
 misc/cgo/testplugin/src/issue19418/main.go         |    29 +
 .../cgo/testplugin/src/issue19418/plugin.go        |     4 +-
 misc/cgo/testplugin/src/issue19529/plugin.go       |    15 +
 misc/cgo/testplugin/src/issue22175/main.go         |    28 +
 misc/cgo/testplugin/src/issue22175/plugin1.go      |    21 +
 misc/cgo/testplugin/src/issue22175/plugin2.go      |     9 +
 misc/cgo/testplugin/src/issue22295.pkg/main.go     |    28 +
 misc/cgo/testplugin/src/issue22295.pkg/plugin.go   |    16 +
 misc/cgo/testplugin/src/plugin1/plugin1.go         |    20 +-
 misc/cgo/testplugin/src/plugin2/plugin2.go         |    16 +
 misc/cgo/testplugin/test.bash                      |    72 +-
 .../testplugin/{unnamed1.go => unnamed1/main.go}   |     0
 .../testplugin/{unnamed2.go => unnamed2/main.go}   |     0
 misc/cgo/testsanitizers/cc_test.go                 |   441 +
 misc/cgo/testsanitizers/cshared_test.go            |    74 +
 misc/cgo/testsanitizers/msan_test.go               |    55 +
 misc/cgo/testsanitizers/{ => src}/msan.go          |     0
 misc/cgo/testsanitizers/{ => src}/msan2.go         |     0
 misc/cgo/testsanitizers/src/msan2_cmsan.go         |    38 +
 misc/cgo/testsanitizers/{ => src}/msan3.go         |     0
 misc/cgo/testsanitizers/{ => src}/msan4.go         |     0
 misc/cgo/testsanitizers/{ => src}/msan5.go         |     0
 misc/cgo/testsanitizers/{ => src}/msan_fail.go     |     0
 misc/cgo/testsanitizers/{ => src}/msan_shared.go   |     0
 misc/cgo/testsanitizers/{ => src}/tsan.go          |     0
 misc/cgo/testsanitizers/{ => src}/tsan10.go        |     0
 misc/cgo/testsanitizers/{ => src}/tsan11.go        |     0
 misc/cgo/testsanitizers/{ => src}/tsan12.go        |     0
 misc/cgo/testsanitizers/{ => src}/tsan2.go         |     0
 misc/cgo/testsanitizers/{ => src}/tsan3.go         |     0
 misc/cgo/testsanitizers/{ => src}/tsan4.go         |     0
 misc/cgo/testsanitizers/{ => src}/tsan5.go         |     0
 misc/cgo/testsanitizers/{ => src}/tsan6.go         |     0
 misc/cgo/testsanitizers/{ => src}/tsan7.go         |     0
 misc/cgo/testsanitizers/{ => src}/tsan8.go         |     0
 misc/cgo/testsanitizers/{ => src}/tsan9.go         |     0
 misc/cgo/testsanitizers/{ => src}/tsan_shared.go   |     0
 misc/cgo/testsanitizers/test.bash                  |   233 -
 misc/cgo/testsanitizers/tsan_test.go               |    56 +
 misc/cgo/testshared/shared_test.go                 |   139 +-
 misc/cgo/testshared/src/depBase/dep.go             |     2 +-
 misc/cgo/testshared/src/division/division.go       |     2 +-
 misc/cgo/testshared/src/exe/exe.go                 |     2 +-
 misc/cgo/testshared/src/global/main.go             |    71 +
 misc/cgo/testshared/src/globallib/global.go        |    17 +
 misc/ios/go_darwin_arm_exec.go                     |    38 +-
 misc/nacl/testzip.proto                            |    10 +
 misc/swig/stdio/file.go                            |    15 +
 misc/swig/stdio/file_test.go                       |     6 +
 misc/trace/trace_viewer_full.html                  |  9525 +++++
 misc/trace/trace_viewer_lean.html                  |  7758 -----
 src/archive/tar/common.go                          |   608 +-
 src/archive/tar/example_test.go                    |    33 +-
 src/archive/tar/format.go                          |   174 +-
 src/archive/tar/reader.go                          |   825 +-
 src/archive/tar/reader_test.go                     |  1428 +-
 src/archive/tar/{stat_atim.go => stat_actime1.go}  |     0
 .../tar/{stat_atimespec.go => stat_actime2.go}     |     0
 src/archive/tar/stat_unix.go                       |    72 +-
 src/archive/tar/strconv.go                         |   130 +-
 src/archive/tar/strconv_test.go                    |   139 +-
 src/archive/tar/tar_test.go                        |   541 +-
 src/archive/tar/testdata/gnu-long-nul.tar          |   Bin 0 -> 2560 bytes
 src/archive/tar/testdata/gnu-nil-sparse-data.tar   |   Bin 0 -> 2560 bytes
 src/archive/tar/testdata/gnu-nil-sparse-hole.tar   |   Bin 0 -> 1536 bytes
 src/archive/tar/testdata/gnu-not-utf8.tar          |   Bin 0 -> 1536 bytes
 src/archive/tar/testdata/gnu-sparse-big.tar        |   Bin 0 -> 5120 bytes
 src/archive/tar/testdata/gnu-utf8.tar              |   Bin 0 -> 2560 bytes
 src/archive/tar/testdata/invalid-go17.tar          |   Bin 0 -> 1536 bytes
 src/archive/tar/testdata/pax-global-records.tar    |   Bin 0 -> 7168 bytes
 src/archive/tar/testdata/pax-nil-sparse-data.tar   |   Bin 0 -> 4096 bytes
 ...star.issue12594.tar => pax-nil-sparse-hole.tar} |   Bin 3072 -> 3072 bytes
 src/archive/tar/testdata/pax-nul-path.tar          |   Bin 0 -> 2560 bytes
 src/archive/tar/testdata/pax-nul-xattrs.tar        |   Bin 0 -> 2560 bytes
 src/archive/tar/testdata/pax-pos-size-file.tar     |   Bin 2560 -> 2560 bytes
 src/archive/tar/testdata/pax-records.tar           |   Bin 0 -> 2560 bytes
 src/archive/tar/testdata/pax-sparse-big.tar        |   Bin 0 -> 6144 bytes
 src/archive/tar/testdata/trailing-slash.tar        |   Bin 0 -> 2560 bytes
 src/archive/tar/testdata/ustar-file-devs.tar       |   Bin 0 -> 1536 bytes
 src/archive/tar/testdata/writer-big-long.tar       |   Bin 4096 -> 1536 bytes
 src/archive/tar/testdata/writer-big.tar            |   Bin 4096 -> 512 bytes
 src/archive/tar/writer.go                          |   818 +-
 src/archive/tar/writer_test.go                     |   995 +-
 src/archive/zip/reader.go                          |   165 +-
 src/archive/zip/reader_test.go                     |   429 +-
 src/archive/zip/struct.go                          |   104 +-
 src/archive/zip/testdata/time-22738.zip            |   Bin 0 -> 140 bytes
 src/archive/zip/testdata/time-7zip.zip             |   Bin 0 -> 150 bytes
 src/archive/zip/testdata/time-go.zip               |   Bin 0 -> 148 bytes
 src/archive/zip/testdata/time-infozip.zip          |   Bin 0 -> 166 bytes
 src/archive/zip/testdata/time-osx.zip              |   Bin 0 -> 142 bytes
 src/archive/zip/testdata/time-win7.zip             |   Bin 0 -> 114 bytes
 src/archive/zip/testdata/time-winrar.zip           |   Bin 0 -> 150 bytes
 src/archive/zip/testdata/time-winzip.zip           |   Bin 0 -> 150 bytes
 src/archive/zip/testdata/utf8-7zip.zip             |   Bin 0 -> 146 bytes
 src/archive/zip/testdata/utf8-infozip.zip          |   Bin 0 -> 162 bytes
 src/archive/zip/testdata/utf8-osx.zip              |   Bin 0 -> 138 bytes
 src/archive/zip/testdata/utf8-winrar.zip           |   Bin 0 -> 146 bytes
 src/archive/zip/testdata/utf8-winzip.zip           |   Bin 0 -> 146 bytes
 src/archive/zip/writer.go                          |   137 +-
 src/archive/zip/writer_test.go                     |   124 +-
 src/archive/zip/zip_test.go                        |    42 +-
 src/bootstrap.bash                                 |    42 +
 src/bufio/bufio.go                                 |     6 +
 src/bufio/bufio_test.go                            |    18 +
 src/bufio/export_test.go                           |     2 +
 src/bufio/scan.go                                  |     9 +-
 src/builtin/builtin.go                             |     5 +-
 src/bytes/boundary_test.go                         |    84 +
 src/bytes/buffer.go                                |    94 +-
 src/bytes/buffer_test.go                           |   114 +-
 src/bytes/bytes.go                                 |   292 +-
 src/bytes/bytes_amd64.go                           |    42 +-
 src/bytes/bytes_arm64.go                           |    68 +
 src/bytes/bytes_arm64.s                            |    74 +
 src/bytes/bytes_generic.go                         |    40 +-
 src/bytes/bytes_s390x.go                           |    42 +-
 src/bytes/bytes_test.go                            |   133 +-
 src/bytes/equal_test.go                            |    47 -
 src/bytes/example_test.go                          |   141 +
 src/bytes/reader.go                                |     6 +
 src/bytes/reader_test.go                           |     4 +-
 src/cmd/api/goapi.go                               |    14 +-
 src/cmd/api/goapi_test.go                          |     3 +-
 src/cmd/api/run.go                                 |    15 +-
 src/cmd/asm/doc.go                                 |    31 +-
 src/cmd/asm/internal/arch/amd64.go                 |    28 -
 src/cmd/asm/internal/arch/arm.go                   |    10 +
 src/cmd/asm/internal/arch/arm64.go                 |   167 +-
 src/cmd/asm/internal/asm/asm.go                    |   108 +-
 src/cmd/asm/internal/asm/endtoend_test.go          |     5 +-
 src/cmd/asm/internal/asm/parse.go                  |   199 +-
 src/cmd/asm/internal/asm/testdata/amd64enc.s       |  9238 ++---
 src/cmd/asm/internal/asm/testdata/amd64enc_extra.s |   239 +
 src/cmd/asm/internal/asm/testdata/amd64error.s     |    27 +
 src/cmd/asm/internal/asm/testdata/arm.s            |   182 +-
 src/cmd/asm/internal/asm/testdata/arm64.s          |    65 +-
 src/cmd/asm/internal/asm/testdata/arm64enc.s       |    62 +-
 src/cmd/asm/internal/asm/testdata/armerror.s       |   144 +-
 src/cmd/asm/internal/asm/testdata/armv6.s          |    20 +
 src/cmd/asm/internal/asm/testdata/ppc64.s          |    61 +
 src/cmd/asm/internal/asm/testdata/s390x.s          |     8 +
 src/cmd/asm/internal/flags/flags.go                |     2 +
 src/cmd/asm/internal/lex/input.go                  |     3 +-
 src/cmd/asm/main.go                                |     2 +-
 src/cmd/buildid/buildid.go                         |    73 +
 src/cmd/buildid/doc.go                             |    18 +
 src/cmd/cgo/ast.go                                 |   272 +-
 src/cmd/cgo/doc.go                                 |   285 +-
 src/cmd/cgo/gcc.go                                 |   220 +-
 src/cmd/cgo/main.go                                |    21 +-
 src/cmd/cgo/out.go                                 |    88 +-
 src/cmd/compile/fmt_test.go                        |    27 +-
 src/cmd/compile/internal/amd64/ggen.go             |     6 +-
 src/cmd/compile/internal/amd64/ssa.go              |   124 +-
 src/cmd/compile/internal/arm/ssa.go                |    60 +-
 src/cmd/compile/internal/arm64/ggen.go             |     9 +-
 src/cmd/compile/internal/arm64/ssa.go              |   110 +-
 src/cmd/compile/internal/gc/alg.go                 |     4 +-
 src/cmd/compile/internal/gc/align.go               |     2 +
 src/cmd/compile/internal/gc/asm_test.go            |  2134 +-
 src/cmd/compile/internal/gc/bexport.go             |   185 +-
 src/cmd/compile/internal/gc/bimport.go             |   127 +-
 src/cmd/compile/internal/gc/bitset.go              |    10 +
 src/cmd/compile/internal/gc/builtin.go             |   371 +-
 src/cmd/compile/internal/gc/builtin/runtime.go     |    15 +-
 src/cmd/compile/internal/gc/bv.go                  |    40 +-
 src/cmd/compile/internal/gc/closure.go             |    37 +-
 src/cmd/compile/internal/gc/const.go               |    29 +-
 src/cmd/compile/internal/gc/dcl.go                 |   338 +-
 src/cmd/compile/internal/gc/dwinl.go               |   317 +
 src/cmd/compile/internal/gc/esc.go                 |    72 +-
 src/cmd/compile/internal/gc/export.go              |    39 +-
 src/cmd/compile/internal/gc/float_test.go          |   230 +-
 src/cmd/compile/internal/gc/fmt.go                 |    44 +-
 src/cmd/compile/internal/gc/gen.go                 |    18 +-
 src/cmd/compile/internal/gc/go.go                  |    20 +-
 src/cmd/compile/internal/gc/gsubr.go               |    12 +-
 src/cmd/compile/internal/gc/init.go                |     5 +-
 src/cmd/compile/internal/gc/inl.go                 |   441 +-
 src/cmd/compile/internal/gc/inl_test.go            |   215 +
 src/cmd/compile/internal/gc/main.go                |   155 +-
 src/cmd/compile/internal/gc/noder.go               |   240 +-
 src/cmd/compile/internal/gc/obj.go                 |   104 +-
 src/cmd/compile/internal/gc/op_string.go           |    16 +
 src/cmd/compile/internal/gc/opnames.go             |   159 -
 src/cmd/compile/internal/gc/order.go               |    71 +-
 src/cmd/compile/internal/gc/pgen.go                |   628 +-
 src/cmd/compile/internal/gc/phi.go                 |    37 +-
 src/cmd/compile/internal/gc/plive.go               |   148 +-
 src/cmd/compile/internal/gc/racewalk.go            |   124 +-
 src/cmd/compile/internal/gc/range.go               |   197 +-
 src/cmd/compile/internal/gc/reflect.go             |   410 +-
 src/cmd/compile/internal/gc/scope.go               |     2 +-
 src/cmd/compile/internal/gc/scope_test.go          |    13 +
 src/cmd/compile/internal/gc/select.go              |   118 +-
 src/cmd/compile/internal/gc/sinit.go               |    51 +-
 src/cmd/compile/internal/gc/sizeof_test.go         |     2 +-
 src/cmd/compile/internal/gc/ssa.go                 |   821 +-
 src/cmd/compile/internal/gc/ssa_test.go            |    83 +-
 src/cmd/compile/internal/gc/subr.go                |   148 +-
 src/cmd/compile/internal/gc/swt.go                 |    55 +-
 src/cmd/compile/internal/gc/syntax.go              |   222 +-
 src/cmd/compile/internal/gc/testdata/arithConst.go | 21356 ++++++++----
 .../internal/gc/testdata/flowgraph_generator1.go   |   315 +
 .../internal/gc/testdata/gen/arithConstGen.go      |    15 +
 src/cmd/compile/internal/gc/typecheck.go           |   331 +-
 src/cmd/compile/internal/gc/universe.go            |     5 +-
 src/cmd/compile/internal/gc/unsafe.go              |     4 +-
 src/cmd/compile/internal/gc/walk.go                |   646 +-
 src/cmd/compile/internal/mips/galign.go            |     1 +
 src/cmd/compile/internal/mips/ssa.go               |    12 +-
 src/cmd/compile/internal/mips64/ssa.go             |   217 +-
 src/cmd/compile/internal/ppc64/ssa.go              |    71 +-
 src/cmd/compile/internal/s390x/ssa.go              |    50 +-
 src/cmd/compile/internal/ssa/block.go              |    23 +
 src/cmd/compile/internal/ssa/cache.go              |    22 +
 src/cmd/compile/internal/ssa/check.go              |    42 +-
 src/cmd/compile/internal/ssa/compile.go            |     5 +-
 src/cmd/compile/internal/ssa/config.go             |    28 +-
 src/cmd/compile/internal/ssa/copyelim.go           |     2 +-
 src/cmd/compile/internal/ssa/deadstore.go          |    55 +
 src/cmd/compile/internal/ssa/debug.go              |   574 +
 src/cmd/compile/internal/ssa/debug_test.go         |   907 +
 src/cmd/compile/internal/ssa/decompose.go          |   197 +-
 src/cmd/compile/internal/ssa/export_test.go        |    30 +-
 src/cmd/compile/internal/ssa/func.go               |    12 +-
 src/cmd/compile/internal/ssa/gen/386.rules         |     3 +-
 src/cmd/compile/internal/ssa/gen/386Ops.go         |     9 +-
 src/cmd/compile/internal/ssa/gen/AMD64.rules       |   285 +-
 src/cmd/compile/internal/ssa/gen/AMD64Ops.go       |    52 +-
 src/cmd/compile/internal/ssa/gen/ARM.rules         |   270 +-
 src/cmd/compile/internal/ssa/gen/ARM64.rules       |   237 +-
 src/cmd/compile/internal/ssa/gen/ARM64Ops.go       |    26 +-
 src/cmd/compile/internal/ssa/gen/ARMOps.go         |    60 +-
 src/cmd/compile/internal/ssa/gen/MIPS.rules        |     1 +
 src/cmd/compile/internal/ssa/gen/MIPS64.rules      |   141 +-
 src/cmd/compile/internal/ssa/gen/MIPS64Ops.go      |    66 +-
 src/cmd/compile/internal/ssa/gen/MIPSOps.go        |     3 +
 src/cmd/compile/internal/ssa/gen/PPC64.rules       |   262 +-
 src/cmd/compile/internal/ssa/gen/PPC64Ops.go       |    40 +-
 src/cmd/compile/internal/ssa/gen/S390X.rules       |   230 +-
 src/cmd/compile/internal/ssa/gen/S390XOps.go       |    42 +-
 src/cmd/compile/internal/ssa/gen/generic.rules     |   102 +-
 src/cmd/compile/internal/ssa/gen/genericOps.go     |    52 +-
 src/cmd/compile/internal/ssa/gen/main.go           |     7 +-
 src/cmd/compile/internal/ssa/gen/rulegen.go        |    51 +-
 src/cmd/compile/internal/ssa/html.go               |    52 +-
 src/cmd/compile/internal/ssa/likelyadjust.go       |    42 +-
 src/cmd/compile/internal/ssa/location.go           |    48 +-
 src/cmd/compile/internal/ssa/loopreschedchecks.go  |     4 +-
 src/cmd/compile/internal/ssa/looprotate.go         |     5 +-
 src/cmd/compile/internal/ssa/nilcheck.go           |    10 +-
 src/cmd/compile/internal/ssa/op.go                 |     2 +-
 src/cmd/compile/internal/ssa/opGen.go              |  1856 +-
 src/cmd/compile/internal/ssa/opt.go                |     7 -
 src/cmd/compile/internal/ssa/print.go              |     2 +-
 src/cmd/compile/internal/ssa/redblack32.go         |     4 +-
 src/cmd/compile/internal/ssa/regalloc.go           |   179 +-
 src/cmd/compile/internal/ssa/rewrite.go            |    71 +-
 src/cmd/compile/internal/ssa/rewrite386.go         |   149 +-
 src/cmd/compile/internal/ssa/rewriteAMD64.go       |  5210 ++-
 src/cmd/compile/internal/ssa/rewriteARM.go         | 22427 +++++++-----
 src/cmd/compile/internal/ssa/rewriteARM64.go       |  1339 +-
 src/cmd/compile/internal/ssa/rewriteMIPS.go        |    48 +
 src/cmd/compile/internal/ssa/rewriteMIPS64.go      |   550 +-
 src/cmd/compile/internal/ssa/rewritePPC64.go       | 34501 ++++++++++++++++++-
 src/cmd/compile/internal/ssa/rewriteS390X.go       |  3457 +-
 src/cmd/compile/internal/ssa/rewrite_test.go       |    22 +
 src/cmd/compile/internal/ssa/rewritegeneric.go     |  3136 +-
 src/cmd/compile/internal/ssa/sizeof_test.go        |     1 +
 src/cmd/compile/internal/ssa/softfloat.go          |    66 +
 src/cmd/compile/internal/ssa/stackalloc.go         |     8 +-
 .../internal/ssa/testdata/hist.dbg-dlv.nexts       |    99 +
 .../internal/ssa/testdata/hist.dbg-gdb.nexts       |   123 +
 src/cmd/compile/internal/ssa/testdata/hist.go      |    98 +
 .../internal/ssa/testdata/hist.opt-dlv.nexts       |   105 +
 .../internal/ssa/testdata/hist.opt-gdb.nexts       |   182 +
 .../ssa/testdata/i22558.dbg-22558-dlv.nexts        |    11 +
 .../ssa/testdata/i22558.dbg-22558-gdb.nexts        |    11 +
 src/cmd/compile/internal/ssa/testdata/i22558.go    |    43 +
 .../ssa/testdata/i22600.dbg-race-gdb.nexts         |     7 +
 src/cmd/compile/internal/ssa/testdata/i22600.go    |    19 +
 src/cmd/compile/internal/ssa/trim.go               |     6 +-
 src/cmd/compile/internal/ssa/value.go              |    71 +-
 src/cmd/compile/internal/ssa/writebarrier.go       |    60 +-
 src/cmd/compile/internal/syntax/branches.go        |     2 +-
 src/cmd/compile/internal/syntax/parser.go          |   317 +-
 src/cmd/compile/internal/syntax/parser_test.go     |     2 +-
 src/cmd/compile/internal/syntax/tokens.go          |     4 +-
 src/cmd/compile/internal/types/etype_string.go     |    16 +
 src/cmd/compile/internal/types/scope.go            |    61 +-
 src/cmd/compile/internal/types/sym.go              |     5 +-
 src/cmd/compile/internal/types/type.go             |    83 +-
 src/cmd/compile/internal/types/utils.go            |    48 -
 src/cmd/compile/internal/x86/387.go                |     6 +
 src/cmd/compile/internal/x86/ssa.go                |    43 +-
 src/cmd/cover/cover.go                             |   295 +-
 src/cmd/cover/cover_test.go                        |   141 +-
 src/cmd/cover/doc.go                               |     4 +
 src/cmd/cover/func.go                              |     4 +
 src/cmd/cover/testdata/directives.go               |    40 +
 src/cmd/cover/testdata/test.go                     |     2 +-
 src/cmd/dist/build.go                              |   649 +-
 src/cmd/dist/buildgo.go                            |    90 +-
 src/cmd/dist/buildruntime.go                       |    62 +-
 src/cmd/dist/buildtool.go                          |    51 +-
 src/cmd/dist/deps.go                               |    94 -
 src/cmd/dist/doc.go                                |    19 +
 src/cmd/dist/imports.go                            |   245 +
 src/cmd/dist/main.go                               |   214 +-
 src/cmd/dist/mkdeps.bash                           |    47 -
 src/cmd/dist/sys_windows.go                        |     2 +-
 src/cmd/dist/test.go                               |   497 +-
 src/cmd/dist/util.go                               |   225 +-
 src/cmd/doc/doc_test.go                            |    61 +
 src/cmd/doc/main.go                                |    14 +-
 src/cmd/doc/pkg.go                                 |     8 +-
 src/cmd/doc/testdata/pkg.go                        |     5 +
 src/cmd/fix/cftype.go                              |    93 +
 src/cmd/fix/cftype_test.go                         |   185 +
 src/cmd/fix/context.go                             |     2 +-
 src/cmd/fix/typecheck.go                           |    56 +
 src/cmd/go/alldocs.go                              |   147 +-
 src/cmd/go/go_test.go                              |  1256 +-
 src/cmd/go/go_windows_test.go                      |    81 +
 src/cmd/go/internal/base/base.go                   |     4 +-
 src/cmd/go/internal/base/path.go                   |    22 -
 src/cmd/go/internal/base/tool.go                   |    11 +-
 src/cmd/go/internal/cache/cache.go                 |   370 +
 src/cmd/go/internal/cache/cache_test.go            |   198 +
 src/cmd/go/internal/cache/default.go               |   100 +
 src/cmd/go/internal/cache/hash.go                  |   174 +
 src/cmd/go/internal/cache/hash_test.go             |    52 +
 src/cmd/go/internal/cfg/cfg.go                     |    31 +-
 src/cmd/go/internal/clean/clean.go                 |    68 +-
 src/cmd/go/internal/envcmd/env.go                  |    50 +-
 src/cmd/go/internal/fix/fix.go                     |     4 +-
 src/cmd/go/internal/fmtcmd/fmt.go                  |    36 +-
 src/cmd/go/internal/generate/generate.go           |     4 +-
 src/cmd/go/internal/get/get.go                     |    13 +-
 src/cmd/go/internal/get/vcs.go                     |    58 +-
 src/cmd/go/internal/get/vcs_test.go                |    18 +
 src/cmd/go/internal/help/helpdoc.go                |    15 +-
 src/cmd/go/internal/list/list.go                   |    25 +-
 src/cmd/go/internal/load/flag.go                   |   121 +
 src/cmd/go/internal/load/flag_test.go              |   135 +
 src/cmd/go/internal/load/icfg.go                   |    75 +
 src/cmd/go/internal/load/pkg.go                    |   974 +-
 src/cmd/go/internal/load/search.go                 |    49 +-
 src/cmd/go/internal/load/testgo.go                 |    21 -
 src/cmd/go/internal/run/run.go                     |     9 +-
 src/cmd/go/internal/test/cover.go                  |    84 +
 src/cmd/go/internal/test/test.go                   |   756 +-
 src/cmd/go/internal/test/testflag.go               |    39 +-
 src/cmd/go/internal/tool/tool.go                   |     2 +-
 src/cmd/go/internal/vet/vet.go                     |    41 +-
 src/cmd/go/internal/vet/vetflag.go                 |     1 +
 src/cmd/go/internal/work/action.go                 |   747 +
 src/cmd/go/internal/work/build.go                  |  3525 +-
 src/cmd/go/internal/work/build_test.go             |     7 +-
 src/cmd/go/internal/work/buildid.go                |   487 +
 src/cmd/go/internal/work/exec.go                   |  2302 ++
 src/cmd/go/internal/work/gc.go                     |   500 +
 src/cmd/go/internal/work/gccgo.go                  |   497 +
 src/cmd/go/internal/work/init.go                   |   217 +
 src/cmd/go/main.go                                 |     6 +
 src/cmd/go/note_test.go                            |    53 +-
 src/cmd/go/testdata/print_goroot.go                |    11 +
 src/cmd/go/testdata/src/complex/main.go            |    12 +
 .../go/testdata/src/complex/nest/sub/test12/p.go   |    11 +
 .../go/testdata/src/complex/nest/sub/test23/p.go   |    11 +
 .../testdata/src/complex/nest/sub/vendor/v2/v2.go  |     3 +
 .../go/testdata/src/complex/nest/vendor/v1/v1.go   |     3 +
 .../go/testdata/src/complex/nest/vendor/v2/v2.go   |     3 +
 .../go/testdata/src/complex/nest/vendor/v3/v3.go   |     3 +
 src/cmd/go/testdata/src/complex/vendor/v/v.go      |     3 +
 src/cmd/go/testdata/src/complex/w/w.go             |     3 +
 src/cmd/go/testdata/src/coverasm/p.go              |     7 +
 src/cmd/go/testdata/src/coverasm/p.s               |     2 +
 src/cmd/go/testdata/src/coverasm/p_test.go         |     7 +
 src/cmd/go/testdata/src/coverbad/p.go              |     5 +
 src/cmd/go/testdata/src/coverbad/p1.go             |     7 +
 src/cmd/go/testdata/src/coverbad/p_test.go         |     5 +
 src/cmd/go/testdata/src/coverdep/p.go              |     6 +
 src/cmd/go/testdata/src/coverdep/p1/p1.go          |     3 +
 src/cmd/go/testdata/src/coverdep/p_test.go         |     7 +
 src/cmd/go/testdata/src/failfast_test.go           |    54 +
 src/cmd/go/testdata/src/not_main/not_main.go       |     3 +
 src/cmd/go/testdata/src/skipper/skip_test.go       |     7 +
 src/cmd/go/testdata/src/sleepy1/p_test.go          |    10 +
 src/cmd/go/testdata/src/sleepy2/p_test.go          |    10 +
 src/cmd/go/testdata/src/sleepybad/p.go             |     5 +
 src/cmd/go/testdata/src/testrace/race_test.go      |     2 +
 src/cmd/go/testdata/src/vetcycle/p.go              |    12 +
 src/cmd/go/testdata/standalone_main_normal_test.go |    10 +
 src/cmd/go/testdata/standalone_main_wrong_test.go  |    10 +
 src/cmd/{go => }/internal/buildid/buildid.go       |    71 +-
 src/cmd/internal/buildid/buildid_test.go           |   137 +
 src/cmd/{go => }/internal/buildid/note.go          |    18 +-
 src/cmd/internal/buildid/rewrite.go                |    91 +
 src/cmd/internal/buildid/testdata/a.elf            |   Bin 0 -> 12768 bytes
 src/cmd/internal/buildid/testdata/a.macho          |   Bin 0 -> 13472 bytes
 src/cmd/internal/buildid/testdata/a.pe             |   Bin 0 -> 3584 bytes
 src/cmd/internal/buildid/testdata/p.a              |   Bin 0 -> 682 bytes
 src/cmd/internal/dwarf/dwarf.go                    |   863 +-
 src/cmd/internal/edit/edit.go                      |    93 +
 src/cmd/internal/edit/edit_test.go                 |    28 +
 src/cmd/internal/goobj/goobj_test.go               |   318 +
 src/cmd/internal/goobj/read.go                     |   107 +-
 src/cmd/internal/goobj/testdata/go1.go             |    11 +
 src/cmd/internal/goobj/testdata/go2.go             |    11 +
 src/cmd/internal/goobj/testdata/mycgo/c1.c         |     9 +
 src/cmd/internal/goobj/testdata/mycgo/c2.c         |     9 +
 src/cmd/internal/goobj/testdata/mycgo/go.go        |     5 +
 src/cmd/internal/goobj/testdata/mycgo/go1.go       |    11 +
 src/cmd/internal/goobj/testdata/mycgo/go2.go       |    11 +
 src/cmd/internal/obj/arm/a.out.go                  |    31 +-
 src/cmd/internal/obj/arm/anames.go                 |    26 +
 src/cmd/internal/obj/arm/anames5.go                |     1 +
 src/cmd/internal/obj/arm/asm5.go                   |   812 +-
 src/cmd/internal/obj/arm/list5.go                  |    23 +
 src/cmd/internal/obj/arm/obj5.go                   |     2 +-
 src/cmd/internal/obj/arm64/a.out.go                |    48 +-
 src/cmd/internal/obj/arm64/anames.go               |    16 +
 src/cmd/internal/obj/arm64/anames7.go              |     5 +
 src/cmd/internal/obj/arm64/asm7.go                 |   827 +-
 src/cmd/internal/obj/arm64/doc.go                  |   157 +
 src/cmd/internal/obj/arm64/list7.go                |   141 +
 src/cmd/internal/obj/arm64/obj7.go                 |    86 +-
 src/cmd/internal/obj/data.go                       |    20 +-
 src/cmd/internal/obj/go.go                         |     2 +-
 src/cmd/internal/obj/inl.go                        |    30 +-
 src/cmd/internal/obj/line_test.go                  |     2 +-
 src/cmd/internal/obj/link.go                       |   183 +-
 src/cmd/internal/obj/mips/asm0.go                  |     1 +
 src/cmd/internal/obj/objfile.go                    |   411 +-
 src/cmd/internal/obj/pass.go                       |     4 +-
 src/cmd/internal/obj/pcln.go                       |     2 +
 src/cmd/internal/obj/plist.go                      |    22 +-
 src/cmd/internal/obj/ppc64/a.out.go                |    21 +
 src/cmd/internal/obj/ppc64/anames.go               |    21 +
 src/cmd/internal/obj/ppc64/asm9.go                 |   239 +-
 src/cmd/internal/obj/ppc64/obj9.go                 |     2 +-
 src/cmd/internal/obj/s390x/a.out.go                |     9 +
 src/cmd/internal/obj/s390x/anames.go               |     7 +
 src/cmd/internal/obj/s390x/asmz.go                 |    77 +-
 src/cmd/internal/obj/s390x/objz.go                 |    32 +-
 src/cmd/internal/obj/sizeof_test.go                |     2 +-
 src/cmd/internal/obj/sym.go                        |     3 +-
 src/cmd/internal/obj/util.go                       |   113 +-
 src/cmd/internal/obj/x86/a.out.go                  |   919 +-
 src/cmd/internal/obj/x86/aenum.go                  |  1136 +
 src/cmd/internal/obj/x86/anames.go                 |  1329 +-
 src/cmd/internal/obj/x86/asm6.go                   |  1169 +-
 src/cmd/internal/obj/x86/obj6.go                   |    70 +-
 src/cmd/internal/obj/x86/vex_optabs.go             |   382 +
 src/cmd/internal/obj/x86/ytab.go                   |    40 +
 src/cmd/internal/objabi/autotype.go                |     1 +
 src/cmd/internal/objabi/flag.go                    |    73 +-
 src/cmd/internal/objabi/reloctype.go               |    14 +-
 src/cmd/internal/objabi/reloctype_string.go        |     4 +-
 src/cmd/internal/objabi/symkind.go                 |     3 +-
 src/cmd/internal/objabi/symkind_string.go          |     4 +-
 src/cmd/internal/objabi/util.go                    |    10 +
 src/cmd/internal/objfile/disasm.go                 |    54 +-
 src/cmd/internal/objfile/elf.go                    |     6 +-
 src/cmd/internal/objfile/goobj.go                  |    29 +-
 src/cmd/internal/objfile/macho.go                  |     6 +-
 src/cmd/internal/objfile/objfile.go                |    78 +-
 src/cmd/internal/objfile/pe.go                     |    10 +-
 src/cmd/internal/objfile/plan9obj.go               |     4 +-
 src/cmd/internal/src/pos.go                        |    23 +-
 src/cmd/internal/src/pos_test.go                   |    14 +-
 src/cmd/internal/src/xpos_test.go                  |     2 +-
 src/cmd/internal/test2json/test2json.go            |   413 +
 src/cmd/internal/test2json/test2json_test.go       |   277 +
 src/cmd/internal/test2json/testdata/ascii.json     |    10 +
 src/cmd/internal/test2json/testdata/ascii.test     |     7 +
 src/cmd/internal/test2json/testdata/smiley.json    |   182 +
 src/cmd/internal/test2json/testdata/smiley.test    |    97 +
 src/cmd/internal/test2json/testdata/unicode.json   |    10 +
 src/cmd/internal/test2json/testdata/unicode.test   |     7 +
 src/cmd/internal/test2json/testdata/vet.json       |   182 +
 src/cmd/internal/test2json/testdata/vet.test       |    97 +
 src/cmd/link/doc.go                                |     2 +-
 src/cmd/link/internal/amd64/asm.go                 |   362 +-
 src/cmd/link/internal/amd64/obj.go                 |    70 +-
 src/cmd/link/internal/arm/asm.go                   |   365 +-
 src/cmd/link/internal/arm/obj.go                   |    61 +-
 src/cmd/link/internal/arm64/asm.go                 |   236 +-
 src/cmd/link/internal/arm64/obj.go                 |    59 +-
 src/cmd/link/internal/ld/ar.go                     |     9 +-
 src/cmd/link/internal/ld/config.go                 |    94 +-
 src/cmd/link/internal/ld/data.go                   |  1220 +-
 src/cmd/link/internal/ld/deadcode.go               |    75 +-
 src/cmd/link/internal/ld/decodesym.go              |   177 +-
 src/cmd/link/internal/ld/dwarf.go                  |   925 +-
 src/cmd/link/internal/ld/dwarf_test.go             |   421 +-
 src/cmd/link/internal/ld/elf.go                    |  1149 +-
 src/cmd/link/internal/ld/go.go                     |    72 +-
 src/cmd/link/internal/ld/ld.go                     |    64 +-
 src/cmd/link/internal/ld/lib.go                    |   828 +-
 src/cmd/link/internal/ld/link.go                   |   268 +-
 src/cmd/link/internal/ld/macho.go                  |   432 +-
 src/cmd/link/internal/ld/macho_combine_dwarf.go    |    31 +-
 src/cmd/link/internal/ld/main.go                   |    49 +-
 src/cmd/link/internal/ld/nooptcgolink_test.go      |     2 +-
 src/cmd/link/internal/ld/outbuf.go                 |   120 +
 src/cmd/link/internal/ld/pcln.go                   |   155 +-
 src/cmd/link/internal/ld/pe.go                     |  1778 +-
 src/cmd/link/internal/ld/sym.go                    |    24 +-
 src/cmd/link/internal/ld/symtab.go                 |   463 +-
 src/cmd/link/internal/ld/typelink.go               |    11 +-
 src/cmd/link/internal/ld/util.go                   |    17 +-
 src/cmd/link/internal/{ld => loadelf}/ldelf.go     |   588 +-
 src/cmd/link/internal/{ld => loadmacho}/ldmacho.go |   345 +-
 src/cmd/link/internal/{ld => loadpe}/ldpe.go       |   155 +-
 src/cmd/link/internal/mips/asm.go                  |   113 +-
 src/cmd/link/internal/mips/obj.go                  |    72 +-
 src/cmd/link/internal/mips64/asm.go                |   150 +-
 src/cmd/link/internal/mips64/obj.go                |    68 +-
 src/cmd/link/internal/{ld => objfile}/objfile.go   |   153 +-
 src/cmd/link/internal/ppc64/asm.go                 |   437 +-
 src/cmd/link/internal/ppc64/obj.go                 |    76 +-
 src/cmd/link/internal/s390x/asm.go                 |   378 +-
 src/cmd/link/internal/s390x/obj.go                 |    60 +-
 src/cmd/link/internal/sym/attribute.go             |   109 +
 src/cmd/link/internal/sym/library.go               |    22 +
 src/cmd/link/internal/sym/reloc.go                 |   116 +
 src/cmd/link/internal/sym/segment.go               |    58 +
 src/cmd/link/internal/sym/symbol.go                |   382 +
 src/cmd/link/internal/{ld => sym}/symbols.go       |    39 +-
 src/cmd/link/internal/{ld => sym}/symkind.go       |    23 +-
 .../link/internal/{ld => sym}/symkind_string.go    |     6 +-
 src/cmd/link/internal/x86/asm.go                   |   353 +-
 src/cmd/link/internal/x86/obj.go                   |    66 +-
 src/cmd/link/link_test.go                          |    44 +-
 src/cmd/link/main.go                               |    24 +-
 src/cmd/nm/nm.go                                   |    79 +-
 src/cmd/nm/nm_cgo_test.go                          |    24 +-
 src/cmd/nm/nm_test.go                              |   152 +-
 src/cmd/objdump/objdump_test.go                    |    25 +-
 src/cmd/pack/pack.go                               |    12 +-
 src/cmd/pack/pack_test.go                          |    31 +
 src/cmd/test2json/main.go                          |   131 +
 src/cmd/trace/goroutines.go                        |    17 +-
 src/cmd/trace/main.go                              |    32 +-
 src/cmd/trace/pprof.go                             |   108 +-
 src/cmd/trace/trace.go                             |    83 +-
 src/cmd/vendor/github.com/google/pprof/.gitignore  |     8 +
 .../google/pprof/{CONTRIBUTING => CONTRIBUTING.md} |    16 +-
 src/cmd/vendor/github.com/google/pprof/README.md   |    29 +-
 .../google/pprof/doc/developer/profile.proto.md    |     8 +-
 .../vendor/github.com/google/pprof/doc/pprof.md    |    97 +-
 .../github.com/google/pprof/driver/driver.go       |     8 +-
 .../google/pprof/internal/binutils/addr2liner.go   |    19 +-
 .../pprof/internal/binutils/addr2liner_llvm.go     |     5 +
 .../pprof/internal/binutils/addr2liner_nm.go       |    15 +-
 .../google/pprof/internal/binutils/binutils.go     |    80 +-
 .../pprof/internal/binutils/binutils_test.go       |   161 +-
 .../google/pprof/internal/binutils/disasm_test.go  |     4 +-
 .../binutils/testdata/fake-llvm-symbolizer         |    34 +
 .../google/pprof/internal/binutils/testdata/hello  |   Bin 0 -> 9503 bytes
 .../github.com/google/pprof/internal/driver/cli.go |    84 +-
 .../google/pprof/internal/driver/commands.go       |    33 +-
 .../google/pprof/internal/driver/driver.go         |    71 +-
 .../google/pprof/internal/driver/driver_focus.go   |    73 +-
 .../google/pprof/internal/driver/driver_test.go    |   561 +-
 .../google/pprof/internal/driver/fetch.go          |   126 +-
 .../google/pprof/internal/driver/fetch_test.go     |   266 +-
 .../google/pprof/internal/driver/interactive.go    |     3 +-
 .../internal/driver/testdata/cppbench.contention   |    24 +
 .../driver/testdata/cppbench.small.contention      |    19 +
 .../driver/testdata/pprof.contention.cum.files.dot |     6 +-
 ...prof.contention.flat.addresses.dot.focus.ignore |     8 +-
 .../driver/testdata/pprof.cpu.call_tree.callgrind  |    99 +
 .../internal/driver/testdata/pprof.cpu.comments    |     1 +
 .../testdata/pprof.cpu.cum.lines.text.focus.hide   |     8 +
 .../driver/testdata/pprof.cpu.cum.lines.text.hide  |     2 +
 .../driver/testdata/pprof.cpu.cum.lines.text.show  |     2 +
 .../testdata/pprof.cpu.cum.lines.topproto.hide     |     2 +
 .../testdata/pprof.cpu.flat.addresses.disasm       |     6 +-
 .../testdata/pprof.cpu.flat.addresses.weblist      |    69 +-
 .../pprof.cpu.flat.functions.call_tree.dot         |    21 +
 .../driver/testdata/pprof.cpu.flat.functions.dot   |    30 +-
 .../driver/testdata/pprof.cpu.flat.functions.text  |    12 +-
 .../pprof/internal/driver/testdata/pprof.cpu.peek  |    16 +-
 .../pprof/internal/driver/testdata/pprof.cpu.tags  |    20 +-
 .../driver/testdata/pprof.cpu.tags.focus.ignore    |     8 +-
 .../internal/driver/testdata/pprof.cpu.traces      |    32 +-
 .../testdata/pprof.heap.cum.lines.tree.focus       |     2 +
 .../pprof.heap.cum.relative_percentages.tree.focus |    22 +-
 .../testdata/pprof.heap.flat.files.text.focus      |     8 +
 .../testdata/pprof.heap.flat.inuse_objects.text    |    12 +-
 .../testdata/pprof.heap.flat.inuse_space.dot.focus |    18 +-
 .../pprof.heap.flat.inuse_space.dot.focus.ignore   |    22 +-
 .../testdata/pprof.heap.flat.lines.dot.focus       |    18 +-
 .../pprof/internal/driver/testdata/pprof.heap.tags |    10 +-
 .../internal/driver/testdata/pprof.heap.tags.unit  |    10 +-
 .../pprof.heap_alloc.flat.alloc_objects.text       |    12 +-
 .../testdata/pprof.heap_alloc.flat.alloc_space.dot |    14 +
 .../pprof.heap_alloc.flat.alloc_space.dot.focus    |    26 +-
 .../pprof.heap_alloc.flat.alloc_space.dot.hide     |    12 +-
 .../driver/testdata/pprof.heap_request.tags.focus  |     8 +
 .../driver/testdata/pprof.heap_sizetags.dot        |    30 +
 .../driver/testdata/pprof.heap_tags.traces         |    32 +
 .../pprof.unknown.flat.functions.call_tree.text    |     8 +
 .../testdata/pprof.unknown.flat.functions.text     |     8 -
 .../google/pprof/internal/driver/webhtml.go        |   965 +
 .../google/pprof/internal/driver/webui.go          |   393 +
 .../google/pprof/internal/driver/webui_test.go     |   243 +
 .../google/pprof/internal/elfexec/elfexec.go       |    25 +-
 .../google/pprof/internal/elfexec/elfexec_test.go  |     3 +-
 .../google/pprof/internal/graph/dotgraph.go        |    59 +-
 .../google/pprof/internal/graph/dotgraph_test.go   |   123 +-
 .../google/pprof/internal/graph/graph.go           |    41 +-
 .../google/pprof/internal/graph/graph_test.go      |     4 +-
 .../pprof/internal/graph/testdata/compose1.dot     |     6 +-
 .../pprof/internal/graph/testdata/compose2.dot     |     6 +-
 .../pprof/internal/graph/testdata/compose3.dot     |    10 +-
 .../pprof/internal/graph/testdata/compose4.dot     |     2 +-
 .../pprof/internal/graph/testdata/compose5.dot     |    10 +-
 .../pprof/internal/graph/testdata/compose6.dot     |     7 +
 .../pprof/internal/measurement/measurement.go      |    22 +-
 .../pprof/internal/measurement/measurement_test.go |    47 +
 .../google/pprof/internal/plugin/plugin.go         |    25 +
 .../google/pprof/internal/proftest/proftest.go     |    26 +-
 .../google/pprof/internal/report/report.go         |   246 +-
 .../google/pprof/internal/report/report_test.go    |    21 +
 .../google/pprof/internal/report/source.go         |   247 +-
 .../google/pprof/internal/report/source_html.go    |    41 +-
 .../google/pprof/internal/report/source_test.go    |    89 +
 .../pprof/internal/report/testdata/README.md       |    10 +
 .../pprof/internal/report/testdata/sample.bin      |   Bin 0 -> 2342380 bytes
 .../pprof/internal/report/testdata/sample.cpu      |   Bin 0 -> 1836 bytes
 .../internal/report/testdata/sample/sample.go      |    41 +
 .../pprof/internal/report/testdata/source.dot      |    14 +-
 .../google/pprof/internal/symbolizer/symbolizer.go |    57 +-
 .../pprof/internal/symbolizer/symbolizer_test.go   |    70 +-
 .../google/pprof/internal/symbolz/symbolz.go       |    28 +-
 .../google/pprof/internal/symbolz/symbolz_test.go  |    98 +-
 .../github.com/google/pprof/profile/encode.go      |    40 +-
 .../github.com/google/pprof/profile/filter.go      |     3 +-
 .../google/pprof/profile/legacy_java_profile.go    |     5 +-
 .../github.com/google/pprof/profile/merge.go       |    43 +-
 .../github.com/google/pprof/profile/profile.go     |   293 +-
 .../google/pprof/profile/profile_test.go           |   557 +-
 .../github.com/google/pprof/profile/proto.go       |    14 +-
 .../github.com/google/pprof/profile/proto_test.go  |    19 +-
 .../github.com/google/pprof/profile/prune.go       |    47 +-
 .../github.com/google/pprof/profile/prune_test.go  |    91 +
 .../github.com/google/pprof/proto/profile.proto    |     9 +
 src/cmd/vendor/github.com/google/pprof/test.sh     |    19 +
 .../vendor/golang.org/x/arch/arm/armasm/decode.go  |     8 +-
 .../golang.org/x/arch/arm/armasm/ext_test.go       |     2 +-
 .../vendor/golang.org/x/arch/arm/armasm/inst.go    |     2 +-
 .../vendor/golang.org/x/arch/arm/armasm/plan9x.go  |    77 +-
 .../vendor/golang.org/x/arch/arm/armasm/tables.go  |   104 +
 .../x/arch/arm/armasm/testdata/decode.txt          |  1250 +
 .../vendor/golang.org/x/arch/arm64/arm64asm/arg.go |   494 +
 .../golang.org/x/arch/arm64/arm64asm/condition.go  |   329 +
 .../x/arch/arm64/arm64asm/condition_util.go        |    81 +
 .../golang.org/x/arch/arm64/arm64asm/decode.go     |  2768 ++
 .../x/arch/arm64/arm64asm/decode_test.go           |    78 +
 .../golang.org/x/arch/arm64/arm64asm/ext_test.go   |   601 +
 .../vendor/golang.org/x/arch/arm64/arm64asm/gnu.go |    35 +
 .../golang.org/x/arch/arm64/arm64asm/inst.go       |   963 +
 .../golang.org/x/arch/arm64/arm64asm/inst.json     |  1219 +
 .../x/arch/arm64/arm64asm/objdump_test.go          |   145 +
 .../x/arch/arm64/arm64asm/objdumpext_test.go       |   291 +
 .../golang.org/x/arch/arm64/arm64asm/plan9x.go     |   611 +
 .../golang.org/x/arch/arm64/arm64asm/tables.go     |  3366 ++
 .../x/arch/arm64/arm64asm/testdata/Makefile        |     7 +
 .../x/arch/arm64/arm64asm/testdata/cases.txt       |  9203 +++++
 .../golang.org/x/arch/ppc64/ppc64asm/ext_test.go   |     2 +-
 .../golang.org/x/arch/x86/x86asm/decode_test.go    |     4 +-
 .../golang.org/x/arch/x86/x86asm/ext_test.go       |     6 +-
 .../golang.org/x/arch/x86/x86asm/format_test.go    |    68 +
 src/cmd/vendor/golang.org/x/arch/x86/x86asm/gnu.go |    36 +-
 .../vendor/golang.org/x/arch/x86/x86asm/intel.go   |    40 +-
 .../vendor/golang.org/x/arch/x86/x86asm/plan9x.go  |    35 +-
 src/cmd/vendor/vendor.json                         |     4 +-
 src/cmd/vet/README                                 |     4 +-
 src/cmd/vet/all/whitelist/386.txt                  |    10 +-
 src/cmd/vet/all/whitelist/all.txt                  |     8 +-
 src/cmd/vet/all/whitelist/amd64.txt                |     3 +-
 src/cmd/vet/all/whitelist/arm.txt                  |     5 -
 src/cmd/vet/all/whitelist/arm64.txt                |     6 -
 src/cmd/vet/all/whitelist/darwin_arm64.txt         |     6 -
 src/cmd/vet/all/whitelist/mips64x.txt              |     2 -
 src/cmd/vet/all/whitelist/mipsx.txt                |     2 -
 src/cmd/vet/all/whitelist/nacl_amd64p32.txt        |     2 -
 src/cmd/vet/all/whitelist/s390x.txt                |     2 -
 src/cmd/vet/all/whitelist/windows.txt              |     2 -
 src/cmd/vet/asmdecl.go                             |     2 +-
 src/cmd/vet/assign.go                              |     3 +
 src/cmd/vet/buildtag.go                            |     4 +-
 src/cmd/vet/cgo.go                                 |     7 +-
 src/cmd/vet/copylock.go                            |    13 +-
 src/cmd/vet/dead.go                                |     2 +-
 src/cmd/vet/doc.go                                 |    27 +-
 src/cmd/vet/httpresponse.go                        |    10 +-
 src/cmd/vet/main.go                                |   113 +-
 src/cmd/vet/method.go                              |     2 +-
 src/cmd/vet/print.go                               |   153 +-
 src/cmd/vet/rangeloop.go                           |    61 +-
 src/cmd/vet/structtag.go                           |    47 +-
 src/cmd/vet/testdata/assign.go                     |    15 +-
 src/cmd/vet/testdata/cgo/cgo2.go                   |     3 +
 src/cmd/vet/testdata/cgo/cgo4.go                   |    15 +
 src/cmd/vet/testdata/copylock.go                   |    22 +-
 src/cmd/vet/testdata/copylock_func.go              |     6 +-
 src/cmd/vet/testdata/print.go                      |   256 +-
 src/cmd/vet/testdata/rangeloop.go                  |    38 +-
 src/cmd/vet/testdata/shift.go                      |     7 +-
 src/cmd/vet/testdata/structtag.go                  |    20 +
 src/cmd/vet/tests.go                               |     2 +-
 src/cmd/vet/types.go                               |    54 +-
 src/cmd/vet/unused.go                              |     2 +-
 src/compress/bzip2/bzip2.go                        |     2 +-
 src/compress/bzip2/bzip2_test.go                   |     8 +
 src/compress/flate/huffman_bit_writer.go           |     8 -
 src/compress/gzip/gunzip.go                        |     2 +-
 src/container/heap/heap_test.go                    |     1 +
 src/container/ring/example_test.go                 |   193 +
 src/context/benchmark_test.go                      |    56 +-
 src/context/context.go                             |    14 +-
 src/context/example_test.go                        |     2 +-
 src/crypto/aes/asm_s390x.s                         |    62 +
 src/crypto/aes/ctr_s390x.go                        |     4 +
 src/crypto/aes/gcm_amd64.s                         |    83 +-
 src/crypto/aes/gcm_s390x.go                        |   100 +-
 src/crypto/cipher/benchmark_test.go                |    19 +
 src/crypto/cipher/cipher.go                        |    23 +-
 src/crypto/cipher/example_test.go                  |    76 +-
 src/crypto/cipher/gcm.go                           |     4 +-
 src/crypto/cipher/io.go                            |     6 +-
 src/crypto/cipher/ofb.go                           |     2 +-
 src/crypto/cipher/xor.go                           |     9 +-
 src/crypto/dsa/dsa.go                              |     2 +-
 src/crypto/ecdsa/ecdsa.go                          |    19 +-
 src/crypto/ecdsa/ecdsa_test.go                     |    58 +-
 src/crypto/elliptic/elliptic.go                    |    11 +-
 src/crypto/elliptic/elliptic_test.go               |   129 +-
 src/crypto/elliptic/p256_amd64.go                  |    64 +-
 src/crypto/elliptic/p256_asm_amd64.s               |    62 +-
 src/crypto/elliptic/p256_asm_s390x.s               |    41 +-
 src/crypto/elliptic/p256_s390x.go                  |    49 +-
 src/crypto/hmac/hmac.go                            |     3 +
 src/crypto/issue21104_test.go                      |    61 +
 src/crypto/md5/md5.go                              |    77 +-
 src/crypto/md5/md5_test.go                         |   101 +-
 src/crypto/rand/rand_linux.go                      |    25 +-
 src/crypto/rand/rand_linux_test.go                 |    42 +
 src/crypto/rc4/rc4.go                              |     3 +-
 src/crypto/rc4/rc4_asm.go                          |     4 +-
 src/crypto/rc4/rc4_ref.go                          |     2 +-
 src/crypto/rsa/pss.go                              |     2 +-
 src/crypto/rsa/rsa.go                              |    19 +-
 src/crypto/sha1/sha1.go                            |   103 +-
 src/crypto/sha1/sha1_test.go                       |   105 +-
 src/crypto/sha1/sha1block_amd64.s                  |     4 +-
 src/crypto/sha1/sha1block_arm64.go                 |    28 +
 src/crypto/sha1/sha1block_arm64.s                  |   152 +
 src/crypto/sha1/sha1block_generic.go               |     2 +-
 src/crypto/sha256/sha256.go                        |    91 +-
 src/crypto/sha256/sha256_test.go                   |   191 +-
 src/crypto/sha256/sha256block_amd64.s              |    20 +-
 src/crypto/sha256/sha256block_arm64.go             |    23 +
 src/crypto/sha256/sha256block_arm64.s              |   119 +
 src/crypto/sha256/sha256block_generic.go           |     2 +-
 src/crypto/sha512/sha512.go                        |    91 +
 src/crypto/sha512/sha512_test.go                   |   790 +-
 src/crypto/sha512/sha512block_amd64.s              |    16 +-
 src/crypto/subtle/constant_time.go                 |    16 +-
 src/crypto/subtle/constant_time_test.go            |    32 +
 src/crypto/tls/boring.go                           |     6 +-
 src/crypto/tls/boring_test.go                      |    31 +-
 src/crypto/tls/common.go                           |    67 +-
 src/crypto/tls/conn.go                             |    28 +-
 src/crypto/tls/conn_test.go                        |    12 +
 src/crypto/tls/handshake_client.go                 |   180 +-
 src/crypto/tls/handshake_client_test.go            |    37 +-
 src/crypto/tls/handshake_messages.go               |    71 +-
 src/crypto/tls/handshake_messages_test.go          |    12 +-
 src/crypto/tls/handshake_server.go                 |    32 +-
 src/crypto/tls/handshake_server_test.go            |    87 +
 src/crypto/tls/handshake_test.go                   |     8 +-
 src/crypto/tls/key_agreement.go                    |    63 +-
 src/crypto/tls/prf.go                              |    46 +-
 .../testdata/Client-TLSv10-ClientCert-ECDSA-ECDSA  |    94 +-
 .../testdata/Client-TLSv10-ClientCert-ECDSA-RSA    |    90 +-
 .../testdata/Client-TLSv10-ClientCert-RSA-ECDSA    |    92 +-
 .../tls/testdata/Client-TLSv10-ClientCert-RSA-RSA  |    90 +-
 .../tls/testdata/Client-TLSv10-ECDHE-ECDSA-AES     |    76 +-
 .../tls/testdata/Client-TLSv10-ECDHE-RSA-AES       |    72 +-
 src/crypto/tls/testdata/Client-TLSv10-RSA-RC4      |    40 +-
 .../tls/testdata/Client-TLSv11-ECDHE-ECDSA-AES     |    74 +-
 .../tls/testdata/Client-TLSv11-ECDHE-RSA-AES       |    72 +-
 src/crypto/tls/testdata/Client-TLSv11-RSA-RC4      |    40 +-
 .../tls/testdata/Client-TLSv12-AES128-GCM-SHA256   |    44 +-
 .../tls/testdata/Client-TLSv12-AES128-SHA256       |    58 +-
 .../tls/testdata/Client-TLSv12-AES256-GCM-SHA384   |    44 +-
 src/crypto/tls/testdata/Client-TLSv12-ALPN         |    63 +-
 .../testdata/Client-TLSv12-ClientCert-ECDSA-ECDSA  |    96 +-
 .../testdata/Client-TLSv12-ClientCert-ECDSA-RSA    |    88 +-
 .../Client-TLSv12-ClientCert-RSA-AES256-GCM-SHA384 |    84 +-
 .../testdata/Client-TLSv12-ClientCert-RSA-ECDSA    |   100 +-
 .../tls/testdata/Client-TLSv12-ClientCert-RSA-RSA  |    84 +-
 .../tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES     |    74 +-
 .../tls/testdata/Client-TLSv12-ECDHE-ECDSA-AES-GCM |    68 +-
 .../Client-TLSv12-ECDHE-ECDSA-AES128-SHA256        |    84 +-
 .../Client-TLSv12-ECDHE-ECDSA-AES256-GCM-SHA384    |    68 +-
 .../Client-TLSv12-ECDHE-ECDSA-CHACHA20-POLY1305    |    64 +-
 .../tls/testdata/Client-TLSv12-ECDHE-RSA-AES       |    72 +-
 .../testdata/Client-TLSv12-ECDHE-RSA-AES128-SHA256 |    80 +-
 .../Client-TLSv12-ECDHE-RSA-CHACHA20-POLY1305      |    60 +-
 src/crypto/tls/testdata/Client-TLSv12-RSA-RC4      |    40 +-
 .../tls/testdata/Client-TLSv12-RenegotiateOnce     |   292 +-
 .../tls/testdata/Client-TLSv12-RenegotiateTwice    |   522 +-
 .../Client-TLSv12-RenegotiateTwiceRejected         |   298 +-
 .../testdata/Client-TLSv12-RenegotiationRejected   |    68 +-
 src/crypto/tls/testdata/Client-TLSv12-SCT          |    62 +-
 .../Client-TLSv12-X25519-ECDHE-RSA-AES-GCM         |    65 +-
 src/crypto/tls/testdata/Server-TLSv12-ALPN         |    64 +-
 src/crypto/tls/testdata/Server-TLSv12-ALPN-NoMatch |    64 +-
 .../Server-TLSv12-CipherSuiteCertPreferenceECDSA   |    66 +-
 .../Server-TLSv12-CipherSuiteCertPreferenceRSA     |    60 +-
 .../Server-TLSv12-ClientAuthRequestedAndECDSAGiven |    76 +-
 .../Server-TLSv12-ClientAuthRequestedAndGiven      |    78 +-
 .../Server-TLSv12-ClientAuthRequestedNotGiven      |    60 +-
 .../tls/testdata/Server-TLSv12-ECDHE-ECDSA-AES     |    62 +-
 src/crypto/tls/testdata/Server-TLSv12-RSA-AES-GCM  |    50 +-
 .../testdata/Server-TLSv12-RSA-AES256-GCM-SHA384   |    50 +-
 .../Server-TLSv12-X25519-ECDHE-RSA-AES-GCM         |    50 +-
 src/crypto/tls/tls_test.go                         |    52 +
 src/crypto/x509/name_constraints_test.go           |  2002 ++
 src/crypto/x509/pkcs1.go                           |    33 +
 src/crypto/x509/pkcs8.go                           |    47 +
 src/crypto/x509/pkcs8_test.go                      |    95 +-
 src/crypto/x509/pkix/pkix.go                       |    81 +-
 src/crypto/x509/root_cgo_darwin.go                 |     6 +-
 src/crypto/x509/root_windows.go                    |     4 +-
 src/crypto/x509/sec1.go                            |     6 +
 src/crypto/x509/sec1_test.go                       |     2 +-
 src/crypto/x509/verify.go                          |   699 +-
 src/crypto/x509/verify_test.go                     |    35 +-
 src/crypto/x509/x509.go                            |   629 +-
 src/crypto/x509/x509_test.go                       |   480 +-
 src/database/sql/convert.go                        |    32 +-
 src/database/sql/convert_test.go                   |    15 +-
 src/database/sql/ctxutil.go                        |    19 +-
 src/database/sql/driver/driver.go                  |    87 +-
 src/database/sql/fakedb_test.go                    |    72 +
 src/database/sql/sql.go                            |   299 +-
 src/database/sql/sql_test.go                       |   244 +-
 src/debug/dwarf/entry.go                           |     4 +-
 src/debug/dwarf/entry_test.go                      |    60 +
 src/debug/dwarf/open.go                            |    17 +-
 src/debug/dwarf/type.go                            |    77 +-
 src/debug/dwarf/typeunit.go                        |    11 +-
 src/debug/dwarf/unit.go                            |    11 +-
 src/debug/elf/elf.go                               |   756 +-
 src/debug/elf/file.go                              |    19 +-
 src/debug/elf/reader.go                            |     6 +-
 src/debug/gosym/symtab.go                          |     9 +-
 src/debug/macho/file.go                            |   109 +-
 src/debug/macho/file_test.go                       |   303 +-
 src/debug/macho/macho.go                           |   233 +-
 src/debug/macho/reloctype.go                       |    72 +
 src/debug/macho/reloctype_string.go                |    49 +
 .../testdata/clang-386-darwin-exec-with-rpath      |   Bin 0 -> 8416 bytes
 src/debug/macho/testdata/clang-386-darwin.obj      |   Bin 0 -> 464 bytes
 .../testdata/clang-amd64-darwin-exec-with-rpath    |   Bin 0 -> 8432 bytes
 src/debug/macho/testdata/clang-amd64-darwin.obj    |   Bin 0 -> 768 bytes
 src/encoding/asn1/asn1.go                          |   109 +-
 src/encoding/asn1/asn1_test.go                     |    63 +-
 src/encoding/asn1/common.go                        |    33 +-
 src/encoding/asn1/marshal.go                       |    71 +-
 src/encoding/asn1/marshal_test.go                  |    46 +
 src/encoding/base32/base32.go                      |    15 +-
 src/encoding/base64/base64.go                      |   314 +-
 src/encoding/base64/base64_test.go                 |     5 +-
 src/encoding/binary/binary_test.go                 |    30 +-
 src/encoding/binary/example_test.go                |    26 +
 src/encoding/csv/reader.go                         |   437 +-
 src/encoding/csv/reader_test.go                    |   409 +-
 src/encoding/csv/writer.go                         |     6 +-
 src/encoding/gob/codec_test.go                     |     1 +
 src/encoding/gob/debug.go                          |     2 +-
 src/encoding/gob/decoder.go                        |     8 +-
 src/encoding/gob/doc.go                            |     2 +-
 src/encoding/hex/hex.go                            |   118 +-
 src/encoding/hex/hex_test.go                       |    96 +-
 src/encoding/json/bench_test.go                    |    15 +
 src/encoding/json/decode.go                        |    39 +-
 src/encoding/json/decode_test.go                   |   151 +-
 src/encoding/json/encode.go                        |    47 +-
 src/encoding/json/encode_test.go                   |    18 +-
 src/encoding/json/example_test.go                  |    47 +-
 src/encoding/json/stream.go                        |    52 +-
 src/encoding/json/stream_test.go                   |    21 +-
 src/encoding/pem/example_test.go                   |    21 +
 src/encoding/pem/pem.go                            |    27 +-
 src/encoding/pem/pem_test.go                       |    14 +
 src/encoding/xml/atom_test.go                      |     6 +-
 src/encoding/xml/marshal.go                        |     9 +-
 src/encoding/xml/marshal_test.go                   |     4 +-
 src/encoding/xml/read.go                           |    85 +-
 src/encoding/xml/read_test.go                      |   183 +-
 src/encoding/xml/typeinfo.go                       |    10 +-
 src/encoding/xml/xml.go                            |   118 +-
 src/encoding/xml/xml_test.go                       |    93 +-
 src/flag/export_test.go                            |     2 +
 src/flag/flag.go                                   |    67 +-
 src/flag/flag_test.go                              |    56 +
 src/fmt/doc.go                                     |     5 +-
 src/fmt/example_test.go                            |    29 +
 src/fmt/fmt_test.go                                |    30 +-
 src/fmt/print.go                                   |    16 +-
 src/fmt/scan.go                                    |    34 +-
 src/go/ast/ast.go                                  |     4 +-
 src/go/ast/import.go                               |    48 +-
 src/go/build/build.go                              |    42 +-
 src/go/build/build_test.go                         |    13 +
 src/go/build/deps_test.go                          |    20 +-
 src/go/build/doc.go                                |     1 +
 src/go/constant/value.go                           |     2 +-
 src/go/doc/example.go                              |    11 +-
 src/go/doc/exports.go                              |     2 +-
 src/go/doc/reader.go                               |    25 +-
 src/go/doc/testdata/blank.0.golden                 |    15 +-
 src/go/doc/testdata/blank.1.golden                 |    24 +-
 src/go/doc/testdata/blank.2.golden                 |    15 +-
 src/go/doc/testdata/blank.go                       |    10 +-
 src/go/doc/testdata/issue16153.0.golden            |    32 +
 src/go/doc/testdata/issue16153.1.golden            |    34 +
 src/go/doc/testdata/issue16153.2.golden            |    32 +
 src/go/doc/testdata/issue16153.go                  |    27 +
 src/go/doc/testdata/issue18063.0.golden            |    45 +
 src/go/doc/testdata/issue18063.1.golden            |    45 +
 src/go/doc/testdata/issue18063.2.golden            |    45 +
 src/go/doc/testdata/issue18063.go                  |    33 +
 src/go/format/format.go                            |     8 +-
 src/go/importer/importer.go                        |    38 +-
 src/go/importer/importer_test.go                   |    68 +
 .../gccgoimporter/gccgoinstallation_test.go        |     5 +-
 src/go/internal/gccgoimporter/importer.go          |    52 +-
 src/go/internal/gccgoimporter/importer_test.go     |     3 +-
 src/go/internal/gccgoimporter/parser_test.go       |     5 +
 src/go/internal/gcimporter/bimport.go              |     2 +-
 src/go/internal/gcimporter/gcimporter.go           |    65 +-
 src/go/internal/gcimporter/gcimporter_test.go      |    16 +-
 src/go/internal/srcimporter/srcimporter.go         |    28 +-
 src/go/internal/srcimporter/srcimporter_test.go    |    14 +
 .../srcimporter/testdata/issue20855/issue20855.go  |     7 +
 src/go/printer/nodes.go                            |    72 +-
 src/go/printer/testdata/comments.golden            |    28 +
 src/go/printer/testdata/comments.input             |    28 +
 src/go/printer/testdata/expressions.golden         |    49 +-
 src/go/printer/testdata/expressions.input          |    40 +-
 src/go/printer/testdata/expressions.raw            |    49 +-
 src/go/types/api.go                                |    30 +-
 src/go/types/api_test.go                           |    81 +-
 src/go/types/builtins.go                           |     7 +-
 src/go/types/call.go                               |    67 +-
 src/go/types/check_test.go                         |     1 +
 src/go/types/conversions.go                        |    17 +-
 src/go/types/expr.go                               |    37 +-
 src/go/types/exprstring.go                         |    12 +-
 src/go/types/hilbert_test.go                       |     2 +
 src/go/types/issues_test.go                        |    22 +
 src/go/types/methodset.go                          |    12 +-
 src/go/types/object.go                             |    38 +-
 src/go/types/object_test.go                        |    12 +-
 src/go/types/predicates.go                         |     6 +-
 src/go/types/resolver.go                           |     8 +-
 src/go/types/scope.go                              |     3 +-
 src/go/types/stdlib_test.go                        |    20 +-
 src/go/types/stmt.go                               |    37 +-
 src/go/types/testdata/cycles4.src                  |    12 +
 src/go/types/testdata/decls5.src                   |    10 +
 src/go/types/testdata/shifts.src                   |     9 +
 src/go/types/testdata/vardecl.src                  |     7 +
 src/go/types/type.go                               |    20 +-
 src/go/types/typestring.go                         |    10 +
 src/go/types/typestring_test.go                    |    20 +
 src/go/types/typexpr.go                            |    10 +-
 src/hash/adler32/adler32.go                        |    50 +-
 src/hash/adler32/adler32_test.go                   |   125 +-
 src/hash/crc32/crc32.go                            |    71 +-
 src/hash/crc32/crc32_arm64.go                      |     5 +-
 src/hash/crc32/crc32_arm64.s                       |     6 -
 src/hash/crc32/crc32_test.go                       |   150 +-
 src/hash/crc64/crc64.go                            |    72 +-
 src/hash/crc64/crc64_test.go                       |   154 +-
 src/hash/example_test.go                           |    51 +
 src/hash/fnv/fnv.go                                |   165 +
 src/hash/fnv/fnv_test.go                           |   113 +-
 src/hash/hash.go                                   |    15 +
 src/html/entity.go                                 |     2 +-
 src/html/template/escape_test.go                   |    21 +-
 src/html/template/template.go                      |     5 +
 src/html/template/url.go                           |    22 +-
 src/image/color/color.go                           |    33 +-
 src/image/color/color_test.go                      |    47 +
 src/image/draw/draw.go                             |    24 +-
 src/image/draw/draw_test.go                        |    45 +
 src/image/gif/reader.go                            |   339 +-
 src/image/gif/reader_test.go                       |    58 +
 src/image/gif/writer.go                            |   144 +-
 src/image/gif/writer_test.go                       |    42 +-
 src/image/jpeg/reader_test.go                      |     4 +-
 src/image/jpeg/writer_test.go                      |     8 +-
 src/image/png/reader.go                            |     6 +
 src/image/png/reader_test.go                       |    29 +-
 src/image/png/writer_test.go                       |    28 +-
 src/internal/cpu/cpu.go                            |    47 +-
 src/internal/cpu/cpu_arm64.go                      |    40 +-
 src/internal/cpu/cpu_ppc64x.go                     |    54 +
 src/internal/cpu/cpu_test.go                       |    23 +
 src/internal/cpu/cpu_x86.go                        |     8 +-
 src/internal/poll/fd.go                            |     4 +
 src/internal/poll/fd_poll_runtime.go               |     4 +-
 src/internal/poll/fd_unix.go                       |    26 +-
 src/internal/poll/fd_windows.go                    |   102 +-
 src/internal/poll/sendfile_windows.go              |     9 +
 src/internal/poll/sockoptip.go                     |     2 +-
 src/internal/syscall/windows/exec_windows_test.go  |   152 +
 src/internal/syscall/windows/mksyscall.go          |     2 +-
 src/internal/syscall/windows/psapi_windows.go      |    20 +
 src/internal/syscall/windows/security_windows.go   |    26 +
 src/internal/syscall/windows/syscall_windows.go    |   128 +-
 src/internal/syscall/windows/zsyscall_windows.go   |    99 +-
 src/internal/testenv/testenv.go                    |    59 +-
 src/internal/trace/parser.go                       |    88 +-
 src/internal/trace/testdata/http_1_10_good         |   Bin 0 -> 2201 bytes
 src/internal/trace/testdata/stress_1_10_good       |   Bin 0 -> 370999 bytes
 .../trace/testdata/stress_start_stop_1_10_good     |   Bin 0 -> 6338 bytes
 src/io/example_test.go                             |    16 +
 src/io/io.go                                       |    10 +-
 src/io/io_test.go                                  |    39 +
 src/io/ioutil/ioutil.go                            |    23 +-
 src/io/multi.go                                    |    16 +-
 src/io/multi_test.go                               |    49 +
 src/io/pipe.go                                     |   177 +-
 src/io/pipe_test.go                                |   109 +
 src/iostest.bash                                   |     8 +-
 src/log/log.go                                     |    18 +-
 src/log/syslog/syslog_unix.go                      |     4 +-
 src/make.bash                                      |    88 +-
 src/make.bat                                       |    69 +-
 src/make.rc                                        |    69 +-
 src/math/abs.go                                    |    11 +-
 src/math/all_test.go                               |   240 +-
 src/math/big/arith_amd64.s                         |     2 -
 src/math/big/arith_ppc64x.s                        |   128 +-
 src/math/big/calibrate_test.go                     |    86 +-
 src/math/big/decimal.go                            |     2 +-
 src/math/big/float.go                              |    12 +-
 src/math/big/int.go                                |   219 +-
 src/math/big/int_test.go                           |   164 +-
 src/math/big/intconv.go                            |    13 +-
 src/math/big/intconv_test.go                       |    16 +-
 src/math/big/intmarsh.go                           |     8 +-
 src/math/big/nat.go                                |    75 +-
 src/math/big/nat_test.go                           |    46 +
 src/math/big/natconv.go                            |    30 +-
 src/math/big/natconv_test.go                       |    14 +-
 src/math/big/prime.go                              |    10 +-
 src/math/big/rat.go                                |     9 +-
 src/math/big/ratconv.go                            |     7 +-
 src/math/big/ratmarsh.go                           |     6 +-
 src/math/big/sqrt.go                               |   151 +
 src/math/big/sqrt_test.go                          |   123 +
 src/math/bits.go                                   |     3 +
 src/math/bits/example_test.go                      |   200 +-
 src/math/bits/make_examples.go                     |   112 +
 src/math/cmplx/asin.go                             |    19 +-
 src/math/cmplx/cmath_test.go                       |    63 +
 src/math/cmplx/sqrt.go                             |     7 +-
 src/math/const.go                                  |    18 +-
 src/math/dim.go                                    |    17 +-
 src/math/dim_386.s                                 |     3 -
 src/math/dim_amd64.s                               |    38 -
 src/math/dim_arm.s                                 |     3 -
 src/math/dim_arm64.s                               |    29 -
 src/math/dim_s390x.s                               |    36 -
 src/math/erfinv.go                                 |   127 +
 src/math/example_test.go                           |    71 +
 src/math/exp.go                                    |     4 +-
 src/math/exp_amd64.s                               |    75 +-
 src/math/exp_asm.go                                |    11 +
 src/math/expm1.go                                  |    50 +-
 src/math/floor.go                                  |    77 +-
 src/math/floor_amd64.s                             |    12 -
 src/math/modf_ppc64x.s                             |    17 +
 src/math/pow.go                                    |    20 +-
 src/math/rand/example_test.go                      |    32 +
 src/math/rand/rand.go                              |    54 +
 src/math/rand/rand_test.go                         |   137 +-
 src/math/sin_s390x.s                               |    12 +-
 src/math/sqrt_mipsx.s                              |     4 +
 src/math/stubs_mips64x.s                           |     3 -
 src/math/stubs_mipsx.s                             |     3 -
 src/math/stubs_ppc64x.s                            |     6 -
 src/mime/mediatype.go                              |    37 +-
 src/mime/mediatype_test.go                         |   183 +-
 src/mime/multipart/formdata.go                     |     3 +-
 src/mime/multipart/formdata_test.go                |    26 +
 src/net/cgo_unix.go                                |    20 +-
 src/net/fd_windows.go                              |    20 +-
 src/net/hook_windows.go                            |     8 +-
 src/net/hosts_test.go                              |     2 +-
 src/net/http/client.go                             |    29 +-
 src/net/http/client_test.go                        |    80 +-
 src/net/http/clientserver_test.go                  |    58 +-
 src/net/http/cookie.go                             |     2 -
 src/net/http/example_test.go                       |    28 +
 src/net/http/export_test.go                        |    13 +-
 src/net/http/fs.go                                 |    18 +-
 src/net/http/fs_test.go                            |    92 +-
 src/net/http/h2_bundle.go                          |   581 +-
 src/net/http/header.go                             |     1 +
 src/net/http/httputil/reverseproxy.go              |    52 +-
 src/net/http/httputil/reverseproxy_test.go         |    73 +
 src/net/http/pprof/pprof.go                        |    10 +-
 src/net/http/readrequest_test.go                   |     8 +
 src/net/http/request.go                            |    30 +-
 src/net/http/response.go                           |     7 +
 src/net/http/response_test.go                      |    36 +-
 src/net/http/serve_test.go                         |   163 +-
 src/net/http/server.go                             |   157 +-
 src/net/http/sniff.go                              |    15 +
 src/net/http/sniff_test.go                         |    24 +-
 src/net/http/transfer.go                           |     5 +-
 src/net/http/transport.go                          |   185 +-
 src/net/http/transport_test.go                     |   367 +-
 src/net/internal/socktest/sys_windows.go           |    37 +-
 src/net/iprawsock.go                               |     2 +-
 src/net/listen_test.go                             |    33 +
 src/net/lookup_plan9.go                            |     2 +-
 src/net/lookup_test.go                             |    24 +
 src/net/lookup_windows.go                          |     5 +-
 src/net/mail/message.go                            |   177 +-
 src/net/mail/message_test.go                       |   191 +-
 src/net/main_windows_test.go                       |     3 +
 src/net/net_windows_test.go                        |    31 +-
 src/net/parse.go                                   |     2 +-
 src/net/pipe.go                                    |   232 +-
 src/net/pipe_test.go                               |    74 +-
 src/net/platform_test.go                           |    28 +-
 src/net/port.go                                    |     4 +-
 src/net/protoconn_test.go                          |    10 +-
 src/net/rawconn.go                                 |    16 +
 src/net/rawconn_unix_test.go                       |    50 +
 src/net/rawconn_windows_test.go                    |    53 +
 src/net/rpc/server.go                              |    14 +-
 src/net/rpc/server_test.go                         |    52 +
 src/net/smtp/smtp.go                               |    38 +
 src/net/smtp/smtp_test.go                          |    37 +-
 src/net/sock_bsd.go                                |     4 +-
 src/net/sock_windows.go                            |    13 +-
 src/net/{sockoptip_bsd.go => sockoptip_bsdvar.go}  |     2 +-
 src/net/sockoptip_posix.go                         |     2 +-
 src/net/sockoptip_stub.go                          |     2 +-
 src/net/tcpsock.go                                 |    12 +
 src/net/tcpsock_test.go                            |    72 +
 src/net/textproto/reader.go                        |    16 +-
 src/net/textproto/reader_test.go                   |    18 +
 src/net/udpsock.go                                 |     2 +-
 src/net/udpsock_test.go                            |     4 +-
 src/net/unixsock.go                                |    12 +
 src/net/unixsock_linux_test.go                     |   104 +
 src/net/unixsock_test.go                           |    45 -
 src/net/url/example_test.go                        |   108 +
 src/net/url/url.go                                 |    50 +-
 src/net/url/url_test.go                            |    52 +
 src/net/write_unix_test.go                         |    66 +
 src/os/env_test.go                                 |     2 +-
 src/os/error.go                                    |    25 +
 src/os/exec/exec.go                                |    78 +-
 src/os/exec_plan9.go                               |     7 +-
 src/os/exec_posix.go                               |     7 +-
 src/os/file.go                                     |    49 +-
 src/os/file_plan9.go                               |    26 +
 src/os/file_posix.go                               |    24 +
 src/os/file_unix.go                                |    40 +-
 src/os/file_windows.go                             |    11 +-
 src/os/os_test.go                                  |    68 +-
 src/os/os_unix_test.go                             |    13 -
 src/os/os_windows_test.go                          |    11 +-
 src/os/path.go                                     |     6 +
 src/os/path_test.go                                |    31 +
 src/os/pipe_bsd.go                                 |     2 +-
 src/os/pipe_freebsd.go                             |    18 +-
 src/os/pipe_linux.go                               |     2 +-
 src/os/signal/example_test.go                      |    15 +
 src/os/signal/internal/pty/pty.go                  |    42 +
 src/os/signal/signal_cgo_test.go                   |   228 +
 src/os/signal/signal_test.go                       |     6 +-
 src/os/stat_windows.go                             |     2 +-
 src/os/sys_freebsd.go                              |    17 +-
 src/os/sys_windows.go                              |     2 +-
 src/os/timeout_test.go                             |   589 +
 src/os/user/cgo_lookup_unix.go                     |    24 +-
 src/os/user/cgo_unix_test.go                       |    24 +
 src/os/user/getgrouplist_darwin.go                 |    23 +
 src/os/user/getgrouplist_unix.go                   |    19 +
 src/os/user/listgroups_unix.go                     |    22 +-
 src/os/wait_wait6.go                               |     5 -
 src/path/example_test.go                           |     4 +
 src/path/filepath/example_test.go                  |    20 +
 src/path/filepath/example_unix_test.go             |    22 +
 src/path/filepath/path.go                          |    24 +-
 src/path/filepath/path_test.go                     |   216 +-
 src/path/filepath/path_windows.go                  |     4 +-
 src/path/filepath/path_windows_test.go             |    92 +
 src/path/filepath/symlink_windows.go               |    97 +-
 src/plugin/plugin.go                               |     1 +
 src/plugin/plugin_dlopen.go                        |    90 +-
 src/reflect/all_test.go                            |   201 +-
 src/reflect/export_test.go                         |     4 +-
 src/reflect/swapper.go                             |     4 +-
 src/reflect/type.go                                |   116 +-
 src/reflect/value.go                               |   193 +-
 src/regexp/backtrack.go                            |    59 +-
 src/regexp/example_test.go                         |    64 +
 src/regexp/exec.go                                 |    15 +-
 src/regexp/syntax/prog.go                          |    13 +-
 src/runtime/alg.go                                 |    19 +-
 src/runtime/append_test.go                         |    78 +-
 src/runtime/asm_386.s                              |   165 +-
 src/runtime/asm_amd64.s                            |   244 +-
 src/runtime/asm_amd64p32.s                         |   101 +-
 src/runtime/asm_arm.s                              |   186 +-
 src/runtime/asm_arm64.s                            |   391 +-
 src/runtime/asm_mips64x.s                          |    85 +-
 src/runtime/asm_mipsx.s                            |    85 +-
 src/runtime/asm_ppc64x.s                           |   372 +-
 src/runtime/asm_s390x.s                            |   152 +-
 src/runtime/cgo/asm_386.s                          |    33 +-
 src/runtime/cgo/asm_amd64.s                        |    12 +-
 src/runtime/cgo/asm_mipsx.s                        |    13 +-
 src/runtime/cgo/gcc_android_386.c                  |     7 +-
 src/runtime/cgo/gcc_android_amd64.c                |     7 +-
 src/runtime/cgo/gcc_darwin_386.c                   |    11 +-
 src/runtime/cgo/gcc_darwin_amd64.c                 |    11 +-
 src/runtime/cgo/gcc_libinit.c                      |     4 +
 src/runtime/cgo/gcc_mipsx.S                        |    17 +-
 src/runtime/cgo/gcc_mmap.c                         |     6 +-
 src/runtime/cgo/gcc_signal2_darwin_armx.c          |    13 +
 src/runtime/cgo/gcc_signal_darwin_armx.c           |     3 +-
 src/runtime/cgo/gcc_signal_darwin_lldb.c           |     2 -
 src/runtime/cgo/gcc_util.c                         |    13 +-
 src/runtime/cgo/signal_darwin_arm.s                |     6 +-
 src/runtime/cgo/signal_darwin_arm64.s              |     6 +-
 src/runtime/cgo/signal_darwin_armx.go              |    28 +-
 src/runtime/cgo_mmap.go                            |    10 +-
 src/runtime/cgocall.go                             |    86 +-
 src/runtime/cgocheck.go                            |     4 +
 src/runtime/chan.go                                |    74 +-
 src/runtime/chan_test.go                           |    53 +
 src/runtime/cputicks.go                            |     2 +-
 src/runtime/crash_cgo_test.go                      |    92 +-
 src/runtime/crash_test.go                          |    47 +-
 src/runtime/crash_unix_test.go                     |     8 +-
 src/runtime/debug.go                               |     3 -
 src/runtime/defs1_netbsd_386.go                    |     1 +
 src/runtime/defs1_netbsd_amd64.go                  |     1 +
 src/runtime/defs1_netbsd_arm.go                    |     1 +
 src/runtime/defs_darwin.go                         |     1 +
 src/runtime/defs_darwin_386.go                     |     1 +
 src/runtime/defs_darwin_amd64.go                   |     1 +
 src/runtime/defs_darwin_arm.go                     |     1 +
 src/runtime/defs_darwin_arm64.go                   |     1 +
 src/runtime/defs_dragonfly.go                      |     1 +
 src/runtime/defs_dragonfly_amd64.go                |     1 +
 src/runtime/defs_freebsd.go                        |     1 +
 src/runtime/defs_freebsd_386.go                    |     1 +
 src/runtime/defs_freebsd_amd64.go                  |     1 +
 src/runtime/defs_freebsd_arm.go                    |     1 +
 src/runtime/defs_netbsd.go                         |     1 +
 src/runtime/defs_openbsd.go                        |     1 +
 src/runtime/defs_openbsd_386.go                    |     1 +
 src/runtime/defs_openbsd_amd64.go                  |     1 +
 src/runtime/defs_openbsd_arm.go                    |     1 +
 src/runtime/duff_amd64.s                           |    32 +-
 src/runtime/duff_arm64.s                           |   192 +-
 src/runtime/error.go                               |    23 +-
 src/runtime/export_test.go                         |    56 +-
 src/runtime/extern.go                              |     8 +-
 src/runtime/gc_test.go                             |   124 +
 src/runtime/hash32.go                              |    26 +
 src/runtime/hash64.go                              |    22 +
 src/runtime/hash_test.go                           |    34 +
 src/runtime/hashmap.go                             |   695 +-
 src/runtime/hashmap_fast.go                        |   927 +-
 src/runtime/heapdump.go                            |    18 -
 src/runtime/iface.go                               |   252 +-
 src/runtime/internal/atomic/atomic_test.go         |     2 +-
 src/runtime/internal/sys/arch_386.go               |     2 +-
 src/runtime/internal/sys/arch_amd64.go             |     2 +-
 src/runtime/internal/sys/arch_amd64p32.go          |     2 +-
 src/runtime/internal/sys/arch_arm.go               |     2 +-
 src/runtime/internal/sys/arch_arm64.go             |     4 +-
 src/runtime/internal/sys/arch_mips.go              |     2 +-
 src/runtime/internal/sys/arch_mips64.go            |     2 +-
 src/runtime/internal/sys/arch_mips64le.go          |     2 +-
 src/runtime/internal/sys/arch_mipsle.go            |     2 +-
 src/runtime/internal/sys/arch_ppc64.go             |     2 +-
 src/runtime/internal/sys/arch_ppc64le.go           |     2 +-
 src/runtime/internal/sys/arch_s390x.go             |     2 +-
 src/runtime/internal/sys/gengoos.go                |    10 +-
 src/runtime/internal/sys/sys.go                    |     4 +-
 src/runtime/internal/sys/zgoarch_386.go            |     4 +-
 src/runtime/internal/sys/zgoarch_amd64.go          |     4 +-
 src/runtime/internal/sys/zgoarch_amd64p32.go       |     4 +-
 src/runtime/internal/sys/zgoarch_arm.go            |     4 +-
 src/runtime/internal/sys/zgoarch_arm64.go          |     4 +-
 src/runtime/internal/sys/zgoarch_arm64be.go        |    28 +
 src/runtime/internal/sys/zgoarch_armbe.go          |    28 +
 src/runtime/internal/sys/zgoarch_mips.go           |     4 +-
 src/runtime/internal/sys/zgoarch_mips64.go         |     4 +-
 src/runtime/internal/sys/zgoarch_mips64le.go       |     4 +-
 src/runtime/internal/sys/zgoarch_mips64p32.go      |    28 +
 src/runtime/internal/sys/zgoarch_mips64p32le.go    |    28 +
 src/runtime/internal/sys/zgoarch_mipsle.go         |     4 +-
 src/runtime/internal/sys/zgoarch_ppc.go            |    28 +
 src/runtime/internal/sys/zgoarch_ppc64.go          |     4 +-
 src/runtime/internal/sys/zgoarch_ppc64le.go        |     4 +-
 src/runtime/internal/sys/zgoarch_s390.go           |    28 +
 src/runtime/internal/sys/zgoarch_s390x.go          |     4 +-
 src/runtime/internal/sys/zgoarch_sparc.go          |    28 +
 src/runtime/internal/sys/zgoarch_sparc64.go        |    28 +
 src/runtime/internal/sys/zgoos_android.go          |     5 +-
 src/runtime/internal/sys/zgoos_darwin.go           |     5 +-
 src/runtime/internal/sys/zgoos_dragonfly.go        |     5 +-
 src/runtime/internal/sys/zgoos_freebsd.go          |     5 +-
 src/runtime/internal/sys/zgoos_linux.go            |     4 +-
 src/runtime/internal/sys/zgoos_nacl.go             |     5 +-
 src/runtime/internal/sys/zgoos_netbsd.go           |     5 +-
 src/runtime/internal/sys/zgoos_openbsd.go          |     5 +-
 src/runtime/internal/sys/zgoos_plan9.go            |     5 +-
 src/runtime/internal/sys/zgoos_solaris.go          |     5 +-
 src/runtime/internal/sys/zgoos_windows.go          |     5 +-
 src/runtime/internal/sys/zgoos_zos.go              |    20 +
 src/runtime/lock_sema.go                           |     8 +-
 src/runtime/malloc.go                              |    82 +-
 src/runtime/malloc_test.go                         |     5 +-
 src/runtime/map_test.go                            |   214 +-
 src/runtime/mbarrier.go                            |    58 +-
 src/runtime/mbitmap.go                             |    26 +-
 src/runtime/mcache.go                              |     3 +-
 src/runtime/mem_bsd.go                             |    22 +-
 src/runtime/mem_darwin.go                          |    14 +-
 src/runtime/mem_linux.go                           |    42 +-
 src/runtime/memclr_amd64p32.s                      |    23 +
 src/runtime/memclr_arm64.s                         |    78 +-
 ...{memmove_nacl_amd64p32.s => memmove_amd64p32.s} |     0
 src/runtime/memmove_test.go                        |     9 +
 src/runtime/mfinal.go                              |    15 +-
 src/runtime/mfinal_test.go                         |    21 +
 src/runtime/mgc.go                                 |   317 +-
 src/runtime/mgclarge.go                            |     4 +-
 src/runtime/mgcmark.go                             |    54 +-
 src/runtime/mgcwork.go                             |    56 +-
 src/runtime/mheap.go                               |    77 +-
 src/runtime/mkduff.go                              |     9 +-
 src/runtime/mksizeclasses.go                       |    13 +-
 src/runtime/mmap.go                                |     3 +-
 src/runtime/mprof.go                               |    12 +-
 src/runtime/mstats.go                              |    16 +-
 src/runtime/mwbbuf.go                              |   248 +
 src/runtime/netpoll_kqueue.go                      |    19 +-
 src/runtime/netpoll_windows.go                     |     2 +-
 src/runtime/os3_plan9.go                           |     3 +
 src/runtime/os3_solaris.go                         |    12 +-
 src/runtime/os_darwin.go                           |    10 +-
 src/runtime/os_darwin_arm64.go                     |     2 -
 src/runtime/os_freebsd.go                          |    23 +-
 src/runtime/os_linux.go                            |    79 +-
 src/runtime/os_linux_arm64.go                      |    20 +-
 src/runtime/os_linux_noauxv.go                     |     2 +-
 src/runtime/os_linux_ppc64x.go                     |    53 +-
 src/runtime/os_nacl.go                             |     8 +-
 src/runtime/os_netbsd.go                           |    24 +-
 src/runtime/os_plan9.go                            |     8 +-
 src/runtime/os_windows.go                          |    11 +-
 src/runtime/panic.go                               |    81 +-
 src/runtime/plugin.go                              |    32 +-
 src/runtime/pprof/pprof.go                         |    92 +-
 src/runtime/pprof/pprof_test.go                    |   282 +-
 src/runtime/print.go                               |    18 +-
 src/runtime/proc.go                                |   673 +-
 src/runtime/proc_test.go                           |   151 +
 src/runtime/race.go                                |   108 +-
 src/runtime/race/output_test.go                    |    18 +-
 src/runtime/race/testdata/atomic_test.go           |    13 +
 src/runtime/race/testdata/chan_test.go             |    22 +
 src/runtime/race/testdata/finalizer_test.go        |     1 +
 src/runtime/race/testdata/map_test.go              |     2 +
 src/runtime/race/testdata/mop_test.go              |    21 +
 src/runtime/race/testdata/mutex_test.go            |     5 +
 src/runtime/race/testdata/rwmutex_test.go          |     2 +
 src/runtime/race/testdata/select_test.go           |     7 +
 src/runtime/race/testdata/sync_test.go             |     6 +
 src/runtime/race/testdata/waitgroup_test.go        |     8 +
 src/runtime/rt0_android_386.s                      |    14 +-
 src/runtime/rt0_android_amd64.s                    |     8 +-
 src/runtime/rt0_android_arm.s                      |     5 +-
 src/runtime/rt0_darwin_386.s                       |    70 +-
 src/runtime/rt0_darwin_amd64.s                     |    72 +-
 src/runtime/rt0_darwin_arm.s                       |    94 +-
 src/runtime/rt0_dragonfly_amd64.s                  |     9 +-
 src/runtime/rt0_freebsd_386.s                      |    15 +-
 src/runtime/rt0_freebsd_amd64.s                    |     9 +-
 src/runtime/rt0_freebsd_arm.s                      |    13 +-
 src/runtime/rt0_linux_386.s                        |    70 +-
 src/runtime/rt0_linux_amd64.s                      |    69 +-
 src/runtime/rt0_linux_arm.s                        |   148 +-
 src/runtime/rt0_linux_ppc64le.s                    |     3 +-
 src/runtime/rt0_linux_s390x.s                      |    21 +-
 src/runtime/rt0_nacl_386.s                         |     6 +-
 src/runtime/rt0_nacl_arm.s                         |     4 -
 src/runtime/rt0_netbsd_386.s                       |    15 +-
 src/runtime/rt0_netbsd_amd64.s                     |    10 +-
 src/runtime/rt0_netbsd_arm.s                       |    10 +-
 src/runtime/rt0_openbsd_386.s                      |    15 +-
 src/runtime/rt0_openbsd_amd64.s                    |    10 +-
 src/runtime/rt0_openbsd_arm.s                      |    10 +-
 src/runtime/rt0_plan9_386.s                        |     2 +-
 src/runtime/rt0_plan9_arm.s                        |     2 -
 src/runtime/rt0_solaris_amd64.s                    |    10 +-
 src/runtime/rt0_windows_386.s                      |    19 +-
 src/runtime/rt0_windows_amd64.s                    |     9 +-
 src/runtime/runtime-gdb_test.go                    |    97 +-
 src/runtime/runtime-lldb_test.go                   |    84 +-
 src/runtime/runtime.go                             |    14 +-
 src/runtime/runtime1.go                            |    11 -
 src/runtime/runtime2.go                            |   170 +-
 src/runtime/runtime_boring.go                      |    19 +
 src/runtime/runtime_linux_test.go                  |    12 +
 src/runtime/runtime_mmap_test.go                   |    26 +-
 src/runtime/runtime_test.go                        |     9 +-
 src/runtime/rwmutex_test.go                        |     5 +
 src/runtime/select.go                              |    76 +-
 src/runtime/sema.go                                |     5 +-
 src/runtime/signal_darwin.go                       |    23 +-
 src/runtime/signal_darwin_arm.go                   |     2 +-
 src/runtime/signal_darwin_arm64.go                 |     2 +-
 src/runtime/signal_dragonfly.go                    |    23 +-
 src/runtime/signal_freebsd.go                      |    23 +-
 src/runtime/signal_freebsd_arm.go                  |     2 +-
 src/runtime/signal_linux_arm.go                    |     2 +-
 src/runtime/signal_linux_arm64.go                  |     2 +-
 src/runtime/signal_linux_ppc64x.go                 |     2 +-
 src/runtime/signal_nacl.go                         |    12 +-
 src/runtime/signal_nacl_arm.go                     |     2 +-
 src/runtime/signal_netbsd.go                       |    23 +-
 src/runtime/signal_netbsd_arm.go                   |     2 +-
 src/runtime/signal_openbsd.go                      |    17 +-
 src/runtime/signal_openbsd_arm.go                  |     2 +-
 src/runtime/signal_sighandler.go                   |     6 +-
 src/runtime/signal_solaris.go                      |    19 +-
 src/runtime/signal_unix.go                         |    97 +-
 src/runtime/signal_windows.go                      |     7 +-
 src/runtime/sigqueue.go                            |    35 +-
 src/runtime/sigtab_linux_generic.go                |    19 +-
 src/runtime/sigtab_linux_mipsx.go                  |    19 +-
 src/runtime/sizeclasses.go                         |   134 +-
 src/runtime/slice.go                               |    42 +-
 src/runtime/softfloat64.go                         |   112 +
 src/runtime/stack.go                               |    61 +-
 src/runtime/stack_test.go                          |   192 +-
 src/runtime/string.go                              |     6 +-
 src/runtime/stubs.go                               |    70 +-
 src/runtime/stubs2.go                              |     6 +
 src/runtime/symtab.go                              |    59 +-
 src/runtime/sys_darwin_386.s                       |    38 +-
 src/runtime/sys_darwin_amd64.s                     |   151 +-
 src/runtime/sys_darwin_arm.s                       |    42 +-
 src/runtime/sys_darwin_arm64.s                     |    26 +-
 src/runtime/sys_dragonfly_amd64.s                  |    23 +-
 src/runtime/sys_freebsd_386.s                      |    27 +-
 src/runtime/sys_freebsd_amd64.s                    |    20 +-
 src/runtime/sys_freebsd_arm.s                      |    30 +-
 src/runtime/sys_linux_386.s                        |   221 +-
 src/runtime/sys_linux_amd64.s                      |   190 +-
 src/runtime/sys_linux_arm.s                        |    26 +-
 src/runtime/sys_linux_arm64.s                      |    20 +-
 src/runtime/sys_linux_mips64x.s                    |    21 +-
 src/runtime/sys_linux_mipsx.s                      |    23 +-
 src/runtime/sys_linux_ppc64x.s                     |   121 +-
 src/runtime/sys_linux_s390x.s                      |    22 +-
 src/runtime/sys_nacl_386.s                         |    17 +-
 src/runtime/sys_nacl_amd64p32.s                    |    17 +-
 src/runtime/sys_nacl_arm.s                         |    14 +-
 src/runtime/sys_netbsd_386.s                       |    29 +-
 src/runtime/sys_netbsd_amd64.s                     |    33 +-
 src/runtime/sys_netbsd_arm.s                       |    41 +-
 src/runtime/sys_openbsd_386.s                      |    27 +-
 src/runtime/sys_openbsd_amd64.s                    |    17 +-
 src/runtime/sys_openbsd_arm.s                      |    21 +-
 src/runtime/sys_plan9_386.s                        |     8 +-
 src/runtime/sys_plan9_amd64.s                      |     8 +-
 src/runtime/sys_plan9_arm.s                        |    10 +-
 src/runtime/sys_solaris_amd64.s                    |    17 +-
 src/runtime/sys_x86.go                             |     2 +-
 src/runtime/syscall_windows.go                     |    22 +-
 src/runtime/syscall_windows_test.go                |    14 +-
 src/runtime/testdata/testprog/gettid.go            |    29 +
 src/runtime/testdata/testprog/gettid_none.go       |    15 +
 src/runtime/testdata/testprog/lockosthread.go      |    94 +
 src/runtime/testdata/testprog/syscall_windows.go   |    45 +-
 src/runtime/testdata/testprogcgo/callback.go       |     6 +-
 src/runtime/testdata/testprogcgo/catchpanic.go     |    46 +
 src/runtime/testdata/testprogcgo/cgo.go            |     6 +-
 src/runtime/testdata/testprogcgo/lockosthread.c    |    13 +
 src/runtime/testdata/testprogcgo/lockosthread.go   |   111 +
 src/runtime/testdata/testprogcgo/sigstack.go       |    95 +
 src/runtime/testdata/testprogcgo/stack_windows.go  |    54 +
 src/runtime/time.go                                |   248 +-
 src/runtime/trace.go                               |   112 +-
 src/runtime/trace/example_test.go                  |    39 +
 src/runtime/trace/trace.go                         |    37 +-
 src/runtime/trace/trace_test.go                    |    57 +
 src/runtime/traceback.go                           |    48 +-
 src/runtime/type.go                                |     6 +-
 src/runtime/vdso_linux.go                          |   281 +
 src/runtime/vdso_linux_386.go                      |    93 +
 src/runtime/vdso_linux_amd64.go                    |   242 +-
 src/runtime/vdso_linux_test.go                     |    63 +
 src/sort/example_interface_test.go                 |    14 +
 src/sort/example_keys_test.go                      |     2 +-
 src/sort/example_multi_test.go                     |     9 +-
 src/sort/example_test.go                           |    44 +
 src/sort/slice.go                                  |    46 +
 src/sort/sort.go                                   |    39 -
 src/sort/sort_test.go                              |    60 +-
 src/strconv/atoi.go                                |   133 +-
 src/strconv/atoi_test.go                           |   363 +-
 src/strconv/export_test.go                         |    10 +
 src/strconv/extfloat.go                            |     2 +-
 src/strconv/isprint.go                             |    65 +-
 src/strconv/quote.go                               |     2 +-
 src/strings/builder.go                             |   120 +
 src/strings/builder_test.go                        |   282 +
 src/strings/example_test.go                        |   124 +-
 src/strings/strings.go                             |   255 +-
 src/strings/strings_amd64.go                       |    20 +-
 src/strings/strings_generic.go                     |    38 +-
 src/strings/strings_s390x.go                       |    20 +-
 src/strings/strings_test.go                        |    46 +
 src/sync/atomic/asm_darwin_arm.s                   |    10 +
 src/sync/atomic/atomic_test.go                     |     6 +-
 src/sync/atomic/value.go                           |    12 -
 src/sync/cond.go                                   |     2 +-
 src/sync/waitgroup.go                              |    12 +-
 src/syscall/asm_plan9_386.s                        |    15 +-
 src/syscall/asm_plan9_amd64.s                      |    15 +-
 src/syscall/asm_plan9_arm.s                        |    11 +-
 src/syscall/creds_test.go                          |   183 +-
 src/syscall/exec_freebsd.go                        |    18 +-
 src/syscall/exec_linux.go                          |    18 +-
 src/syscall/exec_linux_test.go                     |    25 +-
 src/syscall/exec_windows.go                        |     7 +-
 src/syscall/fs_nacl.go                             |     8 +
 src/syscall/mkall.sh                               |     6 -
 src/syscall/mksyscall_windows.go                   |     2 +-
 src/syscall/net_nacl.go                            |    13 +-
 src/syscall/syscall.go                             |     9 +-
 src/syscall/syscall_bsd.go                         |    11 +-
 src/syscall/syscall_darwin.go                      |    36 +-
 src/syscall/syscall_dragonfly.go                   |     7 +-
 src/syscall/syscall_freebsd.go                     |    16 +-
 src/syscall/syscall_linux.go                       |    40 +-
 src/syscall/syscall_linux_arm64.go                 |    12 +-
 src/syscall/syscall_linux_mips64x.go               |    12 +-
 src/syscall/syscall_linux_ppc64x.go                |     2 +-
 src/syscall/syscall_nacl.go                        |     1 -
 src/syscall/syscall_netbsd.go                      |     7 +-
 src/syscall/syscall_openbsd.go                     |     8 +-
 src/syscall/syscall_plan9.go                       |     7 +-
 src/syscall/syscall_solaris.go                     |    11 +-
 src/syscall/syscall_unix_test.go                   |     3 +
 src/syscall/syscall_windows.go                     |     4 +-
 src/syscall/types_darwin.go                        |     6 +
 src/syscall/types_dragonfly.go                     |     6 +
 src/syscall/types_freebsd.go                       |     6 +
 src/syscall/types_netbsd.go                        |     6 +
 src/syscall/types_openbsd.go                       |     6 +
 src/syscall/types_solaris.go                       |     6 +
 .../{ztypes_windows.go => types_windows.go}        |     0
 ...{ztypes_windows_386.go => types_windows_386.go} |     0
 ...pes_windows_amd64.go => types_windows_amd64.go} |     0
 src/syscall/zsyscall_darwin_386.go                 |     7 -
 src/syscall/zsyscall_darwin_amd64.go               |     7 -
 src/syscall/zsyscall_darwin_arm.go                 |     7 -
 src/syscall/zsyscall_darwin_arm64.go               |     7 -
 src/syscall/zsyscall_dragonfly_amd64.go            |    22 +-
 src/syscall/zsyscall_freebsd_386.go                |    34 +-
 src/syscall/zsyscall_freebsd_amd64.go              |    34 +-
 src/syscall/zsyscall_freebsd_arm.go                |    34 +-
 src/syscall/zsyscall_linux_386.go                  |    11 +-
 src/syscall/zsyscall_linux_amd64.go                |    11 +-
 src/syscall/zsyscall_linux_arm.go                  |    11 +-
 src/syscall/zsyscall_linux_arm64.go                |    33 +-
 src/syscall/zsyscall_linux_mips.go                 |    11 +-
 src/syscall/zsyscall_linux_mips64.go               |    33 +-
 src/syscall/zsyscall_linux_mips64le.go             |    33 +-
 src/syscall/zsyscall_linux_mipsle.go               |    11 +-
 src/syscall/zsyscall_linux_ppc64.go                |    13 +-
 src/syscall/zsyscall_linux_ppc64le.go              |    13 +-
 src/syscall/zsyscall_linux_s390x.go                |    11 +-
 src/syscall/zsyscall_nacl_386.go                   |    10 -
 src/syscall/zsyscall_nacl_amd64p32.go              |    10 -
 src/syscall/zsyscall_nacl_arm.go                   |    10 -
 src/syscall/zsyscall_netbsd_386.go                 |    22 +-
 src/syscall/zsyscall_netbsd_amd64.go               |    22 +-
 src/syscall/zsyscall_netbsd_arm.go                 |    24 +-
 src/syscall/zsyscall_openbsd_386.go                |    22 +-
 src/syscall/zsyscall_openbsd_amd64.go              |    22 +-
 src/syscall/zsyscall_openbsd_arm.go                |    22 +-
 src/syscall/zsyscall_solaris_amd64.go              |    26 +-
 src/syscall/zsyscall_windows.go                    |    19 +
 src/syscall/zsysnum_dragonfly_amd64.go             |     1 +
 src/syscall/zsysnum_freebsd_386.go                 |     1 +
 src/syscall/zsysnum_freebsd_amd64.go               |     1 +
 src/syscall/zsysnum_freebsd_arm.go                 |     1 +
 src/syscall/ztypes_darwin_386.go                   |     4 +
 src/syscall/ztypes_darwin_amd64.go                 |     4 +
 src/syscall/ztypes_darwin_arm.go                   |     4 +
 src/syscall/ztypes_darwin_arm64.go                 |     4 +
 src/syscall/ztypes_dragonfly_amd64.go              |     4 +
 src/syscall/ztypes_freebsd_386.go                  |     4 +
 src/syscall/ztypes_freebsd_amd64.go                |     4 +
 src/syscall/ztypes_freebsd_arm.go                  |     4 +
 src/syscall/ztypes_linux_ppc64.go                  |     4 +-
 src/syscall/ztypes_linux_ppc64le.go                |     4 +-
 src/syscall/ztypes_netbsd_386.go                   |     4 +
 src/syscall/ztypes_netbsd_amd64.go                 |     4 +
 src/syscall/ztypes_netbsd_arm.go                   |     4 +
 src/syscall/ztypes_openbsd_386.go                  |     4 +
 src/syscall/ztypes_openbsd_amd64.go                |     4 +
 src/syscall/ztypes_openbsd_arm.go                  |     4 +
 src/syscall/ztypes_solaris_amd64.go                |     4 +
 src/testing/benchmark.go                           |    84 +-
 src/testing/example.go                             |     2 +-
 src/testing/iotest/logger.go                       |     2 +-
 src/testing/testing.go                             |   134 +-
 src/text/tabwriter/tabwriter.go                    |    84 +-
 src/text/template/doc.go                           |     6 +
 src/text/template/exec.go                          |   128 +-
 src/text/template/exec_test.go                     |    21 +
 src/text/template/funcs.go                         |    20 +-
 src/text/template/multi_test.go                    |     3 +
 src/text/template/parse/lex.go                     |    22 +-
 src/text/template/parse/lex_test.go                |    32 +-
 src/text/template/parse/node.go                    |    64 +
 src/text/template/parse/parse.go                   |    44 +-
 src/text/template/parse/parse_test.go              |    12 +
 src/time/example_test.go                           |   335 +-
 src/time/export_android_test.go                    |     4 +-
 src/time/export_test.go                            |     1 +
 src/time/export_windows_test.go                    |     9 +-
 src/time/format.go                                 |    19 +-
 src/time/format_test.go                            |     3 +
 src/time/genzabbrs.go                              |    16 +-
 src/time/internal_test.go                          |    19 +
 src/time/sleep.go                                  |     4 +-
 src/time/sleep_test.go                             |    53 +-
 src/time/sys_plan9.go                              |    34 +-
 src/time/sys_unix.go                               |    36 +-
 src/time/sys_windows.go                            |    34 +-
 src/time/tick_test.go                              |    22 +-
 src/time/time.go                                   |    12 +-
 src/time/time_test.go                              |     5 +-
 src/time/zoneinfo.go                               |    19 +-
 src/time/zoneinfo_android.go                       |    56 +-
 src/time/zoneinfo_ios.go                           |    32 +-
 src/time/zoneinfo_plan9.go                         |    26 +-
 src/time/zoneinfo_read.go                          |   113 +-
 src/time/zoneinfo_test.go                          |    25 +
 src/time/zoneinfo_unix.go                          |    44 +-
 src/time/zoneinfo_windows.go                       |    25 +-
 src/time/zoneinfo_windows_test.go                  |     6 +-
 src/unicode/letter.go                              |     8 +-
 src/unicode/maketables.go                          |    19 +-
 src/unicode/script_test.go                         |    12 +-
 src/unicode/tables.go                              |   372 +-
 src/unicode/utf8/utf8.go                           |    20 +-
 src/unsafe/unsafe.go                               |     2 +-
 src/vendor/golang_org/x/crypto/cryptobyte/asn1.go  |   732 +
 .../golang_org/x/crypto/cryptobyte/asn1/asn1.go    |    46 +
 .../golang_org/x/crypto/cryptobyte/asn1_test.go    |   300 +
 .../golang_org/x/crypto/cryptobyte/builder.go      |   309 +
 .../x/crypto/cryptobyte/cryptobyte_test.go         |   428 +
 .../golang_org/x/crypto/cryptobyte/example_test.go |   154 +
 .../golang_org/x/crypto/cryptobyte/string.go       |   167 +
 src/vendor/golang_org/x/net/idna/idna.go           |   128 +-
 src/vendor/golang_org/x/net/idna/punycode.go       |     2 +-
 src/vendor/golang_org/x/net/idna/tables.go         |  4398 +--
 src/vendor/golang_org/x/net/idna/trie.go           |     2 +-
 src/vendor/golang_org/x/net/idna/trieval.go        |    19 +-
 .../x/net/internal/nettest/helper_bsd.go           |    53 +
 .../x/net/internal/nettest/helper_nobsd.go         |    15 +
 .../x/net/internal/nettest/helper_posix.go         |    31 +
 .../x/net/internal/nettest/helper_stub.go          |    32 +
 .../x/net/internal/nettest/helper_unix.go          |    29 +
 .../x/net/internal/nettest/helper_windows.go       |    42 +
 .../golang_org/x/net/internal/nettest/interface.go |    94 +
 .../golang_org/x/net/internal/nettest/rlimit.go    |    11 +
 .../golang_org/x/net/internal/nettest/stack.go     |   152 +
 .../golang_org/x/net/nettest/conntest_test.go      |    58 +-
 src/vendor/golang_org/x/net/route/defs_openbsd.go  |    11 +
 src/vendor/golang_org/x/net/route/route_classic.go |    10 +-
 src/vendor/golang_org/x/net/route/route_test.go    |     4 +
 src/vendor/golang_org/x/net/route/sys_darwin.go    |     4 +-
 src/vendor/golang_org/x/net/route/sys_dragonfly.go |     4 +-
 src/vendor/golang_org/x/net/route/sys_freebsd.go   |     4 +-
 src/vendor/golang_org/x/net/route/sys_netbsd.go    |     4 +-
 src/vendor/golang_org/x/net/route/sys_openbsd.go   |     5 +-
 src/vendor/golang_org/x/net/route/zsys_openbsd.go  |    13 +-
 .../golang_org/x/text/secure/bidirule/bidirule.go  |     6 +-
 src/vendor/golang_org/x/text/secure/doc.go         |     2 +-
 .../golang_org/x/text/transform/transform.go       |     2 +-
 src/vendor/golang_org/x/text/unicode/bidi/bidi.go  |     2 +-
 .../golang_org/x/text/unicode/bidi/bracket.go      |     2 +-
 src/vendor/golang_org/x/text/unicode/bidi/core.go  |     2 +-
 src/vendor/golang_org/x/text/unicode/bidi/prop.go  |     2 +-
 .../golang_org/x/text/unicode/bidi/tables.go       |  1358 +-
 .../golang_org/x/text/unicode/bidi/trieval.go      |     2 +-
 src/vendor/golang_org/x/text/unicode/doc.go        |     2 +-
 .../golang_org/x/text/unicode/norm/composition.go  |    20 +-
 .../golang_org/x/text/unicode/norm/forminfo.go     |     2 +-
 src/vendor/golang_org/x/text/unicode/norm/input.go |    10 +-
 src/vendor/golang_org/x/text/unicode/norm/iter.go  |    33 +-
 .../golang_org/x/text/unicode/norm/normalize.go    |    18 +-
 .../golang_org/x/text/unicode/norm/readwriter.go   |     2 +-
 .../golang_org/x/text/unicode/norm/tables.go       |  2844 +-
 .../golang_org/x/text/unicode/norm/transform.go    |     4 +-
 src/vendor/golang_org/x/text/unicode/norm/trie.go  |     2 +-
 test/chan/sendstmt.go                              |     2 +-
 test/chancap.go                                    |    43 +-
 test/closure3.dir/main.go                          |   283 +
 test/closure3.go                                   |    10 +
 test/ddd1.go                                       |     3 +-
 test/escape2.go                                    |     2 +-
 test/escape2n.go                                   |    15 +
 test/escape4.go                                    |     6 +-
 test/fixedbugs/bug289.go                           |     4 +-
 test/fixedbugs/bug388.go                           |     2 +-
 test/fixedbugs/bug487.go                           |     4 +-
 test/fixedbugs/bug503.go                           |    16 +
 .../fixedbugs/bug504.dir/a.go                      |     4 +-
 test/fixedbugs/bug504.dir/b.go                     |    11 +
 test/fixedbugs/bug504.dir/c.go                     |     9 +
 test/fixedbugs/bug504.dir/main.go                  |    11 +
 test/fixedbugs/bug504.go                           |    10 +
 test/fixedbugs/bug505.go                           |    20 +
 test/fixedbugs/issue13265.go                       |    15 +
 test/fixedbugs/issue14006.go                       |     3 +
 test/fixedbugs/issue14540.go                       |    20 +
 test/fixedbugs/issue15747.go                       |     6 +-
 test/fixedbugs/issue15747b.go                      |     2 +-
 test/fixedbugs/issue18902.go                       |    12 +-
 test/fixedbugs/issue19137.go                       |    16 +
 test/fixedbugs/issue19261.dir/p.go                 |    24 +
 test/fixedbugs/issue19261.dir/q.go                 |    17 +
 test/fixedbugs/issue19261.go                       |     7 +
 test/fixedbugs/issue20250.go                       |    10 +-
 test/fixedbugs/issue20739.go                       |    16 +
 test/fixedbugs/issue20812.go                       |    15 +
 test/fixedbugs/issue21253.go                       |    27 +
 test/fixedbugs/issue21256.go                       |     9 +
 test/fixedbugs/issue21273.go                       |    28 +
 test/fixedbugs/issue21317.go                       |    60 +
 test/fixedbugs/issue21687.go                       |    68 +
 test/fixedbugs/issue21709.go                       |    37 +
 test/fixedbugs/issue21770.go                       |    20 +
 test/fixedbugs/issue21808.go                       |    17 +
 test/fixedbugs/issue21808.out                      |     3 +
 test/fixedbugs/issue21879.go                       |    37 +
 test/fixedbugs/issue21879.out                      |     2 +
 test/fixedbugs/issue21882.go                       |     9 +
 test/fixedbugs/issue21887.go                       |    25 +
 test/fixedbugs/issue21887.out                      |     2 +
 test/fixedbugs/issue21988.go                       |    17 +
 test/fixedbugs/issue22063.go                       |    17 +
 test/fixedbugs/issue22076.go                       |    25 +
 test/fixedbugs/issue22164.go                       |    26 +
 test/fixedbugs/issue22198.go                       |    18 +
 test/fixedbugs/issue22200.go                       |    20 +
 test/fixedbugs/issue22200b.go                      |    28 +
 test/fixedbugs/issue22351.go                       |    11 +
 test/fixedbugs/issue22389.go                       |    18 +
 test/fixedbugs/issue22429.go                       |    18 +
 test/fixedbugs/issue22458.go                       |    26 +
 test/fixedbugs/issue22581.go                       |    27 +
 test/fixedbugs/issue22605.go                       |    26 +
 test/fixedbugs/issue22660.go                       |    50 +
 test/fixedbugs/issue22683.go                       |    30 +
 test/fixedbugs/issue22683.out                      |     1 +
 test/fixedbugs/issue22781.go                       |    29 +
 test/fixedbugs/issue22794.go                       |    20 +
 test/fixedbugs/issue22877.dir/p.go                 |    14 +
 test/fixedbugs/issue22877.dir/p.s                  |     8 +
 test/fixedbugs/issue22877.go                       |     7 +
 test/fixedbugs/issue22881.go                       |    72 +
 test/fixedbugs/issue22904.go                       |    19 +
 test/fixedbugs/issue22941.dir/a.go                 |     7 +
 test/fixedbugs/issue22941.dir/b.go                 |    30 +
 test/fixedbugs/issue22941.dir/main.go              |    15 +
 test/fixedbugs/issue22941.go                       |     7 +
 test/fixedbugs/issue22962.dir/a.go                 |    11 +
 test/fixedbugs/issue22962.dir/b.go                 |     9 +
 test/fixedbugs/issue22962.go                       |     7 +
 test/fixedbugs/issue4388.go                        |    56 -
 test/fixedbugs/issue7525.go                        |     4 +-
 test/fixedbugs/issue7525d.go                       |    15 +
 test/fixedbugs/issue7525e.go                       |    15 +
 test/inline.go                                     |    92 +-
 test/inline_callers.go                             |     8 +-
 test/intrinsic_atomic.go                           |     2 +-
 test/live.go                                       |    51 +-
 test/live2.go                                      |    11 +-
 test/makechan.go                                   |    34 +
 test/makemap.go                                    |    34 +
 test/mergemul.go                                   |   117 +
 test/method2.go                                    |     4 +
 test/method6.go                                    |    22 +
 test/method7.go                                    |    56 +
 test/nilptr3.go                                    |     7 +
 test/nosplit.go                                    |    43 +-
 test/notinheap3.go                                 |    60 +
 test/nowritebarrier.go                             |    15 +
 test/print.go                                      |    14 +-
 test/print.out                                     |    10 +
 test/range.go                                      |    49 +-
 test/rename1.go                                    |     4 +-
 test/run.go                                        |    58 +-
 test/shift1.go                                     |     3 +-
 1928 files changed, 217744 insertions(+), 72030 deletions(-)

diff --cc src/cmd/compile/internal/gc/reflect.go
index 47ac541822,66b1a8e186..bbb263ee8d
--- a/src/cmd/compile/internal/gc/reflect.go
+++ b/src/cmd/compile/internal/gc/reflect.go
@@@ -1275,47 -1339,20 +1339,47 @@@ func dtypesym(t *types.Type) *obj.LSym 
  	// ../../../../runtime/type.go:/structType
  	// for security, only the exported fields.
  	case TSTRUCT:
+ 		fields := t.Fields().Slice()
 +
 +		// omitFieldForAwfulBoringCryptoKludge reports whether
 +		// the field t should be omitted from the reflect data.
 +		// In the crypto/... packages we omit an unexported field
 +		// named "boring", to keep from breaking client code that
 +		// expects rsa.PublicKey etc to have only public fields.
 +		// As the name suggests, this is an awful kludge, but it is
 +		// limited to the dev.boringcrypto branch and avoids
 +		// much more invasive effects elsewhere.
 +		omitFieldForAwfulBoringCryptoKludge := func(t *types.Field) bool {
 +			if t.Sym == nil || t.Sym.Name != "boring" || t.Sym.Pkg == nil {
 +				return false
 +			}
 +			path := t.Sym.Pkg.Path
 +			if t.Sym.Pkg == localpkg {
 +				path = myimportpath
 +			}
 +			return strings.HasPrefix(path, "crypto/")
 +		}
- 
- 		n := 0
- 
- 		for _, t1 := range t.Fields().Slice() {
- 			if omitFieldForAwfulBoringCryptoKludge(t1) {
- 				continue
++		newFields := fields[:0:0]
++		for _, t1 := range fields {
++			if !omitFieldForAwfulBoringCryptoKludge(t1) {
++				newFields = append(newFields, t1)
 +			}
++		}
++		fields = newFields
++
+ 		for _, t1 := range fields {
  			dtypesym(t1.Type)
- 			n++
  		}
  
- 		ot = dcommontype(lsym, ot, t)
- 		pkg := localpkg
- 		if t.Sym != nil {
- 			pkg = t.Sym.Pkg
- 		} else {
- 			// Unnamed type. Grab the package from the first field, if any.
- 			for _, f := range t.Fields().Slice() {
- 				if f.Embedded != 0 {
- 					continue
- 				}
- 				pkg = f.Sym.Pkg
+ 		// All non-exported struct field names within a struct
+ 		// type must originate from a single package. By
+ 		// identifying and recording that package within the
+ 		// struct type descriptor, we can omit that
+ 		// information from the field descriptors.
+ 		var spkg *types.Pkg
+ 		for _, f := range fields {
+ 			if !exportname(f.Sym.Name) {
+ 				spkg = f.Sym.Pkg
  				break
  			}
  		}
diff --cc src/cmd/go/go_test.go
index a12df2988c,e0ac90dddf..75d65b7235
--- a/src/cmd/go/go_test.go
+++ b/src/cmd/go/go_test.go
@@@ -3632,8 -3961,8 +3961,12 @@@ func TestBinaryOnlyPackages(t *testing.
  	tg.grepStdout("false", "did not see BinaryOnly=false for p4")
  }
  
 -// Issue 16050.
 -func TestAlwaysLinkSysoFiles(t *testing.T) {
 +// Issue 16050 and 21884.
 +func TestLinkSysoFiles(t *testing.T) {
++	if runtime.GOOS != "linux" || runtime.GOARCH != "amd64" {
++		t.Skip("not linux/amd64")
++	}
++
  	tg := testgo(t)
  	defer tg.cleanup()
  	tg.parallel()
diff --cc src/crypto/ecdsa/ecdsa.go
index 3fe1dda660,755ed284a9..6a47cc7d98
--- a/src/crypto/ecdsa/ecdsa.go
+++ b/src/crypto/ecdsa/ecdsa.go
@@@ -49,11 -47,9 +49,11 @@@ const 
  type PublicKey struct {
  	elliptic.Curve
  	X, Y *big.Int
 +
 +	boring unsafe.Pointer
  }
  
- // PrivateKey represents a ECDSA private key.
+ // PrivateKey represents an ECDSA private key.
  type PrivateKey struct {
  	PublicKey
  	D *big.Int
@@@ -70,21 -64,15 +70,24 @@@ func (priv *PrivateKey) Public() crypto
  	return &priv.PublicKey
  }
  
- // Sign signs msg with priv, reading randomness from rand. This method is
- // intended to support keys where the private part is kept in, for example, a
- // hardware module. Common uses should use the Sign function in this package
- // directly.
- func (priv *PrivateKey) Sign(rand io.Reader, msg []byte, opts crypto.SignerOpts) ([]byte, error) {
+ // Sign signs digest with priv, reading randomness from rand. The opts argument
+ // is not currently used but, in keeping with the crypto.Signer interface,
+ // should be the hash function used to digest the message.
+ //
+ // This method implements crypto.Signer, which is an interface to support keys
+ // where the private part is kept in, for example, a hardware module. Common
+ // uses should use the Sign function in this package directly.
+ func (priv *PrivateKey) Sign(rand io.Reader, digest []byte, opts crypto.SignerOpts) ([]byte, error) {
 +	if boring.Enabled && rand == boring.RandReader {
 +		b, err := boringPrivateKey(priv)
 +		if err != nil {
 +			return nil, err
 +		}
- 		return boring.SignMarshalECDSA(b, msg)
++		return boring.SignMarshalECDSA(b, digest)
 +	}
 +	boring.UnreachableExceptTests()
 +
- 	r, s, err := Sign(rand, priv, msg)
+ 	r, s, err := Sign(rand, priv, digest)
  	if err != nil {
  		return nil, err
  	}
diff --cc src/crypto/hmac/hmac.go
index 6996963660,3c8e727bc8..4576b9843b
--- a/src/crypto/hmac/hmac.go
+++ b/src/crypto/hmac/hmac.go
@@@ -65,14 -64,10 +65,17 @@@ func (h *hmac) Reset() 
  }
  
  // New returns a new HMAC hash using the given hash.Hash type and key.
+ // Note that unlike other hash implementations in the standard library,
+ // the returned Hash does not implement encoding.BinaryMarshaler
+ // or encoding.BinaryUnmarshaler.
  func New(h func() hash.Hash, key []byte) hash.Hash {
 +	if boring.Enabled {
 +		hm := boring.NewHMAC(h, key)
 +		if hm != nil {
 +			return hm
 +		}
 +		// BoringCrypto did not recognize h, so fall through to standard Go code.
 +	}
  	hm := new(hmac)
  	hm.outer = h()
  	hm.inner = h()
diff --cc src/crypto/issue21104_test.go
index 0000000000,b4276df4e1..4662088799
mode 000000,100644..100644
--- a/src/crypto/issue21104_test.go
+++ b/src/crypto/issue21104_test.go
@@@ -1,0 -1,61 +1,61 @@@
+ // Copyright 2017 The Go Authors. All rights reserved.
+ // Use of this source code is governed by a BSD-style
+ // license that can be found in the LICENSE file.
+ 
 -package crypto
++package crypto_test
+ 
+ import (
+ 	"crypto/aes"
+ 	"crypto/cipher"
+ 	"crypto/rc4"
+ 	"testing"
+ )
+ 
+ func TestRC4OutOfBoundsWrite(t *testing.T) {
+ 	// This cipherText is encrypted "0123456789"
+ 	cipherText := []byte{238, 41, 187, 114, 151, 2, 107, 13, 178, 63}
+ 	cipher, err := rc4.NewCipher([]byte{0})
+ 	if err != nil {
+ 		panic(err)
+ 	}
+ 	test(t, "RC4", cipherText, cipher.XORKeyStream)
+ }
+ func TestCTROutOfBoundsWrite(t *testing.T) {
+ 	testBlock(t, "CTR", cipher.NewCTR)
+ }
+ func TestOFBOutOfBoundsWrite(t *testing.T) {
+ 	testBlock(t, "OFB", cipher.NewOFB)
+ }
+ func TestCFBEncryptOutOfBoundsWrite(t *testing.T) {
+ 	testBlock(t, "CFB Encrypt", cipher.NewCFBEncrypter)
+ }
+ func TestCFBDecryptOutOfBoundsWrite(t *testing.T) {
+ 	testBlock(t, "CFB Decrypt", cipher.NewCFBDecrypter)
+ }
+ func testBlock(t *testing.T, name string, newCipher func(cipher.Block, []byte) cipher.Stream) {
+ 	// This cipherText is encrypted "0123456789"
+ 	cipherText := []byte{86, 216, 121, 231, 219, 191, 26, 12, 176, 117}
+ 	var iv, key [16]byte
+ 	block, err := aes.NewCipher(key[:])
+ 	if err != nil {
+ 		panic(err)
+ 	}
+ 	stream := newCipher(block, iv[:])
+ 	test(t, name, cipherText, stream.XORKeyStream)
+ }
+ func test(t *testing.T, name string, cipherText []byte, xor func([]byte, []byte)) {
+ 	want := "abcdefghij"
+ 	plainText := []byte(want)
+ 	shorterLen := len(cipherText) / 2
+ 	defer func() {
+ 		err := recover()
+ 		if err == nil {
+ 			t.Errorf("%v XORKeyStream expected to panic on len(dst) < len(src), but didn't", name)
+ 		}
+ 		const plain = "0123456789"
+ 		if plainText[shorterLen] == plain[shorterLen] {
+ 			t.Errorf("%v XORKeyStream did out of bounds write, want %v, got %v", name, want, string(plainText))
+ 		}
+ 	}()
+ 	xor(plainText[:shorterLen], cipherText)
+ }
diff --cc src/crypto/sha1/sha1.go
index 535937e902,5f32434f0f..3badf55885
--- a/src/crypto/sha1/sha1.go
+++ b/src/crypto/sha1/sha1.go
@@@ -50,11 -113,10 +113,13 @@@ func (d *digest) Reset() 
  	d.len = 0
  }
  
- // New returns a new hash.Hash computing the SHA1 checksum.
+ // New returns a new hash.Hash computing the SHA1 checksum. The Hash also
+ // implements encoding.BinaryMarshaler and encoding.BinaryUnmarshaler to
+ // marshal and unmarshal the internal state of the hash.
  func New() hash.Hash {
 +	if boringEnabled {
 +		return boringNewSHA1()
 +	}
  	d := new(digest)
  	d.Reset()
  	return d
diff --cc src/crypto/sha1/sha1_test.go
index 426402a8c2,8fefde0db2..20095190c3
--- a/src/crypto/sha1/sha1_test.go
+++ b/src/crypto/sha1/sha1_test.go
@@@ -7,8 -7,9 +7,10 @@@
  package sha1
  
  import (
+ 	"bytes"
 +	"crypto/internal/boring"
  	"crypto/rand"
+ 	"encoding"
  	"fmt"
  	"io"
  	"testing"
diff --cc src/crypto/sha256/sha256.go
index f386f83206,f078cab378..a5bb144f0e
--- a/src/crypto/sha256/sha256.go
+++ b/src/crypto/sha256/sha256.go
@@@ -8,7 -8,7 +8,8 @@@ package sha25
  
  import (
  	"crypto"
 +	"crypto/internal/boring"
+ 	"errors"
  	"hash"
  )
  
@@@ -79,11 -164,11 +165,14 @@@ func (d *digest) Reset() 
  	d.len = 0
  }
  
- // New returns a new hash.Hash computing the SHA256 checksum.
+ // New returns a new hash.Hash computing the SHA256 checksum. The Hash
+ // also implements encoding.BinaryMarshaler and
+ // encoding.BinaryUnmarshaler to marshal and unmarshal the internal
+ // state of the hash.
  func New() hash.Hash {
 +	if boring.Enabled {
 +		return boring.NewSHA256()
 +	}
  	d := new(digest)
  	d.Reset()
  	return d
diff --cc src/crypto/sha256/sha256_test.go
index 17721d5635,cd402864e5..a188a64ad1
--- a/src/crypto/sha256/sha256_test.go
+++ b/src/crypto/sha256/sha256_test.go
@@@ -7,9 -7,11 +7,12 @@@
  package sha256
  
  import (
+ 	"bytes"
 +	"crypto/internal/boring"
  	"crypto/rand"
+ 	"encoding"
  	"fmt"
+ 	"hash"
  	"io"
  	"testing"
  )
diff --cc src/crypto/sha512/sha512.go
index d37f853499,2ea27c5535..81918e4fcf
--- a/src/crypto/sha512/sha512.go
+++ b/src/crypto/sha512/sha512.go
@@@ -8,7 -12,7 +12,8 @@@ package sha51
  
  import (
  	"crypto"
 +	"crypto/internal/boring"
+ 	"errors"
  	"hash"
  )
  
@@@ -125,11 -129,94 +130,97 @@@ func (d *digest) Reset() 
  	d.len = 0
  }
  
+ const (
+ 	magic384      = "sha\x04"
+ 	magic512_224  = "sha\x05"
+ 	magic512_256  = "sha\x06"
+ 	magic512      = "sha\x07"
+ 	marshaledSize = len(magic512) + 8*8 + chunk + 8
+ )
+ 
+ func (d *digest) MarshalBinary() ([]byte, error) {
+ 	b := make([]byte, 0, marshaledSize)
+ 	switch d.function {
+ 	case crypto.SHA384:
+ 		b = append(b, magic384...)
+ 	case crypto.SHA512_224:
+ 		b = append(b, magic512_224...)
+ 	case crypto.SHA512_256:
+ 		b = append(b, magic512_256...)
+ 	case crypto.SHA512:
+ 		b = append(b, magic512...)
+ 	default:
+ 		return nil, errors.New("crypto/sha512: invalid hash function")
+ 	}
+ 	b = appendUint64(b, d.h[0])
+ 	b = appendUint64(b, d.h[1])
+ 	b = appendUint64(b, d.h[2])
+ 	b = appendUint64(b, d.h[3])
+ 	b = appendUint64(b, d.h[4])
+ 	b = appendUint64(b, d.h[5])
+ 	b = appendUint64(b, d.h[6])
+ 	b = appendUint64(b, d.h[7])
+ 	b = append(b, d.x[:]...)
+ 	b = appendUint64(b, d.len)
+ 	return b, nil
+ }
+ 
+ func (d *digest) UnmarshalBinary(b []byte) error {
+ 	if len(b) < len(magic512) {
+ 		return errors.New("crypto/sha512: invalid hash state identifier")
+ 	}
+ 	switch {
+ 	case d.function == crypto.SHA384 && string(b[:len(magic384)]) == magic384:
+ 	case d.function == crypto.SHA512_224 && string(b[:len(magic512_224)]) == magic512_224:
+ 	case d.function == crypto.SHA512_256 && string(b[:len(magic512_256)]) == magic512_256:
+ 	case d.function == crypto.SHA512 && string(b[:len(magic512)]) == magic512:
+ 	default:
+ 		return errors.New("crypto/sha512: invalid hash state identifier")
+ 	}
+ 	if len(b) != marshaledSize {
+ 		return errors.New("crypto/sha512: invalid hash state size")
+ 	}
+ 	b = b[len(magic512):]
+ 	b, d.h[0] = consumeUint64(b)
+ 	b, d.h[1] = consumeUint64(b)
+ 	b, d.h[2] = consumeUint64(b)
+ 	b, d.h[3] = consumeUint64(b)
+ 	b, d.h[4] = consumeUint64(b)
+ 	b, d.h[5] = consumeUint64(b)
+ 	b, d.h[6] = consumeUint64(b)
+ 	b, d.h[7] = consumeUint64(b)
+ 	b = b[copy(d.x[:], b):]
+ 	b, d.len = consumeUint64(b)
+ 	d.nx = int(d.len) % chunk
+ 	return nil
+ }
+ 
+ func appendUint64(b []byte, x uint64) []byte {
+ 	a := [8]byte{
+ 		byte(x >> 56),
+ 		byte(x >> 48),
+ 		byte(x >> 40),
+ 		byte(x >> 32),
+ 		byte(x >> 24),
+ 		byte(x >> 16),
+ 		byte(x >> 8),
+ 		byte(x),
+ 	}
+ 	return append(b, a[:]...)
+ }
+ 
+ func consumeUint64(b []byte) ([]byte, uint64) {
+ 	_ = b[7]
+ 	x := uint64(b[7]) | uint64(b[6])<<8 | uint64(b[5])<<16 | uint64(b[4])<<24 |
+ 		uint64(b[3])<<32 | uint64(b[2])<<40 | uint64(b[1])<<48 | uint64(b[0])<<56
+ 	return b[8:], x
+ }
+ 
  // New returns a new hash.Hash computing the SHA-512 checksum.
  func New() hash.Hash {
 +	if boring.Enabled {
 +		return boring.NewSHA512()
 +	}
  	d := &digest{function: crypto.SHA512}
  	d.Reset()
  	return d
diff --cc src/crypto/sha512/sha512_test.go
index 2c41d1a3ec,4423cf5f18..93c4591bd8
--- a/src/crypto/sha512/sha512_test.go
+++ b/src/crypto/sha512/sha512_test.go
@@@ -7,8 -7,9 +7,10 @@@
  package sha512
  
  import (
+ 	"bytes"
 +	"crypto/internal/boring"
  	"crypto/rand"
+ 	"encoding"
  	"encoding/hex"
  	"hash"
  	"io"
diff --cc src/crypto/tls/boring.go
index 791049f0d3,0000000000..f6d922c673
mode 100644,000000..100644
--- a/src/crypto/tls/boring.go
+++ b/src/crypto/tls/boring.go
@@@ -1,121 -1,0 +1,121 @@@
 +// Copyright 2017 The Go Authors. All rights reserved.
 +// Use of this source code is governed by a BSD-style
 +// license that can be found in the LICENSE file.
 +
 +package tls
 +
 +import (
 +	"crypto/ecdsa"
 +	"crypto/internal/boring/fipstls"
 +	"crypto/rsa"
 +	"crypto/x509"
 +)
 +
 +// needFIPS returns fipstls.Required(); it avoids a new import in common.go.
 +func needFIPS() bool {
 +	return fipstls.Required()
 +}
 +
 +// fipsMinVersion replaces c.minVersion in FIPS-only mode.
 +func fipsMinVersion(c *Config) uint16 {
 +	// FIPS requires TLS 1.2.
 +	return VersionTLS12
 +}
 +
 +// fipsMaxVersion replaces c.maxVersion in FIPS-only mode.
 +func fipsMaxVersion(c *Config) uint16 {
 +	// FIPS requires TLS 1.2.
 +	return VersionTLS12
 +}
 +
 +// default defaultFIPSCurvePreferences is the FIPS-allowed curves,
 +// in preference order (most preferable first).
 +var defaultFIPSCurvePreferences = []CurveID{CurveP256, CurveP384, CurveP521}
 +
 +// fipsCurvePreferences replaces c.curvePreferences in FIPS-only mode.
 +func fipsCurvePreferences(c *Config) []CurveID {
 +	if c == nil || len(c.CurvePreferences) == 0 {
 +		return defaultFIPSCurvePreferences
 +	}
 +	var list []CurveID
 +	for _, id := range c.CurvePreferences {
 +		for _, allowed := range defaultFIPSCurvePreferences {
 +			if id == allowed {
 +				list = append(list, id)
 +				break
 +			}
 +		}
 +	}
 +	return list
 +}
 +
 +// default FIPSCipherSuites is the FIPS-allowed cipher suites,
 +// in preference order (most preferable first).
 +var defaultFIPSCipherSuites = []uint16{
 +	TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,
 +	TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,
 +	TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,
 +	TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,
 +	TLS_RSA_WITH_AES_128_GCM_SHA256,
 +	TLS_RSA_WITH_AES_256_GCM_SHA384,
 +}
 +
 +// fipsCipherSuites replaces c.cipherSuites in FIPS-only mode.
 +func fipsCipherSuites(c *Config) []uint16 {
 +	if c == nil || c.CipherSuites == nil {
 +		return defaultFIPSCipherSuites
 +	}
 +	var list []uint16
 +	for _, id := range c.CipherSuites {
 +		for _, allowed := range defaultFIPSCipherSuites {
 +			if id == allowed {
 +				list = append(list, id)
 +				break
 +			}
 +		}
 +	}
 +	return list
 +}
 +
 +// isBoringCertificate reports whether a certificate may be used
 +// when constructing a verified chain.
 +// It is called for each leaf, intermediate, and root certificate.
 +func isBoringCertificate(c *x509.Certificate) bool {
 +	if !needFIPS() {
 +		// Everything is OK if we haven't forced FIPS-only mode.
 +		return true
 +	}
 +
 +	// Otherwise the key must be RSA 2048, RSA 3072, or ECDSA P-256.
 +	switch k := c.PublicKey.(type) {
 +	default:
 +		return false
 +	case *rsa.PublicKey:
 +		if size := k.N.BitLen(); size != 2048 && size != 3072 {
 +			return false
 +		}
 +	case *ecdsa.PublicKey:
 +		if name := k.Curve.Params().Name; name != "P-256" && name != "P-384" {
 +			return false
 +		}
 +	}
 +
 +	return true
 +}
 +
 +// supportedSignatureAlgorithms returns the supported signature algorithms.
 +// It knows that the FIPS-allowed ones are all at the beginning of
 +// defaultSupportedSignatureAlgorithms.
- func supportedSignatureAlgorithms() []signatureAndHash {
++func supportedSignatureAlgorithms() []SignatureScheme {
 +	all := defaultSupportedSignatureAlgorithms
 +	if !needFIPS() {
 +		return all
 +	}
 +	i := 0
- 	for i < len(all) && all[i].hash != hashSHA1 {
++	for i < len(all) && all[i] != PKCS1WithSHA1 {
 +		i++
 +	}
 +	return all[:i]
 +}
 +
- var testingOnlyForceClientHelloSignatureAndHashes []signatureAndHash
++var testingOnlyForceClientHelloSignatureAlgorithms []SignatureScheme
diff --cc src/crypto/tls/boring_test.go
index 15422f8adf,0000000000..f31f3f6bc8
mode 100644,000000..100644
--- a/src/crypto/tls/boring_test.go
+++ b/src/crypto/tls/boring_test.go
@@@ -1,579 -1,0 +1,576 @@@
 +// Copyright 2017 The Go Authors. All rights reserved.
 +// Use of this source code is governed by a BSD-style
 +// license that can be found in the LICENSE file.
 +
 +package tls
 +
 +import (
 +	"crypto/ecdsa"
 +	"crypto/elliptic"
 +	"crypto/internal/boring/fipstls"
 +	"crypto/rand"
 +	"crypto/rsa"
 +	"crypto/x509"
 +	"crypto/x509/pkix"
 +	"fmt"
 +	"math/big"
 +	"net"
 +	"runtime"
 +	"strings"
 +	"testing"
 +	"time"
 +)
 +
 +func TestBoringServerProtocolVersion(t *testing.T) {
 +	test := func(name string, v uint16, msg string) {
 +		t.Run(name, func(t *testing.T) {
 +			serverConfig := testConfig.Clone()
 +			serverConfig.MinVersion = VersionSSL30
 +			clientHello := &clientHelloMsg{
 +				vers:               v,
 +				cipherSuites:       allCipherSuites(),
 +				compressionMethods: []uint8{compressionNone},
 +			}
 +			testClientHelloFailure(t, serverConfig, clientHello, msg)
 +		})
 +	}
 +
 +	test("VersionSSL30", VersionSSL30, "")
 +	test("VersionTLS10", VersionTLS10, "")
 +	test("VersionTLS11", VersionTLS11, "")
 +	test("VersionTLS12", VersionTLS12, "")
 +
 +	fipstls.Force()
 +	defer fipstls.Abandon()
 +	test("VersionSSL30", VersionSSL30, "unsupported, maximum protocol version")
 +	test("VersionTLS10", VersionTLS10, "unsupported, maximum protocol version")
 +	test("VersionTLS11", VersionTLS11, "unsupported, maximum protocol version")
 +	test("VersionTLS12", VersionTLS12, "")
 +}
 +
 +func isBoringCipherSuite(id uint16) bool {
 +	switch id {
 +	case TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,
 +		TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,
 +		TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,
 +		TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,
 +		TLS_RSA_WITH_AES_128_GCM_SHA256,
 +		TLS_RSA_WITH_AES_256_GCM_SHA384:
 +		return true
 +	}
 +	return false
 +}
 +
 +func isBoringCurve(id CurveID) bool {
 +	switch id {
 +	case CurveP256, CurveP384, CurveP521:
 +		return true
 +	}
 +	return false
 +}
 +
 +func isECDSA(id uint16) bool {
 +	for _, suite := range cipherSuites {
 +		if suite.id == id {
 +			return suite.flags&suiteECDSA == suiteECDSA
 +		}
 +	}
 +	panic(fmt.Sprintf("unknown cipher suite %#x", id))
 +}
 +
- func isBoringSignatureAndHash(sigHash signatureAndHash) bool {
- 	switch sigHash.signature {
++func isBoringSignatureScheme(alg SignatureScheme) bool {
++	switch alg {
 +	default:
 +		return false
- 	case signatureRSA,
- 		signatureECDSA:
- 		// ok
- 	}
- 	switch sigHash.hash {
- 	default:
- 		return false
- 	case hashSHA256,
- 		hashSHA384:
++	case PKCS1WithSHA256,
++		ECDSAWithP256AndSHA256,
++		PKCS1WithSHA384,
++		ECDSAWithP384AndSHA384,
++		PKCS1WithSHA512,
++		ECDSAWithP521AndSHA512:
 +		// ok
 +	}
 +	return true
 +}
 +
 +func TestBoringServerCipherSuites(t *testing.T) {
 +	serverConfig := testConfig.Clone()
 +	serverConfig.CipherSuites = allCipherSuites()
 +	serverConfig.Certificates = make([]Certificate, 1)
 +
 +	for _, id := range allCipherSuites() {
 +		if isECDSA(id) {
 +			serverConfig.Certificates[0].Certificate = [][]byte{testECDSACertificate}
 +			serverConfig.Certificates[0].PrivateKey = testECDSAPrivateKey
 +		} else {
 +			serverConfig.Certificates[0].Certificate = [][]byte{testRSACertificate}
 +			serverConfig.Certificates[0].PrivateKey = testRSAPrivateKey
 +		}
 +		serverConfig.BuildNameToCertificate()
 +		t.Run(fmt.Sprintf("suite=%#x", id), func(t *testing.T) {
 +			clientHello := &clientHelloMsg{
 +				vers:               VersionTLS12,
 +				cipherSuites:       []uint16{id},
 +				compressionMethods: []uint8{compressionNone},
 +				supportedCurves:    defaultCurvePreferences,
 +				supportedPoints:    []uint8{pointFormatUncompressed},
 +			}
 +
 +			testClientHello(t, serverConfig, clientHello)
 +			t.Run("fipstls", func(t *testing.T) {
 +				fipstls.Force()
 +				defer fipstls.Abandon()
 +				msg := ""
 +				if !isBoringCipherSuite(id) {
 +					msg = "no cipher suite supported by both client and server"
 +				}
 +				testClientHelloFailure(t, serverConfig, clientHello, msg)
 +			})
 +		})
 +	}
 +}
 +
 +func TestBoringServerCurves(t *testing.T) {
 +	serverConfig := testConfig.Clone()
 +	serverConfig.Certificates = make([]Certificate, 1)
 +	serverConfig.Certificates[0].Certificate = [][]byte{testECDSACertificate}
 +	serverConfig.Certificates[0].PrivateKey = testECDSAPrivateKey
 +	serverConfig.BuildNameToCertificate()
 +
 +	for _, curveid := range defaultCurvePreferences {
 +		t.Run(fmt.Sprintf("curve=%d", curveid), func(t *testing.T) {
 +			clientHello := &clientHelloMsg{
 +				vers:               VersionTLS12,
 +				cipherSuites:       []uint16{TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256},
 +				compressionMethods: []uint8{compressionNone},
 +				supportedCurves:    []CurveID{curveid},
 +				supportedPoints:    []uint8{pointFormatUncompressed},
 +			}
 +
 +			testClientHello(t, serverConfig, clientHello)
 +
 +			// With fipstls forced, bad curves should be rejected.
 +			t.Run("fipstls", func(t *testing.T) {
 +				fipstls.Force()
 +				defer fipstls.Abandon()
 +				msg := ""
 +				if !isBoringCurve(curveid) {
 +					msg = "no cipher suite supported by both client and server"
 +				}
 +				testClientHelloFailure(t, serverConfig, clientHello, msg)
 +			})
 +		})
 +	}
 +}
 +
 +func boringHandshake(t *testing.T, clientConfig, serverConfig *Config) (clientErr, serverErr error) {
 +	c, s := realNetPipe(t)
 +	client := Client(c, clientConfig)
 +	server := Server(s, serverConfig)
 +	done := make(chan error, 1)
 +	go func() {
 +		done <- client.Handshake()
 +		c.Close()
 +	}()
 +	serverErr = server.Handshake()
 +	s.Close()
 +	clientErr = <-done
 +	return
 +}
 +
 +func TestBoringServerSignatureAndHash(t *testing.T) {
 +	serverConfig := testConfig.Clone()
 +	serverConfig.Certificates = make([]Certificate, 1)
 +
 +	defer func() {
- 		testingOnlyForceClientHelloSignatureAndHashes = nil
++		testingOnlyForceClientHelloSignatureAlgorithms = nil
 +	}()
 +
 +	for _, sigHash := range defaultSupportedSignatureAlgorithms {
- 		testingOnlyForceClientHelloSignatureAndHashes = []signatureAndHash{sigHash}
++		testingOnlyForceClientHelloSignatureAlgorithms = []SignatureScheme{sigHash}
 +
 +		t.Run(fmt.Sprintf("%v", sigHash), func(t *testing.T) {
- 			if sigHash.signature == signatureRSA {
++			if sigHash == PKCS1WithSHA1 || sigHash == PKCS1WithSHA256 || sigHash == PKCS1WithSHA384 || sigHash == PKCS1WithSHA512 {
 +				serverConfig.CipherSuites = []uint16{TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256}
 +				serverConfig.Certificates[0].Certificate = [][]byte{testRSACertificate}
 +				serverConfig.Certificates[0].PrivateKey = testRSAPrivateKey
 +			} else {
 +				serverConfig.CipherSuites = []uint16{TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256}
 +				serverConfig.Certificates = make([]Certificate, 1)
 +				serverConfig.Certificates[0].Certificate = [][]byte{testECDSACertificate}
 +				serverConfig.Certificates[0].PrivateKey = testECDSAPrivateKey
 +			}
 +			serverConfig.BuildNameToCertificate()
 +
 +			clientErr, _ := boringHandshake(t, testConfig, serverConfig)
 +			if clientErr != nil {
 +				t.Fatalf("expected handshake with %v to succeed; err=%v", sigHash, clientErr)
 +			}
 +
 +			// With fipstls forced, bad curves should be rejected.
 +			t.Run("fipstls", func(t *testing.T) {
 +				fipstls.Force()
 +				defer fipstls.Abandon()
 +				clientErr, _ := boringHandshake(t, testConfig, serverConfig)
- 				if isBoringSignatureAndHash(sigHash) {
++				if isBoringSignatureScheme(sigHash) {
 +					if clientErr != nil {
 +						t.Fatalf("expected handshake with %v to succeed; err=%v", sigHash, clientErr)
 +					}
 +				} else {
 +					if clientErr == nil {
 +						t.Fatalf("expected handshake with %v to fail, but it succeeded", sigHash)
 +					}
 +				}
 +			})
 +		})
 +	}
 +}
 +
 +func TestBoringClientHello(t *testing.T) {
 +	// Test that no matter what we put in the client config,
 +	// the client does not offer non-FIPS configurations.
 +	fipstls.Force()
 +	defer fipstls.Abandon()
 +
 +	c, s := net.Pipe()
 +	defer c.Close()
 +	defer s.Close()
 +
 +	clientConfig := testConfig.Clone()
 +	// All sorts of traps for the client to avoid.
 +	clientConfig.MinVersion = VersionSSL30
 +	clientConfig.CipherSuites = allCipherSuites()
 +	clientConfig.CurvePreferences = defaultCurvePreferences
 +
 +	go Client(c, testConfig).Handshake()
 +	srv := Server(s, testConfig)
 +	msg, err := srv.readHandshake()
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +	hello, ok := msg.(*clientHelloMsg)
 +	if !ok {
 +		t.Fatalf("unexpected message type %T", msg)
 +	}
 +
 +	if hello.vers != VersionTLS12 {
 +		t.Errorf("client vers=%#x, want %#x (TLS 1.2)", hello.vers, VersionTLS12)
 +	}
 +	for _, id := range hello.cipherSuites {
 +		if !isBoringCipherSuite(id) {
 +			t.Errorf("client offered disallowed suite %#x", id)
 +		}
 +	}
 +	for _, id := range hello.supportedCurves {
 +		if !isBoringCurve(id) {
 +			t.Errorf("client offered disallowed curve %d", id)
 +		}
 +	}
- 	for _, sigHash := range hello.signatureAndHashes {
- 		if !isBoringSignatureAndHash(sigHash) {
++	for _, sigHash := range hello.supportedSignatureAlgorithms {
++		if !isBoringSignatureScheme(sigHash) {
 +			t.Errorf("client offered disallowed signature-and-hash %v", sigHash)
 +		}
 +	}
 +}
 +
 +func TestBoringCertAlgs(t *testing.T) {
 +	// NaCl and arm time out generating keys. Nothing in this test is architecture-specific, so just don't bother on those.
 +	if runtime.GOOS == "nacl" || runtime.GOARCH == "arm" {
 +		t.Skipf("skipping on %s/%s because key generation takes too long", runtime.GOOS, runtime.GOARCH)
 +	}
 +
 +	// Set up some roots, intermediate CAs, and leaf certs with various algorithms.
 +	// X_Y is X signed by Y.
 +	R1 := boringCert(t, "R1", boringRSAKey(t, 2048), nil, boringCertCA|boringCertFIPSOK)
 +	R2 := boringCert(t, "R2", boringRSAKey(t, 4096), nil, boringCertCA)
 +
 +	M1_R1 := boringCert(t, "M1_R1", boringECDSAKey(t, elliptic.P256()), R1, boringCertCA|boringCertFIPSOK)
 +	M2_R1 := boringCert(t, "M2_R1", boringECDSAKey(t, elliptic.P224()), R1, boringCertCA)
 +
 +	I_R1 := boringCert(t, "I_R1", boringRSAKey(t, 3072), R1, boringCertCA|boringCertFIPSOK)
 +	I_R2 := boringCert(t, "I_R2", I_R1.key, R2, boringCertCA|boringCertFIPSOK)
 +	I_M1 := boringCert(t, "I_M1", I_R1.key, M1_R1, boringCertCA|boringCertFIPSOK)
 +	I_M2 := boringCert(t, "I_M2", I_R1.key, M2_R1, boringCertCA|boringCertFIPSOK)
 +
 +	L1_I := boringCert(t, "L1_I", boringECDSAKey(t, elliptic.P384()), I_R1, boringCertLeaf|boringCertFIPSOK)
 +	L2_I := boringCert(t, "L2_I", boringRSAKey(t, 1024), I_R1, boringCertLeaf)
 +
 +	// boringCert checked that isBoringCertificate matches the caller's boringCertFIPSOK bit.
 +	// If not, no point in building bigger end-to-end tests.
 +	if t.Failed() {
 +		t.Fatalf("isBoringCertificate failures; not continuing")
 +	}
 +
 +	// client verifying server cert
 +	testServerCert := func(t *testing.T, desc string, pool *x509.CertPool, key interface{}, list [][]byte, ok bool) {
 +		clientConfig := testConfig.Clone()
 +		clientConfig.RootCAs = pool
 +		clientConfig.InsecureSkipVerify = false
 +		clientConfig.ServerName = "example.com"
 +
 +		serverConfig := testConfig.Clone()
 +		serverConfig.Certificates = []Certificate{{Certificate: list, PrivateKey: key}}
 +		serverConfig.BuildNameToCertificate()
 +
 +		clientErr, _ := boringHandshake(t, clientConfig, serverConfig)
 +
 +		if (clientErr == nil) == ok {
 +			if ok {
 +				t.Logf("%s: accept", desc)
 +			} else {
 +				t.Logf("%s: reject", desc)
 +			}
 +		} else {
 +			if ok {
 +				t.Errorf("%s: BAD reject (%v)", desc, clientErr)
 +			} else {
 +				t.Errorf("%s: BAD accept", desc)
 +			}
 +		}
 +	}
 +
 +	// server verifying client cert
 +	testClientCert := func(t *testing.T, desc string, pool *x509.CertPool, key interface{}, list [][]byte, ok bool) {
 +		clientConfig := testConfig.Clone()
 +		clientConfig.ServerName = "example.com"
 +		clientConfig.Certificates = []Certificate{{Certificate: list, PrivateKey: key}}
 +
 +		serverConfig := testConfig.Clone()
 +		serverConfig.ClientCAs = pool
 +		serverConfig.ClientAuth = RequireAndVerifyClientCert
 +
 +		_, serverErr := boringHandshake(t, clientConfig, serverConfig)
 +
 +		if (serverErr == nil) == ok {
 +			if ok {
 +				t.Logf("%s: accept", desc)
 +			} else {
 +				t.Logf("%s: reject", desc)
 +			}
 +		} else {
 +			if ok {
 +				t.Errorf("%s: BAD reject (%v)", desc, serverErr)
 +			} else {
 +				t.Errorf("%s: BAD accept", desc)
 +			}
 +		}
 +	}
 +
 +	// Run simple basic test with known answers before proceeding to
 +	// exhaustive test with computed answers.
 +	r1pool := x509.NewCertPool()
 +	r1pool.AddCert(R1.cert)
 +	testServerCert(t, "basic", r1pool, L2_I.key, [][]byte{L2_I.der, I_R1.der}, true)
 +	testClientCert(t, "basic (client cert)", r1pool, L2_I.key, [][]byte{L2_I.der, I_R1.der}, true)
 +	fipstls.Force()
 +	testServerCert(t, "basic (fips)", r1pool, L2_I.key, [][]byte{L2_I.der, I_R1.der}, false)
 +	testClientCert(t, "basic (fips, client cert)", r1pool, L2_I.key, [][]byte{L2_I.der, I_R1.der}, false)
 +	fipstls.Abandon()
 +
 +	if t.Failed() {
 +		t.Fatal("basic test failed, skipping exhaustive test")
 +	}
 +
 +	if testing.Short() {
 +		t.Logf("basic test passed; skipping exhaustive test in -short mode")
 +		return
 +	}
 +
 +	for l := 1; l <= 2; l++ {
 +		leaf := L1_I
 +		if l == 2 {
 +			leaf = L2_I
 +		}
 +		for i := 0; i < 64; i++ {
 +			reachable := map[string]bool{leaf.parentOrg: true}
 +			reachableFIPS := map[string]bool{leaf.parentOrg: leaf.fipsOK}
 +			list := [][]byte{leaf.der}
 +			listName := leaf.name
 +			addList := func(cond int, c *boringCertificate) {
 +				if cond != 0 {
 +					list = append(list, c.der)
 +					listName += "," + c.name
 +					if reachable[c.org] {
 +						reachable[c.parentOrg] = true
 +					}
 +					if reachableFIPS[c.org] && c.fipsOK {
 +						reachableFIPS[c.parentOrg] = true
 +					}
 +				}
 +			}
 +			addList(i&1, I_R1)
 +			addList(i&2, I_R2)
 +			addList(i&4, I_M1)
 +			addList(i&8, I_M2)
 +			addList(i&16, M1_R1)
 +			addList(i&32, M2_R1)
 +
 +			for r := 1; r <= 3; r++ {
 +				pool := x509.NewCertPool()
 +				rootName := ","
 +				shouldVerify := false
 +				shouldVerifyFIPS := false
 +				addRoot := func(cond int, c *boringCertificate) {
 +					if cond != 0 {
 +						rootName += "," + c.name
 +						pool.AddCert(c.cert)
 +						if reachable[c.org] {
 +							shouldVerify = true
 +						}
 +						if reachableFIPS[c.org] && c.fipsOK {
 +							shouldVerifyFIPS = true
 +						}
 +					}
 +				}
 +				addRoot(r&1, R1)
 +				addRoot(r&2, R2)
 +				rootName = rootName[1:] // strip leading comma
 +				testServerCert(t, listName+"->"+rootName[1:], pool, leaf.key, list, shouldVerify)
 +				testClientCert(t, listName+"->"+rootName[1:]+"(client cert)", pool, leaf.key, list, shouldVerify)
 +				fipstls.Force()
 +				testServerCert(t, listName+"->"+rootName[1:]+" (fips)", pool, leaf.key, list, shouldVerifyFIPS)
 +				testClientCert(t, listName+"->"+rootName[1:]+" (fips, client cert)", pool, leaf.key, list, shouldVerifyFIPS)
 +				fipstls.Abandon()
 +			}
 +		}
 +	}
 +}
 +
 +const (
 +	boringCertCA = iota
 +	boringCertLeaf
 +	boringCertFIPSOK = 0x80
 +)
 +
 +func boringRSAKey(t *testing.T, size int) *rsa.PrivateKey {
 +	k, err := rsa.GenerateKey(rand.Reader, size)
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +	return k
 +}
 +
 +func boringECDSAKey(t *testing.T, curve elliptic.Curve) *ecdsa.PrivateKey {
 +	k, err := ecdsa.GenerateKey(curve, rand.Reader)
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +	return k
 +}
 +
 +type boringCertificate struct {
 +	name      string
 +	org       string
 +	parentOrg string
 +	der       []byte
 +	cert      *x509.Certificate
 +	key       interface{}
 +	fipsOK    bool
 +}
 +
 +func boringCert(t *testing.T, name string, key interface{}, parent *boringCertificate, mode int) *boringCertificate {
 +	org := name
 +	parentOrg := ""
 +	if i := strings.Index(org, "_"); i >= 0 {
 +		org = org[:i]
 +		parentOrg = name[i+1:]
 +	}
 +	tmpl := &x509.Certificate{
 +		SerialNumber: big.NewInt(1),
 +		Subject: pkix.Name{
 +			Organization: []string{org},
 +		},
 +		NotBefore: time.Unix(0, 0),
 +		NotAfter:  time.Unix(0, 0),
 +
 +		KeyUsage:              x509.KeyUsageKeyEncipherment | x509.KeyUsageDigitalSignature,
 +		ExtKeyUsage:           []x509.ExtKeyUsage{x509.ExtKeyUsageServerAuth, x509.ExtKeyUsageClientAuth},
 +		BasicConstraintsValid: true,
 +	}
 +	if mode&^boringCertFIPSOK == boringCertLeaf {
 +		tmpl.DNSNames = []string{"example.com"}
 +	} else {
 +		tmpl.IsCA = true
 +		tmpl.KeyUsage |= x509.KeyUsageCertSign
 +	}
 +
 +	var pcert *x509.Certificate
 +	var pkey interface{}
 +	if parent != nil {
 +		pcert = parent.cert
 +		pkey = parent.key
 +	} else {
 +		pcert = tmpl
 +		pkey = key
 +	}
 +
 +	var pub interface{}
 +	var desc string
 +	switch k := key.(type) {
 +	case *rsa.PrivateKey:
 +		pub = &k.PublicKey
 +		desc = fmt.Sprintf("RSA-%d", k.N.BitLen())
 +	case *ecdsa.PrivateKey:
 +		pub = &k.PublicKey
 +		desc = "ECDSA-" + k.Curve.Params().Name
 +	default:
 +		t.Fatalf("invalid key %T", key)
 +	}
 +
 +	der, err := x509.CreateCertificate(rand.Reader, tmpl, pcert, pub, pkey)
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +	cert, err := x509.ParseCertificate(der)
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +
 +	// Tell isBoringCertificate to enforce FIPS restrictions for this check.
 +	fipstls.Force()
 +	defer fipstls.Abandon()
 +
 +	fipsOK := mode&boringCertFIPSOK != 0
 +	if isBoringCertificate(cert) != fipsOK {
 +		t.Errorf("isBoringCertificate(cert with %s key) = %v, want %v", desc, !fipsOK, fipsOK)
 +	}
 +	return &boringCertificate{name, org, parentOrg, der, cert, key, fipsOK}
 +}
 +
 +func boringPool(t *testing.T, list ...*boringCertificate) *x509.CertPool {
 +	pool := x509.NewCertPool()
 +	for _, c := range list {
 +		cert, err := x509.ParseCertificate(c.der)
 +		if err != nil {
 +			t.Fatal(err)
 +		}
 +		pool.AddCert(cert)
 +	}
 +	return pool
 +}
 +
 +func boringList(t *testing.T, list ...*boringCertificate) [][]byte {
 +	var all [][]byte
 +	for _, c := range list {
 +		all = append(all, c.der)
 +	}
 +	return all
 +}
 +
 +// realNetPipe is like net.Pipe but returns an actual network socket pair,
 +// which has buffering that avoids various deadlocks if both sides
 +// try to speak at the same time.
 +func realNetPipe(t *testing.T) (net.Conn, net.Conn) {
 +	l := newLocalListener(t)
 +	defer l.Close()
 +	c, err := net.Dial("tcp", l.Addr().String())
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +	s, err := l.Accept()
 +	if err != nil {
 +		c.Close()
 +		t.Fatal(err)
 +	}
 +	return c, s
 +}
diff --cc src/crypto/tls/common.go
index bf1128dd4e,d4b0286b85..a4641db7a6
--- a/src/crypto/tls/common.go
+++ b/src/crypto/tls/common.go
@@@ -139,22 -133,19 +133,19 @@@ const 
  	signatureECDSA uint8 = 3
  )
  
- // signatureAndHash mirrors the TLS 1.2, SignatureAndHashAlgorithm struct. See
- // RFC 5246, section A.4.1.
- type signatureAndHash struct {
- 	hash, signature uint8
- }
- 
 -// supportedSignatureAlgorithms contains the signature and hash algorithms that
 +// defaultSupportedSignatureAlgorithms contains the signature and hash algorithms that
  // the code advertises as supported in a TLS 1.2 ClientHello and in a TLS 1.2
- // CertificateRequest.
- var defaultSupportedSignatureAlgorithms = []signatureAndHash{
- 	{hashSHA256, signatureRSA},
- 	{hashSHA256, signatureECDSA},
- 	{hashSHA384, signatureRSA},
- 	{hashSHA384, signatureECDSA},
- 	{hashSHA1, signatureRSA},
- 	{hashSHA1, signatureECDSA},
+ // CertificateRequest. The two fields are merged to match with TLS 1.3.
+ // Note that in TLS 1.2, the ECDSA algorithms are not constrained to P-256, etc.
 -var supportedSignatureAlgorithms = []SignatureScheme{
++var defaultSupportedSignatureAlgorithms = []SignatureScheme{
+ 	PKCS1WithSHA256,
+ 	ECDSAWithP256AndSHA256,
+ 	PKCS1WithSHA384,
+ 	ECDSAWithP384AndSHA384,
+ 	PKCS1WithSHA512,
+ 	ECDSAWithP521AndSHA512,
+ 	PKCS1WithSHA1,
+ 	ECDSAWithSHA1,
  }
  
  // ConnectionState records basic TLS details about the connection.
diff --cc src/crypto/tls/handshake_client.go
index 47a06bde49,dc529c96d6..8ab34c02e5
--- a/src/crypto/tls/handshake_client.go
+++ b/src/crypto/tls/handshake_client.go
@@@ -99,11 -85,29 +85,32 @@@ NextCipherSuite
  	}
  
  	if hello.vers >= VersionTLS12 {
- 		hello.signatureAndHashes = supportedSignatureAlgorithms()
 -		hello.supportedSignatureAlgorithms = supportedSignatureAlgorithms
++		hello.supportedSignatureAlgorithms = supportedSignatureAlgorithms()
++	}
++	if testingOnlyForceClientHelloSignatureAlgorithms != nil {
++		hello.supportedSignatureAlgorithms = testingOnlyForceClientHelloSignatureAlgorithms
  	}
  
- 	if testingOnlyForceClientHelloSignatureAndHashes != nil {
- 		hello.signatureAndHashes = testingOnlyForceClientHelloSignatureAndHashes
+ 	return hello, nil
+ }
+ 
+ // c.out.Mutex <= L; c.handshakeMutex <= L.
+ func (c *Conn) clientHandshake() error {
+ 	if c.config == nil {
+ 		c.config = defaultConfig()
+ 	}
+ 
+ 	// This may be a renegotiation handshake, in which case some fields
+ 	// need to be reset.
+ 	c.didResume = false
+ 
+ 	hello, err := makeClientHello(c.config)
+ 	if err != nil {
+ 		return err
+ 	}
+ 
+ 	if c.handshakes > 0 {
+ 		hello.secureRenegotiation = c.clientFinished[:]
  	}
  
  	var session *ClientSessionState
diff --cc src/crypto/tls/handshake_messages_test.go
index 7f3d03a463,37eb748eea..1bf12c9ff2
--- a/src/crypto/tls/handshake_messages_test.go
+++ b/src/crypto/tls/handshake_messages_test.go
@@@ -141,7 -145,7 +145,7 @@@ func (*clientHelloMsg) Generate(rand *r
  		}
  	}
  	if rand.Intn(10) > 5 {
- 		m.signatureAndHashes = supportedSignatureAlgorithms()
 -		m.supportedSignatureAlgorithms = supportedSignatureAlgorithms
++		m.supportedSignatureAlgorithms = supportedSignatureAlgorithms()
  	}
  	m.alpnProtocols = make([]string, rand.Intn(5))
  	for i := range m.alpnProtocols {
diff --cc src/crypto/tls/handshake_server.go
index 93e664079f,991b4e9e62..07e388a35e
--- a/src/crypto/tls/handshake_server.go
+++ b/src/crypto/tls/handshake_server.go
@@@ -418,7 -418,7 +418,7 @@@ func (hs *serverHandshakeState) doFullH
  		}
  		if c.vers >= VersionTLS12 {
  			certReq.hasSignatureAndHash = true
- 			certReq.signatureAndHashes = supportedSignatureAlgorithms()
 -			certReq.supportedSignatureAlgorithms = supportedSignatureAlgorithms
++			certReq.supportedSignatureAlgorithms = supportedSignatureAlgorithms()
  		}
  
  		// An empty list of certificateAuthorities signals to
@@@ -519,12 -519,14 +519,14 @@@
  		}
  
  		// Determine the signature type.
- 		var signatureAndHash signatureAndHash
+ 		var signatureAlgorithm SignatureScheme
+ 		var sigType uint8
  		if certVerify.hasSignatureAndHash {
- 			signatureAndHash = certVerify.signatureAndHash
- 			if !isSupportedSignatureAndHash(signatureAndHash, supportedSignatureAlgorithms()) {
+ 			signatureAlgorithm = certVerify.signatureAlgorithm
 -			if !isSupportedSignatureAlgorithm(signatureAlgorithm, supportedSignatureAlgorithms) {
++			if !isSupportedSignatureAlgorithm(signatureAlgorithm, supportedSignatureAlgorithms()) {
  				return errors.New("tls: unsupported hash function for client certificate")
  			}
+ 			sigType = signatureFromSignatureScheme(signatureAlgorithm)
  		} else {
  			// Before TLS 1.2 the signature algorithm was implicit
  			// from the key type, and only one hash per signature
diff --cc src/crypto/tls/key_agreement.go
index e8a46b8708,3f570b66c6..a168c5b260
--- a/src/crypto/tls/key_agreement.go
+++ b/src/crypto/tls/key_agreement.go
@@@ -110,14 -110,14 +110,14 @@@ func md5SHA1Hash(slices [][]byte) []byt
  }
  
  // hashForServerKeyExchange hashes the given slices and returns their digest
- // and the identifier of the hash function used. The sigAndHash argument is
- // only used for >= TLS 1.2 and precisely identifies the hash function to use.
- func hashForServerKeyExchange(sigAndHash signatureAndHash, version uint16, slices ...[]byte) ([]byte, crypto.Hash, error) {
+ // and the identifier of the hash function used. The signatureAlgorithm argument
+ // is only used for >= TLS 1.2 and identifies the hash function to use.
+ func hashForServerKeyExchange(sigType uint8, signatureAlgorithm SignatureScheme, version uint16, slices ...[]byte) ([]byte, crypto.Hash, error) {
  	if version >= VersionTLS12 {
- 		if !isSupportedSignatureAndHash(sigAndHash, supportedSignatureAlgorithms()) {
 -		if !isSupportedSignatureAlgorithm(signatureAlgorithm, supportedSignatureAlgorithms) {
++		if !isSupportedSignatureAlgorithm(signatureAlgorithm, supportedSignatureAlgorithms()) {
  			return nil, crypto.Hash(0), errors.New("tls: unsupported hash function used by peer")
  		}
- 		hashFunc, err := lookupTLSHash(sigAndHash.hash)
+ 		hashFunc, err := lookupTLSHash(signatureAlgorithm)
  		if err != nil {
  			return nil, crypto.Hash(0), err
  		}
@@@ -142,15 -142,22 +142,22 @@@ func pickTLS12HashForSignature(sigType 
  		// If the client didn't specify any signature_algorithms
  		// extension then we can assume that it supports SHA1. See
  		// http://tools.ietf.org/html/rfc5246#section-7.4.1.4.1
- 		return hashSHA1, nil
+ 		switch sigType {
+ 		case signatureRSA:
+ 			return PKCS1WithSHA1, nil
+ 		case signatureECDSA:
+ 			return ECDSAWithSHA1, nil
+ 		default:
+ 			return 0, errors.New("tls: unknown signature algorithm")
+ 		}
  	}
  
- 	for _, sigAndHash := range clientList {
- 		if sigAndHash.signature != sigType {
+ 	for _, sigAlg := range clientList {
+ 		if signatureFromSignatureScheme(sigAlg) != sigType {
  			continue
  		}
- 		if isSupportedSignatureAndHash(sigAndHash, supportedSignatureAlgorithms()) {
- 			return sigAndHash.hash, nil
 -		if isSupportedSignatureAlgorithm(sigAlg, supportedSignatureAlgorithms) {
++		if isSupportedSignatureAlgorithm(sigAlg, supportedSignatureAlgorithms()) {
+ 			return sigAlg, nil
  		}
  	}
  
diff --cc src/crypto/tls/prf.go
index b93ce4fd20,74438f8bc8..7e64535a10
--- a/src/crypto/tls/prf.go
+++ b/src/crypto/tls/prf.go
@@@ -310,16 -309,11 +309,11 @@@ func (h finishedHash) serverSum(masterS
  	return out
  }
  
- // selectClientCertSignatureAlgorithm returns a signatureAndHash to sign a
+ // selectClientCertSignatureAlgorithm returns a SignatureScheme to sign a
  // client's CertificateVerify with, or an error if none can be found.
- func (h finishedHash) selectClientCertSignatureAlgorithm(serverList []signatureAndHash, sigType uint8) (signatureAndHash, error) {
- 	if h.version < VersionTLS12 {
- 		// Nothing to negotiate before TLS 1.2.
- 		return signatureAndHash{signature: sigType}, nil
- 	}
- 
+ func (h finishedHash) selectClientCertSignatureAlgorithm(serverList []SignatureScheme, sigType uint8) (SignatureScheme, error) {
  	for _, v := range serverList {
- 		if v.signature == sigType && isSupportedSignatureAndHash(v, supportedSignatureAlgorithms()) {
 -		if signatureFromSignatureScheme(v) == sigType && isSupportedSignatureAlgorithm(v, supportedSignatureAlgorithms) {
++		if signatureFromSignatureScheme(v) == sigType && isSupportedSignatureAlgorithm(v, supportedSignatureAlgorithms()) {
  			return v, nil
  		}
  	}
diff --cc src/crypto/x509/verify.go
index 999cb08cf3,7a6bd454f2..d27ee3e249
--- a/src/crypto/x509/verify.go
+++ b/src/crypto/x509/verify.go
@@@ -147,6 -174,6 +174,11 @@@ var errNotParsed = errors.New("x509: mi
  // VerifyOptions contains parameters for Certificate.Verify. It's a structure
  // because other PKIX verification APIs have ended up needing many options.
  type VerifyOptions struct {
++	// IsBoring is a validity check for BoringCrypto.
++	// If not nil, it will be called to check whether a given certificate
++	// can be used for constructing verification chains.
++	IsBoring func(*Certificate) bool
++
  	DNSName       string
  	Intermediates *CertPool
  	Roots         *CertPool // if nil, the system roots are used
@@@ -263,13 -770,6 +775,13 @@@ func (c *Certificate) isValid(certType 
  		}
  	}
  
 +	if opts.IsBoring != nil && !opts.IsBoring(c) {
 +		// IncompatibleUsage is not quite right here,
 +		// but it's also the "no chains found" error
 +		// and is close enough.
- 		return CertificateInvalidError{c, IncompatibleUsage}
++		return CertificateInvalidError{c, IncompatibleUsage, ""}
 +	}
 +
  	return nil
  }
  
diff --cc src/runtime/runtime_boring.go
index 0000000000,0000000000..5a98b20253
new file mode 100644
--- /dev/null
+++ b/src/runtime/runtime_boring.go
@@@ -1,0 -1,0 +1,19 @@@
++// Copyright 2017 The Go Authors. All rights reserved.
++// Use of this source code is governed by a BSD-style
++// license that can be found in the LICENSE file.
++
++package runtime
++
++import _ "unsafe" // for go:linkname
++
++//go:linkname boring_runtime_arg0 crypto/internal/boring.runtime_arg0
++func boring_runtime_arg0() string {
++	// On Windows, argslice is not set, and it's too much work to find argv0.
++	if len(argslice) == 0 {
++		return ""
++	}
++	return argslice[0]
++}
++
++//go:linkname fipstls_runtime_arg0 crypto/internal/boring/fipstls.runtime_arg0
++func fipstls_runtime_arg0() string { return boring_runtime_arg0() }
