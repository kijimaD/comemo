commit 97dcc68f1ec4202b467210dcd2607c7630bb9d6e
Author: Russ Cox <rsc@golang.org>
Date:   Sun Feb 15 19:20:35 2009 -0800

    insert ${GOOS} and ${GOARCH} in
    command-line comment.
    
    R=r
    DELTA=11  (6 added, 0 deleted, 5 changed)
    OCL=25051
    CL=25051
---
 src/cmd/gobuild/gobuild.c | 12 +++++++++---
 src/lib/net/Makefile      |  4 ++--
 2 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/src/cmd/gobuild/gobuild.c b/src/cmd/gobuild/gobuild.c
index 091e2af6fc..5368d9f4d5 100644
--- a/src/cmd/gobuild/gobuild.c
+++ b/src/cmd/gobuild/gobuild.c
@@ -263,12 +263,18 @@ dollarfmt(Fmt *f)
 	for(; *s; s+=n){
 		n = strlen(goarch);
 		if(strncmp(s, goarch, n) == 0){
-			fmtstrcpy(f, "$(GOARCH)");
+			if(f->flags & FmtSharp)
+				fmtstrcpy(f, "${GOARCH}");  // shell
+			else
+				fmtstrcpy(f, "$(GOARCH)");  // make
 			continue;
 		}
 		n = strlen(goos);
 		if(strncmp(s, goos, n) == 0){
-			fmtstrcpy(f, "$(GOOS)");
+			if(f->flags & FmtSharp)
+				fmtstrcpy(f, "${GOOS}");  // shell
+			else
+				fmtstrcpy(f, "$(GOOS)");  // make
 			continue;
 		}
 		n = chartorune(&r, s);
@@ -327,7 +333,7 @@ writemakefile(void)
 			Bprint(&bout, "\\\n#   ");
 			o = Boffset(&bout);
 		}
-		Bprint(&bout, " %s", oargv[i]);
+		Bprint(&bout, " %#$", oargv[i]);
 	}
 	Bprint(&bout, " >Makefile\n");
 	Bprint(&bout, preamble, thechar);
diff --git a/src/lib/net/Makefile b/src/lib/net/Makefile
index ff5176a1f9..8a4953c2f2 100644
--- a/src/lib/net/Makefile
+++ b/src/lib/net/Makefile
@@ -3,8 +3,8 @@
 # license that can be found in the LICENSE file.
 
 # DO NOT EDIT.  Automatically generated by gobuild.
-# gobuild -m dnsclient.go dnsconfig.go dnsmsg.go fd.go fd_darwin.go\
-#    ip.go net.go net_darwin.go parse.go port.go >Makefile
+# gobuild -m dnsclient.go dnsconfig.go dnsmsg.go fd.go fd_${GOOS}.go\
+#    ip.go net.go net_${GOOS}.go parse.go port.go >Makefile
 O=6
 GC=$(O)g
 CC=$(O)c -w
