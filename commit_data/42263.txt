commit 62ce702c77915c6fddc2fcbd95265df4b2f17a08
Merge: e8f14494a0 ec732632c2
Author: Filippo Valsorda <filippo@golang.org>
Date:   Tue Nov 19 15:20:53 2019 -0500

    [dev.boringcrypto] all: merge master into dev.boringcrypto
    
    Signing-side signature algorithm selection moved to
    selectSignatureScheme, so add FIPS logic there.
    
    Change-Id: I827e7296d01ecfd36072e2139e74603ef42c6b24

 AUTHORS                                            |     2 +-
 CONTRIBUTORS                                       |    35 +-
 SECURITY.md                                        |     2 +-
 api/except.txt                                     |     1 +
 api/next.txt                                       |     5 +
 doc/articles/wiki/final-noclosure.go               |     2 +-
 doc/articles/wiki/index.html                       |     2 +-
 doc/asm.html                                       |    17 +-
 doc/code.html                                      |   648 -
 doc/contrib.html                                   |     3 +-
 doc/devel/release.html                             |    68 +
 doc/docs.html                                      |   232 -
 doc/effective_go.html                              |     2 +-
 doc/gccgo_contribute.html                          |     2 +-
 doc/gccgo_install.html                             |   100 +-
 doc/go1.13.html                                    |    44 +-
 doc/go1.14.html                                    |   290 +
 doc/go_faq.html                                    |     4 +-
 doc/go_spec.html                                   |     4 +-
 doc/install-source.html                            |    68 +-
 doc/modules.md                                     |    61 +
 doc/play/hello.go                                  |     2 +
 doc/progs/eff_qr.go                                |     6 +-
 doc/security.html                                  |     6 +-
 misc/benchcmp                                      |     5 -
 misc/cgo/life/overlaydir_test.go                   |     2 +-
 misc/cgo/stdio/overlaydir_test.go                  |     2 +-
 misc/cgo/test/cgo_test.go                          |     6 +-
 misc/cgo/test/issue31891.c                         |    13 +
 misc/cgo/test/overlaydir_test.go                   |     2 +-
 misc/cgo/test/test.go                              |    98 +-
 misc/cgo/test/testdata/issue9026/issue9026.go      |     2 +-
 misc/cgo/test/testx.go                             |    51 +-
 misc/cgo/testcarchive/carchive_test.go             |    83 +-
 misc/cgo/testcarchive/overlaydir_test.go           |     2 +-
 misc/cgo/testcarchive/testdata/libgo7/sink.go      |    17 +
 misc/cgo/testcarchive/testdata/main2.c             |    37 +-
 misc/cgo/testcarchive/testdata/main3.c             |    21 +
 misc/cgo/testcarchive/testdata/main7.c             |    18 +
 misc/cgo/testcshared/overlaydir_test.go            |     2 +-
 misc/cgo/testplugin/overlaydir_test.go             |     2 +-
 misc/cgo/testplugin/plugin_test.go                 |     7 +-
 misc/cgo/testshared/overlaydir_test.go             |     2 +-
 misc/cgo/testso/overlaydir_test.go                 |     2 +-
 misc/cgo/testsovar/overlaydir_test.go              |     2 +-
 misc/ios/clangwrap.sh                              |     2 +-
 misc/nacl/README                                   |   121 -
 misc/nacl/go_nacl_386_exec                         |    10 -
 misc/nacl/go_nacl_amd64p32_exec                    |    10 -
 misc/nacl/go_nacl_arm_exec                         |    10 -
 misc/nacl/mkzip.go                                 |   226 -
 misc/nacl/testdata/empty                           |     0
 misc/nacl/testdata/group                           |     8 -
 misc/nacl/testdata/hosts                           |     1 -
 misc/nacl/testdata/mime.types                      |  1596 ---
 misc/nacl/testzip.proto                            |   190 -
 misc/reboot/overlaydir_test.go                     |     2 +-
 misc/trace/trace_viewer_full.html                  |    20 +-
 misc/wasm/wasm_exec.js                             |   214 +-
 src/bufio/bufio.go                                 |    17 +-
 src/bufio/bufio_test.go                            |    46 +
 src/buildall.bash                                  |    12 +-
 src/bytes/bytes.go                                 |     3 +-
 src/bytes/compare_test.go                          |    33 +
 src/cmd/asm/internal/arch/arch.go                  |   182 +-
 src/cmd/asm/internal/arch/ppc64.go                 |     2 +-
 src/cmd/asm/internal/arch/s390x.go                 |    34 +-
 src/cmd/asm/internal/asm/asm.go                    |    19 +-
 src/cmd/asm/internal/asm/endtoend_test.go          |     4 +
 src/cmd/asm/internal/asm/testdata/amd64enc_extra.s |     6 +
 src/cmd/asm/internal/asm/testdata/amd64error.s     |     8 +
 src/cmd/asm/internal/asm/testdata/arm64.s          |   593 +
 src/cmd/asm/internal/asm/testdata/arm64enc.s       |     3 +-
 src/cmd/asm/internal/asm/testdata/arm64error.s     |   104 +
 src/cmd/asm/internal/asm/testdata/mips64.s         |   402 +-
 src/cmd/asm/internal/asm/testdata/ppc64.s          |    23 +-
 src/cmd/asm/internal/asm/testdata/riscvenc.s       |   269 +
 src/cmd/asm/internal/asm/testdata/s390x.s          |   134 +-
 src/cmd/asm/internal/flags/flags.go                |     1 +
 src/cmd/asm/main.go                                |    10 +-
 src/cmd/cgo/doc.go                                 |     4 +-
 src/cmd/cgo/gcc.go                                 |    21 +-
 src/cmd/cgo/out.go                                 |    12 +-
 src/cmd/compile/fmt_test.go                        |     2 +-
 src/cmd/compile/fmtmap_test.go                     |    10 +-
 src/cmd/compile/internal/amd64/galign.go           |     6 -
 src/cmd/compile/internal/amd64/ggen.go             |    22 +-
 src/cmd/compile/internal/amd64/ssa.go              |    27 +-
 src/cmd/compile/internal/arm/galign.go             |     1 -
 src/cmd/compile/internal/arm/ggen.go               |    23 +-
 src/cmd/compile/internal/arm/ssa.go                |    11 +-
 src/cmd/compile/internal/arm64/galign.go           |     1 -
 src/cmd/compile/internal/arm64/ggen.go             |    28 +-
 src/cmd/compile/internal/arm64/ssa.go              |    13 +-
 src/cmd/compile/internal/gc/alg.go                 |   178 +-
 src/cmd/compile/internal/gc/align.go               |    59 +-
 src/cmd/compile/internal/gc/bexport.go             |     9 +-
 src/cmd/compile/internal/gc/bimport.go             |    10 -
 src/cmd/compile/internal/gc/builtin.go             |   106 +-
 src/cmd/compile/internal/gc/builtin/runtime.go     |    37 +
 src/cmd/compile/internal/gc/class_string.go        |     5 +-
 src/cmd/compile/internal/gc/closure.go             |    38 +-
 src/cmd/compile/internal/gc/const.go               |   551 +-
 src/cmd/compile/internal/gc/dcl.go                 |    14 +-
 src/cmd/compile/internal/gc/dep_test.go            |     3 +-
 src/cmd/compile/internal/gc/esc.go                 |  2261 +---
 src/cmd/compile/internal/gc/escape.go              |   572 +-
 src/cmd/compile/internal/gc/export.go              |     2 +-
 src/cmd/compile/internal/gc/fmt.go                 |    94 +-
 src/cmd/compile/internal/gc/gen.go                 |     8 +-
 src/cmd/compile/internal/gc/go.go                  |    44 +-
 src/cmd/compile/internal/gc/gsubr.go               |    18 +-
 src/cmd/compile/internal/gc/iexport.go             |    96 +-
 src/cmd/compile/internal/gc/iimport.go             |    86 +-
 src/cmd/compile/internal/gc/init.go                |    14 +-
 src/cmd/compile/internal/gc/initorder.go           |     2 +-
 src/cmd/compile/internal/gc/inl.go                 |    43 +-
 src/cmd/compile/internal/gc/inl_test.go            |     9 +-
 src/cmd/compile/internal/gc/lex.go                 |     7 +-
 src/cmd/compile/internal/gc/main.go                |    63 +-
 src/cmd/compile/internal/gc/mpfloat.go             |     5 -
 src/cmd/compile/internal/gc/noder.go               |   109 +-
 src/cmd/compile/internal/gc/obj.go                 |    41 +-
 src/cmd/compile/internal/gc/op_string.go           |    85 +-
 src/cmd/compile/internal/gc/order.go               |   191 +-
 src/cmd/compile/internal/gc/pgen.go                |    77 +-
 src/cmd/compile/internal/gc/plive.go               |   144 +-
 src/cmd/compile/internal/gc/range.go               |     2 +-
 src/cmd/compile/internal/gc/reflect.go             |   134 +-
 src/cmd/compile/internal/gc/select.go              |     8 +-
 src/cmd/compile/internal/gc/sinit.go               |    41 +-
 src/cmd/compile/internal/gc/sizeof_test.go         |     4 +-
 src/cmd/compile/internal/gc/ssa.go                 |   814 +-
 src/cmd/compile/internal/gc/subr.go                |    30 +-
 src/cmd/compile/internal/gc/swt.go                 |  1336 +-
 src/cmd/compile/internal/gc/swt_test.go            |    50 -
 src/cmd/compile/internal/gc/syntax.go              |   224 +-
 src/cmd/compile/internal/gc/typecheck.go           |   639 +-
 src/cmd/compile/internal/gc/types.go               |     3 -
 src/cmd/compile/internal/gc/universe.go            |    23 +-
 src/cmd/compile/internal/gc/walk.go                |   322 +-
 src/cmd/compile/internal/gc/zerorange_test.go      |    98 +
 src/cmd/compile/internal/logopt/escape.go          |    13 +
 .../compile/internal/logopt/escape_bootstrap.go    |    12 +
 src/cmd/compile/internal/logopt/log_opts.go        |   439 +
 src/cmd/compile/internal/logopt/logopt_test.go     |   130 +
 src/cmd/compile/internal/mips/galign.go            |     1 -
 src/cmd/compile/internal/mips/ggen.go              |    16 -
 src/cmd/compile/internal/mips/ssa.go               |    34 +-
 src/cmd/compile/internal/mips64/galign.go          |     1 -
 src/cmd/compile/internal/mips64/ggen.go            |    16 -
 src/cmd/compile/internal/mips64/ssa.go             |    23 +-
 src/cmd/compile/internal/ppc64/galign.go           |     1 -
 src/cmd/compile/internal/ppc64/ggen.go             |    16 -
 src/cmd/compile/internal/ppc64/ssa.go              |   347 +-
 src/cmd/compile/internal/s390x/galign.go           |     1 -
 src/cmd/compile/internal/s390x/ggen.go             |    34 +-
 src/cmd/compile/internal/s390x/ssa.go              |   192 +-
 src/cmd/compile/internal/ssa/README.md             |     8 +-
 src/cmd/compile/internal/ssa/block.go              |   129 +-
 src/cmd/compile/internal/ssa/branchelim.go         |   110 +-
 src/cmd/compile/internal/ssa/check.go              |    66 +-
 src/cmd/compile/internal/ssa/checkbce.go           |    16 +-
 src/cmd/compile/internal/ssa/compile.go            |     3 +
 src/cmd/compile/internal/ssa/config.go             |    45 +-
 src/cmd/compile/internal/ssa/copyelim.go           |     6 +-
 src/cmd/compile/internal/ssa/cse.go                |     8 +-
 src/cmd/compile/internal/ssa/deadcode.go           |    14 +-
 src/cmd/compile/internal/ssa/deadstore.go          |    18 +-
 src/cmd/compile/internal/ssa/debug_test.go         |     2 +-
 src/cmd/compile/internal/ssa/dom.go                |    33 +-
 src/cmd/compile/internal/ssa/flagalloc.go          |    42 +-
 src/cmd/compile/internal/ssa/func.go               |    14 +-
 src/cmd/compile/internal/ssa/fuse.go               |     2 +-
 src/cmd/compile/internal/ssa/gen/386.rules         |   121 +-
 src/cmd/compile/internal/ssa/gen/386Ops.go         |    34 +-
 src/cmd/compile/internal/ssa/gen/AMD64.rules       |   161 +-
 src/cmd/compile/internal/ssa/gen/AMD64Ops.go       |    47 +-
 src/cmd/compile/internal/ssa/gen/ARM.rules         |   151 +-
 src/cmd/compile/internal/ssa/gen/ARM64.rules       |   145 +-
 src/cmd/compile/internal/ssa/gen/ARM64Ops.go       |    59 +-
 src/cmd/compile/internal/ssa/gen/ARMOps.go         |    30 +-
 src/cmd/compile/internal/ssa/gen/MIPS.rules        |    34 +-
 src/cmd/compile/internal/ssa/gen/MIPS64.rules      |    38 +-
 src/cmd/compile/internal/ssa/gen/MIPS64Ops.go      |    53 +-
 src/cmd/compile/internal/ssa/gen/MIPSOps.go        |    40 +-
 src/cmd/compile/internal/ssa/gen/PPC64.rules       |    97 +-
 src/cmd/compile/internal/ssa/gen/PPC64Ops.go       |   134 +-
 src/cmd/compile/internal/ssa/gen/README            |     2 +-
 src/cmd/compile/internal/ssa/gen/S390X.rules       |   636 +-
 src/cmd/compile/internal/ssa/gen/S390XOps.go       |   109 +-
 src/cmd/compile/internal/ssa/gen/Wasm.rules        |   129 +-
 src/cmd/compile/internal/ssa/gen/WasmOps.go        |   143 +-
 src/cmd/compile/internal/ssa/gen/generic.rules     |    63 +-
 src/cmd/compile/internal/ssa/gen/genericOps.go     |    48 +-
 src/cmd/compile/internal/ssa/gen/main.go           |   138 +-
 src/cmd/compile/internal/ssa/gen/rulegen.go        |   491 +-
 src/cmd/compile/internal/ssa/html.go               |     4 +-
 src/cmd/compile/internal/ssa/lca_test.go           |    15 -
 src/cmd/compile/internal/ssa/likelyadjust.go       |     8 +-
 src/cmd/compile/internal/ssa/loop_test.go          |    88 -
 src/cmd/compile/internal/ssa/loopbce.go            |    91 +-
 src/cmd/compile/internal/ssa/loopreschedchecks.go  |    10 +
 src/cmd/compile/internal/ssa/nilcheck.go           |    39 +-
 src/cmd/compile/internal/ssa/nilcheck_test.go      |     2 +-
 src/cmd/compile/internal/ssa/numberlines.go        |    47 +-
 src/cmd/compile/internal/ssa/op.go                 |     4 +-
 src/cmd/compile/internal/ssa/opGen.go              |  1260 +-
 src/cmd/compile/internal/ssa/phiopt.go             |    14 +-
 src/cmd/compile/internal/ssa/poset.go              |   583 +-
 src/cmd/compile/internal/ssa/poset_test.go         |   130 +-
 src/cmd/compile/internal/ssa/prove.go              |    99 +-
 src/cmd/compile/internal/ssa/redblack32_test.go    |    14 +-
 src/cmd/compile/internal/ssa/regalloc.go           |   103 +-
 src/cmd/compile/internal/ssa/rewrite.go            |    26 +-
 src/cmd/compile/internal/ssa/rewrite386.go         |  4869 ++-----
 .../compile/internal/ssa/rewrite386splitload.go    |     6 -
 src/cmd/compile/internal/ssa/rewriteAMD64.go       | 12859 ++++--------------
 .../compile/internal/ssa/rewriteAMD64splitload.go  |     8 -
 src/cmd/compile/internal/ssa/rewriteARM.go         |  5119 +++-----
 src/cmd/compile/internal/ssa/rewriteARM64.go       |  9402 +++-----------
 src/cmd/compile/internal/ssa/rewriteMIPS.go        |  1024 +-
 src/cmd/compile/internal/ssa/rewriteMIPS64.go      |   991 +-
 src/cmd/compile/internal/ssa/rewritePPC64.go       |  9367 ++++---------
 src/cmd/compile/internal/ssa/rewriteS390X.go       | 13011 ++++++-------------
 src/cmd/compile/internal/ssa/rewriteWasm.go        |   794 +-
 src/cmd/compile/internal/ssa/rewritedec.go         |    12 -
 src/cmd/compile/internal/ssa/rewritedec64.go       |   114 +-
 src/cmd/compile/internal/ssa/rewritegeneric.go     |  8335 +++++-------
 src/cmd/compile/internal/ssa/schedule.go           |    18 +-
 src/cmd/compile/internal/ssa/shortcircuit.go       |    14 +-
 src/cmd/compile/internal/ssa/sizeof_test.go        |     4 +-
 src/cmd/compile/internal/ssa/sparsetree.go         |     4 +-
 src/cmd/compile/internal/ssa/stmtlines_test.go     |    21 +-
 .../internal/ssa/testdata/hist.dlv-opt.nexts       |     8 -
 .../internal/ssa/testdata/hist.gdb-dbg.nexts       |     2 +-
 .../internal/ssa/testdata/hist.gdb-opt.nexts       |    44 +-
 src/cmd/compile/internal/ssa/tighten.go            |     2 +-
 src/cmd/compile/internal/ssa/trim.go               |    23 +
 src/cmd/compile/internal/ssa/value.go              |    14 +-
 src/cmd/compile/internal/ssa/writebarrier.go       |   109 +-
 src/cmd/compile/internal/syntax/dumper_test.go     |     3 +-
 src/cmd/compile/internal/syntax/nodes.go           |     1 +
 src/cmd/compile/internal/syntax/parser.go          |    15 +-
 src/cmd/compile/internal/syntax/parser_test.go     |     2 +-
 src/cmd/compile/internal/syntax/printer_test.go    |    11 +-
 src/cmd/compile/internal/syntax/scanner.go         |    99 +-
 src/cmd/compile/internal/syntax/scanner_test.go    |    31 +-
 src/cmd/compile/internal/syntax/tokens.go          |     2 +-
 src/cmd/compile/internal/types/etype_string.go     |    47 +-
 src/cmd/compile/internal/types/identity.go         |     7 +
 src/cmd/compile/internal/types/sizeof_test.go      |     3 -
 src/cmd/compile/internal/types/sym.go              |    14 +-
 src/cmd/compile/internal/types/type.go             |    75 +-
 src/cmd/compile/internal/wasm/ssa.go               |   164 +-
 src/cmd/compile/internal/x86/galign.go             |     1 -
 src/cmd/compile/internal/x86/ggen.go               |    18 +-
 src/cmd/compile/internal/x86/ssa.go                |    10 +-
 src/cmd/compile/main.go                            |     1 -
 src/cmd/cover/cover_test.go                        |     4 +-
 src/cmd/cover/func.go                              |     4 +
 src/cmd/dist/build.go                              |   114 +-
 src/cmd/dist/buildtool.go                          |     7 +
 src/cmd/dist/imports.go                            |    31 +
 src/cmd/dist/main.go                               |     9 +-
 src/cmd/dist/test.go                               |    45 +-
 src/cmd/dist/util.go                               |     4 -
 src/cmd/doc/dirs.go                                |   126 +-
 src/cmd/doc/doc_test.go                            |    20 +-
 src/cmd/doc/main.go                                |    48 +-
 src/cmd/doc/pkg.go                                 |    18 +-
 src/cmd/fix/main.go                                |    49 +-
 src/cmd/fix/main_test.go                           |     4 +-
 src/cmd/go.mod                                     |     7 +-
 src/cmd/go.sum                                     |    18 +-
 src/cmd/go/alldocs.go                              |    55 +-
 src/cmd/go/go_test.go                              |   143 +-
 src/cmd/go/help_test.go                            |     2 -
 src/cmd/go/internal/base/flag.go                   |     5 +
 src/cmd/go/internal/base/signal_unix.go            |     2 +-
 src/cmd/go/internal/cache/cache.go                 |    69 +-
 src/cmd/go/internal/cfg/cfg.go                     |    15 +-
 src/cmd/go/internal/clean/clean.go                 |     2 +-
 src/cmd/go/internal/dirhash/hash_test.go           |   135 -
 src/cmd/go/internal/doc/doc.go                     |     2 +
 src/cmd/go/internal/envcmd/env.go                  |    69 +-
 src/cmd/go/internal/fmtcmd/fmt.go                  |     6 +-
 src/cmd/go/internal/generate/generate.go           |     2 +-
 src/cmd/go/internal/get/discovery.go               |    16 +-
 src/cmd/go/internal/get/get.go                     |     6 +-
 src/cmd/go/internal/get/path.go                    |     5 +-
 src/cmd/go/internal/get/vcs.go                     |    73 +-
 src/cmd/go/internal/help/helpdoc.go                |    10 +-
 src/cmd/go/internal/imports/build.go               |     4 +-
 src/cmd/go/internal/list/list.go                   |    18 +-
 src/cmd/go/internal/load/pkg.go                    |   202 +-
 src/cmd/go/internal/load/pkg_test.go               |    44 +-
 src/cmd/go/internal/load/test.go                   |    17 +-
 .../lockedfile/internal/filelock/filelock_test.go  |     2 +-
 src/cmd/go/internal/lockedfile/lockedfile.go       |    65 +
 src/cmd/go/internal/lockedfile/lockedfile_test.go  |     4 +-
 src/cmd/go/internal/lockedfile/transform_test.go   |   104 +
 src/cmd/go/internal/modcmd/download.go             |    52 +-
 src/cmd/go/internal/modcmd/edit.go                 |    33 +-
 src/cmd/go/internal/modcmd/graph.go                |    10 +-
 src/cmd/go/internal/modcmd/init.go                 |     8 +-
 src/cmd/go/internal/modcmd/mod.go                  |     9 +-
 src/cmd/go/internal/modcmd/tidy.go                 |    32 +-
 src/cmd/go/internal/modcmd/vendor.go               |    78 +-
 src/cmd/go/internal/modcmd/verify.go               |    14 +-
 src/cmd/go/internal/modcmd/why.go                  |    10 +-
 src/cmd/go/internal/modconv/convert.go             |     7 +-
 src/cmd/go/internal/modconv/convert_test.go        |     5 +-
 src/cmd/go/internal/modconv/dep.go                 |     6 +-
 src/cmd/go/internal/modconv/glide.go               |     4 +-
 src/cmd/go/internal/modconv/glock.go               |     4 +-
 src/cmd/go/internal/modconv/godeps.go              |     4 +-
 src/cmd/go/internal/modconv/modconv.go             |     2 +-
 src/cmd/go/internal/modconv/tsv.go                 |     4 +-
 src/cmd/go/internal/modconv/vconf.go               |     4 +-
 src/cmd/go/internal/modconv/vjson.go               |     4 +-
 src/cmd/go/internal/modconv/vmanifest.go           |     4 +-
 src/cmd/go/internal/modconv/vyml.go                |     4 +-
 src/cmd/go/internal/modfetch/bootstrap.go          |     2 +-
 src/cmd/go/internal/modfetch/cache.go              |    62 +-
 src/cmd/go/internal/modfetch/codehost/codehost.go  |     7 +-
 src/cmd/go/internal/modfetch/codehost/git.go       |   125 +-
 src/cmd/go/internal/modfetch/codehost/git_test.go  |    27 +-
 src/cmd/go/internal/modfetch/codehost/shell.go     |     2 +-
 src/cmd/go/internal/modfetch/codehost/svn.go       |   154 +
 src/cmd/go/internal/modfetch/codehost/vcs.go       |   104 +-
 src/cmd/go/internal/modfetch/coderepo.go           |   261 +-
 src/cmd/go/internal/modfetch/coderepo_test.go      |   378 +-
 src/cmd/go/internal/modfetch/fetch.go              |   216 +-
 src/cmd/go/internal/modfetch/insecure.go           |    16 +
 src/cmd/go/internal/modfetch/proxy.go              |    49 +-
 src/cmd/go/internal/modfetch/pseudo.go             |     5 +-
 src/cmd/go/internal/modfetch/repo.go               |    33 +-
 src/cmd/go/internal/modfetch/sumdb.go              |    14 +-
 src/cmd/go/internal/modfetch/unzip.go              |   173 -
 .../modfetch/zip_sum_test/testdata/zip_sums.csv    |  2124 +++
 .../internal/modfetch/zip_sum_test/zip_sum_test.go |   230 +
 src/cmd/go/internal/modfile/gopkgin.go             |    47 -
 src/cmd/go/internal/modfile/read_test.go           |   365 -
 src/cmd/go/internal/modfile/rule_test.go           |    90 -
 src/cmd/go/internal/modfile/testdata/block.golden  |    29 -
 src/cmd/go/internal/modfile/testdata/block.in      |    29 -
 .../go/internal/modfile/testdata/comment.golden    |    10 -
 src/cmd/go/internal/modfile/testdata/comment.in    |     8 -
 src/cmd/go/internal/modfile/testdata/empty.golden  |     0
 src/cmd/go/internal/modfile/testdata/empty.in      |     0
 .../go/internal/modfile/testdata/gopkg.in.golden   |     6 -
 src/cmd/go/internal/modfile/testdata/module.golden |     1 -
 src/cmd/go/internal/modfile/testdata/module.in     |     1 -
 .../go/internal/modfile/testdata/replace.golden    |     5 -
 src/cmd/go/internal/modfile/testdata/replace.in    |     5 -
 .../go/internal/modfile/testdata/replace2.golden   |    10 -
 src/cmd/go/internal/modfile/testdata/replace2.in   |    10 -
 src/cmd/go/internal/modfile/testdata/rule1.golden  |     7 -
 src/cmd/go/internal/modget/get.go                  |    83 +-
 src/cmd/go/internal/modload/build.go               |    74 +-
 src/cmd/go/internal/modload/import.go              |   108 +-
 src/cmd/go/internal/modload/import_test.go         |     6 +-
 src/cmd/go/internal/modload/init.go                |   617 +-
 src/cmd/go/internal/modload/list.go                |    25 +-
 src/cmd/go/internal/modload/load.go                |   223 +-
 src/cmd/go/internal/modload/query.go               |   181 +-
 src/cmd/go/internal/modload/query_test.go          |     3 +-
 src/cmd/go/internal/modload/search.go              |    25 +-
 src/cmd/go/internal/modload/stat_openfile.go       |    27 +
 src/cmd/go/internal/modload/stat_unix.go           |    31 +
 src/cmd/go/internal/modload/stat_windows.go        |    23 +
 src/cmd/go/internal/modload/testgo.go              |     2 +-
 src/cmd/go/internal/module/module_test.go          |   319 -
 src/cmd/go/internal/mvs/mvs.go                     |    16 +-
 src/cmd/go/internal/mvs/mvs_test.go                |    32 +-
 src/cmd/go/internal/note/example_test.go           |   128 -
 src/cmd/go/internal/note/note_test.go              |   472 -
 src/cmd/go/internal/renameio/renameio_test.go      |    14 +-
 src/cmd/go/internal/renameio/umask_test.go         |     4 +-
 src/cmd/go/internal/robustio/robustio_darwin.go    |    21 +
 src/cmd/go/internal/robustio/robustio_flaky.go     |    92 +
 src/cmd/go/internal/robustio/robustio_other.go     |     2 +-
 src/cmd/go/internal/robustio/robustio_windows.go   |    80 +-
 src/cmd/go/internal/run/run.go                     |     4 +-
 src/cmd/go/internal/search/search.go               |    84 +-
 src/cmd/go/internal/search/search_test.go          |     2 +-
 src/cmd/go/internal/semver/semver_test.go          |   183 -
 src/cmd/go/internal/sumweb/client_test.go          |   460 -
 src/cmd/go/internal/sumweb/encode.go               |   167 -
 src/cmd/go/internal/sumweb/encode_test.go          |    67 -
 src/cmd/go/internal/test/test.go                   |     5 +-
 src/cmd/go/internal/test/testflag.go               |     2 +-
 src/cmd/go/internal/tlog/ct_test.go                |    96 -
 src/cmd/go/internal/tlog/note_test.go              |   117 -
 src/cmd/go/internal/tlog/tlog_test.go              |   269 -
 src/cmd/go/internal/vet/vetflag.go                 |     2 +-
 src/cmd/go/internal/web/api.go                     |   125 +-
 src/cmd/go/internal/web/http.go                    |    29 +-
 src/cmd/go/internal/web/url_other.go               |     2 +-
 src/cmd/go/internal/web/url_other_test.go          |     2 +-
 src/cmd/go/internal/work/action.go                 |    14 +-
 src/cmd/go/internal/work/build.go                  |    55 +-
 src/cmd/go/internal/work/build_test.go             |     2 -
 src/cmd/go/internal/work/buildid.go                |    16 +-
 src/cmd/go/internal/work/exec.go                   |   112 +-
 src/cmd/go/internal/work/gc.go                     |     3 +-
 src/cmd/go/internal/work/gccgo.go                  |    11 +-
 src/cmd/go/internal/work/init.go                   |    23 +-
 src/cmd/go/internal/work/security.go               |    12 +
 src/cmd/go/internal/work/security_test.go          |     7 +
 src/cmd/go/main.go                                 |     2 +-
 src/cmd/go/proxy_test.go                           |    42 +-
 src/cmd/go/script_test.go                          |    40 +-
 .../testdata/mod/example.com_dotgo.go_v1.0.0.txt   |    16 +
 .../testdata/mod/not-rsc.io_quote_v0.1.0-nomod.txt |    59 +
 src/cmd/go/testdata/print_goroot.go                |     7 +-
 src/cmd/go/testdata/script/README                  |     6 +-
 src/cmd/go/testdata/script/build_multi_main.txt    |    10 +
 src/cmd/go/testdata/script/build_trimpath.txt      |   100 +-
 src/cmd/go/testdata/script/cmd_import_error.txt    |     2 +-
 src/cmd/go/testdata/script/cover_mod_empty.txt     |     9 +
 .../script/cover_pkgall_multiple_mains.txt         |    21 +-
 src/cmd/go/testdata/script/env_write.txt           |    32 +
 src/cmd/go/testdata/script/fmt_load_errors.txt     |    19 +
 src/cmd/go/testdata/script/gccgo_m.txt             |    19 +
 src/cmd/go/testdata/script/gccgo_mangle.txt        |    15 +
 .../go/testdata/script/get_insecure_redirect.txt   |     5 +-
 .../go/testdata/script/link_syso_issue33139.txt    |    43 +
 src/cmd/go/testdata/script/list_ambiguous_path.txt |    38 +
 src/cmd/go/testdata/script/list_split_main.txt     |    25 +
 .../go/testdata/script/mod_ambiguous_import.txt    |    49 +
 src/cmd/go/testdata/script/mod_auth.txt            |     2 +
 src/cmd/go/testdata/script/mod_build_info_err.txt  |    22 +
 src/cmd/go/testdata/script/mod_cache_rw.txt        |    49 +
 .../testdata/script/mod_convert_tsv_insecure.txt   |    24 +
 .../go/testdata/script/mod_convert_vendor_json.txt |     2 +-
 .../script/mod_convert_vendor_manifest.txt         |     2 +-
 src/cmd/go/testdata/script/mod_doc.txt             |    29 +
 src/cmd/go/testdata/script/mod_download.txt        |    10 +-
 src/cmd/go/testdata/script/mod_download_json.txt   |    10 +
 src/cmd/go/testdata/script/mod_download_latest.txt |    20 -
 .../testdata/script/mod_download_replace_file.txt  |    16 +
 src/cmd/go/testdata/script/mod_fs_patterns.txt     |    35 +-
 src/cmd/go/testdata/script/mod_get_direct.txt      |    20 +
 .../testdata/script/mod_get_insecure_redirect.txt  |    34 +
 src/cmd/go/testdata/script/mod_get_major.txt       |    23 +
 src/cmd/go/testdata/script/mod_get_newcycle.txt    |     1 -
 src/cmd/go/testdata/script/mod_get_patterns.txt    |     4 +-
 src/cmd/go/testdata/script/mod_get_svn.txt         |    31 +-
 .../go/testdata/script/mod_get_trailing_slash.txt  |    30 +
 src/cmd/go/testdata/script/mod_getmode_vendor.txt  |    15 +-
 src/cmd/go/testdata/script/mod_getx.txt            |    14 +
 .../go/testdata/script/mod_go_version_mixed.txt    |    43 +
 src/cmd/go/testdata/script/mod_in_testdata_dir.txt |    45 +
 src/cmd/go/testdata/script/mod_internal.txt        |    12 +-
 src/cmd/go/testdata/script/mod_issue35317.txt      |     8 +
 src/cmd/go/testdata/script/mod_list_dir.txt        |     4 +-
 src/cmd/go/testdata/script/mod_list_upgrade.txt    |    20 -
 src/cmd/go/testdata/script/mod_load_badchain.txt   |     4 +
 src/cmd/go/testdata/script/mod_missing_repo.txt    |    15 +
 .../testdata/script/mod_missingpkg_prerelease.txt  |     5 +
 src/cmd/go/testdata/script/mod_outside.txt         |   160 +-
 src/cmd/go/testdata/script/mod_permissions.txt     |    57 +
 .../go/testdata/script/mod_prefer_compatible.txt   |    65 +
 src/cmd/go/testdata/script/mod_proxy_errors.txt    |    19 +
 src/cmd/go/testdata/script/mod_readonly.txt        |    56 +-
 src/cmd/go/testdata/script/mod_replace.txt         |    14 +
 src/cmd/go/testdata/script/mod_replace_import.txt  |    20 +
 src/cmd/go/testdata/script/mod_retention.txt       |   135 +
 src/cmd/go/testdata/script/mod_sumdb.txt           |     2 +-
 src/cmd/go/testdata/script/mod_sumdb_cache.txt     |     7 +
 src/cmd/go/testdata/script/mod_sumdb_file_path.txt |     5 +-
 src/cmd/go/testdata/script/mod_test_files.txt      |     1 +
 src/cmd/go/testdata/script/mod_tidy.txt            |     1 -
 src/cmd/go/testdata/script/mod_tidy_cycle.txt      |    75 +
 src/cmd/go/testdata/script/mod_tidy_replace.txt    |    26 +
 src/cmd/go/testdata/script/mod_vendor.txt          |    56 +-
 src/cmd/go/testdata/script/mod_vendor_auto.txt     |   256 +
 src/cmd/go/testdata/script/mod_vendor_build.txt    |     2 +-
 src/cmd/go/testdata/script/mod_vendor_replace.txt  |    31 +-
 src/cmd/go/testdata/script/mod_vendor_unused.txt   |    67 +
 src/cmd/go/testdata/script/modfile_flag.txt        |    67 +
 src/cmd/go/testdata/script/noncanonical_import.txt |    21 +
 src/cmd/go/testdata/script/test_compile_binary.txt |     2 +-
 .../go/testdata/script/test_compile_tempfile.txt   |    11 +
 src/cmd/go/testdata/script/test_timeout.txt        |    11 +-
 src/cmd/go/testdata/script/version.txt             |     5 +
 src/cmd/go/testdata/src/canonical/a/a.go           |     3 -
 src/cmd/go/testdata/src/canonical/a/vendor/c/c.go  |     1 -
 src/cmd/go/testdata/src/canonical/b/b.go           |     3 -
 src/cmd/go/testdata/src/canonical/d/d.go           |     3 -
 .../go/testdata/src/testcache/testcache_test.go    |     2 +-
 src/cmd/gofmt/gofmt.go                             |    46 +-
 src/cmd/gofmt/gofmt_test.go                        |     4 +-
 src/cmd/gofmt/rewrite.go                           |     6 +
 src/cmd/gofmt/testdata/import.golden               |    73 +-
 src/cmd/gofmt/testdata/import.input                |    71 +-
 src/cmd/gofmt/testdata/issue28082.golden           |    13 +
 src/cmd/gofmt/testdata/issue28082.input            |    13 +
 src/cmd/gofmt/testdata/rewrite10.golden            |    19 +
 src/cmd/gofmt/testdata/rewrite10.input             |    19 +
 src/cmd/internal/diff/diff.go                      |    58 +
 src/cmd/internal/dwarf/dwarf.go                    |    12 +-
 src/cmd/internal/goobj/read.go                     |    33 +-
 src/cmd/internal/goobj/readnew.go                  |   187 +
 src/cmd/internal/goobj2/builtin.go                 |    45 +
 src/cmd/internal/goobj2/builtinlist.go             |   194 +
 src/cmd/internal/goobj2/funcinfo.go                |   147 +
 src/cmd/internal/goobj2/mkbuiltin.go               |   124 +
 src/cmd/internal/goobj2/objfile.go                 |   587 +
 src/cmd/internal/obj/arm/a.out.go                  |     3 -
 src/cmd/internal/obj/arm/anames.go                 |     2 -
 src/cmd/internal/obj/arm/asm5.go                   |   354 +-
 src/cmd/internal/obj/arm64/a.out.go                |    29 +-
 src/cmd/internal/obj/arm64/anames.go               |    11 +
 src/cmd/internal/obj/arm64/asm7.go                 |   186 +-
 src/cmd/internal/obj/arm64/list7.go                |    29 +-
 src/cmd/internal/obj/arm64/obj7.go                 |    37 +-
 src/cmd/internal/obj/arm64/sysRegEnc.go            |   895 ++
 src/cmd/internal/obj/dwarf.go                      |   203 +
 src/cmd/internal/obj/inl.go                        |    15 +
 src/cmd/internal/obj/link.go                       |    60 +-
 src/cmd/internal/obj/mips/a.out.go                 |    35 +-
 src/cmd/internal/obj/mips/asm0.go                  |   666 +-
 src/cmd/internal/obj/mips/obj0.go                  |     6 +
 src/cmd/internal/obj/objfile.go                    |    84 +-
 src/cmd/internal/obj/objfile2.go                   |   429 +
 src/cmd/internal/obj/pcln.go                       |   107 +-
 src/cmd/internal/obj/plist.go                      |    73 +-
 src/cmd/internal/obj/ppc64/a.out.go                |     8 +-
 src/cmd/internal/obj/ppc64/anames.go               |     8 +-
 src/cmd/internal/obj/ppc64/asm9.go                 |    89 +-
 src/cmd/internal/obj/ppc64/obj9.go                 |    94 +-
 src/cmd/internal/obj/riscv/anames.go               |   245 +
 src/cmd/internal/obj/riscv/cpu.go                  |   559 +
 src/cmd/internal/obj/riscv/inst.go                 |   459 +
 src/cmd/internal/obj/riscv/list.go                 |    33 +
 src/cmd/internal/obj/riscv/obj.go                  |  1174 ++
 src/cmd/internal/obj/s390x/a.out.go                |    22 +
 src/cmd/internal/obj/s390x/anames.go               |    16 +
 src/cmd/internal/obj/s390x/asmz.go                 |   410 +-
 src/cmd/internal/obj/s390x/condition_code.go       |   120 +
 src/cmd/internal/obj/s390x/objz.go                 |    17 +-
 src/cmd/internal/obj/s390x/rotate.go               |    47 +
 src/cmd/internal/obj/s390x/vector.go               |     4 +-
 src/cmd/internal/obj/sizeof_test.go                |     4 +-
 src/cmd/internal/obj/sym.go                        |   176 +
 src/cmd/internal/obj/util.go                       |     1 +
 src/cmd/internal/obj/wasm/a.out.go                 |    28 +-
 src/cmd/internal/obj/wasm/anames.go                |     5 +
 src/cmd/internal/obj/wasm/wasmobj.go               |   324 +-
 src/cmd/internal/obj/x86/aenum.go                  |     5 +
 src/cmd/internal/obj/x86/anames.go                 |     5 +
 src/cmd/internal/obj/x86/asm6.go                   |   229 +-
 src/cmd/internal/obj/x86/obj6.go                   |   101 +-
 src/cmd/internal/objabi/doc.go                     |     6 +-
 src/cmd/internal/objabi/funcdata.go                |    11 +-
 src/cmd/internal/objabi/funcid.go                  |    15 +
 src/cmd/internal/objabi/head.go                    |     5 -
 src/cmd/internal/objabi/reloctype.go               |    30 +-
 src/cmd/internal/objabi/stack.go                   |     2 +-
 src/cmd/internal/objabi/symkind.go                 |     4 +-
 src/cmd/internal/objabi/util.go                    |     2 +-
 src/cmd/internal/objfile/disasm.go                 |    30 +-
 src/cmd/internal/objfile/goobj.go                  |     2 +-
 src/cmd/internal/objfile/objfile.go                |     2 +-
 src/cmd/internal/src/pos.go                        |     5 +-
 src/cmd/internal/src/xpos.go                       |    30 +
 src/cmd/internal/sys/arch.go                       |    24 +-
 src/cmd/internal/test2json/test2json.go            |     2 +-
 .../internal/test2json/testdata/benchshort.json    |     2 +-
 src/cmd/internal/test2json/testdata/empty.json     |     1 +
 .../cmd/internal/test2json/testdata/empty.test     |     0
 src/cmd/internal/test2json/testdata/panic.json     |    19 +
 src/cmd/internal/test2json/testdata/panic.test     |    17 +
 src/cmd/link/dwarf_test.go                         |     9 +-
 src/cmd/link/internal/amd64/asm.go                 |    41 +-
 src/cmd/link/internal/amd64/obj.go                 |    15 -
 src/cmd/link/internal/arm/asm.go                   |    32 +-
 src/cmd/link/internal/arm/obj.go                   |    11 -
 src/cmd/link/internal/arm64/asm.go                 |    26 +-
 src/cmd/link/internal/arm64/obj.go                 |    14 +-
 src/cmd/link/internal/ld/config.go                 |    32 +-
 src/cmd/link/internal/ld/data.go                   |    66 +-
 src/cmd/link/internal/ld/deadcode.go               |    78 +-
 src/cmd/link/internal/ld/deadcode2.go              |   441 +
 src/cmd/link/internal/ld/decodesym.go              |    58 +-
 src/cmd/link/internal/ld/dwarf.go                  |   547 +-
 src/cmd/link/internal/ld/dwarf_test.go             |    78 +-
 src/cmd/link/internal/ld/elf.go                    |    17 +-
 src/cmd/link/internal/ld/elf_test.go               |    79 +
 src/cmd/link/internal/ld/execarchive.go            |    37 +
 src/cmd/link/internal/ld/execarchive_noexec.go     |    13 +
 src/cmd/link/internal/ld/go.go                     |    63 +-
 src/cmd/link/internal/ld/issue33808_test.go        |    54 +
 src/cmd/link/internal/ld/ld.go                     |     6 +-
 src/cmd/link/internal/ld/ld_test.go                |    65 +
 src/cmd/link/internal/ld/lib.go                    |   722 +-
 src/cmd/link/internal/ld/link.go                   |    18 +-
 src/cmd/link/internal/ld/macho.go                  |    15 +-
 src/cmd/link/internal/ld/main.go                   |    13 +-
 src/cmd/link/internal/ld/outbuf_nommap.go          |     2 +-
 src/cmd/link/internal/ld/outbuf_windows.go         |    49 +
 src/cmd/link/internal/ld/pcln.go                   |   104 +-
 src/cmd/link/internal/ld/pe.go                     |   116 +-
 src/cmd/link/internal/ld/sym.go                    |    27 +-
 src/cmd/link/internal/ld/symtab.go                 |     7 +-
 src/cmd/link/internal/ld/util.go                   |    34 +-
 src/cmd/link/internal/ld/xcoff.go                  |    45 +-
 src/cmd/link/internal/loadelf/ldelf.go             |    35 +-
 src/cmd/link/internal/loader/loader.go             |  1308 ++
 src/cmd/link/internal/loadmacho/ldmacho.go         |    21 +-
 src/cmd/link/internal/loadpe/ldpe.go               |    53 +-
 src/cmd/link/internal/loadxcoff/ldxcoff.go         |    25 +-
 src/cmd/link/internal/mips/asm.go                  |    26 -
 src/cmd/link/internal/mips64/asm.go                |    26 +-
 src/cmd/link/internal/mips64/obj.go                |    11 -
 src/cmd/link/internal/objfile/objfile.go           |    43 +-
 src/cmd/link/internal/ppc64/asm.go                 |    30 +-
 src/cmd/link/internal/ppc64/obj.go                 |    11 -
 src/cmd/link/internal/s390x/asm.go                 |    27 -
 src/cmd/link/internal/sym/compilation_unit.go      |    23 +
 src/cmd/link/internal/sym/library.go               |     1 +
 src/cmd/link/internal/sym/sizeof_test.go           |     2 -
 src/cmd/link/internal/sym/symbol.go                |    12 +-
 src/cmd/link/internal/sym/symbols.go               |    11 +
 src/cmd/link/internal/sym/symkind.go               |    12 +-
 src/cmd/link/internal/sym/symkind_string.go        |    40 +-
 src/cmd/link/internal/wasm/asm.go                  |    47 +-
 src/cmd/link/internal/x86/asm.go                   |    31 +-
 src/cmd/link/internal/x86/obj.go                   |    11 -
 src/cmd/link/link_test.go                          |   126 +
 src/cmd/link/main.go                               |     2 +-
 src/cmd/nm/nm_cgo_test.go                          |     5 +
 .../vendor/golang.org/x/crypto/ed25519/ed25519.go  |   222 +
 .../golang.org/x/crypto/ed25519/ed25519_go113.go   |    73 +
 .../crypto/ed25519/internal/edwards25519/const.go  |  1422 ++
 .../ed25519/internal/edwards25519/edwards25519.go  |  1793 +++
 src/cmd/vendor/golang.org/x/mod/LICENSE            |    27 +
 src/cmd/vendor/golang.org/x/mod/PATENTS            |    22 +
 .../golang.org/x/mod/internal/lazyregexp/lazyre.go |    78 +
 .../golang.org/x/mod}/modfile/print.go             |     1 +
 .../golang.org/x/mod}/modfile/read.go              |    44 +-
 .../golang.org/x/mod}/modfile/rule.go              |    21 +-
 .../golang.org/x/mod}/module/module.go             |   282 +-
 .../golang.org/x/mod}/semver/semver.go             |     2 +-
 .../golang.org/x/mod/sumdb}/cache.go               |     2 +-
 .../golang.org/x/mod/sumdb}/client.go              |   182 +-
 .../golang.org/x/mod/sumdb}/dirhash/hash.go        |    33 +-
 .../golang.org/x/mod/sumdb}/note/note.go           |     6 +-
 .../golang.org/x/mod/sumdb}/server.go              |    86 +-
 .../golang.org/x/mod/sumdb}/test.go                |    25 +-
 .../golang.org/x/mod/sumdb}/tlog/note.go           |     2 +-
 .../golang.org/x/mod/sumdb}/tlog/tile.go           |    25 +-
 .../golang.org/x/mod/sumdb}/tlog/tlog.go           |     7 +-
 src/cmd/vendor/golang.org/x/mod/zip/zip.go         |   560 +
 .../golang.org/x/tools/go/analysis/analysis.go     |    39 +-
 .../golang.org/x/tools/go/analysis/diagnostic.go   |    61 +
 .../vendor/golang.org/x/tools/go/analysis/doc.go   |    16 +-
 .../go/analysis/internal/analysisflags/flags.go    |     6 +-
 .../x/tools/go/analysis/internal/facts/facts.go    |    26 +-
 .../x/tools/go/analysis/passes/asmdecl/asmdecl.go  |    14 +-
 .../x/tools/go/analysis/passes/assign/assign.go    |    10 +-
 .../x/tools/go/analysis/passes/atomic/atomic.go    |     2 +-
 .../x/tools/go/analysis/passes/bools/bools.go      |     4 +-
 .../x/tools/go/analysis/passes/cgocall/cgocall.go  |     4 +-
 .../go/analysis/passes/composite/composite.go      |     2 +-
 .../go/analysis/passes/composite/whitelist.go      |     1 +
 .../tools/go/analysis/passes/copylock/copylock.go  |    14 +-
 .../tools/go/analysis/passes/ctrlflow/ctrlflow.go  |     9 +-
 .../tools/go/analysis/passes/errorsas/errorsas.go  |     4 +-
 .../analysis/passes/httpresponse/httpresponse.go   |     2 +-
 .../x/tools/go/analysis/passes/inspect/inspect.go  |     2 +-
 .../go/analysis/passes/loopclosure/loopclosure.go  |     2 +-
 .../go/analysis/passes/lostcancel/lostcancel.go    |     6 +-
 .../x/tools/go/analysis/passes/nilfunc/nilfunc.go  |     2 +-
 .../x/tools/go/analysis/passes/printf/printf.go    |   195 +-
 .../x/tools/go/analysis/passes/printf/types.go     |     8 +-
 .../x/tools/go/analysis/passes/shift/shift.go      |     2 +-
 .../go/analysis/passes/stdmethods/stdmethods.go    |     2 +-
 .../go/analysis/passes/structtag/structtag.go      |     6 +-
 .../go/analysis/passes/unreachable/unreachable.go  |     2 +-
 .../go/analysis/passes/unsafeptr/unsafeptr.go      |     2 +-
 .../x/tools/go/analysis/unitchecker/unitchecker.go |     8 +
 .../golang.org/x/tools/go/analysis/validate.go     |     9 +-
 .../vendor/golang.org/x/tools/go/cfg/builder.go    |     2 +-
 .../x/tools/go/types/objectpath/objectpath.go      |     2 +-
 src/cmd/vendor/golang.org/x/xerrors/LICENSE        |    27 +
 src/cmd/vendor/golang.org/x/xerrors/PATENTS        |    22 +
 src/cmd/vendor/golang.org/x/xerrors/README         |     2 +
 src/cmd/vendor/golang.org/x/xerrors/adaptor.go     |   193 +
 src/cmd/vendor/golang.org/x/xerrors/codereview.cfg |     1 +
 src/cmd/vendor/golang.org/x/xerrors/doc.go         |    22 +
 src/cmd/vendor/golang.org/x/xerrors/errors.go      |    33 +
 src/cmd/vendor/golang.org/x/xerrors/fmt.go         |   109 +
 src/cmd/vendor/golang.org/x/xerrors/format.go      |    34 +
 src/cmd/vendor/golang.org/x/xerrors/frame.go       |    56 +
 src/cmd/vendor/golang.org/x/xerrors/go.mod         |     3 +
 .../golang.org/x/xerrors/internal/internal.go}     |     7 +-
 src/cmd/vendor/golang.org/x/xerrors/wrap.go        |   106 +
 src/cmd/vendor/modules.txt                         |    26 +-
 src/cmd/vet/testdata/asm/asm.go                    |     2 +
 src/cmd/vet/testdata/asm/asm1.s                    |    15 +
 src/cmd/vet/testdata/print/print.go                |     5 +-
 src/compress/flate/deflate.go                      |    13 +-
 src/compress/lzw/reader.go                         |    10 +-
 src/context/context.go                             |    63 +-
 src/context/context_test.go                        |    83 +-
 src/context/x_test.go                              |     1 +
 src/crypto/aes/gcm_ppc64le.go                      |   257 +
 src/crypto/aes/gcm_ppc64le.s                       |   563 +
 src/crypto/cipher/xor_ppc64x.s                     |    77 +-
 src/crypto/dsa/dsa.go                              |     7 +-
 src/crypto/dsa/dsa_test.go                         |    15 +
 src/crypto/ecdsa/ecdsa.go                          |    36 +-
 src/crypto/ecdsa/ecdsa_noasm.go                    |    22 -
 src/crypto/ecdsa/ecdsa_s390x.go                    |   153 -
 src/crypto/ecdsa/ecdsa_s390x.s                     |    31 -
 src/crypto/ecdsa/ecdsa_s390x_test.go               |    33 -
 src/crypto/ed25519/ed25519.go                      |    21 +-
 src/crypto/ed25519/ed25519_test.go                 |     9 +
 src/crypto/elliptic/fuzz_test.go                   |     2 +-
 src/crypto/elliptic/p256_asm_ppc64le.s             |  2494 ++++
 src/crypto/elliptic/p256_generic.go                |     2 +-
 src/crypto/elliptic/p256_ppc64le.go                |   521 +
 src/crypto/md5/md5block_amd64p32.s                 |   184 -
 src/crypto/md5/md5block_decl.go                    |     2 +-
 src/crypto/md5/md5block_generic.go                 |     2 +-
 src/crypto/rand/eagain.go                          |     2 +-
 src/crypto/rand/rand_unix.go                       |     2 +-
 src/crypto/sha1/sha1block_amd64p32.s               |   216 -
 src/crypto/sha1/sha1block_decl.go                  |     2 +-
 src/crypto/sha1/sha1block_generic.go               |     2 +-
 src/crypto/tls/auth.go                             |   167 +-
 src/crypto/tls/auth_test.go                        |   158 +-
 src/crypto/tls/boring_test.go                      |     7 +-
 src/crypto/tls/cipher_suites.go                    |    20 +-
 src/crypto/tls/common.go                           |    97 +-
 src/crypto/tls/conn.go                             |     4 +-
 src/crypto/tls/example_test.go                     |    53 +
 src/crypto/tls/generate_cert.go                    |    20 +-
 src/crypto/tls/handshake_client.go                 |    74 +-
 src/crypto/tls/handshake_client_test.go            |    22 +-
 src/crypto/tls/handshake_client_tls13.go           |    41 +-
 src/crypto/tls/handshake_messages.go               |   109 +-
 src/crypto/tls/handshake_messages_test.go          |    18 +-
 src/crypto/tls/handshake_server.go                 |   185 +-
 src/crypto/tls/handshake_server_test.go            |   105 +-
 src/crypto/tls/handshake_server_tls13.go           |    47 +-
 src/crypto/tls/handshake_test.go                   |    40 +-
 src/crypto/tls/handshake_unix_test.go              |    18 +
 src/crypto/tls/key_agreement.go                    |    94 +-
 src/crypto/tls/prf.go                              |    31 +-
 src/crypto/tls/testdata/Client-TLSv12-ALPN         |    74 +-
 src/crypto/tls/testdata/Client-TLSv13-ALPN         |   162 +-
 .../tls/testdata/Server-TLSv10-ECDHE-ECDSA-AES     |   139 +-
 .../testdata/Server-TLSv10-ExportKeyingMaterial    |   159 +-
 src/crypto/tls/testdata/Server-TLSv10-RSA-3DES     |   131 +-
 src/crypto/tls/testdata/Server-TLSv10-RSA-AES      |   137 +-
 src/crypto/tls/testdata/Server-TLSv10-RSA-RC4      |   125 +-
 src/crypto/tls/testdata/Server-TLSv11-RSA-RC4      |   125 +-
 src/crypto/tls/testdata/Server-TLSv12-ALPN         |   151 +-
 src/crypto/tls/testdata/Server-TLSv12-ALPN-NoMatch |   150 +-
 .../Server-TLSv12-CipherSuiteCertPreferenceECDSA   |   137 +-
 .../Server-TLSv12-CipherSuiteCertPreferenceRSA     |   145 +-
 .../Server-TLSv12-ClientAuthRequestedAndECDSAGiven |   157 +-
 ...erver-TLSv12-ClientAuthRequestedAndEd25519Given |   149 +-
 .../Server-TLSv12-ClientAuthRequestedAndGiven      |   139 +-
 ...rver-TLSv12-ClientAuthRequestedAndPKCS1v15Given |   157 +-
 .../Server-TLSv12-ClientAuthRequestedNotGiven      |   139 +-
 .../tls/testdata/Server-TLSv12-ECDHE-ECDSA-AES     |   137 +-
 src/crypto/tls/testdata/Server-TLSv12-Ed25519      |    92 +-
 .../testdata/Server-TLSv12-ExportKeyingMaterial    |   150 +-
 src/crypto/tls/testdata/Server-TLSv12-IssueTicket  |   150 +-
 .../testdata/Server-TLSv12-IssueTicketPreDisable   |   150 +-
 src/crypto/tls/testdata/Server-TLSv12-P256         |   143 +-
 src/crypto/tls/testdata/Server-TLSv12-RSA-3DES     |   131 +-
 src/crypto/tls/testdata/Server-TLSv12-RSA-AES      |   135 +-
 src/crypto/tls/testdata/Server-TLSv12-RSA-AES-GCM  |   135 +-
 .../testdata/Server-TLSv12-RSA-AES256-GCM-SHA384   |   135 +-
 src/crypto/tls/testdata/Server-TLSv12-RSA-RC4      |   125 +-
 .../tls/testdata/Server-TLSv12-RSA-RSAPKCS1v15     |   135 +-
 src/crypto/tls/testdata/Server-TLSv12-RSA-RSAPSS   |    87 +-
 src/crypto/tls/testdata/Server-TLSv12-Resume       |    66 +-
 .../tls/testdata/Server-TLSv12-ResumeDisabled      |   151 +-
 src/crypto/tls/testdata/Server-TLSv12-SNI          |   135 +-
 .../tls/testdata/Server-TLSv12-SNI-GetCertificate  |   135 +-
 .../Server-TLSv12-SNI-GetCertificateNotFound       |   135 +-
 src/crypto/tls/testdata/Server-TLSv12-X25519       |   135 +-
 .../tls/testdata/Server-TLSv13-AES128-SHA256       |   168 +-
 src/crypto/tls/tls.go                              |     4 -
 src/crypto/tls/tls_test.go                         |    54 -
 src/crypto/x509/name_constraints_test.go           |     2 +-
 src/crypto/x509/root_nacl.go                       |     8 -
 src/crypto/x509/root_unix.go                       |     2 +-
 src/crypto/x509/root_windows.go                    |    10 +-
 src/crypto/x509/verify.go                          |    16 +-
 src/crypto/x509/x509.go                            |    82 +-
 src/crypto/x509/x509_test.go                       |   154 +-
 src/database/sql/convert.go                        |     2 +-
 src/database/sql/convert_test.go                   |     4 +-
 src/database/sql/ctxutil.go                        |     2 -
 src/database/sql/fakedb_test.go                    |     3 -
 src/database/sql/sql.go                            |     4 +-
 src/database/sql/sql_test.go                       |     2 +-
 src/debug/dwarf/attr_string.go                     |   322 +-
 src/debug/dwarf/buf.go                             |    31 +-
 src/debug/dwarf/class_string.go                    |    21 +
 src/debug/dwarf/const.go                           |   196 +-
 src/debug/dwarf/entry.go                           |   227 +-
 src/debug/dwarf/entry_test.go                      |    20 +-
 src/debug/dwarf/line.go                            |   246 +-
 src/debug/dwarf/line_test.go                       |    58 +-
 src/debug/dwarf/open.go                            |    25 +
 src/debug/dwarf/tag_string.go                      |    81 +-
 src/debug/dwarf/type_test.go                       |     2 +-
 src/debug/dwarf/typeunit.go                        |     2 +-
 src/debug/dwarf/unit.go                            |    26 +-
 src/debug/elf/file.go                              |   136 +-
 src/debug/elf/file_test.go                         |     2 +-
 src/debug/macho/file.go                            |     7 +-
 src/debug/pe/file.go                               |   200 +-
 src/debug/pe/file_test.go                          |   174 +-
 src/debug/pe/testdata/vmlinuz-4.15.0-47-generic    |   Bin 0 -> 474 bytes
 src/encoding/asn1/asn1.go                          |    33 +-
 src/encoding/asn1/asn1_test.go                     |    33 +
 src/encoding/asn1/common.go                        |     1 +
 src/encoding/base32/base32.go                      |    49 +-
 src/encoding/base32/base32_test.go                 |    18 +
 src/encoding/binary/binary.go                      |    61 +-
 src/encoding/binary/binary_test.go                 |   164 +
 src/encoding/csv/fuzz.go                           |    14 +-
 src/encoding/gob/codec_test.go                     |     2 +-
 src/encoding/json/bench_test.go                    |    35 +
 src/encoding/json/decode.go                        |    86 +-
 src/encoding/json/decode_test.go                   |   131 +-
 src/encoding/json/encode.go                        |    94 +-
 src/encoding/json/encode_test.go                   |   113 +-
 src/encoding/json/indent.go                        |    21 +-
 src/encoding/json/scanner.go                       |    36 +-
 src/encoding/json/scanner_test.go                  |     5 +-
 src/encoding/json/stream.go                        |    17 +-
 src/encoding/json/stream_test.go                   |    10 +
 src/encoding/xml/marshal.go                        |     2 +-
 src/encoding/xml/marshal_test.go                   |     1 -
 src/encoding/xml/read.go                           |     2 +-
 src/encoding/xml/typeinfo.go                       |     8 +-
 src/encoding/xml/xml.go                            |     5 +-
 src/encoding/xml/xml_test.go                       |    45 +
 src/errors/errors.go                               |     8 +-
 src/errors/wrap.go                                 |     6 +-
 src/flag/flag.go                                   |     3 +
 src/fmt/errors_test.go                             |    10 +-
 src/fmt/scan.go                                    |    13 +
 src/fmt/scan_test.go                               |    19 +-
 src/go.mod                                         |     6 +-
 src/go.sum                                         |     9 +-
 src/go/ast/ast.go                                  |    12 +-
 src/go/ast/filter.go                               |     7 +-
 src/go/ast/import.go                               |    88 +-
 src/go/ast/issues_test.go                          |    42 +
 src/go/build/build.go                              |   149 +-
 src/go/build/build_test.go                         |    83 +-
 src/go/build/deps_test.go                          |     5 +-
 src/go/build/doc.go                                |     1 +
 src/go/build/syslist.go                            |     3 +
 src/go/doc/doc.go                                  |   104 +-
 src/go/doc/doc_test.go                             |    13 +-
 src/go/doc/example.go                              |   111 +-
 src/go/doc/example_test.go                         |   211 +
 src/go/doc/testdata/bugpara.go                     |     4 +
 src/go/internal/gccgoimporter/importer_test.go     |     3 +-
 src/go/internal/gccgoimporter/parser.go            |    80 +-
 .../internal/gccgoimporter/testdata/issue34182.go  |    17 +
 .../internal/gccgoimporter/testdata/issue34182.gox |    13 +
 src/go/internal/gcimporter/bimport.go              |     6 +-
 src/go/internal/gcimporter/gcimporter_test.go      |     7 +-
 src/go/internal/gcimporter/iimport.go              |    42 +-
 src/go/parser/interface.go                         |    23 +-
 src/go/parser/parser.go                            |    29 +-
 src/go/parser/parser_test.go                       |    25 +-
 src/go/parser/testdata/issue34946.src              |    22 +
 src/go/printer/nodes.go                            |    33 +-
 src/go/printer/printer_test.go                     |    31 +
 src/go/types/api.go                                |    15 +-
 src/go/types/builtins.go                           |     6 +-
 src/go/types/call.go                               |     7 +-
 src/go/types/conversions.go                        |     4 +-
 src/go/types/decl.go                               |   287 +-
 src/go/types/example_test.go                       |     2 +-
 src/go/types/expr.go                               |    17 +-
 src/go/types/initorder.go                          |    12 +-
 src/go/types/issues_test.go                        |    58 +
 src/go/types/lookup.go                             |    16 +-
 src/go/types/methodset.go                          |     7 +-
 src/go/types/object_test.go                        |    44 +-
 src/go/types/operand.go                            |     7 +-
 src/go/types/predicates.go                         |    42 +-
 src/go/types/resolver.go                           |    36 +-
 src/go/types/scope.go                              |     2 +-
 src/go/types/selection.go                          |     8 +-
 src/go/types/stdlib_test.go                        |     2 +
 src/go/types/stmt.go                               |     4 +-
 src/go/types/testdata/const0.src                   |    14 +
 src/go/types/testdata/cycles.src                   |    11 +-
 src/go/types/testdata/cycles2.src                  |     4 +-
 src/go/types/testdata/cycles5.src                  |    10 +
 src/go/types/testdata/decls0.src                   |     4 -
 src/go/types/type.go                               |    19 +-
 src/go/types/typexpr.go                            |    86 +-
 src/hash/crc32/crc32_amd64p32.go                   |    37 -
 src/hash/crc32/crc32_amd64p32.s                    |    53 -
 src/hash/crc32/crc32_otherarch.go                  |     2 +-
 src/hash/maphash/maphash.go                        |   218 +
 src/hash/maphash/maphash_test.go                   |    88 +
 src/hash/maphash/smhasher_test.go                  |   469 +
 src/html/template/doc.go                           |    45 +
 src/image/gif/writer_test.go                       |     2 +-
 src/image/png/writer.go                            |     5 +-
 src/internal/bytealg/compare_amd64p32.s            |   142 -
 src/internal/bytealg/compare_generic.go            |     2 +-
 src/internal/bytealg/compare_mips64x.s             |    88 +
 src/internal/bytealg/compare_native.go             |     2 +-
 src/internal/bytealg/compare_wasm.s                |     3 +-
 src/internal/bytealg/count_generic.go              |     2 +-
 src/internal/bytealg/count_native.go               |     2 +-
 src/internal/bytealg/count_ppc64x.s                |     2 +-
 src/internal/bytealg/count_s390x.s                 |   169 +
 src/internal/bytealg/equal_amd64p32.s              |   132 -
 src/internal/bytealg/equal_riscv64.s               |    49 +
 src/internal/bytealg/indexbyte_amd64p32.s          |   113 -
 src/internal/bytealg/indexbyte_generic.go          |     2 +-
 src/internal/bytealg/indexbyte_native.go           |     2 +-
 src/internal/bytealg/indexbyte_riscv64.s           |    52 +
 src/internal/cfg/cfg.go                            |     1 +
 src/internal/cpu/cpu.go                            |     2 +-
 src/internal/cpu/cpu_no_init.go                    |     1 -
 .../exp_amd64p32.s => internal/cpu/cpu_riscv64.go} |     6 +-
 src/internal/cpu/cpu_x86.go                        |     6 +-
 src/internal/cpu/cpu_x86.s                         |     8 +-
 src/internal/cpu/cpu_x86_test.go                   |     2 +-
 src/internal/fmtsort/sort.go                       |    14 +-
 src/internal/fmtsort/sort_test.go                  |     2 +-
 src/internal/goroot/gc.go                          |    15 +-
 src/internal/goversion/goversion.go                |     2 +-
 src/internal/poll/export_posix_test.go             |     2 +-
 src/internal/poll/fd_fsync_posix.go                |     2 +-
 .../poll/{fd_poll_nacljs.go => fd_poll_js.go}      |     2 +-
 src/internal/poll/fd_posix.go                      |     2 +-
 src/internal/poll/fd_posix_test.go                 |     2 +-
 src/internal/poll/fd_unix.go                       |     2 +-
 src/internal/poll/hook_unix.go                     |     2 +-
 src/internal/poll/sendfile_windows.go              |    61 +-
 src/internal/poll/sys_cloexec.go                   |     2 +-
 src/internal/reflectlite/reflect_mirror_test.go    |   131 +
 src/internal/reflectlite/set_test.go               |     9 +
 src/internal/reflectlite/type.go                   |    45 +-
 src/internal/reflectlite/value.go                  |    15 +-
 src/internal/singleflight/singleflight_test.go     |     2 +-
 src/internal/syscall/unix/at_sysnum_darwin.go      |     4 -
 .../syscall/unix/at_sysnum_fstatat_linux.go        |     2 +-
 .../syscall/unix/getrandom_linux_generic.go        |    10 +-
 src/internal/syscall/unix/nonblocking_nacl.go      |     9 -
 src/internal/syscall/windows/mksyscall.go          |     2 +-
 src/internal/syscall/windows/registry/mksyscall.go |     2 +-
 .../syscall/windows/registry/registry_test.go      |    80 -
 src/internal/syscall/windows/registry/value.go     |    11 +-
 src/internal/testenv/testenv.go                    |    10 +-
 src/internal/testenv/testenv_notwin.go             |     2 +-
 src/io/io.go                                       |     3 +
 src/io/ioutil/example_test.go                      |    23 +
 src/io/ioutil/ioutil.go                            |     5 +-
 src/io/ioutil/ioutil_test.go                       |    34 +
 src/io/ioutil/tempfile.go                          |    32 +-
 src/io/ioutil/tempfile_test.go                     |    45 +-
 src/io/pipe.go                                     |    35 +-
 src/io/pipe_test.go                                |     8 +-
 src/log/log.go                                     |    27 +-
 src/log/log_test.go                                |     5 +-
 src/log/syslog/doc.go                              |     2 -
 src/log/syslog/example_test.go                     |     2 +-
 src/log/syslog/syslog.go                           |     2 +-
 src/log/syslog/syslog_test.go                      |     2 +-
 src/log/syslog/syslog_unix.go                      |     2 +-
 src/make.bash                                      |     3 +-
 src/math/all_test.go                               |    81 +
 src/math/big/arith_amd64p32.s                      |    40 -
 src/math/big/floatconv_test.go                     |     4 +
 src/math/big/ftoa.go                               |     3 +-
 src/math/big/int.go                                |    50 +-
 src/math/big/int_test.go                           |    26 +-
 src/math/big/nat.go                                |    14 +-
 src/math/big/nat_test.go                           |    29 +-
 src/math/big/rat.go                                |    70 +-
 src/math/big/rat_test.go                           |    56 +-
 src/math/big/ratconv.go                            |     2 +-
 src/math/bits/bits.go                              |    31 +
 src/math/bits/bits_test.go                         |    70 +
 src/math/dim_amd64p32.s                            |     5 -
 src/math/example_test.go                           |    46 +
 src/math/exp_asm.go                                |     2 +-
 src/math/fma.go                                    |   170 +
 src/math/log_amd64p32.s                            |     5 -
 src/math/rand/rand.go                              |    20 +-
 src/math/rand/rand_test.go                         |     8 +
 src/math/sqrt_amd64p32.s                           |     5 -
 src/math/stubs_amd64p32.s                          |     5 -
 src/mime/multipart/multipart.go                    |    38 +-
 src/mime/multipart/multipart_test.go               |    60 +
 src/mime/type.go                                   |     4 +-
 src/mime/type_unix.go                              |     2 +-
 src/naclmake.bash                                  |    48 -
 src/nacltest.bash                                  |    52 -
 src/net/dial.go                                    |     2 +
 src/net/dial_test.go                               |    25 +-
 src/net/dnsclient_unix.go                          |     8 +
 src/net/dnsclient_unix_test.go                     |    47 +
 src/net/error_posix.go                             |     2 +-
 src/net/error_test.go                              |     6 +-
 src/net/example_test.go                            |    18 +
 src/net/fd_unix.go                                 |     4 +-
 src/net/file.go                                    |     2 +-
 src/net/file_stub.go                               |     2 +-
 src/net/file_test.go                               |     8 +-
 src/net/hook_unix.go                               |     2 +-
 src/net/http/{npn_test.go => alpn_test.go}         |     0
 src/net/http/cgi/host_test.go                      |    33 +-
 src/net/http/client.go                             |    98 +-
 src/net/http/client_test.go                        |    92 +-
 src/net/http/clientserver_test.go                  |     9 +
 src/net/http/clone.go                              |    10 +
 src/net/http/cookie.go                             |     5 +-
 src/net/http/export_test.go                        |    30 +
 src/net/http/fs.go                                 |    36 +-
 src/net/http/fs_test.go                            |    26 +-
 src/net/http/h2_bundle.go                          |    53 +-
 src/net/http/header.go                             |    15 +-
 src/net/http/header_test.go                        |    32 +
 src/net/http/http.go                               |     7 +
 src/net/http/http_test.go                          |    52 +
 src/net/http/httptest/example_test.go              |    22 +
 src/net/http/httptest/server.go                    |    12 +-
 src/net/http/httptest/server_test.go               |    36 +
 src/net/http/httputil/dump.go                      |    33 +-
 src/net/http/httputil/dump_test.go                 |    49 +
 src/net/http/httputil/reverseproxy_test.go         |     2 +-
 src/net/http/main_test.go                          |     5 +-
 src/net/http/omithttp2.go                          |    71 +
 src/net/http/pprof/pprof.go                        |     3 +
 src/net/http/readrequest_test.go                   |     4 +-
 src/net/http/request.go                            |    15 +-
 src/net/http/request_test.go                       |    86 +-
 src/net/http/response_test.go                      |     5 +
 src/net/http/roundtrip_js.go                       |    10 +-
 src/net/http/serve_test.go                         |   204 +
 src/net/http/server.go                             |   103 +-
 src/net/http/transfer.go                           |   125 +-
 src/net/http/transfer_test.go                      |   284 +-
 src/net/http/transport.go                          |   125 +-
 src/net/http/transport_test.go                     |   413 +-
 src/net/interface.go                               |     2 +-
 src/net/interface_plan9.go                         |    61 +-
 src/net/interface_stub.go                          |     2 +-
 src/net/interface_test.go                          |     2 +-
 src/net/interface_unix_test.go                     |     4 +-
 src/net/internal/socktest/switch_unix.go           |     2 +-
 src/net/internal/socktest/sys_unix.go              |     2 +-
 src/net/ip.go                                      |     9 +-
 src/net/iprawsock.go                               |     2 +-
 src/net/iprawsock_posix.go                         |     2 +-
 src/net/ipsock_plan9.go                            |     2 +-
 src/net/ipsock_posix.go                            |     4 +-
 src/net/listen_test.go                             |     8 +-
 src/net/lookup.go                                  |     3 +-
 src/net/lookup_fake.go                             |     2 +-
 src/net/lookup_test.go                             |    50 +-
 src/net/lookup_windows.go                          |     3 +-
 src/net/lookup_windows_test.go                     |    85 +
 src/net/mail/message.go                            |    25 +-
 src/net/mail/message_test.go                       |   151 +
 src/net/main_conf_test.go                          |     2 +-
 src/net/main_noconf_test.go                        |     2 +-
 src/net/main_unix_test.go                          |     2 +-
 src/net/net_test.go                                |     7 +-
 src/net/platform_test.go                           |    10 +-
 src/net/port_unix.go                               |     2 +-
 src/net/rawconn.go                                 |     2 +-
 src/net/rawconn_stub_test.go                       |     2 +-
 src/net/rawconn_test.go                            |     4 +-
 src/net/sendfile_stub.go                           |     2 +-
 src/net/sendfile_test.go                           |     2 +-
 src/net/sendfile_windows.go                        |    27 +-
 src/net/server_test.go                             |   114 +-
 src/net/smtp/smtp_test.go                          |    34 +-
 src/net/sock_posix.go                              |     2 +-
 src/net/sock_stub.go                               |     2 +-
 src/net/sockaddr_posix.go                          |     2 +-
 src/net/sockopt_stub.go                            |     2 +-
 src/net/sockoptip_stub.go                          |     2 +-
 src/net/sys_cloexec.go                             |     2 +-
 src/net/tcpsock.go                                 |     7 +-
 src/net/tcpsock_plan9.go                           |     7 +-
 src/net/tcpsock_posix.go                           |     2 +-
 src/net/tcpsock_test.go                            |     4 -
 src/net/tcpsockopt_darwin.go                       |     3 +-
 src/net/tcpsockopt_dragonfly.go                    |     3 +-
 src/net/tcpsockopt_solaris.go                      |     3 +-
 src/net/tcpsockopt_stub.go                         |     2 +-
 src/net/tcpsockopt_unix.go                         |     3 +-
 src/net/tcpsockopt_windows.go                      |     3 +-
 src/net/textproto/header.go                        |    15 +-
 src/net/textproto/header_test.go                   |    54 +
 src/net/textproto/reader.go                        |    45 +-
 src/net/textproto/reader_test.go                   |    52 +-
 src/net/timeout_test.go                            |    58 +-
 src/net/udpsock.go                                 |     5 +-
 src/net/udpsock_plan9.go                           |    10 +-
 src/net/udpsock_plan9_test.go                      |     2 +-
 src/net/udpsock_posix.go                           |     2 +-
 src/net/udpsock_test.go                            |    24 +-
 src/net/unixsock.go                                |     2 +-
 src/net/unixsock_posix.go                          |     2 +-
 src/net/unixsock_test.go                           |     2 +-
 src/net/url/url.go                                 |    30 +-
 src/net/url/url_test.go                            |    15 +
 src/os/dir_unix.go                                 |     2 +-
 src/os/error.go                                    |     2 +-
 src/os/error_posix.go                              |     2 +-
 src/os/error_unix_test.go                          |     2 +-
 src/os/exec/exec.go                                |     8 +-
 src/os/exec/exec_test.go                           |    83 +-
 src/os/exec/lp_unix.go                             |     2 +-
 src/os/exec_posix.go                               |     8 +-
 src/os/exec_unix.go                                |     2 +-
 src/os/executable.go                               |     2 -
 src/os/executable_procfs.go                        |     2 +-
 src/os/executable_test.go                          |     2 +-
 src/os/export_test.go                              |     1 -
 src/os/export_unix_test.go                         |     2 +-
 src/os/file.go                                     |    25 +-
 src/os/file_plan9.go                               |     2 +-
 src/os/file_posix.go                               |     2 +-
 src/os/file_unix.go                                |    10 +-
 src/os/os_test.go                                  |    71 +-
 src/os/os_windows_test.go                          |    16 +
 src/os/path.go                                     |     3 -
 src/os/path_unix.go                                |     2 +-
 src/os/pipe_bsd.go                                 |     2 +-
 src/os/pipe_test.go                                |     4 +-
 src/os/rawconn_test.go                             |     2 +-
 src/os/removeall_at.go                             |     1 -
 src/os/removeall_noat.go                           |     9 +-
 src/os/removeall_test.go                           |    52 +-
 src/os/signal/doc.go                               |     8 +
 src/os/signal/signal.go                            |    15 +
 src/os/signal/signal_plan9.go                      |     3 +-
 src/os/signal/signal_test.go                       |   141 +-
 src/os/signal/signal_unix.go                       |     5 +-
 src/os/{stat_nacljs.go => stat_js.go}              |     2 +-
 src/os/stat_unix.go                                |     2 +-
 src/os/stat_windows.go                             |    22 +-
 src/os/sys_bsd.go                                  |     2 +-
 src/os/sys_nacl.go                                 |     9 -
 src/os/timeout_test.go                             |     1 -
 src/os/user/cgo_lookup_unix.go                     |     4 -
 src/os/user/lookup_stubs.go                        |    11 +-
 src/os/user/lookup_unix.go                         |     2 +-
 src/os/user/lookup_unix_test.go                    |     2 +-
 src/os/wait_unimp.go                               |     2 +-
 src/path/example_test.go                           |    16 +-
 src/path/filepath/path_unix.go                     |     2 +-
 src/path/path.go                                   |     7 +-
 src/plugin/plugin.go                               |     2 +-
 src/plugin/plugin_dlopen.go                        |     2 +-
 src/plugin/plugin_stubs.go                         |     2 +-
 src/plugin/plugin_test.go                          |     1 -
 src/reflect/all_test.go                            |    47 +-
 src/reflect/asm_amd64p32.s                         |    36 -
 src/reflect/deepequal.go                           |    16 +-
 src/reflect/export_test.go                         |    11 +-
 src/reflect/type.go                                |   295 +-
 src/reflect/value.go                               |    29 +-
 src/regexp/backtrack.go                            |     2 +-
 src/regexp/example_test.go                         |    65 +
 src/regexp/exec_test.go                            |     4 +-
 src/runtime/alg.go                                 |   141 +-
 src/runtime/asm.s                                  |     6 -
 src/runtime/asm_386.s                              |    28 +-
 src/runtime/asm_amd64.s                            |    36 +-
 src/runtime/asm_amd64p32.s                         |   763 --
 src/runtime/asm_arm.s                              |    31 +-
 src/runtime/asm_arm64.s                            |    46 +-
 src/runtime/asm_mips64x.s                          |    16 +-
 src/runtime/asm_mipsx.s                            |    24 +-
 src/runtime/asm_ppc64x.s                           |    16 +-
 src/runtime/asm_s390x.s                            |    16 +-
 src/runtime/asm_wasm.s                             |    10 +
 src/runtime/callers_test.go                        |   214 +-
 src/runtime/cgo/asm_nacl_amd64p32.s                |    13 -
 src/runtime/cgo/cgo.go                             |     3 +
 src/runtime/cgo/gcc_freebsd_arm64.c                |    68 +
 src/runtime/cgocall.go                             |    22 +-
 src/runtime/cgocheck.go                            |     2 +-
 src/runtime/chan.go                                |    92 +-
 src/runtime/chan_test.go                           |    18 +-
 src/runtime/checkptr.go                            |   104 +
 src/runtime/cpuflags.go                            |     3 +
 src/runtime/crash_nonunix_test.go                  |     2 +-
 src/runtime/crash_test.go                          |   110 +-
 src/runtime/crash_unix_test.go                     |    74 +-
 src/runtime/debug.go                               |     4 +-
 src/runtime/debug/heapdump_test.go                 |     4 +-
 src/runtime/debug/mod.go                           |     2 +-
 src/runtime/debug_test.go                          |    12 +-
 src/runtime/defer_test.go                          |   283 +
 src/runtime/defs1_linux.go                         |     1 +
 src/runtime/defs1_netbsd_386.go                    |     5 +
 src/runtime/defs1_netbsd_amd64.go                  |     5 +
 src/runtime/defs1_netbsd_arm.go                    |     5 +
 src/runtime/defs1_netbsd_arm64.go                  |     5 +
 src/runtime/defs1_solaris_amd64.go                 |     8 +-
 src/runtime/defs2_linux.go                         |     2 +-
 src/runtime/defs_aix.go                            |     3 +-
 src/runtime/defs_aix_ppc64.go                      |     3 +-
 src/runtime/defs_darwin.go                         |     1 +
 src/runtime/defs_darwin_386.go                     |     1 +
 src/runtime/defs_darwin_amd64.go                   |     1 +
 src/runtime/defs_darwin_arm.go                     |     1 +
 src/runtime/defs_darwin_arm64.go                   |     1 +
 src/runtime/defs_freebsd.go                        |     5 +
 src/runtime/defs_freebsd_386.go                    |     7 +
 src/runtime/defs_freebsd_amd64.go                  |     7 +
 src/runtime/defs_freebsd_arm.go                    |     7 +
 src/runtime/defs_freebsd_arm64.go                  |   259 +
 src/runtime/defs_illumos_amd64.go                  |    14 +
 src/runtime/defs_linux.go                          |     3 +-
 src/runtime/defs_linux_386.go                      |     6 +-
 src/runtime/defs_linux_amd64.go                    |     6 +-
 src/runtime/defs_linux_arm.go                      |     2 +
 src/runtime/defs_linux_arm64.go                    |     6 +-
 src/runtime/defs_linux_mips64x.go                  |     2 +
 src/runtime/defs_linux_mipsx.go                    |     2 +
 src/runtime/defs_linux_ppc64.go                    |     2 +
 src/runtime/defs_linux_ppc64le.go                  |     2 +
 src/runtime/defs_linux_s390x.go                    |     2 +
 src/runtime/defs_nacl_386.go                       |    49 -
 src/runtime/defs_nacl_amd64p32.go                  |    71 -
 src/runtime/defs_nacl_arm.go                       |    56 -
 src/runtime/defs_netbsd.go                         |     5 +
 src/runtime/defs_openbsd.go                        |     5 +
 src/runtime/defs_openbsd_386.go                    |     5 +
 src/runtime/defs_openbsd_amd64.go                  |     5 +
 src/runtime/defs_openbsd_arm.go                    |     5 +
 src/runtime/defs_openbsd_arm64.go                  |     5 +
 src/runtime/defs_solaris.go                        |     8 +-
 src/runtime/defs_windows.go                        |    10 +-
 src/runtime/defs_windows_386.go                    |    10 +-
 src/runtime/defs_windows_amd64.go                  |    10 +-
 src/runtime/defs_windows_arm.go                    |    10 +-
 src/runtime/duff_mips64x.s                         |   644 +-
 src/runtime/env_posix.go                           |     2 +-
 .../export_aix_test.go}                            |     6 +-
 src/runtime/export_debug_test.go                   |     9 +-
 src/runtime/export_futex_test.go                   |    11 +-
 src/runtime/export_linux_test.go                   |     3 +
 src/runtime/export_mmap_test.go                    |     2 +-
 src/runtime/export_solaris_test.go                 |     9 +
 src/runtime/export_test.go                         |   500 +-
 src/runtime/export_unix_test.go                    |    60 +
 src/runtime/extern.go                              |     8 +-
 src/runtime/funcdata.h                             |     1 +
 src/runtime/gc_test.go                             |    25 -
 src/runtime/gcinfo_test.go                         |     8 -
 src/runtime/go_tls.h                               |     5 -
 src/runtime/hash32.go                              |     9 +-
 src/runtime/hash64.go                              |    12 +-
 src/runtime/heapdump.go                            |    15 +-
 src/runtime/iface.go                               |    17 +-
 src/runtime/internal/atomic/asm_386.s              |     6 +
 src/runtime/internal/atomic/asm_amd64.s            |     6 +
 src/runtime/internal/atomic/asm_amd64p32.s         |   159 -
 src/runtime/internal/atomic/asm_mips64x.s          |     8 +
 src/runtime/internal/atomic/asm_mipsx.s            |     8 +
 src/runtime/internal/atomic/asm_ppc64x.s           |     7 +
 src/runtime/internal/atomic/asm_s390x.s            |    52 +-
 src/runtime/internal/atomic/atomic_386.go          |     3 +
 .../atomic/{atomic_amd64x.go => atomic_amd64.go}   |     5 +-
 src/runtime/internal/atomic/atomic_arm.go          |     3 +
 src/runtime/internal/atomic/atomic_arm64.go        |     3 +
 src/runtime/internal/atomic/atomic_arm64.s         |     6 +
 src/runtime/internal/atomic/atomic_mips64x.go      |     3 +
 src/runtime/internal/atomic/atomic_mipsx.go        |     3 +
 src/runtime/internal/atomic/atomic_ppc64x.go       |     3 +
 src/runtime/internal/atomic/atomic_s390x.go        |     3 +
 src/runtime/internal/atomic/atomic_test.go         |   127 +-
 src/runtime/internal/atomic/atomic_wasm.go         |     6 +
 src/runtime/internal/atomic/bench_test.go          |    40 +
 src/runtime/internal/atomic/sys_linux_arm.s        |    26 +-
 src/runtime/internal/atomic/sys_nonlinux_arm.s     |    17 +
 src/runtime/internal/sys/arch_386.go               |     2 +-
 src/runtime/internal/sys/arch_amd64p32.go          |    16 -
 src/runtime/internal/sys/intrinsics.go             |    46 +-
 src/runtime/internal/sys/intrinsics_common.go      |   143 +
 src/runtime/internal/sys/zgoarch_amd64p32.go       |    31 -
 src/runtime/internal/sys/zgoos_nacl.go             |    24 -
 src/runtime/lfstack_32bit.go                       |     2 +-
 src/runtime/libfuzzer.go                           |    75 +
 src/runtime/libfuzzer_amd64.s                      |    42 +
 src/runtime/libfuzzer_arm64.s                      |    31 +
 src/runtime/lock_futex.go                          |     2 +-
 src/runtime/lock_js.go                             |    72 +-
 src/runtime/lock_sema.go                           |     4 +-
 src/runtime/malloc.go                              |    58 +-
 src/runtime/malloc_test.go                         |    21 +
 src/runtime/map.go                                 |    59 +-
 src/runtime/map_benchmark_test.go                  |    32 +-
 src/runtime/map_fast32.go                          |    18 +-
 src/runtime/map_fast64.go                          |    18 +-
 src/runtime/map_faststr.go                         |    14 +-
 src/runtime/map_test.go                            |    61 +
 src/runtime/mbitmap.go                             |    93 +-
 src/runtime/mcentral.go                            |     4 +-
 src/runtime/mem_bsd.go                             |    14 +-
 src/runtime/mem_darwin.go                          |    14 +-
 src/runtime/mem_js.go                              |    18 +-
 src/runtime/mem_linux.go                           |     8 +-
 src/runtime/memclr_amd64p32.s                      |    24 -
 src/runtime/memmove_amd64p32.s                     |    53 -
 src/runtime/mfinal.go                              |     4 +-
 src/runtime/mgc.go                                 |    84 +-
 src/runtime/mgclarge.go                            |   657 -
 src/runtime/mgcmark.go                             |   255 +-
 src/runtime/mgcscavenge.go                         |   714 +-
 src/runtime/mgcscavenge_test.go                    |   400 +
 src/runtime/mgcstack.go                            |    76 +-
 src/runtime/mgcsweep.go                            |    14 +-
 src/runtime/mgcsweepbuf.go                         |    15 +-
 src/runtime/mgcwork.go                             |    10 +-
 src/runtime/mheap.go                               |  1087 +-
 src/runtime/mkduff.go                              |    10 +-
 src/runtime/mknacl.sh                              |    15 -
 src/runtime/mkpreempt.go                           |   516 +
 src/runtime/mmap.go                                |     1 -
 src/runtime/mpagealloc.go                          |   924 ++
 src/runtime/mpagealloc_32bit.go                    |   109 +
 src/runtime/mpagealloc_64bit.go                    |   136 +
 src/runtime/mpagealloc_test.go                     |   740 ++
 src/runtime/mpagecache.go                          |   154 +
 src/runtime/mpagecache_test.go                     |   364 +
 src/runtime/mpallocbits.go                         |   391 +
 src/runtime/mpallocbits_test.go                    |   510 +
 src/runtime/msan_arm64.s                           |     3 +-
 src/runtime/msize.go                               |     2 +-
 src/runtime/mstats.go                              |    15 +-
 src/runtime/nbpipe_fcntl_libc_test.go              |    18 +
 src/runtime/nbpipe_fcntl_unix_test.go              |    14 +
 src/runtime/nbpipe_pipe.go                         |    19 +
 src/runtime/nbpipe_pipe2.go                        |    22 +
 src/runtime/nbpipe_test.go                         |    93 +
 src/runtime/netpoll.go                             |    70 +-
 src/runtime/netpoll_aix.go                         |    86 +-
 src/runtime/netpoll_epoll.go                       |   102 +-
 src/runtime/netpoll_fake.go                        |    15 +-
 src/runtime/netpoll_kqueue.go                      |    81 +-
 src/runtime/netpoll_solaris.go                     |    95 +-
 src/runtime/netpoll_stub.go                        |    30 +-
 src/runtime/netpoll_windows.go                     |    70 +-
 src/runtime/os2_aix.go                             |    45 +-
 src/runtime/os2_nacl.go                            |   155 -
 src/runtime/os3_solaris.go                         |    88 +-
 src/runtime/os_aix.go                              |    22 +-
 src/runtime/os_darwin.go                           |     5 +
 src/runtime/os_dragonfly.go                        |    28 +-
 src/runtime/os_freebsd.go                          |    33 +-
 src/runtime/os_freebsd_arm64.go                    |   156 +
 src/runtime/os_freebsd_noauxv.go                   |     2 +-
 src/runtime/os_illumos.go                          |   132 +
 src/runtime/os_js.go                               |     8 +-
 src/runtime/os_linux.go                            |    16 +-
 src/runtime/os_linux_novdso.go                     |     2 +-
 src/runtime/os_nacl.go                             |   328 -
 src/runtime/os_nacl_arm.go                         |    23 -
 src/runtime/os_netbsd.go                           |    23 +-
 src/runtime/os_only_solaris.go                     |    18 +
 src/runtime/os_openbsd.go                          |    24 +-
 src/runtime/os_plan9.go                            |    16 +-
 src/runtime/os_solaris.go                          |    35 +-
 src/runtime/os_windows.go                          |   106 +-
 src/runtime/panic.go                               |   378 +-
 src/runtime/panic32.go                             |     2 +-
 src/runtime/pprof/label.go                         |     6 +-
 src/runtime/pprof/label_test.go                    |     2 +-
 src/runtime/pprof/mprof_test.go                    |   112 +-
 src/runtime/pprof/pprof.go                         |    30 +-
 src/runtime/pprof/pprof_test.go                    |   133 +-
 src/runtime/pprof/proto.go                         |   282 +-
 src/runtime/pprof/proto_test.go                    |    17 +-
 src/runtime/pprof/protomem.go                      |    23 +-
 src/runtime/pprof/testdata/mappingtest/main.go     |    13 +-
 src/runtime/preempt.go                             |   414 +
 src/runtime/preempt_386.s                          |    52 +
 src/runtime/preempt_amd64.s                        |    79 +
 src/runtime/preempt_arm.s                          |    83 +
 src/runtime/preempt_arm64.s                        |   144 +
 src/runtime/preempt_mips64x.s                      |   141 +
 src/runtime/preempt_mipsx.s                        |   141 +
 src/runtime/preempt_ppc64x.s                       |   147 +
 src/runtime/preempt_s390x.s                        |    51 +
 src/runtime/preempt_wasm.s                         |     8 +
 src/runtime/proc.go                                |   621 +-
 src/runtime/proc_test.go                           |    52 +
 src/runtime/race.go                                |    59 +-
 src/runtime/race/README                            |    14 +-
 src/runtime/race/output_test.go                    |    52 +-
 src/runtime/race/race_darwin_amd64.syso            |   Bin 398868 -> 432640 bytes
 src/runtime/race/race_freebsd_amd64.syso           |   Bin 503384 -> 555192 bytes
 src/runtime/race/race_linux_amd64.syso             |   Bin 449328 -> 478360 bytes
 src/runtime/race/race_linux_arm64.syso             |   Bin 418080 -> 454752 bytes
 src/runtime/race/race_linux_ppc64le.syso           |   Bin 505304 -> 570032 bytes
 src/runtime/race/race_netbsd_amd64.syso            |   Bin 507208 -> 574896 bytes
 src/runtime/race/race_windows_amd64.syso           |   Bin 348915 -> 429378 bytes
 src/runtime/race0.go                               |     2 +
 src/runtime/race_amd64.s                           |    18 +-
 src/runtime/race_arm64.s                           |    21 +-
 src/runtime/race_ppc64le.s                         |    28 +-
 src/runtime/rt0_freebsd_arm64.s                    |   106 +
 src/runtime/rt0_js_wasm.s                          |     2 +-
 src/runtime/rt0_nacl_386.s                         |    24 -
 src/runtime/rt0_nacl_amd64p32.s                    |    30 -
 src/runtime/rt0_nacl_arm.s                         |    16 -
 src/runtime/runtime-gdb_test.go                    |     4 +-
 src/runtime/runtime1.go                            |     2 +
 src/runtime/runtime2.go                            |   166 +-
 src/runtime/runtime_linux_test.go                  |     8 +-
 src/runtime/runtime_mmap_test.go                   |     2 +-
 src/runtime/runtime_test.go                        |    48 +-
 src/runtime/select.go                              |     8 +-
 src/runtime/sema.go                                |    45 +-
 src/runtime/sema_test.go                           |    97 +
 src/runtime/semasleep_test.go                      |     2 +-
 src/runtime/signal_386.go                          |    27 +-
 src/runtime/{signal_amd64x.go => signal_amd64.go}  |    30 +-
 src/runtime/signal_arm.go                          |    20 +-
 src/runtime/signal_arm64.go                        |    20 +-
 src/runtime/signal_freebsd_arm64.go                |    66 +
 src/runtime/signal_linux_s390x.go                  |    16 +
 src/runtime/signal_mips64x.go                      |    16 +
 src/runtime/signal_mipsx.go                        |    16 +
 src/runtime/signal_nacl.go                         |    45 -
 src/runtime/signal_nacl_386.go                     |    41 -
 src/runtime/signal_nacl_amd64p32.go                |    53 -
 src/runtime/signal_nacl_arm.go                     |    53 -
 src/runtime/signal_ppc64x.go                       |    26 +
 src/runtime/signal_sighandler.go                   |   154 -
 src/runtime/signal_unix.go                         |   369 +-
 src/runtime/signal_windows.go                      |     6 +
 src/runtime/signal_windows_test.go                 |    61 +
 src/runtime/sizeof_test.go                         |     2 -
 src/runtime/stack.go                               |   181 +-
 src/runtime/stack_test.go                          |     3 -
 src/runtime/stubs.go                               |     9 +-
 src/runtime/stubs2.go                              |     8 +-
 src/runtime/stubs3.go                              |     4 +-
 src/runtime/stubs32.go                             |     2 +-
 src/runtime/{stubs_amd64x.go => stubs_amd64.go}    |     2 -
 src/runtime/symtab.go                              |    44 +-
 src/runtime/sys_aix_ppc64.s                        |     4 +-
 src/runtime/sys_darwin.go                          |    24 +-
 src/runtime/sys_darwin_386.s                       |    37 +
 src/runtime/sys_darwin_amd64.s                     |    30 +
 src/runtime/sys_darwin_arm.s                       |    46 +-
 src/runtime/sys_darwin_arm64.s                     |    26 +
 src/runtime/sys_dragonfly_amd64.s                  |    54 +-
 src/runtime/sys_freebsd_386.s                      |    64 +-
 src/runtime/sys_freebsd_amd64.s                    |    60 +-
 src/runtime/sys_freebsd_arm.s                      |    74 +-
 src/runtime/sys_freebsd_arm64.s                    |   543 +
 src/runtime/sys_linux_386.s                        |    62 +-
 src/runtime/sys_linux_amd64.s                      |    61 +-
 src/runtime/sys_linux_arm.s                        |   126 +-
 src/runtime/sys_linux_arm64.s                      |   114 +-
 src/runtime/sys_linux_mips64x.s                    |   140 +-
 src/runtime/sys_linux_mipsx.s                      |    68 +-
 src/runtime/sys_linux_ppc64x.s                     |    53 +-
 src/runtime/sys_linux_s390x.s                      |    62 +-
 src/runtime/sys_nacl_386.s                         |   374 -
 src/runtime/sys_nacl_amd64p32.s                    |   482 -
 src/runtime/sys_nacl_arm.s                         |   312 -
 src/runtime/sys_netbsd_386.s                       |    66 +-
 src/runtime/sys_netbsd_amd64.s                     |    59 +-
 src/runtime/sys_netbsd_arm.s                       |    69 +-
 src/runtime/sys_netbsd_arm64.s                     |    67 +-
 src/runtime/sys_openbsd_386.s                      |    62 +-
 src/runtime/sys_openbsd_amd64.s                    |    54 +-
 src/runtime/sys_openbsd_arm.s                      |    68 +-
 src/runtime/sys_openbsd_arm64.s                    |    63 +-
 src/runtime/sys_plan9_386.s                        |     6 +-
 src/runtime/sys_plan9_amd64.s                      |     6 +-
 src/runtime/sys_plan9_arm.s                        |     4 +-
 src/runtime/sys_solaris_amd64.s                    |    40 -
 src/runtime/sys_wasm.s                             |    14 +-
 src/runtime/sys_windows_386.s                      |     2 +-
 src/runtime/sys_windows_amd64.s                    |     2 +-
 src/runtime/sys_windows_arm.s                      |     2 +-
 src/runtime/sys_x86.go                             |     2 +-
 src/runtime/syscall_nacl.h                         |    84 -
 src/runtime/syscall_solaris.go                     |     1 -
 src/runtime/syscall_windows.go                     |    12 +-
 src/runtime/testdata/testfaketime/faketime.go      |    28 +
 src/runtime/testdata/testprog/deadlock.go          |    93 +
 src/runtime/testdata/testprog/preempt.go           |    60 +
 src/runtime/testdata/testprog/signal.go            |     2 +-
 src/runtime/testdata/testprog/vdso.go              |    55 +
 src/runtime/testdata/testprogcgo/numgoroutine.go   |     7 -
 src/runtime/testdata/testprognet/signal.go         |     2 +-
 src/runtime/testdata/testwinlib/main.c             |    57 +
 src/runtime/testdata/testwinlib/main.go            |    28 +
 src/runtime/time.go                                |   961 +-
 src/runtime/time_fake.go                           |   100 +
 src/runtime/time_nofake.go                         |    31 +
 src/runtime/time_test.go                           |    93 +
 src/runtime/timestub2.go                           |     3 +-
 src/runtime/tls_arm.s                              |    13 -
 src/runtime/tls_arm64.h                            |     5 +
 src/runtime/trace.go                               |    21 +-
 src/runtime/trace/trace_stack_test.go              |     1 +
 src/runtime/traceback.go                           |    31 +-
 src/runtime/treap_test.go                          |   270 -
 src/runtime/type.go                                |    37 +-
 src/runtime/vdso_elf64.go                          |     2 +-
 src/runtime/vdso_freebsd.go                        |     4 +-
 src/runtime/vdso_freebsd_arm64.go                  |    21 +
 src/runtime/vdso_in_none.go                        |     2 +-
 src/runtime/vdso_linux.go                          |     3 +-
 src/runtime/vdso_linux_mips64x.go                  |    28 +
 src/runtime/vlop_arm.s                             |     4 +-
 src/strconv/atof.go                                |    37 +-
 src/strconv/atoi.go                                |    11 +-
 src/strconv/atoi_test.go                           |     7 +
 src/strconv/example_test.go                        |     9 +-
 src/strconv/isprint.go                             |    86 +-
 src/strings/builder.go                             |     1 +
 src/strings/builder_test.go                        |    15 -
 src/strings/strings.go                             |     3 +-
 src/strings/strings_test.go                        |    10 +-
 src/sync/atomic/atomic_test.go                     |    14 +-
 src/sync/mutex.go                                  |     3 +-
 src/syscall/asm_darwin_amd64.s                     |     6 -
 src/syscall/asm_freebsd_arm64.s                    |   128 +
 src/syscall/asm_linux_amd64.s                      |     9 -
 src/syscall/asm_linux_arm64.s                      |    23 +
 src/syscall/asm_linux_riscv64.s                    |   115 +
 src/syscall/asm_nacl_386.s                         |    45 -
 src/syscall/asm_nacl_amd64p32.s                    |    42 -
 src/syscall/asm_nacl_arm.s                         |    44 -
 src/syscall/asm_unix_amd64.s                       |     6 -
 src/syscall/dirent.go                              |     2 +-
 src/syscall/{dirent_bsd_test.go => dirent_test.go} |     2 +-
 src/syscall/endian_little.go                       |     2 +-
 src/syscall/env_plan9.go                           |    16 +-
 src/syscall/env_unix.go                            |     2 +-
 src/syscall/exec_linux.go                          |     2 +-
 src/syscall/exec_linux_test.go                     |    56 +-
 src/syscall/fd_nacl.go                             |   326 -
 src/syscall/fs_js.go                               |    12 +-
 src/syscall/fs_nacl.go                             |   846 --
 src/syscall/getdirentries_test.go                  |     6 +-
 .../cpu_amd64p32.go => syscall/js/export_test.go}  |     6 +-
 src/syscall/js/func.go                             |     2 +-
 src/syscall/js/js.go                               |   164 +-
 src/syscall/js/js_js.s                             |     8 +
 src/syscall/js/js_test.go                          |   124 +-
 src/syscall/mkall.sh                               |    28 +-
 src/syscall/mksyscall.pl                           |     8 -
 src/syscall/mksyscall_windows.go                   |   890 +-
 src/syscall/net_js.go                              |     2 +-
 src/syscall/net_nacl.go                            |   973 --
 src/syscall/route_freebsd_64bit.go                 |     2 +-
 src/syscall/sockcmsg_dragonfly.go                  |    16 +
 src/syscall/sockcmsg_linux.go                      |     2 +-
 src/syscall/sockcmsg_unix.go                       |    36 +-
 src/syscall/sockcmsg_unix_other.go                 |    38 +
 src/syscall/syscall.go                             |     2 +-
 src/syscall/syscall_aix.go                         |     2 +-
 src/syscall/syscall_bsd.go                         |     2 +-
 src/syscall/syscall_darwin.go                      |     2 -
 src/syscall/syscall_dragonfly.go                   |    20 +-
 src/syscall/syscall_freebsd.go                     |     9 +-
 src/syscall/syscall_freebsd_arm64.go               |    47 +
 src/syscall/syscall_js.go                          |     7 +-
 src/syscall/syscall_linux.go                       |    17 +-
 src/syscall/syscall_linux_386.go                   |     8 +-
 src/syscall/syscall_linux_amd64.go                 |     9 +
 src/syscall/syscall_linux_arm.go                   |     8 +-
 src/syscall/syscall_linux_arm64.go                 |    78 +-
 src/syscall/syscall_linux_mips64x.go               |     8 +
 src/syscall/syscall_linux_mipsx.go                 |     7 +
 src/syscall/syscall_linux_ppc64x.go                |     9 +-
 src/syscall/syscall_linux_riscv64.go               |   203 +
 src/syscall/syscall_linux_s390x.go                 |    10 +-
 src/syscall/syscall_linux_test.go                  |    11 +-
 src/syscall/syscall_nacl.go                        |   318 -
 src/syscall/syscall_nacl_386.go                    |    23 -
 src/syscall/syscall_nacl_amd64p32.go               |    23 -
 src/syscall/syscall_nacl_arm.go                    |    23 -
 src/syscall/syscall_plan9.go                       |    10 +-
 src/syscall/syscall_solaris.go                     |     2 +-
 src/syscall/syscall_test.go                        |     2 +-
 src/syscall/syscall_unix.go                        |    13 +-
 src/syscall/syscall_unix_test.go                   |     6 +
 src/syscall/syscall_windows.go                     |    10 +-
 src/syscall/{tables_nacljs.go => tables_js.go}     |     8 +-
 src/syscall/time_fake.go                           |    26 +
 src/syscall/time_nacl_386.s                        |    11 -
 src/syscall/time_nacl_amd64p32.s                   |    11 -
 src/syscall/time_nacl_arm.s                        |    11 -
 src/syscall/time_nofake.go                         |    14 +
 src/syscall/timestruct.go                          |     6 +-
 src/syscall/types_linux.go                         |     8 +-
 src/syscall/types_windows.go                       |     7 +-
 src/syscall/unzip_nacl.go                          |   685 -
 src/syscall/zerrors_freebsd_arm64.go               |  1718 +++
 src/syscall/zerrors_linux_riscv64.go               |  1878 +++
 src/syscall/zsyscall_freebsd_arm64.go              |  1420 ++
 src/syscall/zsyscall_linux_386.go                  |   187 +-
 src/syscall/zsyscall_linux_amd64.go                |   187 +-
 src/syscall/zsyscall_linux_arm.go                  |   187 +-
 src/syscall/zsyscall_linux_arm64.go                |   121 +-
 src/syscall/zsyscall_linux_mips.go                 |   187 +-
 src/syscall/zsyscall_linux_mips64.go               |   187 +-
 src/syscall/zsyscall_linux_mips64le.go             |   187 +-
 src/syscall/zsyscall_linux_mipsle.go               |   187 +-
 src/syscall/zsyscall_linux_ppc64.go                |   203 +-
 src/syscall/zsyscall_linux_ppc64le.go              |   203 +-
 src/syscall/zsyscall_linux_riscv64.go              |  1624 +++
 src/syscall/zsyscall_linux_s390x.go                |   203 +-
 src/syscall/zsyscall_nacl_386.go                   |    71 -
 src/syscall/zsyscall_nacl_amd64p32.go              |    71 -
 src/syscall/zsyscall_nacl_arm.go                   |    71 -
 src/syscall/zsysnum_freebsd_arm64.go               |   396 +
 src/syscall/zsysnum_linux_riscv64.go               |   273 +
 src/syscall/ztypes_freebsd_arm64.go                |   572 +
 src/syscall/ztypes_linux_386.go                    |     6 +
 src/syscall/ztypes_linux_amd64.go                  |     6 +
 src/syscall/ztypes_linux_arm.go                    |     6 +
 src/syscall/ztypes_linux_arm64.go                  |     6 +
 src/syscall/ztypes_linux_mips.go                   |     6 +
 src/syscall/ztypes_linux_mips64.go                 |     6 +
 src/syscall/ztypes_linux_mips64le.go               |     6 +
 src/syscall/ztypes_linux_mipsle.go                 |     6 +
 src/syscall/ztypes_linux_ppc64.go                  |     6 +
 src/syscall/ztypes_linux_ppc64le.go                |     6 +
 src/syscall/ztypes_linux_riscv64.go                |   631 +
 src/syscall/ztypes_linux_s390x.go                  |     6 +
 src/testing/benchmark.go                           |    22 +-
 src/testing/iotest/logger_test.go                  |   160 +
 src/testing/iotest/reader_test.go                  |   226 +
 src/testing/iotest/writer_test.go                  |    39 +
 src/testing/panic_test.go                          |    83 +
 src/testing/sub_test.go                            |    97 +-
 src/testing/testing.go                             |    57 +-
 src/text/template/doc.go                           |    18 +-
 src/text/template/exec.go                          |    11 +-
 src/text/template/exec_test.go                     |    42 +-
 src/text/template/funcs.go                         |    22 +-
 src/text/template/parse/node.go                    |   170 +-
 src/text/template/parse/parse.go                   |     9 +-
 src/text/template/parse/parse_test.go              |    52 +-
 src/time/example_test.go                           |    19 +-
 src/time/genzabbrs.go                              |     2 +-
 src/time/internal_test.go                          |     3 +-
 src/time/sleep.go                                  |    17 +-
 src/time/sys_unix.go                               |     2 +-
 src/time/time.go                                   |     2 +-
 src/time/zoneinfo.go                               |    10 +-
 src/time/zoneinfo_abbrs_windows.go                 |     9 +-
 src/time/zoneinfo_unix.go                          |     2 +-
 src/unicode/tables.go                              |   574 +-
 src/unicode/utf8/utf8.go                           |     1 +
 .../golang.org/x/net/dns/dnsmessage/message.go     |     2 +-
 src/vendor/golang.org/x/net/http2/hpack/encode.go  |     2 +-
 src/vendor/golang.org/x/net/idna/tables11.0.0.go   |     2 +-
 src/vendor/golang.org/x/net/idna/tables12.00.go    |  4733 +++++++
 src/vendor/golang.org/x/net/nettest/nettest.go     |    36 +-
 src/vendor/golang.org/x/net/route/address.go       |     2 +-
 src/vendor/golang.org/x/net/route/message.go       |     2 +-
 src/vendor/golang.org/x/net/route/route.go         |     2 +-
 src/vendor/golang.org/x/net/route/route_classic.go |     2 +-
 src/vendor/golang.org/x/net/route/sys.go           |     3 +
 src/vendor/golang.org/x/net/route/sys_dragonfly.go |    14 +-
 .../golang.org/x/net/route/zsys_dragonfly.go       |     4 +-
 .../golang.org/x/text/unicode/bidi/tables11.0.0.go |     2 +-
 .../golang.org/x/text/unicode/bidi/tables12.0.0.go |  1923 +++
 .../golang.org/x/text/unicode/norm/tables11.0.0.go |     2 +-
 .../golang.org/x/text/unicode/norm/tables12.0.0.go |  7710 +++++++++++
 src/vendor/modules.txt                             |     8 +-
 test/closure2.go                                   |     6 +-
 test/codegen/README                                |    20 +-
 test/codegen/arithmetic.go                         |    14 +-
 test/codegen/compare_and_branch.go                 |   154 +
 test/codegen/comparisons.go                        |     5 +
 test/codegen/condmove.go                           |    11 +
 test/codegen/issue33580.go                         |    25 +
 test/codegen/math.go                               |    15 +-
 test/codegen/mathbits.go                           |    11 +
 test/codegen/memcombine.go                         |    20 +-
 test/codegen/shift.go                              |    10 +-
 test/codegen/slices.go                             |    93 +
 test/codegen/stack.go                              |     4 +
 test/codegen/strings.go                            |     3 +
 test/codegen/switch.go                             |    22 +
 test/complit1.go                                   |     4 +-
 test/const.go                                      |    43 +
 test/convlit.go                                    |     4 +-
 test/ddd1.go                                       |     2 +-
 test/defererrcheck.go                              |    86 +
 test/defernil.go                                   |    33 +
 test/escape2.go                                    |   305 +-
 test/escape2n.go                                   |   305 +-
 test/escape5.go                                    |     6 +-
 test/escape_array.go                               |     4 +-
 test/escape_because.go                             |   209 -
 test/escape_calls.go                               |     4 +-
 test/escape_closure.go                             |    28 +-
 test/escape_field.go                               |    42 +-
 test/escape_goto.go                                |    44 +
 test/escape_iface.go                               |    62 +-
 test/escape_indir.go                               |     6 +-
 test/escape_level.go                               |    20 +-
 test/escape_map.go                                 |     2 +-
 test/escape_param.go                               |    68 +-
 test/escape_struct_param1.go                       |    52 +-
 test/escape_struct_param2.go                       |    52 +-
 test/escape_struct_return.go                       |     2 +-
 test/escape_unsafe.go                              |     4 +-
 test/finprofiled.go                                |     4 +-
 test/fixedbugs/bug195.go                           |     4 +-
 test/fixedbugs/bug373.go                           |     2 +-
 test/fixedbugs/issue12006.go                       |    18 +-
 test/fixedbugs/issue12588.go                       |     2 +-
 test/fixedbugs/issue13365.go                       |     6 +-
 test/fixedbugs/issue13799.go                       |    22 +-
 test/fixedbugs/issue14999.go                       |     6 +-
 test/fixedbugs/issue17318.go                       |    12 +-
 test/fixedbugs/issue17645.go                       |     3 +-
 test/fixedbugs/issue20185.go                       |     2 +-
 test/fixedbugs/issue21317.go                       |     4 +-
 test/fixedbugs/issue21576.go                       |    62 +
 test/fixedbugs/issue21709.go                       |    12 +-
 test/fixedbugs/issue21934.go                       |    26 +
 test/fixedbugs/issue21979.go                       |    46 +
 test/fixedbugs/issue22344.go                       |    83 +
 test/fixedbugs/issue23116.go                       |     2 +-
 test/fixedbugs/issue24339.go                       |     2 +-
 test/fixedbugs/issue27557.go                       |    42 +
 test/fixedbugs/issue27718.go                       |    30 +
 test/fixedbugs/issue27732a.go                      |     2 +-
 test/fixedbugs/issue29612.dir/main.go              |    25 +
 test/fixedbugs/issue29870b.go                      |     2 +-
 test/fixedbugs/issue31747.go                       |    10 +-
 test/fixedbugs/issue32133.go                       |    43 +
 test/fixedbugs/issue32187.go                       |    60 +
 test/fixedbugs/issue32454.go                       |    23 +
 test/fixedbugs/issue32723.go                       |    22 +
 test/fixedbugs/issue33020a.dir/a.go                |    13 +
 test/fixedbugs/issue33020a.dir/b.go                |    14 +
 test/fixedbugs/issue33020a.go                      |     9 +
 test/fixedbugs/issue33275.go                       |    34 +
 test/fixedbugs/issue33275_run.go                   |    25 +
 test/fixedbugs/issue33724.go                       |    45 +
 test/fixedbugs/issue33739.dir/a.go                 |    11 +
 test/fixedbugs/issue33739.dir/b.go                 |    11 +
 test/fixedbugs/issue33739.go                       |     9 +
 test/fixedbugs/issue33866.dir/a.go                 |    18 +
 test/fixedbugs/issue33866.dir/b.go                 |    15 +
 test/fixedbugs/issue33866.go                       |     9 +
 test/fixedbugs/issue33903.go                       |    16 +
 test/fixedbugs/issue34123.go                       |    43 +
 test/fixedbugs/issue34329.go                       |    14 +
 test/fixedbugs/issue34395.go                       |    17 +
 test/fixedbugs/issue34503.dir/a.go                 |    15 +
 test/fixedbugs/issue34503.dir/b.go                 |    11 +
 test/fixedbugs/issue34503.go                       |     9 +
 test/fixedbugs/issue34520.go                       |    12 +
 test/fixedbugs/issue34577.dir/a.go                 |    27 +
 test/fixedbugs/issue34577.dir/b.go                 |    23 +
 test/fixedbugs/issue34577.go                       |     9 +
 test/fixedbugs/issue34723.go                       |    70 +
 test/fixedbugs/issue34966.go                       |    14 +
 test/fixedbugs/issue34968.go                       |    15 +
 test/fixedbugs/issue35027.go                       |    23 +
 test/fixedbugs/issue35157.go                       |    20 +
 test/fixedbugs/issue35291.go                       |    14 +
 test/fixedbugs/issue4085b.go                       |    37 +-
 test/fixedbugs/issue5172.go                        |    11 +-
 test/fixedbugs/issue7153.go                        |     2 +-
 test/fixedbugs/issue7310.go                        |     2 +-
 test/fixedbugs/issue7921.go                        |    14 +-
 test/fixedbugs/issue8047b.go                       |     4 +
 test/fixedbugs/issue8438.go                        |     6 +-
 test/fixedbugs/oldescape_issue12006.go             |   174 -
 test/fixedbugs/oldescape_issue17318.go             |    47 -
 test/goprint.go                                    |    15 +-
 test/index.go                                      |     2 +-
 test/initempty.go                                  |    40 +
 test/inline.go                                     |    12 +-
 test/inline_big.go                                 |     6 +-
 test/interface/embed3.dir/embed0.go                |    21 +
 test/interface/embed3.dir/embed1.go                |    78 +
 .../hypot_amd64p32.s => test/interface/embed3.go   |     6 +-
 test/ken/modconst.go                               |     2 +-
 test/linkname.dir/linkname1.go                     |     2 +-
 test/linkname.go                                   |     2 +-
 test/linkx.go                                      |    15 +
 test/linkx_run.go                                  |     2 +-
 test/live.go                                       |    31 +-
 test/live2.go                                      |     4 +-
 test/live_syscall.go                               |     2 +-
 test/loopbce.go                                    |    33 +
 test/nosplit.go                                    |     6 +-
 test/oldescape2.go                                 |  1847 ---
 test/oldescape2n.go                                |  1847 ---
 test/oldescape5.go                                 |   247 -
 test/oldescape_calls.go                            |    54 -
 test/oldescape_closure.go                          |   173 -
 test/oldescape_field.go                            |   174 -
 test/oldescape_iface.go                            |   261 -
 test/oldescape_linkname.go                         |    15 -
 test/oldescape_param.go                            |   441 -
 test/oldescape_struct_return.go                    |    74 -
 test/opt_branchlikely.go                           |     2 +-
 test/prove.go                                      |    64 +-
 test/recover2.go                                   |     2 +-
 test/rename1.go                                    |     2 +-
 test/run.go                                        |    10 +-
 test/runtime/inlinegcpc.go                         |     2 +-
 test/shift1.go                                     |     7 +-
 test/strength.go                                   |     2 +-
 test/typeswitch2.go                                |    10 -
 test/typeswitch2b.go                               |    20 +
 test/uintptrescapes2.go                            |    42 +-
 test/uintptrescapes3.go                            |    63 +
 1843 files changed, 119859 insertions(+), 93442 deletions(-)

diff --cc src/crypto/tls/auth.go
index c62c9af76b,3ae2256620..53bd4d4682
--- a/src/crypto/tls/auth.go
+++ b/src/crypto/tls/auth.go
@@@ -220,6 -211,29 +211,32 @@@ func signatureSchemesForCertificate(ver
  	}
  }
  
+ // selectSignatureScheme picks a SignatureScheme from the peer's preference list
+ // that works with the selected certificate. It's only called for protocol
+ // versions that support signature algorithms, so TLS 1.2 and 1.3.
+ func selectSignatureScheme(vers uint16, c *Certificate, peerAlgs []SignatureScheme) (SignatureScheme, error) {
+ 	supportedAlgs := signatureSchemesForCertificate(vers, c)
+ 	if supportedAlgs == nil {
+ 		return 0, unsupportedCertificateError(c)
+ 	}
+ 	if len(peerAlgs) == 0 && vers == VersionTLS12 {
+ 		// For TLS 1.2, if the client didn't send signature_algorithms then we
+ 		// can assume that it supports SHA1. See RFC 5246, Section 7.4.1.4.1.
+ 		peerAlgs = []SignatureScheme{PKCS1WithSHA1, ECDSAWithSHA1}
+ 	}
+ 	// Pick signature scheme in the peer's preference order, as our
+ 	// preference order is not configurable.
+ 	for _, preferredAlg := range peerAlgs {
++		if needFIPS() && !isSupportedSignatureAlgorithm(preferredAlg, fipsSupportedSignatureAlgorithms) {
++			continue
++		}
+ 		if isSupportedSignatureAlgorithm(preferredAlg, supportedAlgs) {
+ 			return preferredAlg, nil
+ 		}
+ 	}
+ 	return 0, errors.New("tls: peer doesn't support any of the certificate's signature algorithms")
+ }
+ 
  // unsupportedCertificateError returns a helpful error for certificates with
  // an unsupported private key.
  func unsupportedCertificateError(cert *Certificate) error {
diff --cc src/crypto/tls/auth_test.go
index 8a38ce057c,52ddf18d6f..a64c21a43a
--- a/src/crypto/tls/auth_test.go
+++ b/src/crypto/tls/auth_test.go
@@@ -97,9 -96,56 +96,56 @@@ func TestSignatureSelection(t *testing.
  	}
  
  	for testNo, test := range badTests {
- 		sigAlg, sigType, hashFunc, err := pickSignatureAlgorithm(test.pubkey, test.peerSigAlgs, test.ourSigAlgs, test.tlsVersion)
+ 		sigAlg, err := selectSignatureScheme(test.tlsVersion, test.cert, test.peerSigAlgs)
  		if err == nil {
- 			t.Errorf("test[%d]: unexpected success, got %#x %#x %#x", testNo, sigAlg, sigType, hashFunc)
+ 			t.Errorf("test[%d]: unexpected success, got %#x", testNo, sigAlg)
+ 		}
+ 	}
+ }
+ 
+ func TestLegacyTypeAndHash(t *testing.T) {
+ 	sigType, hashFunc, err := legacyTypeAndHashFromPublicKey(testRSAPrivateKey.Public())
+ 	if err != nil {
+ 		t.Errorf("RSA: unexpected error: %v", err)
+ 	}
+ 	if expectedSigType := signaturePKCS1v15; expectedSigType != sigType {
+ 		t.Errorf("RSA: expected signature type %#x, got %#x", expectedSigType, sigType)
+ 	}
+ 	if expectedHashFunc := crypto.MD5SHA1; expectedHashFunc != hashFunc {
+ 		t.Errorf("RSA: expected hash %#x, got %#x", expectedHashFunc, sigType)
+ 	}
+ 
+ 	sigType, hashFunc, err = legacyTypeAndHashFromPublicKey(testECDSAPrivateKey.Public())
+ 	if err != nil {
+ 		t.Errorf("ECDSA: unexpected error: %v", err)
+ 	}
+ 	if expectedSigType := signatureECDSA; expectedSigType != sigType {
+ 		t.Errorf("ECDSA: expected signature type %#x, got %#x", expectedSigType, sigType)
+ 	}
+ 	if expectedHashFunc := crypto.SHA1; expectedHashFunc != hashFunc {
+ 		t.Errorf("ECDSA: expected hash %#x, got %#x", expectedHashFunc, sigType)
+ 	}
+ 
+ 	// Ed25519 is not supported by TLS 1.0 and 1.1.
+ 	_, _, err = legacyTypeAndHashFromPublicKey(testEd25519PrivateKey.Public())
+ 	if err == nil {
+ 		t.Errorf("Ed25519: unexpected success")
+ 	}
+ }
+ 
+ // TestSupportedSignatureAlgorithms checks that all supportedSignatureAlgorithms
+ // have valid type and hash information.
+ func TestSupportedSignatureAlgorithms(t *testing.T) {
 -	for _, sigAlg := range supportedSignatureAlgorithms {
++	for _, sigAlg := range supportedSignatureAlgorithms() {
+ 		sigType, hash, err := typeAndHashFromSignatureScheme(sigAlg)
+ 		if err != nil {
+ 			t.Errorf("%#04x: unexpected error: %v", sigAlg, err)
+ 		}
+ 		if sigType == 0 {
+ 			t.Errorf("%#04x: missing signature type", sigAlg)
+ 		}
+ 		if hash == 0 && sigAlg != Ed25519 {
+ 			t.Errorf("%#04x: missing hash", sigAlg)
  		}
  	}
  }
diff --cc src/crypto/tls/boring_test.go
index f607b68ca2,0000000000..9088167502
mode 100644,000000..100644
--- a/src/crypto/tls/boring_test.go
+++ b/src/crypto/tls/boring_test.go
@@@ -1,633 -1,0 +1,634 @@@
 +// Copyright 2017 The Go Authors. All rights reserved.
 +// Use of this source code is governed by a BSD-style
 +// license that can be found in the LICENSE file.
 +
 +package tls
 +
 +import (
 +	"crypto/ecdsa"
 +	"crypto/elliptic"
 +	"crypto/internal/boring/fipstls"
 +	"crypto/rand"
 +	"crypto/rsa"
 +	"crypto/x509"
 +	"crypto/x509/pkix"
 +	"encoding/pem"
 +	"fmt"
 +	"math/big"
 +	"net"
 +	"runtime"
 +	"strings"
 +	"testing"
 +	"time"
 +)
 +
 +func TestBoringServerProtocolVersion(t *testing.T) {
 +	test := func(name string, v uint16, msg string) {
 +		t.Run(name, func(t *testing.T) {
 +			serverConfig := testConfig.Clone()
 +			serverConfig.MinVersion = VersionSSL30
 +			clientHello := &clientHelloMsg{
 +				vers:               v,
 +				random:             make([]byte, 32),
 +				cipherSuites:       allCipherSuites(),
 +				compressionMethods: []uint8{compressionNone},
 +				supportedVersions:  []uint16{v},
 +			}
 +			testClientHelloFailure(t, serverConfig, clientHello, msg)
 +		})
 +	}
 +
 +	test("VersionTLS10", VersionTLS10, "")
 +	test("VersionTLS11", VersionTLS11, "")
 +	test("VersionTLS12", VersionTLS12, "")
 +	test("VersionTLS13", VersionTLS13, "")
 +
 +	fipstls.Force()
 +	defer fipstls.Abandon()
 +	test("VersionSSL30", VersionSSL30, "client offered only unsupported versions")
 +	test("VersionTLS10", VersionTLS10, "client offered only unsupported versions")
 +	test("VersionTLS11", VersionTLS11, "client offered only unsupported versions")
 +	test("VersionTLS12", VersionTLS12, "")
 +	test("VersionTLS13", VersionTLS13, "client offered only unsupported versions")
 +}
 +
 +func isBoringVersion(v uint16) bool {
 +	return v == VersionTLS12
 +}
 +
 +func isBoringCipherSuite(id uint16) bool {
 +	switch id {
 +	case TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,
 +		TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,
 +		TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,
 +		TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,
 +		TLS_RSA_WITH_AES_128_GCM_SHA256,
 +		TLS_RSA_WITH_AES_256_GCM_SHA384:
 +		return true
 +	}
 +	return false
 +}
 +
 +func isBoringCurve(id CurveID) bool {
 +	switch id {
 +	case CurveP256, CurveP384, CurveP521:
 +		return true
 +	}
 +	return false
 +}
 +
 +func isECDSA(id uint16) bool {
 +	for _, suite := range cipherSuites {
 +		if suite.id == id {
 +			return suite.flags&suiteECSign == suiteECSign
 +		}
 +	}
 +	panic(fmt.Sprintf("unknown cipher suite %#x", id))
 +}
 +
 +func isBoringSignatureScheme(alg SignatureScheme) bool {
 +	switch alg {
 +	default:
 +		return false
 +	case PKCS1WithSHA256,
 +		ECDSAWithP256AndSHA256,
 +		PKCS1WithSHA384,
 +		ECDSAWithP384AndSHA384,
 +		PKCS1WithSHA512,
 +		ECDSAWithP521AndSHA512,
 +		PSSWithSHA256,
 +		PSSWithSHA384,
 +		PSSWithSHA512:
 +		// ok
 +	}
 +	return true
 +}
 +
 +func TestBoringServerCipherSuites(t *testing.T) {
 +	serverConfig := testConfig.Clone()
 +	serverConfig.CipherSuites = allCipherSuites()
 +	serverConfig.Certificates = make([]Certificate, 1)
 +
 +	for _, id := range allCipherSuites() {
 +		if isECDSA(id) {
 +			serverConfig.Certificates[0].Certificate = [][]byte{testECDSACertificate}
 +			serverConfig.Certificates[0].PrivateKey = testECDSAPrivateKey
 +		} else {
 +			serverConfig.Certificates[0].Certificate = [][]byte{testRSACertificate}
 +			serverConfig.Certificates[0].PrivateKey = testRSAPrivateKey
 +		}
 +		serverConfig.BuildNameToCertificate()
 +		t.Run(fmt.Sprintf("suite=%#x", id), func(t *testing.T) {
 +			clientHello := &clientHelloMsg{
 +				vers:               VersionTLS12,
 +				random:             make([]byte, 32),
 +				cipherSuites:       []uint16{id},
 +				compressionMethods: []uint8{compressionNone},
 +				supportedCurves:    defaultCurvePreferences,
 +				supportedPoints:    []uint8{pointFormatUncompressed},
 +			}
 +
 +			testClientHello(t, serverConfig, clientHello)
 +			t.Run("fipstls", func(t *testing.T) {
 +				fipstls.Force()
 +				defer fipstls.Abandon()
 +				msg := ""
 +				if !isBoringCipherSuite(id) {
 +					msg = "no cipher suite supported by both client and server"
 +				}
 +				testClientHelloFailure(t, serverConfig, clientHello, msg)
 +			})
 +		})
 +	}
 +}
 +
 +func TestBoringServerCurves(t *testing.T) {
 +	serverConfig := testConfig.Clone()
 +	serverConfig.Certificates = make([]Certificate, 1)
 +	serverConfig.Certificates[0].Certificate = [][]byte{testECDSACertificate}
 +	serverConfig.Certificates[0].PrivateKey = testECDSAPrivateKey
 +	serverConfig.BuildNameToCertificate()
 +
 +	for _, curveid := range defaultCurvePreferences {
 +		t.Run(fmt.Sprintf("curve=%d", curveid), func(t *testing.T) {
 +			clientHello := &clientHelloMsg{
 +				vers:               VersionTLS12,
 +				random:             make([]byte, 32),
 +				cipherSuites:       []uint16{TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256},
 +				compressionMethods: []uint8{compressionNone},
 +				supportedCurves:    []CurveID{curveid},
 +				supportedPoints:    []uint8{pointFormatUncompressed},
 +			}
 +
 +			testClientHello(t, serverConfig, clientHello)
 +
 +			// With fipstls forced, bad curves should be rejected.
 +			t.Run("fipstls", func(t *testing.T) {
 +				fipstls.Force()
 +				defer fipstls.Abandon()
 +				msg := ""
 +				if !isBoringCurve(curveid) {
 +					msg = "no cipher suite supported by both client and server"
 +				}
 +				testClientHelloFailure(t, serverConfig, clientHello, msg)
 +			})
 +		})
 +	}
 +}
 +
 +func boringHandshake(t *testing.T, clientConfig, serverConfig *Config) (clientErr, serverErr error) {
 +	c, s := localPipe(t)
 +	client := Client(c, clientConfig)
 +	server := Server(s, serverConfig)
 +	done := make(chan error, 1)
 +	go func() {
 +		done <- client.Handshake()
 +		c.Close()
 +	}()
 +	serverErr = server.Handshake()
 +	s.Close()
 +	clientErr = <-done
 +	return
 +}
 +
 +func TestBoringServerSignatureAndHash(t *testing.T) {
 +	defer func() {
 +		testingOnlyForceClientHelloSignatureAlgorithms = nil
 +	}()
 +
 +	for _, sigHash := range defaultSupportedSignatureAlgorithms {
 +		t.Run(fmt.Sprintf("%#x", sigHash), func(t *testing.T) {
 +			serverConfig := testConfig.Clone()
 +			serverConfig.Certificates = make([]Certificate, 1)
 +
 +			testingOnlyForceClientHelloSignatureAlgorithms = []SignatureScheme{sigHash}
 +
- 			switch signatureFromSignatureScheme(sigHash) {
++			sigType, _, _ := typeAndHashFromSignatureScheme(sigHash)
++			switch sigType {
 +			case signaturePKCS1v15, signatureRSAPSS:
 +				serverConfig.CipherSuites = []uint16{TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256}
 +				serverConfig.Certificates[0].Certificate = [][]byte{testRSA2048Certificate}
 +				serverConfig.Certificates[0].PrivateKey = testRSA2048PrivateKey
 +			case signatureEd25519:
 +				serverConfig.CipherSuites = []uint16{TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256}
 +				serverConfig.Certificates[0].Certificate = [][]byte{testEd25519Certificate}
 +				serverConfig.Certificates[0].PrivateKey = testEd25519PrivateKey
 +			case signatureECDSA:
 +				serverConfig.CipherSuites = []uint16{TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256}
 +				serverConfig.Certificates[0].Certificate = [][]byte{testECDSACertificate}
 +				serverConfig.Certificates[0].PrivateKey = testECDSAPrivateKey
 +			}
 +			serverConfig.BuildNameToCertificate()
 +			// PKCS#1 v1.5 signature algorithms can't be used standalone in TLS
 +			// 1.3, and the ECDSA ones bind to the curve used.
 +			// RSA-PSS signatures are not supported in TLS 1.2. Issue 32425.
- 			if signatureFromSignatureScheme(sigHash) != signatureRSAPSS {
++			if sigType != signatureRSAPSS {
 +				serverConfig.MaxVersion = VersionTLS12
 +			}
 +
 +			clientErr, serverErr := boringHandshake(t, testConfig, serverConfig)
 +			if clientErr != nil {
 +				t.Fatalf("expected handshake with %#x to succeed; client error: %v; server error: %v", sigHash, clientErr, serverErr)
 +			}
 +
 +			// With fipstls forced, bad curves should be rejected.
 +			t.Run("fipstls", func(t *testing.T) {
 +				fipstls.Force()
 +				defer fipstls.Abandon()
 +				clientErr, _ := boringHandshake(t, testConfig, serverConfig)
 +				// RSA-PSS is only supported in TLS 1.3, prohibited by forcing fipstls. Issue 32425.
- 				if isBoringSignatureScheme(sigHash) && signatureFromSignatureScheme(sigHash) != signatureRSAPSS {
++				if isBoringSignatureScheme(sigHash) && sigType != signatureRSAPSS {
 +					if clientErr != nil {
 +						t.Fatalf("expected handshake with %#x to succeed; err=%v", sigHash, clientErr)
 +					}
 +				} else {
 +					if clientErr == nil {
 +						t.Fatalf("expected handshake with %#x to fail, but it succeeded", sigHash)
 +					}
 +				}
 +			})
 +		})
 +	}
 +}
 +
 +func TestBoringClientHello(t *testing.T) {
 +	// Test that no matter what we put in the client config,
 +	// the client does not offer non-FIPS configurations.
 +	fipstls.Force()
 +	defer fipstls.Abandon()
 +
 +	c, s := net.Pipe()
 +	defer c.Close()
 +	defer s.Close()
 +
 +	clientConfig := testConfig.Clone()
 +	// All sorts of traps for the client to avoid.
 +	clientConfig.MinVersion = VersionSSL30
 +	clientConfig.MaxVersion = VersionTLS13
 +	clientConfig.CipherSuites = allCipherSuites()
 +	clientConfig.CurvePreferences = defaultCurvePreferences
 +
 +	go Client(c, testConfig).Handshake()
 +	srv := Server(s, testConfig)
 +	msg, err := srv.readHandshake()
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +	hello, ok := msg.(*clientHelloMsg)
 +	if !ok {
 +		t.Fatalf("unexpected message type %T", msg)
 +	}
 +
 +	if !isBoringVersion(hello.vers) {
 +		t.Errorf("client vers=%#x, want %#x (TLS 1.2)", hello.vers, VersionTLS12)
 +	}
 +	for _, v := range hello.supportedVersions {
 +		if !isBoringVersion(v) {
 +			t.Errorf("client offered disallowed version %#x", v)
 +		}
 +	}
 +	for _, id := range hello.cipherSuites {
 +		if !isBoringCipherSuite(id) {
 +			t.Errorf("client offered disallowed suite %#x", id)
 +		}
 +	}
 +	for _, id := range hello.supportedCurves {
 +		if !isBoringCurve(id) {
 +			t.Errorf("client offered disallowed curve %d", id)
 +		}
 +	}
 +	for _, sigHash := range hello.supportedSignatureAlgorithms {
 +		if !isBoringSignatureScheme(sigHash) {
 +			t.Errorf("client offered disallowed signature-and-hash %v", sigHash)
 +		}
 +	}
 +}
 +
 +func TestBoringCertAlgs(t *testing.T) {
 +	// NaCl, arm and wasm time out generating keys. Nothing in this test is architecture-specific, so just don't bother on those.
 +	if runtime.GOOS == "nacl" || runtime.GOARCH == "arm" || runtime.GOOS == "js" {
 +		t.Skipf("skipping on %s/%s because key generation takes too long", runtime.GOOS, runtime.GOARCH)
 +	}
 +
 +	// Set up some roots, intermediate CAs, and leaf certs with various algorithms.
 +	// X_Y is X signed by Y.
 +	R1 := boringCert(t, "R1", boringRSAKey(t, 2048), nil, boringCertCA|boringCertFIPSOK)
 +	R2 := boringCert(t, "R2", boringRSAKey(t, 4096), nil, boringCertCA)
 +
 +	M1_R1 := boringCert(t, "M1_R1", boringECDSAKey(t, elliptic.P256()), R1, boringCertCA|boringCertFIPSOK)
 +	M2_R1 := boringCert(t, "M2_R1", boringECDSAKey(t, elliptic.P224()), R1, boringCertCA)
 +
 +	I_R1 := boringCert(t, "I_R1", boringRSAKey(t, 3072), R1, boringCertCA|boringCertFIPSOK)
 +	I_R2 := boringCert(t, "I_R2", I_R1.key, R2, boringCertCA|boringCertFIPSOK)
 +	I_M1 := boringCert(t, "I_M1", I_R1.key, M1_R1, boringCertCA|boringCertFIPSOK)
 +	I_M2 := boringCert(t, "I_M2", I_R1.key, M2_R1, boringCertCA|boringCertFIPSOK)
 +
 +	L1_I := boringCert(t, "L1_I", boringECDSAKey(t, elliptic.P384()), I_R1, boringCertLeaf|boringCertFIPSOK)
 +	L2_I := boringCert(t, "L2_I", boringRSAKey(t, 1024), I_R1, boringCertLeaf)
 +
 +	// boringCert checked that isBoringCertificate matches the caller's boringCertFIPSOK bit.
 +	// If not, no point in building bigger end-to-end tests.
 +	if t.Failed() {
 +		t.Fatalf("isBoringCertificate failures; not continuing")
 +	}
 +
 +	// client verifying server cert
 +	testServerCert := func(t *testing.T, desc string, pool *x509.CertPool, key interface{}, list [][]byte, ok bool) {
 +		clientConfig := testConfig.Clone()
 +		clientConfig.RootCAs = pool
 +		clientConfig.InsecureSkipVerify = false
 +		clientConfig.ServerName = "example.com"
 +
 +		serverConfig := testConfig.Clone()
 +		serverConfig.Certificates = []Certificate{{Certificate: list, PrivateKey: key}}
 +		serverConfig.BuildNameToCertificate()
 +
 +		clientErr, _ := boringHandshake(t, clientConfig, serverConfig)
 +
 +		if (clientErr == nil) == ok {
 +			if ok {
 +				t.Logf("%s: accept", desc)
 +			} else {
 +				t.Logf("%s: reject", desc)
 +			}
 +		} else {
 +			if ok {
 +				t.Errorf("%s: BAD reject (%v)", desc, clientErr)
 +			} else {
 +				t.Errorf("%s: BAD accept", desc)
 +			}
 +		}
 +	}
 +
 +	// server verifying client cert
 +	testClientCert := func(t *testing.T, desc string, pool *x509.CertPool, key interface{}, list [][]byte, ok bool) {
 +		clientConfig := testConfig.Clone()
 +		clientConfig.ServerName = "example.com"
 +		clientConfig.Certificates = []Certificate{{Certificate: list, PrivateKey: key}}
 +
 +		serverConfig := testConfig.Clone()
 +		serverConfig.ClientCAs = pool
 +		serverConfig.ClientAuth = RequireAndVerifyClientCert
 +
 +		_, serverErr := boringHandshake(t, clientConfig, serverConfig)
 +
 +		if (serverErr == nil) == ok {
 +			if ok {
 +				t.Logf("%s: accept", desc)
 +			} else {
 +				t.Logf("%s: reject", desc)
 +			}
 +		} else {
 +			if ok {
 +				t.Errorf("%s: BAD reject (%v)", desc, serverErr)
 +			} else {
 +				t.Errorf("%s: BAD accept", desc)
 +			}
 +		}
 +	}
 +
 +	// Run simple basic test with known answers before proceeding to
 +	// exhaustive test with computed answers.
 +	r1pool := x509.NewCertPool()
 +	r1pool.AddCert(R1.cert)
 +	testServerCert(t, "basic", r1pool, L2_I.key, [][]byte{L2_I.der, I_R1.der}, true)
 +	testClientCert(t, "basic (client cert)", r1pool, L2_I.key, [][]byte{L2_I.der, I_R1.der}, true)
 +	fipstls.Force()
 +	testServerCert(t, "basic (fips)", r1pool, L2_I.key, [][]byte{L2_I.der, I_R1.der}, false)
 +	testClientCert(t, "basic (fips, client cert)", r1pool, L2_I.key, [][]byte{L2_I.der, I_R1.der}, false)
 +	fipstls.Abandon()
 +
 +	if t.Failed() {
 +		t.Fatal("basic test failed, skipping exhaustive test")
 +	}
 +
 +	if testing.Short() {
 +		t.Logf("basic test passed; skipping exhaustive test in -short mode")
 +		return
 +	}
 +
 +	for l := 1; l <= 2; l++ {
 +		leaf := L1_I
 +		if l == 2 {
 +			leaf = L2_I
 +		}
 +		for i := 0; i < 64; i++ {
 +			reachable := map[string]bool{leaf.parentOrg: true}
 +			reachableFIPS := map[string]bool{leaf.parentOrg: leaf.fipsOK}
 +			list := [][]byte{leaf.der}
 +			listName := leaf.name
 +			addList := func(cond int, c *boringCertificate) {
 +				if cond != 0 {
 +					list = append(list, c.der)
 +					listName += "," + c.name
 +					if reachable[c.org] {
 +						reachable[c.parentOrg] = true
 +					}
 +					if reachableFIPS[c.org] && c.fipsOK {
 +						reachableFIPS[c.parentOrg] = true
 +					}
 +				}
 +			}
 +			addList(i&1, I_R1)
 +			addList(i&2, I_R2)
 +			addList(i&4, I_M1)
 +			addList(i&8, I_M2)
 +			addList(i&16, M1_R1)
 +			addList(i&32, M2_R1)
 +
 +			for r := 1; r <= 3; r++ {
 +				pool := x509.NewCertPool()
 +				rootName := ","
 +				shouldVerify := false
 +				shouldVerifyFIPS := false
 +				addRoot := func(cond int, c *boringCertificate) {
 +					if cond != 0 {
 +						rootName += "," + c.name
 +						pool.AddCert(c.cert)
 +						if reachable[c.org] {
 +							shouldVerify = true
 +						}
 +						if reachableFIPS[c.org] && c.fipsOK {
 +							shouldVerifyFIPS = true
 +						}
 +					}
 +				}
 +				addRoot(r&1, R1)
 +				addRoot(r&2, R2)
 +				rootName = rootName[1:] // strip leading comma
 +				testServerCert(t, listName+"->"+rootName[1:], pool, leaf.key, list, shouldVerify)
 +				testClientCert(t, listName+"->"+rootName[1:]+"(client cert)", pool, leaf.key, list, shouldVerify)
 +				fipstls.Force()
 +				testServerCert(t, listName+"->"+rootName[1:]+" (fips)", pool, leaf.key, list, shouldVerifyFIPS)
 +				testClientCert(t, listName+"->"+rootName[1:]+" (fips, client cert)", pool, leaf.key, list, shouldVerifyFIPS)
 +				fipstls.Abandon()
 +			}
 +		}
 +	}
 +}
 +
 +const (
 +	boringCertCA = iota
 +	boringCertLeaf
 +	boringCertFIPSOK = 0x80
 +)
 +
 +func boringRSAKey(t *testing.T, size int) *rsa.PrivateKey {
 +	k, err := rsa.GenerateKey(rand.Reader, size)
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +	return k
 +}
 +
 +func boringECDSAKey(t *testing.T, curve elliptic.Curve) *ecdsa.PrivateKey {
 +	k, err := ecdsa.GenerateKey(curve, rand.Reader)
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +	return k
 +}
 +
 +type boringCertificate struct {
 +	name      string
 +	org       string
 +	parentOrg string
 +	der       []byte
 +	cert      *x509.Certificate
 +	key       interface{}
 +	fipsOK    bool
 +}
 +
 +func boringCert(t *testing.T, name string, key interface{}, parent *boringCertificate, mode int) *boringCertificate {
 +	org := name
 +	parentOrg := ""
 +	if i := strings.Index(org, "_"); i >= 0 {
 +		org = org[:i]
 +		parentOrg = name[i+1:]
 +	}
 +	tmpl := &x509.Certificate{
 +		SerialNumber: big.NewInt(1),
 +		Subject: pkix.Name{
 +			Organization: []string{org},
 +		},
 +		NotBefore: time.Unix(0, 0),
 +		NotAfter:  time.Unix(0, 0),
 +
 +		KeyUsage:              x509.KeyUsageKeyEncipherment | x509.KeyUsageDigitalSignature,
 +		ExtKeyUsage:           []x509.ExtKeyUsage{x509.ExtKeyUsageServerAuth, x509.ExtKeyUsageClientAuth},
 +		BasicConstraintsValid: true,
 +	}
 +	if mode&^boringCertFIPSOK == boringCertLeaf {
 +		tmpl.DNSNames = []string{"example.com"}
 +	} else {
 +		tmpl.IsCA = true
 +		tmpl.KeyUsage |= x509.KeyUsageCertSign
 +	}
 +
 +	var pcert *x509.Certificate
 +	var pkey interface{}
 +	if parent != nil {
 +		pcert = parent.cert
 +		pkey = parent.key
 +	} else {
 +		pcert = tmpl
 +		pkey = key
 +	}
 +
 +	var pub interface{}
 +	var desc string
 +	switch k := key.(type) {
 +	case *rsa.PrivateKey:
 +		pub = &k.PublicKey
 +		desc = fmt.Sprintf("RSA-%d", k.N.BitLen())
 +	case *ecdsa.PrivateKey:
 +		pub = &k.PublicKey
 +		desc = "ECDSA-" + k.Curve.Params().Name
 +	default:
 +		t.Fatalf("invalid key %T", key)
 +	}
 +
 +	der, err := x509.CreateCertificate(rand.Reader, tmpl, pcert, pub, pkey)
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +	cert, err := x509.ParseCertificate(der)
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +
 +	// Tell isBoringCertificate to enforce FIPS restrictions for this check.
 +	fipstls.Force()
 +	defer fipstls.Abandon()
 +
 +	fipsOK := mode&boringCertFIPSOK != 0
 +	if isBoringCertificate(cert) != fipsOK {
 +		t.Errorf("isBoringCertificate(cert with %s key) = %v, want %v", desc, !fipsOK, fipsOK)
 +	}
 +	return &boringCertificate{name, org, parentOrg, der, cert, key, fipsOK}
 +}
 +
 +// A self-signed test certificate with an RSA key of size 2048, for testing
 +// RSA-PSS with SHA512. SAN of example.golang.
 +var (
 +	testRSA2048Certificate []byte
 +	testRSA2048PrivateKey  *rsa.PrivateKey
 +)
 +
 +func init() {
 +	block, _ := pem.Decode([]byte(`
 +-----BEGIN CERTIFICATE-----
 +MIIC/zCCAeegAwIBAgIRALHHX/kh4+4zMU9DarzBEcQwDQYJKoZIhvcNAQELBQAw
 +EjEQMA4GA1UEChMHQWNtZSBDbzAeFw0xMTAxMDExNTA0MDVaFw0yMDEyMjkxNTA0
 +MDVaMBIxEDAOBgNVBAoTB0FjbWUgQ28wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw
 +ggEKAoIBAQCf8fk0N6ieCBX4IOVIfKitt4kGcOQLeimCfsjqqHcysMIVGEtFSM6E
 +4Ay141f/7IqdW0UtIqNb4PXhROID7yDxR284xL6XbCuv/t5hP3UcehYc3hmLiyVd
 +MkZQiZWtfUUJf/1qOtM+ohNg59LRWp4d+6iX0la1JL3EwCIckkNjJ9hQbF7Pb2CS
 ++ES9Yo55KAap8KOblpcR8MBSN38bqnwjfQdCXvOEOjam2HUxKzEFX5MA+fA0me4C
 +ioCcCRLWKl+GoN9F8fABfoZ+T+2eal4DLuO95rXR8SrOIVBh3XFOr/RVhjtXcNVF
 +ZKcvDt6d68V6jAKAYKm5nlj9GPpd4v+rAgMBAAGjUDBOMA4GA1UdDwEB/wQEAwIF
 +oDATBgNVHSUEDDAKBggrBgEFBQcDATAMBgNVHRMBAf8EAjAAMBkGA1UdEQQSMBCC
 +DmV4YW1wbGUuZ29sYW5nMA0GCSqGSIb3DQEBCwUAA4IBAQCOoYsVcFCBhboqe3WH
 +dC6V7XXXECmnjh01r8h80yv0NR379nSD3cw2M+HKvaXysWqrl5hjGVKw0vtwD81r
 +V4JzDu7IfIog5m8+QNC+7LqDZsz88vDKOrsoySVOmUCgmCKFXew+LA+eO/iQEJTr
 +7ensddOeXJEp27Ed5vW+kmWW3Qmglc2Gwy8wFrMDIqnrnOzBA4oCnDEgtXJt0zog
 +nRwbfEMAWi1aQRy5dT9KA3SP9mo5SeTFSzGGHiE4s4gHUe7jvsAFF2qgtD6+wH6s
 +z9b6shxnC7g5IlBKhI7SVB/Uqt2ydJ+kH1YbjMcIq6NAM5eNMKgZuJr3+zwsSgwh
 +GNaE
 +-----END CERTIFICATE-----`))
 +	testRSA2048Certificate = block.Bytes
 +
 +	block, _ = pem.Decode([]byte(`
 +-----BEGIN RSA PRIVATE KEY-----
 +MIIEpAIBAAKCAQEAn/H5NDeonggV+CDlSHyorbeJBnDkC3opgn7I6qh3MrDCFRhL
 +RUjOhOAMteNX/+yKnVtFLSKjW+D14UTiA+8g8UdvOMS+l2wrr/7eYT91HHoWHN4Z
 +i4slXTJGUImVrX1FCX/9ajrTPqITYOfS0VqeHfuol9JWtSS9xMAiHJJDYyfYUGxe
 +z29gkvhEvWKOeSgGqfCjm5aXEfDAUjd/G6p8I30HQl7zhDo2pth1MSsxBV+TAPnw
 +NJnuAoqAnAkS1ipfhqDfRfHwAX6Gfk/tnmpeAy7jvea10fEqziFQYd1xTq/0VYY7
 +V3DVRWSnLw7enevFeowCgGCpuZ5Y/Rj6XeL/qwIDAQABAoIBAQCNpMZifd/vg42h
 +HdCvLuZaYS0R7SunFlpoXEsltGdLFsnp0IfoJZ/ugFQBSAIIfLwMumU6oXA1z7Uv
 +98aIYV61DePrTCDVDFBsHbNmP8JAo8WtbusEbwd5zyoB7LYG2+clkJklWE73KqUq
 +rmI+UJeyScl2Gin7ZTxBXz1WPBk9VwcnwkeaXpgASIBW23fhECM9gnYEEwaBez5T
 +6Me8d1tHtYQv7vsKe7ro9w9/HKrRXejqYKK1LxkhfFriyV+m8LZJZn2nXOa6G3gF
 +Nb8Qk1Uk5PUBENBmyMFJhT4M/uuSq4YtMrrO2gi8Q+fPhuGzc5SshYKRBp0W4P5r
 +mtVCtEFRAoGBAMENBIFLrV2+HsGj0xYFasKov/QPe6HSTR1Hh2IZONp+oK4oszWE
 +jBT4VcnITmpl6tC1Wy4GcrxjNgKIFZAj+1x1LUULdorXkuG8yr0tAhG9zNyfWsSy
 +PrSovC0UVbzr8Jxxla+kQVxEQQqWQxPlEVuL8kXaIDA6Lyt1Hpua2LvPAoGBANQZ
 +c6Lq2T7+BxLxNdi2m8kZzej5kgzBp/XdVsbFWRlebIX2KrFHsrHzT9PUk3DE1vZK
 +M6pzTt94nQhWSkDgCaw1SohElJ3HFIFwcusF1SJAc3pQepd8ug6IYdlpDMLtBj/P
 +/5P6BVUtgo05E4+I/T3iYatmglQxTtlZ0RkSV2llAoGBALOXkKFX7ahPvf0WksDh
 +uTfuFOTPoowgQG0EpgW0wRdCxeg/JLic3lSD0gsttQV2WsRecryWcxaelRg10RmO
 +38BbogmhaF4xvgsSvujOfiZTE8oK1T43M+6NKsIlML3YILbpU/9aJxPWy0s2DqDr
 +cQJhZrlk+pzjBA7Bnf/URdwxAoGAKR/CNw14D+mrL3YLbbiCXiydqxVwxv5pdZdz
 +8thi3TNcsWC4iGURdcVqbfUinVPdJiXe/Kac3WGCeRJaFVgbKAOxLti1RB5MkIhg
 +D8eyupBqk4W1L1gkrxqsdj4TFlxkwMywjl2E2S4YyQ8PBt6V04DoVRZsIKzqz+PF
 +UionPq0CgYBCYXvqioJhPewkOq/Y5wrDBeZW1FQK5QD9W5M8/5zxd4rdvJtjhbJp
 +oOrtvMdrl6upy9Hz4BJD3FXwVFiPFE7jqeNqi0F21viLxBPMMD3UODF6LL5EyLiR
 +9V4xVMS8KXxvg7rxsuqzMPscViaWUL6WNVBhsD2+92dHxSXzz5EJKQ==
 +-----END RSA PRIVATE KEY-----`))
 +	var err error
 +	testRSA2048PrivateKey, err = x509.ParsePKCS1PrivateKey(block.Bytes)
 +	if err != nil {
 +		panic(err)
 +	}
 +}
diff --cc src/crypto/tls/handshake_client_tls13.go
index 067231b199,66775ff0fe..2e9a20369c
--- a/src/crypto/tls/handshake_client_tls13.go
+++ b/src/crypto/tls/handshake_client_tls13.go
@@@ -452,15 -446,13 +450,13 @@@ func (hs *clientHandshakeStateTLS13) re
  	}
  
  	// See RFC 8446, Section 4.4.3.
 -	if !isSupportedSignatureAlgorithm(certVerify.signatureAlgorithm, supportedSignatureAlgorithms) {
 +	if !isSupportedSignatureAlgorithm(certVerify.signatureAlgorithm, supportedSignatureAlgorithms()) {
  		c.sendAlert(alertIllegalParameter)
- 		return errors.New("tls: invalid certificate signature algorithm")
+ 		return errors.New("tls: certificate used with invalid signature algorithm")
  	}
- 	sigType := signatureFromSignatureScheme(certVerify.signatureAlgorithm)
- 	sigHash, err := hashFromSignatureScheme(certVerify.signatureAlgorithm)
- 	if sigType == 0 || err != nil {
- 		c.sendAlert(alertInternalError)
- 		return err
+ 	sigType, sigHash, err := typeAndHashFromSignatureScheme(certVerify.signatureAlgorithm)
+ 	if err != nil {
+ 		return c.sendAlert(alertInternalError)
  	}
  	if sigType == signaturePKCS1v15 || sigHash == crypto.SHA1 {
  		c.sendAlert(alertIllegalParameter)
diff --cc src/crypto/tls/handshake_server_tls13.go
index 458f90e578,9b05924571..ca71f2ea3f
--- a/src/crypto/tls/handshake_server_tls13.go
+++ b/src/crypto/tls/handshake_server_tls13.go
@@@ -804,15 -791,13 +795,13 @@@ func (hs *serverHandshakeStateTLS13) re
  		}
  
  		// See RFC 8446, Section 4.4.3.
 -		if !isSupportedSignatureAlgorithm(certVerify.signatureAlgorithm, supportedSignatureAlgorithms) {
 +		if !isSupportedSignatureAlgorithm(certVerify.signatureAlgorithm, supportedSignatureAlgorithms()) {
  			c.sendAlert(alertIllegalParameter)
- 			return errors.New("tls: invalid certificate signature algorithm")
+ 			return errors.New("tls: client certificate used with invalid signature algorithm")
  		}
- 		sigType := signatureFromSignatureScheme(certVerify.signatureAlgorithm)
- 		sigHash, err := hashFromSignatureScheme(certVerify.signatureAlgorithm)
- 		if sigType == 0 || err != nil {
- 			c.sendAlert(alertInternalError)
- 			return err
+ 		sigType, sigHash, err := typeAndHashFromSignatureScheme(certVerify.signatureAlgorithm)
+ 		if err != nil {
+ 			return c.sendAlert(alertInternalError)
  		}
  		if sigType == signaturePKCS1v15 || sigHash == crypto.SHA1 {
  			c.sendAlert(alertIllegalParameter)
