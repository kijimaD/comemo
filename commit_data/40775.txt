commit 98188f3001e7216f61098958e64ded2e95e7be27
Merge: 5c354e66d1 0b3a57b537
Author: Filippo Valsorda <filippo@golang.org>
Date:   Thu Jun 27 18:48:02 2019 -0400

    [dev.boringcrypto] all: merge master into dev.boringcrypto
    
    Change-Id: Ic1d89215bb3e37a722d3d3bc7698edea940a83d9

 SECURITY.md                                        |   13 +
 doc/contribute.html                                |   12 +-
 doc/devel/release.html                             |   14 +
 doc/go1.13.html                                    |  484 +++-
 doc/help.html                                      |    3 -
 doc/install-source.html                            |   68 +-
 misc/cgo/errors/ptr_test.go                        |   26 +-
 misc/cgo/test/cgo_test.go                          |    1 -
 misc/cgo/test/test.go                              |   20 +-
 misc/cgo/test/testx.go                             |    5 -
 misc/cgo/testsanitizers/tsan_test.go               |    4 -
 misc/ios/README                                    |    2 +-
 misc/wasm/wasm_exec.js                             |   29 +-
 src/bytes/buffer.go                                |    3 -
 src/cmd/cgo/doc.go                                 |    4 +-
 src/cmd/cgo/gcc.go                                 |   40 -
 src/cmd/cgo/out.go                                 |   36 +-
 src/cmd/compile/doc.go                             |    8 +-
 src/cmd/compile/fmtmap_test.go                     |   65 +-
 src/cmd/compile/internal/gc/class_string.go        |   14 +
 src/cmd/compile/internal/gc/const.go               |   12 +-
 src/cmd/compile/internal/gc/esc.go                 |    1 +
 src/cmd/compile/internal/gc/escape.go              |    1 +
 src/cmd/compile/internal/gc/go.go                  |    9 +-
 src/cmd/compile/internal/gc/gsubr.go               |   30 +-
 src/cmd/compile/internal/gc/init.go                |    2 +-
 src/cmd/compile/internal/gc/initorder.go           |  355 +++
 src/cmd/compile/internal/gc/main.go                |   18 +-
 src/cmd/compile/internal/gc/noder.go               |   32 +-
 src/cmd/compile/internal/gc/op_string.go           |   10 +-
 src/cmd/compile/internal/gc/reflect.go             |   42 +
 src/cmd/compile/internal/gc/sinit.go               |  266 +-
 src/cmd/compile/internal/gc/ssa.go                 |  210 +-
 src/cmd/compile/internal/gc/syntax.go              |   32 +-
 src/cmd/compile/internal/gc/walk.go                |    2 +-
 src/cmd/compile/internal/s390x/ssa.go              |    2 +
 src/cmd/compile/internal/ssa/cse_test.go           |    7 +-
 src/cmd/compile/internal/ssa/fuse.go               |   44 +-
 src/cmd/compile/internal/ssa/gen/S390X.rules       |   19 +-
 src/cmd/compile/internal/ssa/gen/S390XOps.go       |    5 +
 src/cmd/compile/internal/ssa/loop_test.go          |    3 +-
 src/cmd/compile/internal/ssa/nilcheck.go           |   24 +-
 src/cmd/compile/internal/ssa/opGen.go              |    7 +
 src/cmd/compile/internal/ssa/prove.go              |   18 +-
 src/cmd/compile/internal/ssa/rewriteS390X.go       |   65 +-
 src/cmd/cover/cover.go                             |    3 +
 src/cmd/cover/testdata/test.go                     |    4 +
 src/cmd/dist/build.go                              |    7 -
 src/cmd/doc/pkg.go                                 |   86 +-
 src/cmd/go.mod                                     |    4 +-
 src/cmd/go.sum                                     |   14 +-
 src/cmd/go/alldocs.go                              |  322 ++-
 src/cmd/go/go_test.go                              |  118 +-
 src/cmd/go/go_windows_test.go                      |    4 +-
 src/cmd/go/internal/cache/cache.go                 |    2 +-
 src/cmd/go/internal/cfg/cfg.go                     |   28 +-
 src/cmd/go/internal/envcmd/env.go                  |    1 +
 src/cmd/go/internal/get/path.go                    |    3 +
 src/cmd/go/internal/get/vcs.go                     |   21 +-
 src/cmd/go/internal/help/helpdoc.go                |   10 +-
 src/cmd/go/internal/imports/tags.go                |   15 +
 src/cmd/go/internal/load/path.go                   |   24 -
 src/cmd/go/internal/modcmd/download.go             |    8 +
 src/cmd/go/internal/modcmd/graph.go                |    9 +
 src/cmd/go/internal/modcmd/vendor.go               |    4 +-
 src/cmd/go/internal/modcmd/verify.go               |    9 +
 src/cmd/go/internal/modconv/convert_test.go        |   12 +-
 src/cmd/go/internal/modconv/dep.go                 |    4 +-
 src/cmd/go/internal/modfetch/cache.go              |  101 +-
 src/cmd/go/internal/modfetch/codehost/git.go       |   10 +-
 src/cmd/go/internal/modfetch/codehost/vcs.go       |   18 +-
 src/cmd/go/internal/modfetch/coderepo.go           |    7 +-
 src/cmd/go/internal/modfetch/coderepo_test.go      |   65 +-
 src/cmd/go/internal/modfetch/fetch.go              |   77 +-
 src/cmd/go/internal/modfetch/proxy.go              |  202 +-
 src/cmd/go/internal/modfetch/repo.go               |   71 +-
 src/cmd/go/internal/modfetch/sumdb.go              |    5 +-
 src/cmd/go/internal/modget/get.go                  |  286 +-
 src/cmd/go/internal/modload/build.go               |    4 +-
 src/cmd/go/internal/modload/help.go                |   47 +-
 src/cmd/go/internal/modload/import.go              |    8 +-
 src/cmd/go/internal/modload/import_test.go         |    3 +-
 src/cmd/go/internal/modload/init.go                |    6 +-
 src/cmd/go/internal/modload/list.go                |   29 +-
 src/cmd/go/internal/modload/load.go                |  129 +-
 src/cmd/go/internal/modload/query.go               |  323 ++-
 src/cmd/go/internal/modload/query_test.go          |   29 +-
 src/cmd/go/internal/module/module.go               |    3 +
 src/cmd/go/internal/module/module_test.go          |    2 +-
 src/cmd/go/internal/mvs/mvs.go                     |    2 +-
 src/cmd/go/internal/renameio/error_windows.go      |   23 -
 src/cmd/go/internal/renameio/renameio.go           |   32 +-
 src/cmd/go/internal/renameio/renameio_test.go      |  137 +-
 src/cmd/go/internal/renameio/umask_test.go         |   42 +
 src/cmd/go/internal/robustio/robustio.go           |   53 +
 src/cmd/go/internal/robustio/robustio_other.go     |   28 +
 src/cmd/go/internal/robustio/robustio_windows.go   |  105 +
 src/cmd/go/internal/sumweb/server.go               |    4 +-
 src/cmd/go/internal/test/test.go                   |    1 +
 src/cmd/go/internal/web/file_test.go               |   58 +
 src/cmd/go/internal/web/http.go                    |   89 +-
 src/cmd/go/internal/web/url.go                     |   95 +
 src/cmd/go/internal/web/url_other.go               |   21 +
 src/cmd/go/internal/web/url_other_test.go          |   36 +
 src/cmd/go/internal/web/url_test.go                |   77 +
 src/cmd/go/internal/web/url_windows.go             |   43 +
 src/cmd/go/internal/web/url_windows_test.go        |   94 +
 src/cmd/go/internal/work/build.go                  |    9 +
 src/cmd/go/internal/work/exec.go                   |   19 -
 src/cmd/go/internal/work/gc.go                     |   49 -
 src/cmd/go/internal/work/security.go               |    4 +
 src/cmd/go/internal/work/security_test.go          |    8 +
 src/cmd/go/main.go                                 |    3 +-
 src/cmd/go/proxy_test.go                           |   72 +-
 src/cmd/go/script_test.go                          |   15 +-
 .../go/testdata/mod/example.com_noroot_v1.0.0.txt  |    8 +
 .../go/testdata/mod/example.com_noroot_v1.0.1.txt  |    8 +
 ...m_notags_v0.0.0-20190507143103-cc8cbe209b64.txt |    9 +
 ...upgrade_v0.0.0-20190430073000-30950c05d534.txt} |    2 +-
 src/cmd/go/testdata/script/README                  |    3 +-
 src/cmd/go/testdata/script/build_cache_link.txt    |    4 +-
 src/cmd/go/testdata/script/build_multi_main.txt    |    2 +-
 src/cmd/go/testdata/script/env_write.txt           |    2 +-
 src/cmd/go/testdata/script/get_404_meta.txt        |    1 +
 .../go/testdata/script/get_insecure_redirect.txt   |    4 +-
 .../go/testdata/script/install_cleans_build.txt    |   12 +-
 src/cmd/go/testdata/script/mod_build_versioned.txt |   14 +-
 src/cmd/go/testdata/script/mod_file_proxy.txt      |    7 +-
 src/cmd/go/testdata/script/mod_get_commit.txt      |   11 +-
 src/cmd/go/testdata/script/mod_get_hash.txt        |    2 +-
 .../go/testdata/script/mod_get_latest_pseudo.txt   |   10 +
 src/cmd/go/testdata/script/mod_get_local.txt       |   12 +-
 src/cmd/go/testdata/script/mod_get_main.txt        |   12 +-
 src/cmd/go/testdata/script/mod_get_patterns.txt    |   14 +-
 src/cmd/go/testdata/script/mod_get_private_vcs.txt |    2 +-
 src/cmd/go/testdata/script/mod_get_pseudo.txt      |   27 +-
 .../script/mod_get_pseudo_other_branch.txt         |    2 +-
 .../go/testdata/script/mod_get_pseudo_prefix.txt   |    4 +-
 src/cmd/go/testdata/script/mod_get_tags.txt        |   44 +
 src/cmd/go/testdata/script/mod_get_upgrade.txt     |   12 +-
 .../go/testdata/script/mod_get_upgrade_pseudo.txt  |   31 +-
 src/cmd/go/testdata/script/mod_getmode_vendor.txt  |    2 +-
 .../go/testdata/script/mod_git_export_subst.txt    |    2 +-
 src/cmd/go/testdata/script/mod_gobuild_import.txt  |   16 +-
 src/cmd/go/testdata/script/mod_gonoproxy.txt       |   12 +-
 src/cmd/go/testdata/script/mod_gopkg_unstable.txt  |    1 +
 src/cmd/go/testdata/script/mod_import_v1suffix.txt |    2 +-
 src/cmd/go/testdata/script/mod_init_glide.txt      |   34 +
 .../go/testdata/script/mod_list_upgrade_pseudo.txt |   11 +-
 src/cmd/go/testdata/script/mod_load_badchain.txt   |    4 +-
 src/cmd/go/testdata/script/mod_off.txt             |   35 +
 src/cmd/go/testdata/script/mod_outside.txt         |    6 +-
 src/cmd/go/testdata/script/mod_proxy_https.txt     |   19 +
 src/cmd/go/testdata/script/mod_pseudo_cache.txt    |   29 +
 src/cmd/go/testdata/script/mod_sumdb.txt           |   10 +-
 src/cmd/go/testdata/script/mod_sumdb_cache.txt     |   16 +-
 src/cmd/go/testdata/script/mod_sumdb_file_path.txt |   41 +
 src/cmd/go/testdata/script/mod_sumdb_golang.txt    |   31 +-
 src/cmd/go/testdata/script/mod_sumdb_proxy.txt     |   17 +-
 ...upgrade_patch_pkg.txt => mod_upgrade_patch.txt} |    7 +
 .../go/testdata/script/mod_upgrade_patch_mod.txt   |   83 -
 src/cmd/go/testdata/script/mod_vcs_missing.txt     |    2 +-
 .../go/testdata/script/prevent_sys_unix_import.txt |    6 +
 src/cmd/go/testdata/script/test_devnull.txt        |    2 +-
 src/cmd/go/vendor_test.go                          |    9 +
 src/cmd/internal/obj/wasm/a.out.go                 |    8 +-
 src/cmd/internal/obj/wasm/wasmobj.go               |  134 +-
 src/cmd/link/dwarf_test.go                         |    6 +-
 src/cmd/link/internal/ld/dwarf_test.go             |   23 +
 src/cmd/link/internal/ld/macho.go                  |    2 +-
 src/cmd/link/internal/ld/macho_combine_dwarf.go    |    1 +
 src/cmd/link/internal/ld/pcln.go                   |    2 +-
 src/cmd/link/internal/ld/pe.go                     |   16 +-
 .../internal/ld/testdata/issue32233/lib/ObjC.m     |   16 +
 .../internal/ld/testdata/issue32233/lib/lib.go     |   19 +
 .../internal/ld/testdata/issue32233/main/main.go}  |    9 +-
 src/cmd/link/internal/sym/symkind_string.go        |   62 +-
 src/cmd/link/internal/wasm/asm.go                  |   23 +-
 .../vendor/github.com/google/pprof/CONTRIBUTORS    |    1 +
 .../google/pprof/internal/binutils/binutils.go     |    2 +-
 .../github.com/google/pprof/internal/driver/cli.go |   40 +-
 .../google/pprof/internal/driver/commands.go       |    2 +-
 .../google/pprof/internal/driver/driver.go         |    2 +-
 .../google/pprof/internal/driver/driver_focus.go   |    4 +-
 .../google/pprof/internal/driver/interactive.go    |    8 +-
 .../google/pprof/internal/driver/webhtml.go        |    2 +-
 .../google/pprof/internal/driver/webui.go          |   10 +-
 .../google/pprof/internal/elfexec/elfexec.go       |    6 +-
 .../pprof/internal/measurement/measurement.go      |    3 +-
 .../google/pprof/internal/report/source.go         |    8 +-
 .../google/pprof/internal/symbolz/symbolz.go       |    2 +-
 .../github.com/google/pprof/profile/profile.go     |    2 +-
 .../golang.org/x/tools/go/analysis/analysis.go     |   17 +-
 .../go/analysis/internal/analysisflags/flags.go    |    9 +-
 .../tools/go/analysis/passes/errorsas/errorsas.go  |   75 +
 .../go/analysis/passes/structtag/structtag.go      |   69 +-
 .../x/tools/go/analysis/passes/tests/tests.go      |    5 +-
 src/cmd/vendor/modules.txt                         |    5 +-
 src/cmd/vet/main.go                                |    2 +
 src/compress/gzip/gzip_test.go                     |    3 +
 src/crypto/cipher/xor_test.go                      |    5 -
 src/crypto/ecdsa/ecdsa.go                          |   19 +-
 src/crypto/ecdsa/ecdsa_noasm.go                    |   22 +
 src/crypto/ecdsa/ecdsa_s390x.go                    |  153 +
 src/crypto/ecdsa/ecdsa_s390x.s                     |   31 +
 src/crypto/ecdsa/ecdsa_s390x_test.go               |   33 +
 src/crypto/rand/rand_js.go                         |    5 +-
 src/crypto/tls/auth.go                             |   12 +-
 src/crypto/tls/boring.go                           |    9 +
 src/crypto/tls/boring_test.go                      |   27 +-
 src/crypto/tls/common.go                           |   15 +
 src/crypto/tls/handshake_client.go                 |    6 +-
 src/crypto/tls/handshake_client_test.go            |   46 +-
 src/crypto/tls/handshake_server.go                 |    7 +-
 src/crypto/tls/handshake_server_test.go            |   62 +-
 src/crypto/tls/handshake_test.go                   |    1 +
 src/crypto/tls/key_agreement.go                    |    2 +-
 .../Client-TLSv12-ClientCert-RSA-AES256-GCM-SHA384 |   74 +-
 .../testdata/Client-TLSv12-ClientCert-RSA-ECDSA    |   92 +-
 .../tls/testdata/Client-TLSv12-ClientCert-RSA-RSA  |   74 +-
 .../Client-TLSv12-ClientCert-RSA-RSAPKCS1v15       |   74 +-
 .../testdata/Client-TLSv12-ClientCert-RSA-RSAPSS   |  153 +-
 .../tls/testdata/Client-TLSv12-RenegotiateOnce     |  348 +--
 .../tls/testdata/Client-TLSv12-RenegotiateTwice    |  538 ++--
 .../Client-TLSv12-RenegotiateTwiceRejected         |  354 +--
 .../testdata/Client-TLSv13-ClientCert-RSA-RSAPSS   |  237 +-
 src/crypto/tls/testdata/Server-TLSv12-ALPN         |   64 +-
 src/crypto/tls/testdata/Server-TLSv12-ALPN-NoMatch |   64 +-
 .../Server-TLSv12-CipherSuiteCertPreferenceECDSA   |   66 +-
 .../Server-TLSv12-CipherSuiteCertPreferenceRSA     |   60 +-
 .../Server-TLSv12-ClientAuthRequestedAndECDSAGiven |   79 +-
 ...erver-TLSv12-ClientAuthRequestedAndEd25519Given |   65 +-
 .../Server-TLSv12-ClientAuthRequestedAndGiven      |  110 +-
 ...rver-TLSv12-ClientAuthRequestedAndPKCS1v15Given |   86 +-
 .../Server-TLSv12-ClientAuthRequestedNotGiven      |   61 +-
 .../testdata/Server-TLSv12-ExportKeyingMaterial    |   64 +-
 src/crypto/tls/testdata/Server-TLSv12-P256         |   54 +-
 src/crypto/tls/testdata/Server-TLSv12-RSA-3DES     |   50 +-
 src/crypto/tls/testdata/Server-TLSv12-RSA-AES      |   54 +-
 src/crypto/tls/testdata/Server-TLSv12-RSA-AES-GCM  |   50 +-
 .../testdata/Server-TLSv12-RSA-AES256-GCM-SHA384   |   50 +-
 src/crypto/tls/testdata/Server-TLSv12-RSA-RC4      |   44 +-
 .../tls/testdata/Server-TLSv12-RSA-RSAPKCS1v15     |   50 +-
 src/crypto/tls/testdata/Server-TLSv12-RSA-RSAPSS   |   35 +-
 src/crypto/tls/testdata/Server-TLSv12-SNI          |   54 +-
 .../tls/testdata/Server-TLSv12-SNI-GetCertificate  |   54 +-
 .../Server-TLSv12-SNI-GetCertificateNotFound       |   54 +-
 src/crypto/tls/testdata/Server-TLSv12-X25519       |   50 +-
 src/database/sql/convert.go                        |   44 +
 src/database/sql/convert_test.go                   |  104 +
 src/database/sql/driver/types.go                   |   17 +-
 src/database/sql/driver/types_test.go              |   14 +
 src/database/sql/sql.go                            |   35 +
 src/database/sql/sql_test.go                       |   60 +-
 src/debug/macho/macho.go                           |    7 +-
 src/errors/example_test.go                         |   16 -
 src/errors/wrap.go                                 |   17 +-
 src/errors/wrap_test.go                            |   49 +-
 src/go.mod                                         |    6 +-
 src/go.sum                                         |   18 +-
 src/go/internal/gccgoimporter/parser.go            |   69 +-
 src/html/template/context.go                       |    6 +-
 src/html/template/template.go                      |   15 +-
 src/image/draw/draw.go                             |    4 +-
 src/internal/testenv/testenv.go                    |   19 +
 src/math/example_test.go                           |   38 +
 src/net/cgo_darwin_stub.go                         |  209 --
 src/net/cgo_stub.go                                |    1 -
 src/net/conf.go                                    |    5 -
 src/net/dnsclient_unix_test.go                     |    3 +-
 src/net/http/client_test.go                        |    2 +-
 src/net/http/export_test.go                        |   16 +
 src/net/http/h2_bundle.go                          |   26 +-
 src/net/http/roundtrip_js.go                       |   30 +-
 src/net/http/serve_test.go                         |   55 +-
 src/net/http/server.go                             |   23 +-
 src/net/http/transport.go                          |   25 +-
 src/net/http/transport_test.go                     |   91 +-
 src/net/ip.go                                      |    2 +-
 src/os/file.go                                     |    4 +-
 src/os/file_plan9.go                               |    1 +
 src/os/file_unix.go                                |    1 +
 src/os/file_windows.go                             |    1 +
 src/os/os_unix_test.go                             |   13 +-
 src/os/signal/signal_cgo_test.go                   |   11 +
 src/reflect/value.go                               |    2 +-
 src/runtime/asm.s                                  |    8 -
 src/runtime/asm_386.s                              |    8 +-
 src/runtime/asm_ppc64x.s                           |    8 +-
 src/runtime/asm_s390x.s                            |    4 +-
 src/runtime/asm_wasm.s                             |   15 +-
 src/runtime/export_test.go                         |   41 +-
 src/runtime/internal/atomic/asm_s390x.s            |   24 +
 src/runtime/internal/atomic/atomic_386.go          |    4 +
 src/runtime/internal/atomic/atomic_amd64x.go       |    5 +
 src/runtime/internal/atomic/atomic_arm.go          |    4 +
 src/runtime/internal/atomic/atomic_mipsx.go        |    7 +
 src/runtime/internal/atomic/atomic_s390x.go        |   30 +-
 src/runtime/internal/atomic/atomic_wasm.go         |   18 +
 src/runtime/lookup_darwin.go                       |   35 -
 src/runtime/lookup_darwin_386.s                    |   50 -
 src/runtime/lookup_darwin_amd64.s                  |   40 -
 src/runtime/lookup_darwin_arm.s                    |   25 -
 src/runtime/lookup_darwin_arm64.s                  |   21 -
 src/runtime/mcache.go                              |   11 +-
 src/runtime/memclr_arm64.s                         |    8 +-
 src/runtime/memmove_arm64.s                        |   10 +-
 src/runtime/mgc.go                                 |   33 +-
 src/runtime/mgcmark.go                             |   20 +-
 src/runtime/mheap.go                               |   11 +-
 src/runtime/mstats.go                              |    3 +
 src/runtime/os_darwin.go                           |   79 +-
 src/runtime/panic.go                               |   44 +
 src/runtime/proc.go                                |    7 +
 src/runtime/race_arm64.s                           |    2 +-
 src/runtime/race_ppc64le.s                         |   12 +-
 src/runtime/rt0_js_wasm.s                          |   54 +-
 src/runtime/rt0_linux_mipsx.s                      |    2 +-
 src/runtime/runtime2.go                            |    9 +-
 src/runtime/signal_unix.go                         |    9 +-
 src/runtime/stack.go                               |   16 +-
 src/runtime/stack_test.go                          |   55 +
 src/runtime/string.go                              |    2 +
 src/runtime/stubs.go                               |    3 -
 src/runtime/sys_aix_ppc64.s                        |    2 +-
 src/runtime/sys_darwin.go                          |   69 +-
 src/runtime/sys_darwin_386.s                       |   89 +-
 src/runtime/sys_darwin_amd64.s                     |   80 +-
 src/runtime/sys_darwin_arm.s                       |   56 +-
 src/runtime/sys_darwin_arm64.s                     |  205 +-
 src/runtime/sys_linux_arm64.s                      |   46 +-
 src/runtime/sys_netbsd_arm64.s                     |   46 +-
 src/runtime/sys_openbsd_arm64.s                    |   46 +-
 src/runtime/syscall_aix.go                         |   14 +
 src/runtime/syscall_solaris.go                     |   29 +
 src/runtime/syscall_windows.go                     |    2 +-
 src/runtime/tls_arm.s                              |    2 +-
 src/runtime/traceback.go                           |   58 +-
 src/runtime/vdso_linux_test.go                     |   63 -
 src/strconv/atof.go                                |    3 +
 src/strconv/example_test.go                        |    2 +-
 src/strings/example_test.go                        |    6 +-
 src/syscall/dll_windows.go                         |   11 +-
 src/syscall/exec_bsd.go                            |   32 +-
 src/syscall/exec_darwin.go                         |   36 +-
 src/syscall/exec_libc.go                           |   42 +-
 src/syscall/exec_linux.go                          |   32 +-
 src/syscall/exec_linux_test.go                     |   21 +-
 src/syscall/fs_js.go                               |   22 +-
 src/syscall/js/js.go                               |   30 +-
 src/syscall/js/js_js.s                             |    8 +
 src/syscall/js/js_test.go                          |   74 +-
 src/syscall/js/typedarray.go                       |  109 -
 src/syscall/mksyscall.pl                           |    6 +
 src/syscall/syscall_darwin.go                      |    1 -
 src/syscall/syscall_darwin_386.go                  |    1 +
 src/syscall/syscall_darwin_amd64.go                |    1 +
 src/syscall/syscall_darwin_arm.go                  |    7 +
 src/syscall/syscall_darwin_arm64.go                |    7 +
 src/syscall/syscall_freebsd.go                     |   18 +-
 src/syscall/syscall_ptrace_test.go                 |   37 +
 src/syscall/zsyscall_darwin_386.go                 |   31 +-
 src/syscall/zsyscall_darwin_386.s                  |    4 +-
 src/syscall/zsyscall_darwin_amd64.go               |   31 +-
 src/syscall/zsyscall_darwin_amd64.s                |    4 +-
 src/syscall/zsyscall_darwin_arm.go                 |   15 -
 src/syscall/zsyscall_darwin_arm.s                  |    2 -
 src/syscall/zsyscall_darwin_arm64.go               |   15 -
 src/syscall/zsyscall_darwin_arm64.s                |    2 -
 src/syscall/zsyscall_freebsd_386.go                |    2 +-
 src/syscall/zsyscall_freebsd_amd64.go              |    2 +-
 src/syscall/zsyscall_freebsd_arm.go                |    2 +-
 src/testing/internal/testdeps/deps.go              |    1 -
 src/text/template/helper.go                        |   15 +-
 src/text/template/template.go                      |    4 +
 .../x/crypto/internal/chacha20/asm_ppc64le.s       |  668 +++++
 .../x/crypto/internal/chacha20/chacha_noasm.go     |    2 +-
 .../x/crypto/internal/chacha20/chacha_ppc64le.go   |   52 +
 .../golang.org/x/crypto/poly1305/mac_noasm.go      |    2 +-
 .../golang.org/x/crypto/poly1305/sum_noasm.go      |    2 +-
 .../golang.org/x/crypto/poly1305/sum_ppc64le.go    |   68 +
 .../golang.org/x/crypto/poly1305/sum_ppc64le.s     |  247 ++
 .../golang.org/x/sys/{unix => cpu}/asm_aix_ppc64.s |    0
 src/vendor/golang.org/x/sys/cpu/cpu_aix_ppc64.go   |   10 +-
 .../golang.org/x/sys/cpu/syscall_aix_ppc64_gc.go   |   36 +
 src/vendor/golang.org/x/sys/unix/.gitignore        |    2 -
 src/vendor/golang.org/x/sys/unix/README.md         |  173 --
 src/vendor/golang.org/x/sys/unix/affinity_linux.go |  124 -
 src/vendor/golang.org/x/sys/unix/aliases.go        |   14 -
 src/vendor/golang.org/x/sys/unix/asm_darwin_386.s  |   29 -
 .../golang.org/x/sys/unix/asm_darwin_amd64.s       |   29 -
 src/vendor/golang.org/x/sys/unix/asm_darwin_arm.s  |   30 -
 .../golang.org/x/sys/unix/asm_darwin_arm64.s       |   30 -
 .../golang.org/x/sys/unix/asm_dragonfly_amd64.s    |   29 -
 src/vendor/golang.org/x/sys/unix/asm_freebsd_386.s |   29 -
 .../golang.org/x/sys/unix/asm_freebsd_amd64.s      |   29 -
 src/vendor/golang.org/x/sys/unix/asm_freebsd_arm.s |   29 -
 .../golang.org/x/sys/unix/asm_freebsd_arm64.s      |   29 -
 src/vendor/golang.org/x/sys/unix/asm_linux_386.s   |   65 -
 src/vendor/golang.org/x/sys/unix/asm_linux_amd64.s |   57 -
 src/vendor/golang.org/x/sys/unix/asm_linux_arm.s   |   56 -
 src/vendor/golang.org/x/sys/unix/asm_linux_arm64.s |   52 -
 .../golang.org/x/sys/unix/asm_linux_mips64x.s      |   56 -
 src/vendor/golang.org/x/sys/unix/asm_linux_mipsx.s |   54 -
 .../golang.org/x/sys/unix/asm_linux_ppc64x.s       |   44 -
 src/vendor/golang.org/x/sys/unix/asm_linux_s390x.s |   56 -
 src/vendor/golang.org/x/sys/unix/asm_netbsd_386.s  |   29 -
 .../golang.org/x/sys/unix/asm_netbsd_amd64.s       |   29 -
 src/vendor/golang.org/x/sys/unix/asm_netbsd_arm.s  |   29 -
 .../golang.org/x/sys/unix/asm_netbsd_arm64.s       |   29 -
 src/vendor/golang.org/x/sys/unix/asm_openbsd_386.s |   29 -
 .../golang.org/x/sys/unix/asm_openbsd_amd64.s      |   29 -
 src/vendor/golang.org/x/sys/unix/asm_openbsd_arm.s |   29 -
 .../golang.org/x/sys/unix/asm_openbsd_arm64.s      |   29 -
 .../golang.org/x/sys/unix/asm_solaris_amd64.s      |   17 -
 .../golang.org/x/sys/unix/bluetooth_linux.go       |   35 -
 src/vendor/golang.org/x/sys/unix/cap_freebsd.go    |  195 --
 src/vendor/golang.org/x/sys/unix/constants.go      |   13 -
 src/vendor/golang.org/x/sys/unix/dev_aix_ppc.go    |   27 -
 src/vendor/golang.org/x/sys/unix/dev_aix_ppc64.go  |   29 -
 src/vendor/golang.org/x/sys/unix/dev_darwin.go     |   24 -
 src/vendor/golang.org/x/sys/unix/dev_dragonfly.go  |   30 -
 src/vendor/golang.org/x/sys/unix/dev_freebsd.go    |   30 -
 src/vendor/golang.org/x/sys/unix/dev_linux.go      |   42 -
 src/vendor/golang.org/x/sys/unix/dev_netbsd.go     |   29 -
 src/vendor/golang.org/x/sys/unix/dev_openbsd.go    |   29 -
 src/vendor/golang.org/x/sys/unix/dirent.go         |   17 -
 src/vendor/golang.org/x/sys/unix/endian_big.go     |    9 -
 src/vendor/golang.org/x/sys/unix/endian_little.go  |    9 -
 src/vendor/golang.org/x/sys/unix/env_unix.go       |   31 -
 .../golang.org/x/sys/unix/errors_freebsd_386.go    |  227 --
 .../golang.org/x/sys/unix/errors_freebsd_amd64.go  |  227 --
 .../golang.org/x/sys/unix/errors_freebsd_arm.go    |  226 --
 src/vendor/golang.org/x/sys/unix/fcntl.go          |   32 -
 src/vendor/golang.org/x/sys/unix/fcntl_darwin.go   |   18 -
 .../golang.org/x/sys/unix/fcntl_linux_32bit.go     |   13 -
 src/vendor/golang.org/x/sys/unix/gccgo.go          |   62 -
 src/vendor/golang.org/x/sys/unix/gccgo_c.c         |   39 -
 .../golang.org/x/sys/unix/gccgo_linux_amd64.go     |   20 -
 src/vendor/golang.org/x/sys/unix/ioctl.go          |   30 -
 src/vendor/golang.org/x/sys/unix/mkall.sh          |  227 --
 src/vendor/golang.org/x/sys/unix/mkerrors.sh       |  662 -----
 src/vendor/golang.org/x/sys/unix/pagesize_unix.go  |   15 -
 src/vendor/golang.org/x/sys/unix/pledge_openbsd.go |  163 --
 src/vendor/golang.org/x/sys/unix/race.go           |   30 -
 src/vendor/golang.org/x/sys/unix/race0.go          |   25 -
 src/vendor/golang.org/x/sys/unix/sockcmsg_linux.go |   36 -
 src/vendor/golang.org/x/sys/unix/sockcmsg_unix.go  |  120 -
 src/vendor/golang.org/x/sys/unix/str.go            |   26 -
 src/vendor/golang.org/x/sys/unix/syscall.go        |   53 -
 src/vendor/golang.org/x/sys/unix/syscall_aix.go    |  557 ----
 .../golang.org/x/sys/unix/syscall_aix_ppc.go       |   34 -
 .../golang.org/x/sys/unix/syscall_aix_ppc64.go     |   34 -
 src/vendor/golang.org/x/sys/unix/syscall_bsd.go    |  624 ----
 src/vendor/golang.org/x/sys/unix/syscall_darwin.go |  706 -----
 .../golang.org/x/sys/unix/syscall_darwin_386.go    |   63 -
 .../golang.org/x/sys/unix/syscall_darwin_amd64.go  |   63 -
 .../golang.org/x/sys/unix/syscall_darwin_arm.go    |   64 -
 .../golang.org/x/sys/unix/syscall_darwin_arm64.go  |   66 -
 .../x/sys/unix/syscall_darwin_libSystem.go         |   31 -
 .../golang.org/x/sys/unix/syscall_dragonfly.go     |  539 ----
 .../x/sys/unix/syscall_dragonfly_amd64.go          |   52 -
 .../golang.org/x/sys/unix/syscall_freebsd.go       |  824 ------
 .../golang.org/x/sys/unix/syscall_freebsd_386.go   |   52 -
 .../golang.org/x/sys/unix/syscall_freebsd_amd64.go |   52 -
 .../golang.org/x/sys/unix/syscall_freebsd_arm.go   |   52 -
 .../golang.org/x/sys/unix/syscall_freebsd_arm64.go |   52 -
 src/vendor/golang.org/x/sys/unix/syscall_linux.go  | 1853 ------------
 .../golang.org/x/sys/unix/syscall_linux_386.go     |  386 ---
 .../golang.org/x/sys/unix/syscall_linux_amd64.go   |  190 --
 .../x/sys/unix/syscall_linux_amd64_gc.go           |   13 -
 .../golang.org/x/sys/unix/syscall_linux_arm.go     |  287 --
 .../golang.org/x/sys/unix/syscall_linux_arm64.go   |  223 --
 .../golang.org/x/sys/unix/syscall_linux_gc.go      |   14 -
 .../golang.org/x/sys/unix/syscall_linux_gc_386.go  |   16 -
 .../x/sys/unix/syscall_linux_gccgo_386.go          |   30 -
 .../x/sys/unix/syscall_linux_gccgo_arm.go          |   20 -
 .../golang.org/x/sys/unix/syscall_linux_mips64x.go |  222 --
 .../golang.org/x/sys/unix/syscall_linux_mipsx.go   |  234 --
 .../golang.org/x/sys/unix/syscall_linux_ppc64x.go  |  152 -
 .../golang.org/x/sys/unix/syscall_linux_riscv64.go |  226 --
 .../golang.org/x/sys/unix/syscall_linux_s390x.go   |  338 ---
 .../golang.org/x/sys/unix/syscall_linux_sparc64.go |  147 -
 src/vendor/golang.org/x/sys/unix/syscall_netbsd.go |  622 ----
 .../golang.org/x/sys/unix/syscall_netbsd_386.go    |   33 -
 .../golang.org/x/sys/unix/syscall_netbsd_amd64.go  |   33 -
 .../golang.org/x/sys/unix/syscall_netbsd_arm.go    |   33 -
 .../golang.org/x/sys/unix/syscall_netbsd_arm64.go  |   33 -
 .../golang.org/x/sys/unix/syscall_openbsd.go       |  416 ---
 .../golang.org/x/sys/unix/syscall_openbsd_386.go   |   37 -
 .../golang.org/x/sys/unix/syscall_openbsd_amd64.go |   37 -
 .../golang.org/x/sys/unix/syscall_openbsd_arm.go   |   37 -
 .../golang.org/x/sys/unix/syscall_openbsd_arm64.go |   37 -
 .../golang.org/x/sys/unix/syscall_solaris.go       |  737 -----
 .../golang.org/x/sys/unix/syscall_solaris_amd64.go |   23 -
 src/vendor/golang.org/x/sys/unix/syscall_unix.go   |  431 ---
 .../golang.org/x/sys/unix/syscall_unix_gc.go       |   15 -
 .../x/sys/unix/syscall_unix_gc_ppc64x.go           |   24 -
 src/vendor/golang.org/x/sys/unix/timestruct.go     |   82 -
 src/vendor/golang.org/x/sys/unix/unveil_openbsd.go |   42 -
 src/vendor/golang.org/x/sys/unix/xattr_bsd.go      |  240 --
 .../golang.org/x/sys/unix/zerrors_aix_ppc.go       | 1374 ---------
 .../golang.org/x/sys/unix/zerrors_aix_ppc64.go     | 1375 ---------
 .../golang.org/x/sys/unix/zerrors_darwin_386.go    | 1783 ------------
 .../golang.org/x/sys/unix/zerrors_darwin_amd64.go  | 1783 ------------
 .../golang.org/x/sys/unix/zerrors_darwin_arm.go    | 1783 ------------
 .../golang.org/x/sys/unix/zerrors_darwin_arm64.go  | 1783 ------------
 .../x/sys/unix/zerrors_dragonfly_amd64.go          | 1650 -----------
 .../golang.org/x/sys/unix/zerrors_freebsd_386.go   | 1793 ------------
 .../golang.org/x/sys/unix/zerrors_freebsd_amd64.go | 1794 ------------
 .../golang.org/x/sys/unix/zerrors_freebsd_arm.go   | 1802 ------------
 .../golang.org/x/sys/unix/zerrors_freebsd_arm64.go | 1794 ------------
 .../golang.org/x/sys/unix/zerrors_linux_386.go     | 2934 -------------------
 .../golang.org/x/sys/unix/zerrors_linux_amd64.go   | 2934 -------------------
 .../golang.org/x/sys/unix/zerrors_linux_arm.go     | 2940 -------------------
 .../golang.org/x/sys/unix/zerrors_linux_arm64.go   | 2925 -------------------
 .../golang.org/x/sys/unix/zerrors_linux_mips.go    | 2941 -------------------
 .../golang.org/x/sys/unix/zerrors_linux_mips64.go  | 2941 -------------------
 .../x/sys/unix/zerrors_linux_mips64le.go           | 2941 -------------------
 .../golang.org/x/sys/unix/zerrors_linux_mipsle.go  | 2941 -------------------
 .../golang.org/x/sys/unix/zerrors_linux_ppc64.go   | 2996 --------------------
 .../golang.org/x/sys/unix/zerrors_linux_ppc64le.go | 2996 --------------------
 .../golang.org/x/sys/unix/zerrors_linux_riscv64.go | 2921 -------------------
 .../golang.org/x/sys/unix/zerrors_linux_s390x.go   | 2994 -------------------
 .../golang.org/x/sys/unix/zerrors_linux_sparc64.go | 2990 -------------------
 .../golang.org/x/sys/unix/zerrors_netbsd_386.go    | 1772 ------------
 .../golang.org/x/sys/unix/zerrors_netbsd_amd64.go  | 1762 ------------
 .../golang.org/x/sys/unix/zerrors_netbsd_arm.go    | 1751 ------------
 .../golang.org/x/sys/unix/zerrors_netbsd_arm64.go  | 1762 ------------
 .../golang.org/x/sys/unix/zerrors_openbsd_386.go   | 1654 -----------
 .../golang.org/x/sys/unix/zerrors_openbsd_amd64.go | 1765 ------------
 .../golang.org/x/sys/unix/zerrors_openbsd_arm.go   | 1656 -----------
 .../golang.org/x/sys/unix/zerrors_openbsd_arm64.go | 1789 ------------
 .../golang.org/x/sys/unix/zerrors_solaris_amd64.go | 1532 ----------
 .../golang.org/x/sys/unix/zptrace386_linux.go      |   80 -
 .../golang.org/x/sys/unix/zptracearm_linux.go      |   41 -
 .../golang.org/x/sys/unix/zptracemips_linux.go     |   50 -
 .../golang.org/x/sys/unix/zptracemipsle_linux.go   |   50 -
 .../golang.org/x/sys/unix/zsyscall_aix_ppc.go      | 1484 ----------
 .../golang.org/x/sys/unix/zsyscall_aix_ppc64.go    | 1442 ----------
 .../golang.org/x/sys/unix/zsyscall_aix_ppc64_gc.go | 1192 --------
 .../x/sys/unix/zsyscall_aix_ppc64_gccgo.go         | 1070 -------
 .../x/sys/unix/zsyscall_darwin_386.1_11.go         | 1810 ------------
 .../golang.org/x/sys/unix/zsyscall_darwin_386.go   | 2505 ----------------
 .../golang.org/x/sys/unix/zsyscall_darwin_386.s    |  284 --
 .../x/sys/unix/zsyscall_darwin_amd64.1_11.go       | 1810 ------------
 .../golang.org/x/sys/unix/zsyscall_darwin_amd64.go | 2520 ----------------
 .../golang.org/x/sys/unix/zsyscall_darwin_amd64.s  |  286 --
 .../x/sys/unix/zsyscall_darwin_arm.1_11.go         | 1793 ------------
 .../golang.org/x/sys/unix/zsyscall_darwin_arm.go   | 2483 ----------------
 .../golang.org/x/sys/unix/zsyscall_darwin_arm.s    |  282 --
 .../x/sys/unix/zsyscall_darwin_arm64.1_11.go       | 1793 ------------
 .../golang.org/x/sys/unix/zsyscall_darwin_arm64.go | 2483 ----------------
 .../golang.org/x/sys/unix/zsyscall_darwin_arm64.s  |  282 --
 .../x/sys/unix/zsyscall_dragonfly_amd64.go         | 1659 -----------
 .../golang.org/x/sys/unix/zsyscall_freebsd_386.go  | 2015 -------------
 .../x/sys/unix/zsyscall_freebsd_amd64.go           | 2015 -------------
 .../golang.org/x/sys/unix/zsyscall_freebsd_arm.go  | 2015 -------------
 .../x/sys/unix/zsyscall_freebsd_arm64.go           | 2015 -------------
 .../golang.org/x/sys/unix/zsyscall_linux_386.go    | 2246 ---------------
 .../golang.org/x/sys/unix/zsyscall_linux_amd64.go  | 2413 ----------------
 .../golang.org/x/sys/unix/zsyscall_linux_arm.go    | 2383 ----------------
 .../golang.org/x/sys/unix/zsyscall_linux_arm64.go  | 2270 ---------------
 .../golang.org/x/sys/unix/zsyscall_linux_mips.go   | 2426 ----------------
 .../golang.org/x/sys/unix/zsyscall_linux_mips64.go | 2397 ----------------
 .../x/sys/unix/zsyscall_linux_mips64le.go          | 2397 ----------------
 .../golang.org/x/sys/unix/zsyscall_linux_mipsle.go | 2426 ----------------
 .../golang.org/x/sys/unix/zsyscall_linux_ppc64.go  | 2475 ----------------
 .../x/sys/unix/zsyscall_linux_ppc64le.go           | 2475 ----------------
 .../x/sys/unix/zsyscall_linux_riscv64.go           | 2250 ---------------
 .../golang.org/x/sys/unix/zsyscall_linux_s390x.go  | 2245 ---------------
 .../x/sys/unix/zsyscall_linux_sparc64.go           | 2408 ----------------
 .../golang.org/x/sys/unix/zsyscall_netbsd_386.go   | 1826 ------------
 .../golang.org/x/sys/unix/zsyscall_netbsd_amd64.go | 1826 ------------
 .../golang.org/x/sys/unix/zsyscall_netbsd_arm.go   | 1826 ------------
 .../golang.org/x/sys/unix/zsyscall_netbsd_arm64.go | 1826 ------------
 .../golang.org/x/sys/unix/zsyscall_openbsd_386.go  | 1692 -----------
 .../x/sys/unix/zsyscall_openbsd_amd64.go           | 1692 -----------
 .../golang.org/x/sys/unix/zsyscall_openbsd_arm.go  | 1692 -----------
 .../x/sys/unix/zsyscall_openbsd_arm64.go           | 1692 -----------
 .../x/sys/unix/zsyscall_solaris_amd64.go           | 1953 -------------
 .../golang.org/x/sys/unix/zsysctl_openbsd_386.go   |  272 --
 .../golang.org/x/sys/unix/zsysctl_openbsd_amd64.go |  270 --
 .../golang.org/x/sys/unix/zsysctl_openbsd_arm.go   |  272 --
 .../golang.org/x/sys/unix/zsysctl_openbsd_arm64.go |  275 --
 .../golang.org/x/sys/unix/zsysnum_darwin_386.go    |  436 ---
 .../golang.org/x/sys/unix/zsysnum_darwin_amd64.go  |  438 ---
 .../golang.org/x/sys/unix/zsysnum_darwin_arm.go    |  436 ---
 .../golang.org/x/sys/unix/zsysnum_darwin_arm64.go  |  436 ---
 .../x/sys/unix/zsysnum_dragonfly_amd64.go          |  315 --
 .../golang.org/x/sys/unix/zsysnum_freebsd_386.go   |  403 ---
 .../golang.org/x/sys/unix/zsysnum_freebsd_amd64.go |  403 ---
 .../golang.org/x/sys/unix/zsysnum_freebsd_arm.go   |  403 ---
 .../golang.org/x/sys/unix/zsysnum_freebsd_arm64.go |  395 ---
 .../golang.org/x/sys/unix/zsysnum_linux_386.go     |  426 ---
 .../golang.org/x/sys/unix/zsysnum_linux_amd64.go   |  348 ---
 .../golang.org/x/sys/unix/zsysnum_linux_arm.go     |  390 ---
 .../golang.org/x/sys/unix/zsysnum_linux_arm64.go   |  293 --
 .../golang.org/x/sys/unix/zsysnum_linux_mips.go    |  411 ---
 .../golang.org/x/sys/unix/zsysnum_linux_mips64.go  |  341 ---
 .../x/sys/unix/zsysnum_linux_mips64le.go           |  341 ---
 .../golang.org/x/sys/unix/zsysnum_linux_mipsle.go  |  411 ---
 .../golang.org/x/sys/unix/zsysnum_linux_ppc64.go   |  390 ---
 .../golang.org/x/sys/unix/zsysnum_linux_ppc64le.go |  390 ---
 .../golang.org/x/sys/unix/zsysnum_linux_riscv64.go |  292 --
 .../golang.org/x/sys/unix/zsysnum_linux_s390x.go   |  355 ---
 .../golang.org/x/sys/unix/zsysnum_linux_sparc64.go |  370 ---
 .../golang.org/x/sys/unix/zsysnum_netbsd_386.go    |  274 --
 .../golang.org/x/sys/unix/zsysnum_netbsd_amd64.go  |  274 --
 .../golang.org/x/sys/unix/zsysnum_netbsd_arm.go    |  274 --
 .../golang.org/x/sys/unix/zsysnum_netbsd_arm64.go  |  274 --
 .../golang.org/x/sys/unix/zsysnum_openbsd_386.go   |  218 --
 .../golang.org/x/sys/unix/zsysnum_openbsd_amd64.go |  218 --
 .../golang.org/x/sys/unix/zsysnum_openbsd_arm.go   |  218 --
 .../golang.org/x/sys/unix/zsysnum_openbsd_arm64.go |  217 --
 src/vendor/golang.org/x/sys/unix/ztypes_aix_ppc.go |  345 ---
 .../golang.org/x/sys/unix/ztypes_aix_ppc64.go      |  350 ---
 .../golang.org/x/sys/unix/ztypes_darwin_386.go     |  499 ----
 .../golang.org/x/sys/unix/ztypes_darwin_amd64.go   |  509 ----
 .../golang.org/x/sys/unix/ztypes_darwin_arm.go     |  500 ----
 .../golang.org/x/sys/unix/ztypes_darwin_arm64.go   |  509 ----
 .../x/sys/unix/ztypes_dragonfly_amd64.go           |  469 ---
 .../golang.org/x/sys/unix/ztypes_freebsd_386.go    |  603 ----
 .../golang.org/x/sys/unix/ztypes_freebsd_amd64.go  |  602 ----
 .../golang.org/x/sys/unix/ztypes_freebsd_arm.go    |  602 ----
 .../golang.org/x/sys/unix/ztypes_freebsd_arm64.go  |  602 ----
 .../golang.org/x/sys/unix/ztypes_linux_386.go      | 2467 ----------------
 .../golang.org/x/sys/unix/ztypes_linux_amd64.go    | 2480 ----------------
 .../golang.org/x/sys/unix/ztypes_linux_arm.go      | 2458 ----------------
 .../golang.org/x/sys/unix/ztypes_linux_arm64.go    | 2459 ----------------
 .../golang.org/x/sys/unix/ztypes_linux_mips.go     | 2464 ----------------
 .../golang.org/x/sys/unix/ztypes_linux_mips64.go   | 2461 ----------------
 .../golang.org/x/sys/unix/ztypes_linux_mips64le.go | 2461 ----------------
 .../golang.org/x/sys/unix/ztypes_linux_mipsle.go   | 2464 ----------------
 .../golang.org/x/sys/unix/ztypes_linux_ppc64.go    | 2469 ----------------
 .../golang.org/x/sys/unix/ztypes_linux_ppc64le.go  | 2469 ----------------
 .../golang.org/x/sys/unix/ztypes_linux_riscv64.go  | 2486 ----------------
 .../golang.org/x/sys/unix/ztypes_linux_s390x.go    | 2483 ----------------
 .../golang.org/x/sys/unix/ztypes_linux_sparc64.go  | 2464 ----------------
 .../golang.org/x/sys/unix/ztypes_netbsd_386.go     |  465 ---
 .../golang.org/x/sys/unix/ztypes_netbsd_amd64.go   |  472 ---
 .../golang.org/x/sys/unix/ztypes_netbsd_arm.go     |  470 ---
 .../golang.org/x/sys/unix/ztypes_netbsd_arm64.go   |  472 ---
 .../golang.org/x/sys/unix/ztypes_openbsd_386.go    |  570 ----
 .../golang.org/x/sys/unix/ztypes_openbsd_amd64.go  |  570 ----
 .../golang.org/x/sys/unix/ztypes_openbsd_arm.go    |  571 ----
 .../golang.org/x/sys/unix/ztypes_openbsd_arm64.go  |  564 ----
 .../golang.org/x/sys/unix/ztypes_solaris_amd64.go  |  442 ---
 src/vendor/modules.txt                             |    7 +-
 test/codegen/stack.go                              |    5 +
 test/fixedbugs/issue15609.go                       |    2 +
 test/fixedbugs/issue22326.go                       |   25 +
 test/fixedbugs/issue22326.out                      |    1 +
 test/fixedbugs/issue25897a.go                      |   34 +
 test/fixedbugs/issue25897b.go                      |   38 +
 test/fixedbugs/issue27732a.go                      |   23 +
 test/fixedbugs/issue29218.go                       |   24 +
 test/fixedbugs/issue32288.go                       |   48 +
 test/fixedbugs/issue32347.go                       |   18 +
 test/fixedbugs/issue32477.go                       |   71 +
 test/fixedbugs/issue32560.go                       |   51 +
 test/live.go                                       |    2 +-
 662 files changed, 9757 insertions(+), 227001 deletions(-)

diff --cc src/crypto/ecdsa/ecdsa.go
index 0e6bb8b23f,ddc3b35ba3..be01a29606
--- a/src/crypto/ecdsa/ecdsa.go
+++ b/src/crypto/ecdsa/ecdsa.go
@@@ -26,15 -27,8 +27,13 @@@ import 
  	"errors"
  	"io"
  	"math/big"
- 
- 	"crypto/internal/randutil"
  )
  
 +import (
 +	"crypto/internal/boring"
 +	"unsafe"
 +)
 +
  // A invertible implements fast inverse mod Curve.Params().N
  type invertible interface {
  	// Inverse returns the inverse of k in GF(P)
diff --cc src/crypto/tls/boring.go
index 95256b19f7,0000000000..5b5c20ce1f
mode 100644,000000..100644
--- a/src/crypto/tls/boring.go
+++ b/src/crypto/tls/boring.go
@@@ -1,128 -1,0 +1,137 @@@
 +// Copyright 2017 The Go Authors. All rights reserved.
 +// Use of this source code is governed by a BSD-style
 +// license that can be found in the LICENSE file.
 +
 +package tls
 +
 +import (
 +	"crypto/ecdsa"
 +	"crypto/internal/boring/fipstls"
 +	"crypto/rsa"
 +	"crypto/x509"
 +)
 +
 +// needFIPS returns fipstls.Required(); it avoids a new import in common.go.
 +func needFIPS() bool {
 +	return fipstls.Required()
 +}
 +
 +// fipsMinVersion replaces c.minVersion in FIPS-only mode.
 +func fipsMinVersion(c *Config) uint16 {
 +	// FIPS requires TLS 1.2.
 +	return VersionTLS12
 +}
 +
 +// fipsMaxVersion replaces c.maxVersion in FIPS-only mode.
 +func fipsMaxVersion(c *Config) uint16 {
 +	// FIPS requires TLS 1.2.
 +	return VersionTLS12
 +}
 +
 +// default defaultFIPSCurvePreferences is the FIPS-allowed curves,
 +// in preference order (most preferable first).
 +var defaultFIPSCurvePreferences = []CurveID{CurveP256, CurveP384, CurveP521}
 +
 +// fipsCurvePreferences replaces c.curvePreferences in FIPS-only mode.
 +func fipsCurvePreferences(c *Config) []CurveID {
 +	if c == nil || len(c.CurvePreferences) == 0 {
 +		return defaultFIPSCurvePreferences
 +	}
 +	var list []CurveID
 +	for _, id := range c.CurvePreferences {
 +		for _, allowed := range defaultFIPSCurvePreferences {
 +			if id == allowed {
 +				list = append(list, id)
 +				break
 +			}
 +		}
 +	}
 +	return list
 +}
 +
 +// default FIPSCipherSuites is the FIPS-allowed cipher suites,
 +// in preference order (most preferable first).
 +var defaultFIPSCipherSuites = []uint16{
 +	TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,
 +	TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,
 +	TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,
 +	TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,
 +	TLS_RSA_WITH_AES_128_GCM_SHA256,
 +	TLS_RSA_WITH_AES_256_GCM_SHA384,
 +}
 +
 +// fipsCipherSuites replaces c.cipherSuites in FIPS-only mode.
 +func fipsCipherSuites(c *Config) []uint16 {
 +	if c == nil || c.CipherSuites == nil {
 +		return defaultFIPSCipherSuites
 +	}
 +	var list []uint16
 +	for _, id := range c.CipherSuites {
 +		for _, allowed := range defaultFIPSCipherSuites {
 +			if id == allowed {
 +				list = append(list, id)
 +				break
 +			}
 +		}
 +	}
 +	return list
 +}
 +
 +// isBoringCertificate reports whether a certificate may be used
 +// when constructing a verified chain.
 +// It is called for each leaf, intermediate, and root certificate.
 +func isBoringCertificate(c *x509.Certificate) bool {
 +	if !needFIPS() {
 +		// Everything is OK if we haven't forced FIPS-only mode.
 +		return true
 +	}
 +
 +	// Otherwise the key must be RSA 2048, RSA 3072, or ECDSA P-256.
 +	switch k := c.PublicKey.(type) {
 +	default:
 +		return false
 +	case *rsa.PublicKey:
 +		if size := k.N.BitLen(); size != 2048 && size != 3072 {
 +			return false
 +		}
 +	case *ecdsa.PublicKey:
 +		if name := k.Curve.Params().Name; name != "P-256" && name != "P-384" {
 +			return false
 +		}
 +	}
 +
 +	return true
 +}
 +
 +// fipsSupportedSignatureAlgorithms currently are a subset of
 +// defaultSupportedSignatureAlgorithms without Ed25519 and SHA-1.
 +var fipsSupportedSignatureAlgorithms = []SignatureScheme{
 +	PSSWithSHA256,
 +	PSSWithSHA384,
 +	PSSWithSHA512,
 +	PKCS1WithSHA256,
 +	ECDSAWithP256AndSHA256,
 +	PKCS1WithSHA384,
 +	ECDSAWithP384AndSHA384,
 +	PKCS1WithSHA512,
 +	ECDSAWithP521AndSHA512,
 +}
 +
 +// supportedSignatureAlgorithms returns the supported signature algorithms.
 +func supportedSignatureAlgorithms() []SignatureScheme {
 +	if !needFIPS() {
 +		return defaultSupportedSignatureAlgorithms
 +	}
 +	return fipsSupportedSignatureAlgorithms
 +}
 +
++// supportedSignatureAlgorithmsTLS12 returns the supported signature algorithms
++// for TLS 1.2. Issue 32425.
++func supportedSignatureAlgorithmsTLS12() []SignatureScheme {
++	if !needFIPS() {
++		return defaultSupportedSignatureAlgorithmsTLS12
++	}
++	return fipsSupportedSignatureAlgorithms[3:]
++}
++
 +var testingOnlyForceClientHelloSignatureAlgorithms []SignatureScheme
diff --cc src/crypto/tls/boring_test.go
index c785c01fcc,0000000000..74c2636a87
mode 100644,000000..100644
--- a/src/crypto/tls/boring_test.go
+++ b/src/crypto/tls/boring_test.go
@@@ -1,631 -1,0 +1,634 @@@
 +// Copyright 2017 The Go Authors. All rights reserved.
 +// Use of this source code is governed by a BSD-style
 +// license that can be found in the LICENSE file.
 +
 +package tls
 +
 +import (
 +	"crypto/ecdsa"
 +	"crypto/elliptic"
 +	"crypto/internal/boring/fipstls"
 +	"crypto/rand"
 +	"crypto/rsa"
 +	"crypto/x509"
 +	"crypto/x509/pkix"
 +	"encoding/pem"
 +	"fmt"
 +	"math/big"
 +	"net"
 +	"runtime"
 +	"strings"
 +	"testing"
 +	"time"
 +)
 +
 +func TestBoringServerProtocolVersion(t *testing.T) {
 +	test := func(name string, v uint16, msg string) {
 +		t.Run(name, func(t *testing.T) {
 +			serverConfig := testConfig.Clone()
 +			serverConfig.MinVersion = VersionSSL30
 +			clientHello := &clientHelloMsg{
 +				vers:               v,
 +				random:             make([]byte, 32),
 +				cipherSuites:       allCipherSuites(),
 +				compressionMethods: []uint8{compressionNone},
 +				supportedVersions:  []uint16{v},
 +			}
 +			testClientHelloFailure(t, serverConfig, clientHello, msg)
 +		})
 +	}
 +
 +	test("VersionSSL30", VersionSSL30, "")
 +	test("VersionTLS10", VersionTLS10, "")
 +	test("VersionTLS11", VersionTLS11, "")
 +	test("VersionTLS12", VersionTLS12, "")
 +	test("VersionTLS13", VersionTLS13, "")
 +
 +	fipstls.Force()
 +	defer fipstls.Abandon()
 +	test("VersionSSL30", VersionSSL30, "client offered only unsupported versions")
 +	test("VersionTLS10", VersionTLS10, "client offered only unsupported versions")
 +	test("VersionTLS11", VersionTLS11, "client offered only unsupported versions")
 +	test("VersionTLS12", VersionTLS12, "")
 +	test("VersionTLS13", VersionTLS13, "client offered only unsupported versions")
 +}
 +
 +func isBoringVersion(v uint16) bool {
 +	return v == VersionTLS12
 +}
 +
 +func isBoringCipherSuite(id uint16) bool {
 +	switch id {
 +	case TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,
 +		TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,
 +		TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,
 +		TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,
 +		TLS_RSA_WITH_AES_128_GCM_SHA256,
 +		TLS_RSA_WITH_AES_256_GCM_SHA384:
 +		return true
 +	}
 +	return false
 +}
 +
 +func isBoringCurve(id CurveID) bool {
 +	switch id {
 +	case CurveP256, CurveP384, CurveP521:
 +		return true
 +	}
 +	return false
 +}
 +
 +func isECDSA(id uint16) bool {
 +	for _, suite := range cipherSuites {
 +		if suite.id == id {
 +			return suite.flags&suiteECSign == suiteECSign
 +		}
 +	}
 +	panic(fmt.Sprintf("unknown cipher suite %#x", id))
 +}
 +
 +func isBoringSignatureScheme(alg SignatureScheme) bool {
 +	switch alg {
 +	default:
 +		return false
 +	case PKCS1WithSHA256,
 +		ECDSAWithP256AndSHA256,
 +		PKCS1WithSHA384,
 +		ECDSAWithP384AndSHA384,
 +		PKCS1WithSHA512,
 +		ECDSAWithP521AndSHA512,
 +		PSSWithSHA256,
 +		PSSWithSHA384,
 +		PSSWithSHA512:
 +		// ok
 +	}
 +	return true
 +}
 +
 +func TestBoringServerCipherSuites(t *testing.T) {
 +	serverConfig := testConfig.Clone()
 +	serverConfig.CipherSuites = allCipherSuites()
 +	serverConfig.Certificates = make([]Certificate, 1)
 +
 +	for _, id := range allCipherSuites() {
 +		if isECDSA(id) {
 +			serverConfig.Certificates[0].Certificate = [][]byte{testECDSACertificate}
 +			serverConfig.Certificates[0].PrivateKey = testECDSAPrivateKey
 +		} else {
 +			serverConfig.Certificates[0].Certificate = [][]byte{testRSACertificate}
 +			serverConfig.Certificates[0].PrivateKey = testRSAPrivateKey
 +		}
 +		serverConfig.BuildNameToCertificate()
 +		t.Run(fmt.Sprintf("suite=%#x", id), func(t *testing.T) {
 +			clientHello := &clientHelloMsg{
 +				vers:               VersionTLS12,
 +				random:             make([]byte, 32),
 +				cipherSuites:       []uint16{id},
 +				compressionMethods: []uint8{compressionNone},
 +				supportedCurves:    defaultCurvePreferences,
 +				supportedPoints:    []uint8{pointFormatUncompressed},
 +			}
 +
 +			testClientHello(t, serverConfig, clientHello)
 +			t.Run("fipstls", func(t *testing.T) {
 +				fipstls.Force()
 +				defer fipstls.Abandon()
 +				msg := ""
 +				if !isBoringCipherSuite(id) {
 +					msg = "no cipher suite supported by both client and server"
 +				}
 +				testClientHelloFailure(t, serverConfig, clientHello, msg)
 +			})
 +		})
 +	}
 +}
 +
 +func TestBoringServerCurves(t *testing.T) {
 +	serverConfig := testConfig.Clone()
 +	serverConfig.Certificates = make([]Certificate, 1)
 +	serverConfig.Certificates[0].Certificate = [][]byte{testECDSACertificate}
 +	serverConfig.Certificates[0].PrivateKey = testECDSAPrivateKey
 +	serverConfig.BuildNameToCertificate()
 +
 +	for _, curveid := range defaultCurvePreferences {
 +		t.Run(fmt.Sprintf("curve=%d", curveid), func(t *testing.T) {
 +			clientHello := &clientHelloMsg{
 +				vers:               VersionTLS12,
 +				random:             make([]byte, 32),
 +				cipherSuites:       []uint16{TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256},
 +				compressionMethods: []uint8{compressionNone},
 +				supportedCurves:    []CurveID{curveid},
 +				supportedPoints:    []uint8{pointFormatUncompressed},
 +			}
 +
 +			testClientHello(t, serverConfig, clientHello)
 +
 +			// With fipstls forced, bad curves should be rejected.
 +			t.Run("fipstls", func(t *testing.T) {
 +				fipstls.Force()
 +				defer fipstls.Abandon()
 +				msg := ""
 +				if !isBoringCurve(curveid) {
 +					msg = "no cipher suite supported by both client and server"
 +				}
 +				testClientHelloFailure(t, serverConfig, clientHello, msg)
 +			})
 +		})
 +	}
 +}
 +
 +func boringHandshake(t *testing.T, clientConfig, serverConfig *Config) (clientErr, serverErr error) {
 +	c, s := localPipe(t)
 +	client := Client(c, clientConfig)
 +	server := Server(s, serverConfig)
 +	done := make(chan error, 1)
 +	go func() {
 +		done <- client.Handshake()
 +		c.Close()
 +	}()
 +	serverErr = server.Handshake()
 +	s.Close()
 +	clientErr = <-done
 +	return
 +}
 +
 +func TestBoringServerSignatureAndHash(t *testing.T) {
- 	serverConfig := testConfig.Clone()
- 	serverConfig.Certificates = make([]Certificate, 1)
- 
 +	defer func() {
 +		testingOnlyForceClientHelloSignatureAlgorithms = nil
 +	}()
 +
 +	for _, sigHash := range defaultSupportedSignatureAlgorithms {
- 		testingOnlyForceClientHelloSignatureAlgorithms = []SignatureScheme{sigHash}
- 
 +		t.Run(fmt.Sprintf("%#x", sigHash), func(t *testing.T) {
- 			switch sigHash {
- 			case PKCS1WithSHA1, PKCS1WithSHA256, PKCS1WithSHA384, PKCS1WithSHA512,
- 				PSSWithSHA256, PSSWithSHA384, PSSWithSHA512:
++			serverConfig := testConfig.Clone()
++			serverConfig.Certificates = make([]Certificate, 1)
++
++			testingOnlyForceClientHelloSignatureAlgorithms = []SignatureScheme{sigHash}
++
++			switch signatureFromSignatureScheme(sigHash) {
++			case signaturePKCS1v15, signatureRSAPSS:
 +				serverConfig.CipherSuites = []uint16{TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256}
 +				serverConfig.Certificates[0].Certificate = [][]byte{testRSA2048Certificate}
 +				serverConfig.Certificates[0].PrivateKey = testRSA2048PrivateKey
- 			case Ed25519:
++			case signatureEd25519:
 +				serverConfig.CipherSuites = []uint16{TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256}
 +				serverConfig.Certificates[0].Certificate = [][]byte{testEd25519Certificate}
 +				serverConfig.Certificates[0].PrivateKey = testEd25519PrivateKey
- 			default:
++			case signatureECDSA:
 +				serverConfig.CipherSuites = []uint16{TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256}
 +				serverConfig.Certificates[0].Certificate = [][]byte{testECDSACertificate}
 +				serverConfig.Certificates[0].PrivateKey = testECDSAPrivateKey
 +			}
 +			serverConfig.BuildNameToCertificate()
 +			// PKCS#1 v1.5 signature algorithms can't be used standalone in TLS
 +			// 1.3, and the ECDSA ones bind to the curve used.
- 			serverConfig.MaxVersion = VersionTLS12
++			// RSA-PSS signatures are not supported in TLS 1.2. Issue 32425.
++			if signatureFromSignatureScheme(sigHash) != signatureRSAPSS {
++				serverConfig.MaxVersion = VersionTLS12
++			}
 +
 +			clientErr, serverErr := boringHandshake(t, testConfig, serverConfig)
 +			if clientErr != nil {
 +				t.Fatalf("expected handshake with %#x to succeed; client error: %v; server error: %v", sigHash, clientErr, serverErr)
 +			}
 +
 +			// With fipstls forced, bad curves should be rejected.
 +			t.Run("fipstls", func(t *testing.T) {
 +				fipstls.Force()
 +				defer fipstls.Abandon()
 +				clientErr, _ := boringHandshake(t, testConfig, serverConfig)
- 				if isBoringSignatureScheme(sigHash) {
++				// RSA-PSS is only supported in TLS 1.3, prohibited by forcing fipstls. Issue 32425.
++				if isBoringSignatureScheme(sigHash) && signatureFromSignatureScheme(sigHash) != signatureRSAPSS {
 +					if clientErr != nil {
 +						t.Fatalf("expected handshake with %#x to succeed; err=%v", sigHash, clientErr)
 +					}
 +				} else {
 +					if clientErr == nil {
 +						t.Fatalf("expected handshake with %#x to fail, but it succeeded", sigHash)
 +					}
 +				}
 +			})
 +		})
 +	}
 +}
 +
 +func TestBoringClientHello(t *testing.T) {
 +	// Test that no matter what we put in the client config,
 +	// the client does not offer non-FIPS configurations.
 +	fipstls.Force()
 +	defer fipstls.Abandon()
 +
 +	c, s := net.Pipe()
 +	defer c.Close()
 +	defer s.Close()
 +
 +	clientConfig := testConfig.Clone()
 +	// All sorts of traps for the client to avoid.
 +	clientConfig.MinVersion = VersionSSL30
 +	clientConfig.MaxVersion = VersionTLS13
 +	clientConfig.CipherSuites = allCipherSuites()
 +	clientConfig.CurvePreferences = defaultCurvePreferences
 +
 +	go Client(c, testConfig).Handshake()
 +	srv := Server(s, testConfig)
 +	msg, err := srv.readHandshake()
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +	hello, ok := msg.(*clientHelloMsg)
 +	if !ok {
 +		t.Fatalf("unexpected message type %T", msg)
 +	}
 +
 +	if !isBoringVersion(hello.vers) {
 +		t.Errorf("client vers=%#x, want %#x (TLS 1.2)", hello.vers, VersionTLS12)
 +	}
 +	for _, v := range hello.supportedVersions {
 +		if !isBoringVersion(v) {
 +			t.Errorf("client offered disallowed version %#x", v)
 +		}
 +	}
 +	for _, id := range hello.cipherSuites {
 +		if !isBoringCipherSuite(id) {
 +			t.Errorf("client offered disallowed suite %#x", id)
 +		}
 +	}
 +	for _, id := range hello.supportedCurves {
 +		if !isBoringCurve(id) {
 +			t.Errorf("client offered disallowed curve %d", id)
 +		}
 +	}
 +	for _, sigHash := range hello.supportedSignatureAlgorithms {
 +		if !isBoringSignatureScheme(sigHash) {
 +			t.Errorf("client offered disallowed signature-and-hash %v", sigHash)
 +		}
 +	}
 +}
 +
 +func TestBoringCertAlgs(t *testing.T) {
 +	// NaCl, arm and wasm time out generating keys. Nothing in this test is architecture-specific, so just don't bother on those.
 +	if runtime.GOOS == "nacl" || runtime.GOARCH == "arm" || runtime.GOOS == "js" {
 +		t.Skipf("skipping on %s/%s because key generation takes too long", runtime.GOOS, runtime.GOARCH)
 +	}
 +
 +	// Set up some roots, intermediate CAs, and leaf certs with various algorithms.
 +	// X_Y is X signed by Y.
 +	R1 := boringCert(t, "R1", boringRSAKey(t, 2048), nil, boringCertCA|boringCertFIPSOK)
 +	R2 := boringCert(t, "R2", boringRSAKey(t, 4096), nil, boringCertCA)
 +
 +	M1_R1 := boringCert(t, "M1_R1", boringECDSAKey(t, elliptic.P256()), R1, boringCertCA|boringCertFIPSOK)
 +	M2_R1 := boringCert(t, "M2_R1", boringECDSAKey(t, elliptic.P224()), R1, boringCertCA)
 +
 +	I_R1 := boringCert(t, "I_R1", boringRSAKey(t, 3072), R1, boringCertCA|boringCertFIPSOK)
 +	I_R2 := boringCert(t, "I_R2", I_R1.key, R2, boringCertCA|boringCertFIPSOK)
 +	I_M1 := boringCert(t, "I_M1", I_R1.key, M1_R1, boringCertCA|boringCertFIPSOK)
 +	I_M2 := boringCert(t, "I_M2", I_R1.key, M2_R1, boringCertCA|boringCertFIPSOK)
 +
 +	L1_I := boringCert(t, "L1_I", boringECDSAKey(t, elliptic.P384()), I_R1, boringCertLeaf|boringCertFIPSOK)
 +	L2_I := boringCert(t, "L2_I", boringRSAKey(t, 1024), I_R1, boringCertLeaf)
 +
 +	// boringCert checked that isBoringCertificate matches the caller's boringCertFIPSOK bit.
 +	// If not, no point in building bigger end-to-end tests.
 +	if t.Failed() {
 +		t.Fatalf("isBoringCertificate failures; not continuing")
 +	}
 +
 +	// client verifying server cert
 +	testServerCert := func(t *testing.T, desc string, pool *x509.CertPool, key interface{}, list [][]byte, ok bool) {
 +		clientConfig := testConfig.Clone()
 +		clientConfig.RootCAs = pool
 +		clientConfig.InsecureSkipVerify = false
 +		clientConfig.ServerName = "example.com"
 +
 +		serverConfig := testConfig.Clone()
 +		serverConfig.Certificates = []Certificate{{Certificate: list, PrivateKey: key}}
 +		serverConfig.BuildNameToCertificate()
 +
 +		clientErr, _ := boringHandshake(t, clientConfig, serverConfig)
 +
 +		if (clientErr == nil) == ok {
 +			if ok {
 +				t.Logf("%s: accept", desc)
 +			} else {
 +				t.Logf("%s: reject", desc)
 +			}
 +		} else {
 +			if ok {
 +				t.Errorf("%s: BAD reject (%v)", desc, clientErr)
 +			} else {
 +				t.Errorf("%s: BAD accept", desc)
 +			}
 +		}
 +	}
 +
 +	// server verifying client cert
 +	testClientCert := func(t *testing.T, desc string, pool *x509.CertPool, key interface{}, list [][]byte, ok bool) {
 +		clientConfig := testConfig.Clone()
 +		clientConfig.ServerName = "example.com"
 +		clientConfig.Certificates = []Certificate{{Certificate: list, PrivateKey: key}}
 +
 +		serverConfig := testConfig.Clone()
 +		serverConfig.ClientCAs = pool
 +		serverConfig.ClientAuth = RequireAndVerifyClientCert
 +
 +		_, serverErr := boringHandshake(t, clientConfig, serverConfig)
 +
 +		if (serverErr == nil) == ok {
 +			if ok {
 +				t.Logf("%s: accept", desc)
 +			} else {
 +				t.Logf("%s: reject", desc)
 +			}
 +		} else {
 +			if ok {
 +				t.Errorf("%s: BAD reject (%v)", desc, serverErr)
 +			} else {
 +				t.Errorf("%s: BAD accept", desc)
 +			}
 +		}
 +	}
 +
 +	// Run simple basic test with known answers before proceeding to
 +	// exhaustive test with computed answers.
 +	r1pool := x509.NewCertPool()
 +	r1pool.AddCert(R1.cert)
 +	testServerCert(t, "basic", r1pool, L2_I.key, [][]byte{L2_I.der, I_R1.der}, true)
 +	testClientCert(t, "basic (client cert)", r1pool, L2_I.key, [][]byte{L2_I.der, I_R1.der}, true)
 +	fipstls.Force()
 +	testServerCert(t, "basic (fips)", r1pool, L2_I.key, [][]byte{L2_I.der, I_R1.der}, false)
 +	testClientCert(t, "basic (fips, client cert)", r1pool, L2_I.key, [][]byte{L2_I.der, I_R1.der}, false)
 +	fipstls.Abandon()
 +
 +	if t.Failed() {
 +		t.Fatal("basic test failed, skipping exhaustive test")
 +	}
 +
 +	if testing.Short() {
 +		t.Logf("basic test passed; skipping exhaustive test in -short mode")
 +		return
 +	}
 +
 +	for l := 1; l <= 2; l++ {
 +		leaf := L1_I
 +		if l == 2 {
 +			leaf = L2_I
 +		}
 +		for i := 0; i < 64; i++ {
 +			reachable := map[string]bool{leaf.parentOrg: true}
 +			reachableFIPS := map[string]bool{leaf.parentOrg: leaf.fipsOK}
 +			list := [][]byte{leaf.der}
 +			listName := leaf.name
 +			addList := func(cond int, c *boringCertificate) {
 +				if cond != 0 {
 +					list = append(list, c.der)
 +					listName += "," + c.name
 +					if reachable[c.org] {
 +						reachable[c.parentOrg] = true
 +					}
 +					if reachableFIPS[c.org] && c.fipsOK {
 +						reachableFIPS[c.parentOrg] = true
 +					}
 +				}
 +			}
 +			addList(i&1, I_R1)
 +			addList(i&2, I_R2)
 +			addList(i&4, I_M1)
 +			addList(i&8, I_M2)
 +			addList(i&16, M1_R1)
 +			addList(i&32, M2_R1)
 +
 +			for r := 1; r <= 3; r++ {
 +				pool := x509.NewCertPool()
 +				rootName := ","
 +				shouldVerify := false
 +				shouldVerifyFIPS := false
 +				addRoot := func(cond int, c *boringCertificate) {
 +					if cond != 0 {
 +						rootName += "," + c.name
 +						pool.AddCert(c.cert)
 +						if reachable[c.org] {
 +							shouldVerify = true
 +						}
 +						if reachableFIPS[c.org] && c.fipsOK {
 +							shouldVerifyFIPS = true
 +						}
 +					}
 +				}
 +				addRoot(r&1, R1)
 +				addRoot(r&2, R2)
 +				rootName = rootName[1:] // strip leading comma
 +				testServerCert(t, listName+"->"+rootName[1:], pool, leaf.key, list, shouldVerify)
 +				testClientCert(t, listName+"->"+rootName[1:]+"(client cert)", pool, leaf.key, list, shouldVerify)
 +				fipstls.Force()
 +				testServerCert(t, listName+"->"+rootName[1:]+" (fips)", pool, leaf.key, list, shouldVerifyFIPS)
 +				testClientCert(t, listName+"->"+rootName[1:]+" (fips, client cert)", pool, leaf.key, list, shouldVerifyFIPS)
 +				fipstls.Abandon()
 +			}
 +		}
 +	}
 +}
 +
 +const (
 +	boringCertCA = iota
 +	boringCertLeaf
 +	boringCertFIPSOK = 0x80
 +)
 +
 +func boringRSAKey(t *testing.T, size int) *rsa.PrivateKey {
 +	k, err := rsa.GenerateKey(rand.Reader, size)
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +	return k
 +}
 +
 +func boringECDSAKey(t *testing.T, curve elliptic.Curve) *ecdsa.PrivateKey {
 +	k, err := ecdsa.GenerateKey(curve, rand.Reader)
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +	return k
 +}
 +
 +type boringCertificate struct {
 +	name      string
 +	org       string
 +	parentOrg string
 +	der       []byte
 +	cert      *x509.Certificate
 +	key       interface{}
 +	fipsOK    bool
 +}
 +
 +func boringCert(t *testing.T, name string, key interface{}, parent *boringCertificate, mode int) *boringCertificate {
 +	org := name
 +	parentOrg := ""
 +	if i := strings.Index(org, "_"); i >= 0 {
 +		org = org[:i]
 +		parentOrg = name[i+1:]
 +	}
 +	tmpl := &x509.Certificate{
 +		SerialNumber: big.NewInt(1),
 +		Subject: pkix.Name{
 +			Organization: []string{org},
 +		},
 +		NotBefore: time.Unix(0, 0),
 +		NotAfter:  time.Unix(0, 0),
 +
 +		KeyUsage:              x509.KeyUsageKeyEncipherment | x509.KeyUsageDigitalSignature,
 +		ExtKeyUsage:           []x509.ExtKeyUsage{x509.ExtKeyUsageServerAuth, x509.ExtKeyUsageClientAuth},
 +		BasicConstraintsValid: true,
 +	}
 +	if mode&^boringCertFIPSOK == boringCertLeaf {
 +		tmpl.DNSNames = []string{"example.com"}
 +	} else {
 +		tmpl.IsCA = true
 +		tmpl.KeyUsage |= x509.KeyUsageCertSign
 +	}
 +
 +	var pcert *x509.Certificate
 +	var pkey interface{}
 +	if parent != nil {
 +		pcert = parent.cert
 +		pkey = parent.key
 +	} else {
 +		pcert = tmpl
 +		pkey = key
 +	}
 +
 +	var pub interface{}
 +	var desc string
 +	switch k := key.(type) {
 +	case *rsa.PrivateKey:
 +		pub = &k.PublicKey
 +		desc = fmt.Sprintf("RSA-%d", k.N.BitLen())
 +	case *ecdsa.PrivateKey:
 +		pub = &k.PublicKey
 +		desc = "ECDSA-" + k.Curve.Params().Name
 +	default:
 +		t.Fatalf("invalid key %T", key)
 +	}
 +
 +	der, err := x509.CreateCertificate(rand.Reader, tmpl, pcert, pub, pkey)
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +	cert, err := x509.ParseCertificate(der)
 +	if err != nil {
 +		t.Fatal(err)
 +	}
 +
 +	// Tell isBoringCertificate to enforce FIPS restrictions for this check.
 +	fipstls.Force()
 +	defer fipstls.Abandon()
 +
 +	fipsOK := mode&boringCertFIPSOK != 0
 +	if isBoringCertificate(cert) != fipsOK {
 +		t.Errorf("isBoringCertificate(cert with %s key) = %v, want %v", desc, !fipsOK, fipsOK)
 +	}
 +	return &boringCertificate{name, org, parentOrg, der, cert, key, fipsOK}
 +}
 +
 +// A self-signed test certificate with an RSA key of size 2048, for testing
 +// RSA-PSS with SHA512. SAN of example.golang.
 +var (
 +	testRSA2048Certificate []byte
 +	testRSA2048PrivateKey  *rsa.PrivateKey
 +)
 +
 +func init() {
 +	block, _ := pem.Decode([]byte(`
 +-----BEGIN CERTIFICATE-----
 +MIIC/zCCAeegAwIBAgIRALHHX/kh4+4zMU9DarzBEcQwDQYJKoZIhvcNAQELBQAw
 +EjEQMA4GA1UEChMHQWNtZSBDbzAeFw0xMTAxMDExNTA0MDVaFw0yMDEyMjkxNTA0
 +MDVaMBIxEDAOBgNVBAoTB0FjbWUgQ28wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw
 +ggEKAoIBAQCf8fk0N6ieCBX4IOVIfKitt4kGcOQLeimCfsjqqHcysMIVGEtFSM6E
 +4Ay141f/7IqdW0UtIqNb4PXhROID7yDxR284xL6XbCuv/t5hP3UcehYc3hmLiyVd
 +MkZQiZWtfUUJf/1qOtM+ohNg59LRWp4d+6iX0la1JL3EwCIckkNjJ9hQbF7Pb2CS
 ++ES9Yo55KAap8KOblpcR8MBSN38bqnwjfQdCXvOEOjam2HUxKzEFX5MA+fA0me4C
 +ioCcCRLWKl+GoN9F8fABfoZ+T+2eal4DLuO95rXR8SrOIVBh3XFOr/RVhjtXcNVF
 +ZKcvDt6d68V6jAKAYKm5nlj9GPpd4v+rAgMBAAGjUDBOMA4GA1UdDwEB/wQEAwIF
 +oDATBgNVHSUEDDAKBggrBgEFBQcDATAMBgNVHRMBAf8EAjAAMBkGA1UdEQQSMBCC
 +DmV4YW1wbGUuZ29sYW5nMA0GCSqGSIb3DQEBCwUAA4IBAQCOoYsVcFCBhboqe3WH
 +dC6V7XXXECmnjh01r8h80yv0NR379nSD3cw2M+HKvaXysWqrl5hjGVKw0vtwD81r
 +V4JzDu7IfIog5m8+QNC+7LqDZsz88vDKOrsoySVOmUCgmCKFXew+LA+eO/iQEJTr
 +7ensddOeXJEp27Ed5vW+kmWW3Qmglc2Gwy8wFrMDIqnrnOzBA4oCnDEgtXJt0zog
 +nRwbfEMAWi1aQRy5dT9KA3SP9mo5SeTFSzGGHiE4s4gHUe7jvsAFF2qgtD6+wH6s
 +z9b6shxnC7g5IlBKhI7SVB/Uqt2ydJ+kH1YbjMcIq6NAM5eNMKgZuJr3+zwsSgwh
 +GNaE
 +-----END CERTIFICATE-----`))
 +	testRSA2048Certificate = block.Bytes
 +
 +	block, _ = pem.Decode([]byte(`
 +-----BEGIN RSA PRIVATE KEY-----
 +MIIEpAIBAAKCAQEAn/H5NDeonggV+CDlSHyorbeJBnDkC3opgn7I6qh3MrDCFRhL
 +RUjOhOAMteNX/+yKnVtFLSKjW+D14UTiA+8g8UdvOMS+l2wrr/7eYT91HHoWHN4Z
 +i4slXTJGUImVrX1FCX/9ajrTPqITYOfS0VqeHfuol9JWtSS9xMAiHJJDYyfYUGxe
 +z29gkvhEvWKOeSgGqfCjm5aXEfDAUjd/G6p8I30HQl7zhDo2pth1MSsxBV+TAPnw
 +NJnuAoqAnAkS1ipfhqDfRfHwAX6Gfk/tnmpeAy7jvea10fEqziFQYd1xTq/0VYY7
 +V3DVRWSnLw7enevFeowCgGCpuZ5Y/Rj6XeL/qwIDAQABAoIBAQCNpMZifd/vg42h
 +HdCvLuZaYS0R7SunFlpoXEsltGdLFsnp0IfoJZ/ugFQBSAIIfLwMumU6oXA1z7Uv
 +98aIYV61DePrTCDVDFBsHbNmP8JAo8WtbusEbwd5zyoB7LYG2+clkJklWE73KqUq
 +rmI+UJeyScl2Gin7ZTxBXz1WPBk9VwcnwkeaXpgASIBW23fhECM9gnYEEwaBez5T
 +6Me8d1tHtYQv7vsKe7ro9w9/HKrRXejqYKK1LxkhfFriyV+m8LZJZn2nXOa6G3gF
 +Nb8Qk1Uk5PUBENBmyMFJhT4M/uuSq4YtMrrO2gi8Q+fPhuGzc5SshYKRBp0W4P5r
 +mtVCtEFRAoGBAMENBIFLrV2+HsGj0xYFasKov/QPe6HSTR1Hh2IZONp+oK4oszWE
 +jBT4VcnITmpl6tC1Wy4GcrxjNgKIFZAj+1x1LUULdorXkuG8yr0tAhG9zNyfWsSy
 +PrSovC0UVbzr8Jxxla+kQVxEQQqWQxPlEVuL8kXaIDA6Lyt1Hpua2LvPAoGBANQZ
 +c6Lq2T7+BxLxNdi2m8kZzej5kgzBp/XdVsbFWRlebIX2KrFHsrHzT9PUk3DE1vZK
 +M6pzTt94nQhWSkDgCaw1SohElJ3HFIFwcusF1SJAc3pQepd8ug6IYdlpDMLtBj/P
 +/5P6BVUtgo05E4+I/T3iYatmglQxTtlZ0RkSV2llAoGBALOXkKFX7ahPvf0WksDh
 +uTfuFOTPoowgQG0EpgW0wRdCxeg/JLic3lSD0gsttQV2WsRecryWcxaelRg10RmO
 +38BbogmhaF4xvgsSvujOfiZTE8oK1T43M+6NKsIlML3YILbpU/9aJxPWy0s2DqDr
 +cQJhZrlk+pzjBA7Bnf/URdwxAoGAKR/CNw14D+mrL3YLbbiCXiydqxVwxv5pdZdz
 +8thi3TNcsWC4iGURdcVqbfUinVPdJiXe/Kac3WGCeRJaFVgbKAOxLti1RB5MkIhg
 +D8eyupBqk4W1L1gkrxqsdj4TFlxkwMywjl2E2S4YyQ8PBt6V04DoVRZsIKzqz+PF
 +UionPq0CgYBCYXvqioJhPewkOq/Y5wrDBeZW1FQK5QD9W5M8/5zxd4rdvJtjhbJp
 +oOrtvMdrl6upy9Hz4BJD3FXwVFiPFE7jqeNqi0F21viLxBPMMD3UODF6LL5EyLiR
 +9V4xVMS8KXxvg7rxsuqzMPscViaWUL6WNVBhsD2+92dHxSXzz5EJKQ==
 +-----END RSA PRIVATE KEY-----`))
 +	var err error
 +	testRSA2048PrivateKey, err = x509.ParsePKCS1PrivateKey(block.Bytes)
 +	if err != nil {
 +		panic(err)
 +	}
 +}
diff --cc src/crypto/tls/common.go
index 396676328a,d135b1fc99..f7e0f8e164
--- a/src/crypto/tls/common.go
+++ b/src/crypto/tls/common.go
@@@ -184,6 -182,21 +184,21 @@@ var defaultSupportedSignatureAlgorithm
  	ECDSAWithP384AndSHA384,
  	ECDSAWithP521AndSHA512,
  	PKCS1WithSHA1,
+ 	ECDSAWithSHA1,
+ }
+ 
 -// supportedSignatureAlgorithmsTLS12 contains the signature and hash algorithms
++// defaultSupportedSignatureAlgorithmsTLS12 contains the signature and hash algorithms
+ // that are supported in TLS 1.2, where it is possible to distinguish the
+ // protocol version. This is temporary, see Issue 32425.
 -var supportedSignatureAlgorithmsTLS12 = []SignatureScheme{
++var defaultSupportedSignatureAlgorithmsTLS12 = []SignatureScheme{
+ 	PKCS1WithSHA256,
+ 	ECDSAWithP256AndSHA256,
+ 	Ed25519,
+ 	PKCS1WithSHA384,
+ 	PKCS1WithSHA512,
+ 	ECDSAWithP384AndSHA384,
+ 	ECDSAWithP521AndSHA512,
+ 	PKCS1WithSHA1,
  	ECDSAWithSHA1,
  }
  
diff --cc src/crypto/tls/handshake_client.go
index e8f327e23f,ed000eb619..1ff3422148
--- a/src/crypto/tls/handshake_client.go
+++ b/src/crypto/tls/handshake_client.go
@@@ -576,7 -573,7 +576,7 @@@ func (hs *clientHandshakeState) doFullH
  			return fmt.Errorf("tls: client certificate private key of type %T does not implement crypto.Signer", chainToSend.PrivateKey)
  		}
  
- 		signatureAlgorithm, sigType, hashFunc, err := pickSignatureAlgorithm(key.Public(), certReq.supportedSignatureAlgorithms, hs.hello.supportedSignatureAlgorithms, c.vers)
 -		signatureAlgorithm, sigType, hashFunc, err := pickSignatureAlgorithm(key.Public(), certReq.supportedSignatureAlgorithms, supportedSignatureAlgorithmsTLS12, c.vers)
++		signatureAlgorithm, sigType, hashFunc, err := pickSignatureAlgorithm(key.Public(), certReq.supportedSignatureAlgorithms, supportedSignatureAlgorithmsTLS12(), c.vers)
  		if err != nil {
  			c.sendAlert(alertInternalError)
  			return err
diff --cc src/crypto/tls/handshake_server.go
index 969c4babef,a3d8848caf..366c19a0f5
--- a/src/crypto/tls/handshake_server.go
+++ b/src/crypto/tls/handshake_server.go
@@@ -466,7 -467,7 +467,7 @@@ func (hs *serverHandshakeState) doFullH
  		}
  		if c.vers >= VersionTLS12 {
  			certReq.hasSignatureAlgorithm = true
- 			certReq.supportedSignatureAlgorithms = supportedSignatureAlgorithms()
 -			certReq.supportedSignatureAlgorithms = supportedSignatureAlgorithmsTLS12
++			certReq.supportedSignatureAlgorithms = supportedSignatureAlgorithmsTLS12()
  		}
  
  		// An empty list of certificateAuthorities signals to
diff --cc src/crypto/tls/key_agreement.go
index fdf8f803a0,2922017cc4..c92dd2e5b5
--- a/src/crypto/tls/key_agreement.go
+++ b/src/crypto/tls/key_agreement.go
@@@ -185,7 -185,7 +185,7 @@@ NextCandidate
  		return nil, errors.New("tls: certificate private key does not implement crypto.Signer")
  	}
  
- 	signatureAlgorithm, sigType, hashFunc, err := pickSignatureAlgorithm(priv.Public(), clientHello.supportedSignatureAlgorithms, supportedSignatureAlgorithms(), ka.version)
 -	signatureAlgorithm, sigType, hashFunc, err := pickSignatureAlgorithm(priv.Public(), clientHello.supportedSignatureAlgorithms, supportedSignatureAlgorithmsTLS12, ka.version)
++	signatureAlgorithm, sigType, hashFunc, err := pickSignatureAlgorithm(priv.Public(), clientHello.supportedSignatureAlgorithms, supportedSignatureAlgorithmsTLS12(), ka.version)
  	if err != nil {
  		return nil, err
  	}
