commit e126129d7612349874828685c2bcd49de498a1a0
Author: Joel Sing <joel@sing.id.au>
Date:   Mon Aug 19 23:54:17 2024 +1000

    cmd/compile/internal/ssa: combine shift and addition for riscv64 rva22u64
    
    When GORISCV64 enables rva22u64, combined shift and addition using the
    SH1ADD, SH2ADD and SH3ADD instructions that are available via the Zba
    extension. This results in more than 2000 instructions being removed
    from the Go binary on riscv64.
    
    Change-Id: Ia62ae7dda3d8083cff315113421bee73f518eea8
    Reviewed-on: https://go-review.googlesource.com/c/go/+/606636
    LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
    Reviewed-by: Mark Ryan <markdryan@rivosinc.com>
    Reviewed-by: Michael Pratt <mpratt@google.com>
    Reviewed-by: Cherry Mui <cherryyz@google.com>
    Reviewed-by: Meng Zhuo <mengzhuo1203@gmail.com>

 src/cmd/compile/internal/riscv64/ssa.go         |  3 +-
 src/cmd/compile/internal/ssa/_gen/RISCV64.rules |  5 +++
 src/cmd/compile/internal/ssa/_gen/RISCV64Ops.go |  5 +++
 src/cmd/compile/internal/ssa/opGen.go           | 45 +++++++++++++++++++
 src/cmd/compile/internal/ssa/rewriteRISCV64.go  | 57 +++++++++++++++++++++++++
 test/codegen/shift.go                           | 17 ++++++++
 6 files changed, 131 insertions(+), 1 deletion(-)
