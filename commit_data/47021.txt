commit 26713b5fefc158feb1f0f3d5d30627de226f7668
Author: Rob Findley <rfindley@google.com>
Date:   Fri Feb 19 17:37:17 2021 -0500

    go/types: don't write during sanitizeInfo if nothing has changed
    
    In its final phase, the typechecker walks the types it produces to
    ensure that no unexpanded type instances leak through the API. However,
    this also walks shared types (such as those in the universe scope),
    resulting in a potential data race during concurrent typechecking
    passes.
    
    Fix this by being careful not to write if nothing needs to be changed.
    Since any shared types should already be sanitized, this should
    eliminate data races.
    
    For #44434
    
    Change-Id: Iadb2e78863efe0e974e69a00e255f26cfaf9386a
    Reviewed-on: https://go-review.googlesource.com/c/go/+/294411
    Trust: Robert Findley <rfindley@google.com>
    Trust: Robert Griesemer <gri@golang.org>
    Run-TryBot: Robert Findley <rfindley@google.com>
    Reviewed-by: Robert Griesemer <gri@golang.org>
    TryBot-Result: Go Bot <gobot@golang.org>

 src/go/types/sanitize.go | 82 +++++++++++++++++++++++++++++++++++++-----------
 1 file changed, 63 insertions(+), 19 deletions(-)
