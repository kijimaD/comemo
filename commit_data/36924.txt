commit 9e9ff565cdef4ef4db2955f0e96c9e83d452b4af
Author: Lynn Boger <laboger@linux.vnet.ibm.com>
Date:   Thu Mar 29 11:15:18 2018 -0400

    runtime/race: implement race detector for ppc64le
    
    This adds the support to enable the race detector for ppc64le.
    
    Added runtime/race_ppc64le.s to manage the calls from Go to the
    LLVM tsan functions, mostly converting from the Go ABI to the
    PPC64 ABI expected by Clang generated code.
    
    Changed racewalk.go to call racefuncenterfp instead of racefuncenter
    on ppc64le to allow the caller pc to be obtained in the asm code
    before calling the tsan version.
    
    Changed the set up code for racecallbackthunk so it doesn't use
    the autogenerated save and restore of the link register since that
    sequence uses registers inconsistent with the normal ppc64 ABI.
    
    Made various changes to recognize that race is supported for
    ppc64le.
    
    Ensured that tls_g is updated and accessible from race_linux_ppc64le.s
    so that the race ctx can be obtained and passed to tsan functions.
    
    This enables the race tests for ppc64le in cmd/dist/test.go and
    increases the timeout when running the benchmarks with the -race
    option to avoid timing out.
    
    Updates #24354, #23731
    
    Change-Id: Ib97dc7ac313e6313c836dc7d2fb698f9d8fba3ef
    Reviewed-on: https://go-review.googlesource.com/107935
    Run-TryBot: Lynn Boger <laboger@linux.vnet.ibm.com>
    TryBot-Result: Gobot Gobot <gobot@golang.org>
    Reviewed-by: Bryan C. Mills <bcmills@google.com>
    Reviewed-by: Brad Fitzpatrick <bradfitz@golang.org>

 src/cmd/compile/internal/gc/builtin.go         |   1 +
 src/cmd/compile/internal/gc/builtin/runtime.go |   1 +
 src/cmd/compile/internal/gc/racewalk.go        |  27 +-
 src/cmd/dist/test.go                           |   6 +-
 src/cmd/go/internal/work/init.go               |  13 +-
 src/cmd/internal/obj/ppc64/obj9.go             |  16 +-
 src/cmd/link/internal/ld/config.go             |   7 +
 src/race.bash                                  |   4 +-
 src/runtime/asm_ppc64x.s                       |   1 +
 src/runtime/race.go                            |   1 +
 src/runtime/race/race.go                       |   2 +-
 src/runtime/race_ppc64le.s                     | 568 +++++++++++++++++++++++++
 src/runtime/tls_ppc64x.s                       |   2 +-
 13 files changed, 622 insertions(+), 27 deletions(-)
