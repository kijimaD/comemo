commit dc0be727dc6182fb258f9f1048e9a9eef966c563
Author: Filippo Valsorda <filippo@golang.org>
Date:   Sat Nov 3 20:04:44 2018 -0400

    crypto/tls: implement TLS 1.3 middlebox compatibility mode
    
    Looks like the introduction of CCS records in the client second flight
    gave time to s_server to send NewSessionTicket messages in between the
    client application data and close_notify. There seems to be no way of
    turning NewSessionTicket messages off, neither by not sending a
    psk_key_exchange_modes extension, nor by command line flag.
    
    Interleaving the client write like that tickled an issue akin to #18701:
    on Windows, the client reaches Close() before the last record is drained
    from the send buffer, the kernel notices and resets the connection,
    cutting short the last flow. There is no good way of synchronizing this,
    so we sleep for a RTT before calling close, like in CL 75210. Sigh.
    
    Updates #9671
    
    Change-Id: I44dc1cca17b373695b5a18c2741f218af2990bd1
    Reviewed-on: https://go-review.googlesource.com/c/147419
    Run-TryBot: Filippo Valsorda <filippo@golang.org>
    TryBot-Result: Gobot Gobot <gobot@golang.org>
    Reviewed-by: Adam Langley <agl@golang.org>
---
 src/crypto/tls/conn.go                             |   2 +-
 src/crypto/tls/handshake_client_test.go            |  14 +-
 src/crypto/tls/handshake_client_tls13.go           |  22 ++-
 src/crypto/tls/handshake_server_tls13.go           |  21 ++
 .../tls/testdata/Client-TLSv13-AES128-SHA256       | 169 +++++++++-------
 .../tls/testdata/Client-TLSv13-AES256-SHA384       | 173 ++++++++++-------
 src/crypto/tls/testdata/Client-TLSv13-ALPN         | 171 ++++++++++-------
 .../tls/testdata/Client-TLSv13-CHACHA20-SHA256     | 169 +++++++++-------
 src/crypto/tls/testdata/Client-TLSv13-ECDSA        | 159 +++++++++-------
 .../testdata/Client-TLSv13-ExportKeyingMaterial    | 169 +++++++++-------
 .../tls/testdata/Client-TLSv13-HelloRetryRequest   | 205 +++++++++++---------
 src/crypto/tls/testdata/Client-TLSv13-KeyUpdate    | 212 +++++++++++----------
 src/crypto/tls/testdata/Client-TLSv13-P256-ECDHE   | 171 ++++++++++-------
 src/crypto/tls/testdata/Client-TLSv13-X25519-ECDHE | 167 +++++++++-------
 .../tls/testdata/Server-TLSv13-AES128-SHA256       | 150 +++++++--------
 .../tls/testdata/Server-TLSv13-AES256-SHA384       | 154 +++++++--------
 src/crypto/tls/testdata/Server-TLSv13-ALPN         | 156 +++++++--------
 src/crypto/tls/testdata/Server-TLSv13-ALPN-NoMatch | 154 +++++++--------
 .../tls/testdata/Server-TLSv13-CHACHA20-SHA256     | 150 +++++++--------
 .../tls/testdata/Server-TLSv13-ECDHE-ECDSA-AES     | 142 +++++++-------
 .../testdata/Server-TLSv13-ExportKeyingMaterial    | 154 +++++++--------
 .../tls/testdata/Server-TLSv13-HelloRetryRequest   | 181 +++++++++---------
 src/crypto/tls/testdata/Server-TLSv13-P256         | 156 +++++++--------
 src/crypto/tls/testdata/Server-TLSv13-RSA-RSAPSS   | 154 +++++++--------
 src/crypto/tls/testdata/Server-TLSv13-X25519       | 154 +++++++--------
 25 files changed, 1935 insertions(+), 1594 deletions(-)

diff --git a/src/crypto/tls/conn.go b/src/crypto/tls/conn.go
index 451773ec6e..5b0db53040 100644
--- a/src/crypto/tls/conn.go
+++ b/src/crypto/tls/conn.go
@@ -946,7 +946,7 @@ func (c *Conn) writeRecordLocked(typ recordType, data []byte) (int, error) {
 		data = data[m:]
 	}
 
-	if typ == recordTypeChangeCipherSpec {
+	if typ == recordTypeChangeCipherSpec && c.vers != VersionTLS13 {
 		if err := c.out.changeCipherSpec(); err != nil {
 			return n, c.sendAlertLocked(err.(alert))
 		}
diff --git a/src/crypto/tls/handshake_client_test.go b/src/crypto/tls/handshake_client_test.go
index d52c7cc6e5..c60fb62bc3 100644
--- a/src/crypto/tls/handshake_client_test.go
+++ b/src/crypto/tls/handshake_client_test.go
@@ -337,9 +337,14 @@ func (test *clientTest) run(t *testing.T, write bool) {
 
 	doneChan := make(chan bool)
 	go func() {
-		defer func() { doneChan <- true }()
-		defer clientConn.Close()
-		defer client.Close()
+		defer func() {
+			// Give time to the send buffer to drain, to avoid the kernel
+			// sending a RST and cutting off the flow. See Issue 18701.
+			time.Sleep(10 * time.Millisecond)
+			client.Close()
+			clientConn.Close()
+			doneChan <- true
+		}()
 
 		if _, err := client.Write([]byte("hello\n")); err != nil {
 			t.Errorf("Client.Write failed: %s", err)
@@ -482,6 +487,9 @@ func (test *clientTest) run(t *testing.T, write bool) {
 				t.Fatalf("%s #%d: mismatch on read: got:%x want:%x", test.name, i, bb, b)
 			}
 		}
+		// Give time to the send buffer to drain, to avoid the kernel
+		// sending a RST and cutting off the flow. See Issue 18701.
+		time.Sleep(10 * time.Millisecond)
 		serverConn.Close()
 	}
 
diff --git a/src/crypto/tls/handshake_client_tls13.go b/src/crypto/tls/handshake_client_tls13.go
index 624ca4dacb..83287dd926 100644
--- a/src/crypto/tls/handshake_client_tls13.go
+++ b/src/crypto/tls/handshake_client_tls13.go
@@ -18,6 +18,7 @@ type clientHandshakeStateTLS13 struct {
 	serverHello   *serverHelloMsg
 	hello         *clientHelloMsg
 	certReq       *certificateRequestMsgTLS13
+	sentDummyCCS  bool
 	ecdheParams   ecdheParameters
 	suite         *cipherSuiteTLS13
 	transcript    hash.Hash
@@ -57,6 +58,9 @@ func (hs *clientHandshakeStateTLS13) handshake() error {
 		hs.transcript.Write(chHash)
 		hs.transcript.Write(hs.serverHello.marshal())
 
+		if err := hs.sendDummyChangeCipherSpec(); err != nil {
+			return err
+		}
 		if err := hs.processHelloRetryRequest(); err != nil {
 			return err
 		}
@@ -66,9 +70,13 @@ func (hs *clientHandshakeStateTLS13) handshake() error {
 
 	hs.transcript.Write(hs.serverHello.marshal())
 
+	c.buffering = true
 	if err := hs.processServerHello(); err != nil {
 		return err
 	}
+	if err := hs.sendDummyChangeCipherSpec(); err != nil {
+		return err
+	}
 	if err := hs.establishHandshakeKeys(); err != nil {
 		return err
 	}
@@ -81,8 +89,6 @@ func (hs *clientHandshakeStateTLS13) handshake() error {
 	if err := hs.readServerFinished(); err != nil {
 		return err
 	}
-
-	c.buffering = true
 	if err := hs.sendClientCertificate(); err != nil {
 		return err
 	}
@@ -155,6 +161,18 @@ func (hs *clientHandshakeStateTLS13) checkServerHelloOrHRR() error {
 	return nil
 }
 
+// sendDummyChangeCipherSpec sends a ChangeCipherSpec record for compatibility
+// with middleboxes that didn't implement TLS correctly. See RFC 8446, Appendix D.4.
+func (hs *clientHandshakeStateTLS13) sendDummyChangeCipherSpec() error {
+	if hs.sentDummyCCS {
+		return nil
+	}
+	hs.sentDummyCCS = true
+
+	_, err := hs.c.writeRecord(recordTypeChangeCipherSpec, []byte{1})
+	return err
+}
+
 // processHelloRetryRequest handles the HRR in hs.serverHello, modifies and
 // resends hs.hello, and reads the new ServerHello into hs.serverHello.
 func (hs *clientHandshakeStateTLS13) processHelloRetryRequest() error {
diff --git a/src/crypto/tls/handshake_server_tls13.go b/src/crypto/tls/handshake_server_tls13.go
index 9208cf9539..2da0760acf 100644
--- a/src/crypto/tls/handshake_server_tls13.go
+++ b/src/crypto/tls/handshake_server_tls13.go
@@ -20,6 +20,7 @@ type serverHandshakeStateTLS13 struct {
 	c               *Conn
 	clientHello     *clientHelloMsg
 	hello           *serverHelloMsg
+	sentDummyCCS    bool
 	suite           *cipherSuiteTLS13
 	cert            *Certificate
 	sigAlg          SignatureScheme
@@ -205,6 +206,18 @@ GroupSelection:
 	return nil
 }
 
+// sendDummyChangeCipherSpec sends a ChangeCipherSpec record for compatibility
+// with middleboxes that didn't implement TLS correctly. See RFC 8446, Appendix D.4.
+func (hs *serverHandshakeStateTLS13) sendDummyChangeCipherSpec() error {
+	if hs.sentDummyCCS {
+		return nil
+	}
+	hs.sentDummyCCS = true
+
+	_, err := hs.c.writeRecord(recordTypeChangeCipherSpec, []byte{1})
+	return err
+}
+
 func (hs *serverHandshakeStateTLS13) doHelloRetryRequest(selectedGroup CurveID) error {
 	c := hs.c
 
@@ -231,6 +244,10 @@ func (hs *serverHandshakeStateTLS13) doHelloRetryRequest(selectedGroup CurveID)
 		return err
 	}
 
+	if err := hs.sendDummyChangeCipherSpec(); err != nil {
+		return err
+	}
+
 	msg, err := c.readHandshake()
 	if err != nil {
 		return err
@@ -329,6 +346,10 @@ func (hs *serverHandshakeStateTLS13) sendServerParameters() error {
 		return err
 	}
 
+	if err := hs.sendDummyChangeCipherSpec(); err != nil {
+		return err
+	}
+
 	clientSecret := hs.suite.deriveSecret(hs.handshakeSecret,
 		clientHandshakeTrafficLabel, hs.transcript)
 	c.in.setTrafficSecret(hs.suite, clientSecret)
diff --git a/src/crypto/tls/testdata/Client-TLSv13-AES128-SHA256 b/src/crypto/tls/testdata/Client-TLSv13-AES128-SHA256
index c471e88763..da51f260c8 100644
--- a/src/crypto/tls/testdata/Client-TLSv13-AES128-SHA256
+++ b/src/crypto/tls/testdata/Client-TLSv13-AES128-SHA256
@@ -16,74 +16,107 @@
 000000e0  a3 47 cd 62 43 15 28 da  ac 5f bb 29 07 30 ff f6  |.G.bC.(.._.).0..|
 000000f0  84 af c4 cf c2 ed 90 99  5f 58 cb 3b 74           |........_X.;t|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 7a 02 00 00  76 03 03 f0 8a 7b f4 40  |....z...v....{.@|
-00000010  4d 58 1d e4 6a 58 d2 e9  dc 28 6b aa bc 2f 60 37  |MX..jX...(k../`7|
-00000020  1c a3 3c ce 7d f2 97 8d  ff 14 55 20 00 00 00 00  |..<.}.....U ....|
+00000000  16 03 03 00 7a 02 00 00  76 03 03 cb 6b 3c f1 71  |....z...v...k<.q|
+00000010  7d fb a1 03 ad d3 35 fb  fa 9f f5 1b 58 62 c3 83  |}.....5.....Xb..|
+00000020  18 d1 63 9f 14 57 e6 2d  82 f2 37 20 00 00 00 00  |..c..W.-..7 ....|
 00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000040  00 00 00 00 00 00 00 00  00 00 00 00 13 01 00 00  |................|
-00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 a4  |..+.....3.$... .|
-00000060  23 1b 72 8e 09 ba fa 75  6c f5 cc c2 2a aa 3d 0f  |#.r....ul...*.=.|
-00000070  2e c1 f4 70 40 28 9b df  1e 92 2e cb a2 d5 41 14  |...p@(........A.|
-00000080  03 03 00 01 01 17 03 03  00 17 1f f5 f9 57 54 6a  |.............WTj|
-00000090  02 3f 12 97 48 cb e1 df  85 00 58 8d ab 1d 95 55  |.?..H.....X....U|
-000000a0  3f 17 03 03 02 6d 22 f9  23 08 b9 f2 5d 4a f5 9b  |?....m".#...]J..|
-000000b0  41 b5 16 33 dc e9 45 34  a8 15 19 0b b0 1e a4 57  |A..3..E4.......W|
-000000c0  46 52 d9 53 ec 3c 7c 5c  6c e0 f4 2e 90 55 cc 74  |FR.S.<|\l....U.t|
-000000d0  65 92 a3 1e f0 75 f0 13  c5 65 42 fb 0a 9d f3 bb  |e....u...eB.....|
-000000e0  d5 61 b7 70 74 4d d1 e4  28 f3 8d 0b f5 de 04 fa  |.a.ptM..(.......|
-000000f0  46 28 11 b9 d3 50 82 00  97 32 ac ff 19 ce 27 6b  |F(...P...2....'k|
-00000100  e9 a9 ae ec c2 49 5a 61  bf a0 c0 57 71 c1 00 76  |.....IZa...Wq..v|
-00000110  e4 81 40 c0 96 81 0a 38  d4 6c b7 7f e3 52 7c 3d  |..@....8.l...R|=|
-00000120  bb e1 c8 e0 ef c4 f5 85  8e bc fc d5 5a 00 50 ea  |............Z.P.|
-00000130  54 a1 1b da 8c 31 0f 9f  bc 13 a2 d1 89 93 8a 08  |T....1..........|
-00000140  47 c5 5e 78 be 09 b5 34  e3 33 d3 38 16 9e 71 ca  |G.^x...4.3.8..q.|
-00000150  25 5b 7c 35 08 e6 2c 07  c3 0b 37 60 4a 7b 32 49  |%[|5..,...7`J{2I|
-00000160  9b c4 24 28 6d 76 3e 04  8e 14 22 e9 f9 0d 58 25  |..$(mv>..."...X%|
-00000170  ad 0a 31 8b 1f 0c 2e 50  65 3f 77 fc f9 ab a7 60  |..1....Pe?w....`|
-00000180  6a 52 b0 a9 e5 47 f6 91  b6 72 7a 52 b7 fb c5 93  |jR...G...rzR....|
-00000190  0a 4f 3e 0c 0c 12 5e 30  94 10 5f ee af 4a 40 d0  |.O>...^0.._..J@.|
-000001a0  ba 2c 5b 88 18 86 f1 96  8b cd 28 41 44 59 5e 69  |.,[.......(ADY^i|
-000001b0  be 24 bb 97 99 7e 70 9f  9b d7 bb 54 0b 32 73 bf  |.$...~p....T.2s.|
-000001c0  af 71 82 6b b5 21 b6 a0  85 f2 73 56 98 83 60 c0  |.q.k.!....sV..`.|
-000001d0  70 34 c6 1b 7b 40 ee 5d  8e 79 7d bc ac 6b 3c c9  |p4..{@.].y}..k<.|
-000001e0  9c 47 13 d9 08 a9 05 d6  43 38 19 a0 d6 37 e0 48  |.G......C8...7.H|
-000001f0  dd f5 b5 2b e2 d8 25 07  35 5b 20 2f 0e 01 4a 93  |...+..%.5[ /..J.|
-00000200  63 5c 07 b6 3b 7f 62 9a  85 f8 57 0a 69 db 2c 9b  |c\..;.b...W.i.,.|
-00000210  11 60 6d f3 2b 31 cc 4e  7d 93 bb 13 39 fd 85 da  |.`m.+1.N}...9...|
-00000220  cb 52 84 7e 36 89 28 ef  8f b5 04 c2 37 c3 33 04  |.R.~6.(.....7.3.|
-00000230  ba cb 1b 45 23 2f 2a 49  5d 95 6e 95 d4 32 07 ba  |...E#/*I].n..2..|
-00000240  0e 2f 57 0b b2 a5 d9 6b  3e a5 ab f2 97 89 b9 23  |./W....k>......#|
-00000250  5a 3f 11 8d 45 68 3e bc  8a 59 14 36 bc cc 33 b3  |Z?..Eh>..Y.6..3.|
-00000260  50 e3 15 b3 ec 03 ba 52  2f dc 70 5b c0 2a 45 28  |P......R/.p[.*E(|
-00000270  49 2f d0 c7 a1 5c e4 24  35 b0 78 04 fe 87 54 69  |I/...\.$5.x...Ti|
-00000280  c5 6e 56 a7 f5 7f d1 cb  23 af 4a 52 5f 7c 0e 1d  |.nV.....#.JR_|..|
-00000290  5a 83 6a 69 f5 bc 99 74  30 ee 3c 05 2b 12 52 09  |Z.ji...t0.<.+.R.|
-000002a0  b0 a2 36 86 14 70 44 dd  ec 37 44 4b 8f bf e0 76  |..6..pD..7DK...v|
-000002b0  99 c5 84 90 37 59 a3 e3  f7 57 fa ac bb 6b 04 6a  |....7Y...W...k.j|
-000002c0  1e 0f 9f 1d 63 b7 3a 47  48 dc 3b bc ff 4d 47 94  |....c.:GH.;..MG.|
-000002d0  43 38 cb d5 c5 74 bc 6d  0a f3 ea fa 23 ac e5 0b  |C8...t.m....#...|
-000002e0  fa b9 61 b1 d9 20 5c c6  c8 32 2e fa 11 f0 99 90  |..a.. \..2......|
-000002f0  d4 96 42 3a b6 09 f3 11  c9 e1 d8 2d ae 80 6a b0  |..B:.......-..j.|
-00000300  21 7a b6 2d d7 37 93 bf  53 ad 82 eb fc f1 8f 21  |!z.-.7..S......!|
-00000310  f0 bc fd 17 03 03 00 99  47 59 11 95 5b 84 48 92  |........GY..[.H.|
-00000320  22 b1 4b b0 70 57 5c b4  67 41 53 ed a7 5b 38 eb  |".K.pW\.gAS..[8.|
-00000330  bf 10 65 4a f9 21 c4 63  72 a1 d9 06 f2 21 55 df  |..eJ.!.cr....!U.|
-00000340  ff 7e ee ea a3 37 00 f1  14 41 2f 71 b1 8e f1 c0  |.~...7...A/q....|
-00000350  5d 5b 72 4b a5 99 1d 80  c1 e6 94 5d 78 17 46 81  |][rK.......]x.F.|
-00000360  50 1c 6d dc a7 79 60 67  60 ae af fe 6f 84 67 81  |P.m..y`g`...o.g.|
-00000370  bd b5 20 8e 3f 33 28 e4  6a 94 82 37 9d ea 26 71  |.. .?3(.j..7..&q|
-00000380  65 9d 7d a3 c7 32 be ec  3c d0 c6 b5 a6 55 e6 d7  |e.}..2..<....U..|
-00000390  72 49 14 3b 08 41 cb d8  cc d4 52 b5 c8 35 71 79  |rI.;.A....R..5qy|
-000003a0  7d 90 d2 21 0c 61 cb f6  1c 73 0a b0 7d ff 7b 3e  |}..!.a...s..}.{>|
-000003b0  44 17 03 03 00 35 c1 39  ac b9 1b 43 33 1e 43 35  |D....5.9...C3.C5|
-000003c0  50 d0 2f b9 f9 cf f9 c3  dd 1c 4c 1e 52 46 bd dc  |P./.......L.RF..|
-000003d0  48 93 4f e3 f3 46 27 81  0b 80 34 b4 5b a5 06 c9  |H.O..F'...4.[...|
-000003e0  3c 3a 12 e3 33 45 9d d5  0c 1e 98                 |<:..3E.....|
+00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 50  |..+.....3.$... P|
+00000060  5a 0c d6 69 92 a1 c7 2f  57 41 f3 29 b4 d3 a3 d3  |Z..i.../WA.)....|
+00000070  b5 62 85 2a 1d 12 dc 46  d1 ac 96 b6 16 a5 39 14  |.b.*...F......9.|
+00000080  03 03 00 01 01 17 03 03  00 17 1d a4 67 9f ac 28  |............g..(|
+00000090  dc fe 5c 58 be c0 d0 72  9d 77 05 96 1a 9c ac 54  |..\X...r.w.....T|
+000000a0  a2 17 03 03 02 6d 99 b0  fc 88 2d c2 fe 5b 84 1d  |.....m....-..[..|
+000000b0  38 f4 b9 70 87 b7 45 94  a5 09 e4 a3 2f 93 9a 9b  |8..p..E...../...|
+000000c0  ef 1f 80 a5 69 1d 81 47  d5 3e e0 f3 8e cd 1e 11  |....i..G.>......|
+000000d0  ab 2d a1 1d a7 06 9c fd  b4 dd aa 66 3e 8c e0 2f  |.-.........f>../|
+000000e0  cd e3 9a df 30 b4 c1 70  b0 be 2a 62 ba 3f f6 79  |....0..p..*b.?.y|
+000000f0  aa 74 8b f4 4f 3e bc 5c  32 25 29 69 32 d4 90 6a  |.t..O>.\2%)i2..j|
+00000100  45 45 c5 93 94 4f 90 02  9c 23 45 e0 88 14 ae 6c  |EE...O...#E....l|
+00000110  e7 be 20 4e 47 ea 50 8e  a0 c9 74 67 d2 97 d7 31  |.. NG.P...tg...1|
+00000120  52 7e f7 5a a0 55 51 c8  8f 91 12 12 d7 0e 2b a5  |R~.Z.UQ.......+.|
+00000130  ff 6c 5e 46 0d 2f d7 55  b6 c0 24 e1 5f e2 66 a0  |.l^F./.U..$._.f.|
+00000140  32 c6 cf 88 d2 35 ec fd  17 1a ec 06 19 21 5b 6c  |2....5.......![l|
+00000150  eb ac 71 0a e6 3b d3 ea  51 05 33 45 28 ef 0b 25  |..q..;..Q.3E(..%|
+00000160  7d 77 f1 76 6e fe f8 ef  74 21 ff 3b 7d 69 20 f2  |}w.vn...t!.;}i .|
+00000170  7f 99 58 cd 8a 1a ab 87  c7 b0 9c a5 77 d7 b6 54  |..X.........w..T|
+00000180  27 e5 5d ac 25 b7 7a 4a  4e 8a 74 cd 17 bf 86 4b  |'.].%.zJN.t....K|
+00000190  d4 fd a7 74 3f 03 68 d6  67 cf 05 3d 13 95 81 62  |...t?.h.g..=...b|
+000001a0  80 1a f7 d3 3c 39 3d 8b  8c 68 20 4a c4 ee 16 06  |....<9=..h J....|
+000001b0  5d 2f 3c cf 0d 26 0b 14  1a 4f 64 e4 25 c3 b5 63  |]/<..&...Od.%..c|
+000001c0  86 32 82 78 ad 3e 79 c8  c8 e5 29 78 4a a5 98 81  |.2.x.>y...)xJ...|
+000001d0  57 61 e9 3c dc f1 88 ba  a9 5b 8d e1 c1 08 a8 ed  |Wa.<.....[......|
+000001e0  c8 06 3b f7 7a 60 c7 f2  cd ea 2f 7e 0c 30 1d 2b  |..;.z`..../~.0.+|
+000001f0  e4 d6 e3 46 2d 2f d5 26  4f 63 a4 b7 7a ff 8b 29  |...F-/.&Oc..z..)|
+00000200  21 06 53 8d 99 57 f7 63  c6 72 96 cc 47 9a 80 cc  |!.S..W.c.r..G...|
+00000210  03 d5 96 3b bc ad 05 7e  49 f5 6f e6 f7 8c ae 55  |...;...~I.o....U|
+00000220  b9 59 98 a6 93 22 43 9d  62 d9 ae ba 80 c6 82 e4  |.Y..."C.b.......|
+00000230  d9 44 36 de ec dc 89 f3  45 ee bd 58 ff f5 fa de  |.D6.....E..X....|
+00000240  85 9b 0f fe 48 a1 0f 36  a4 ff f8 43 7b 18 74 49  |....H..6...C{.tI|
+00000250  87 d6 bd f0 2b b3 fd 00  8a 86 8c d1 c1 7d 66 38  |....+........}f8|
+00000260  f7 f9 72 36 77 17 7d 18  1c e6 4b 23 30 0c a4 e7  |..r6w.}...K#0...|
+00000270  34 a9 39 83 3c 25 d1 de  0d f4 61 85 7b 01 92 9f  |4.9.<%....a.{...|
+00000280  e7 47 08 e2 fa 84 59 97  8c c5 55 47 27 4f 00 da  |.G....Y...UG'O..|
+00000290  ab 88 bf b8 fe 84 36 5f  b4 f1 f1 28 75 55 29 af  |......6_...(uU).|
+000002a0  b8 a9 1b 46 dc 65 c7 97  27 4c 9a dc 00 59 3a 02  |...F.e..'L...Y:.|
+000002b0  05 2e ed b0 f1 30 74 14  dd 51 08 44 b2 9f 38 1c  |.....0t..Q.D..8.|
+000002c0  03 3c 8f 00 ad 28 e9 27  bd 75 c3 4a f6 70 5e 79  |.<...(.'.u.J.p^y|
+000002d0  7e 38 b3 df 5a 4f 69 11  f2 37 2f 52 cd cc f9 35  |~8..ZOi..7/R...5|
+000002e0  16 49 01 24 32 8a e6 da  6b 4e a8 92 a0 d7 73 7b  |.I.$2...kN....s{|
+000002f0  fb 4c 0f 00 0e 82 d7 27  d3 22 f9 82 de 41 0b 1a  |.L.....'."...A..|
+00000300  2e d3 6c 97 cb 53 b0 6c  25 b5 65 86 8e 50 87 e0  |..l..S.l%.e..P..|
+00000310  4b e6 6d 17 03 03 00 99  e1 28 35 0e 69 35 4a 55  |K.m......(5.i5JU|
+00000320  12 ab 1c 8d 43 b4 a4 44  2b 56 3c 5d c6 1b 3a a8  |....C..D+V<]..:.|
+00000330  df 0a e8 5d c2 a6 4f 83  c0 dc 07 87 53 0c 1f 63  |...]..O.....S..c|
+00000340  e2 db f0 f7 16 e9 e8 f5  5f 5a f9 b1 f1 8d 36 1d  |........_Z....6.|
+00000350  53 47 60 3f ea 22 f7 6c  7c e7 e6 79 b1 85 f2 27  |SG`?.".l|..y...'|
+00000360  5c ef 1e 99 52 5f 06 67  b3 8b 6d 13 83 06 c0 06  |\...R_.g..m.....|
+00000370  ef fa 1b 9f 92 ec 5b e5  b3 25 64 79 6c 90 11 e1  |......[..%dyl...|
+00000380  13 61 5b bf e9 4f 08 35  81 80 86 b7 77 ae 52 29  |.a[..O.5....w.R)|
+00000390  9b 24 1e b0 55 23 ca 69  2f be d1 01 38 e8 79 a8  |.$..U#.i/...8.y.|
+000003a0  e2 f7 61 0f 32 ca ff 09  44 84 84 79 19 22 54 1e  |..a.2...D..y."T.|
+000003b0  22 17 03 03 00 35 00 a1  ea bc bd 87 41 67 cc 5e  |"....5......Ag.^|
+000003c0  2f 4b 1c 52 c2 56 2c 69  7e 69 9b a3 06 69 b5 0b  |/K.R.V,i~i...i..|
+000003d0  6c 2e 1f de 53 9d 82 22  b7 36 9f ac 0e 7a 83 e5  |l...S..".6...z..|
+000003e0  18 30 5b a9 b7 15 5a 16  87 97 1b                 |.0[...Z....|
 >>> Flow 3 (client to server)
-00000000  17 03 03 00 35 da 94 f3  ee 16 d5 21 2c be 50 e4  |....5......!,.P.|
-00000010  08 a2 44 90 27 9a 22 44  9f 04 c8 1f 6c 97 57 54  |..D.'."D....l.WT|
-00000020  da 4b 84 f2 f5 7e be 86  2a 19 f3 ed b6 05 e8 30  |.K...~..*......0|
-00000030  a2 ca ee a0 71 bb 75 8d  ed fe 17 03 03 00 17 db  |....q.u.........|
-00000040  f3 61 60 d9 d2 80 c8 87  17 66 37 b6 e3 a3 27 37  |.a`......f7...'7|
-00000050  c1 91 69 35 60 f6 17 03  03 00 13 e9 c3 a2 1e a4  |..i5`...........|
-00000060  84 65 d3 bb 97 7a 14 1d  4e ae 8b 3f 42 ac        |.e...z..N..?B.|
+00000000  14 03 03 00 01 01 17 03  03 00 35 23 b7 8d d5 9b  |..........5#....|
+00000010  e4 f6 21 27 94 5b 11 76  5c 1f ff f3 19 f8 43 a2  |..!'.[.v\.....C.|
+00000020  4d 07 68 00 a1 de 53 c9  80 f9 e7 fa 56 2c 6b b8  |M.h...S.....V,k.|
+00000030  bc 09 5e 61 ea 0c da c8  89 1c 41 95 55 0d ef 94  |..^a......A.U...|
+00000040  17 03 03 00 17 9a 18 9a  29 27 19 1b 06 da 82 78  |........)'.....x|
+00000050  da 9a 91 77 36 47 ce 25  72 dc b9 26              |...w6G.%r..&|
+>>> Flow 4 (server to client)
+00000000  17 03 03 00 ea d6 5f a3  a5 14 87 cc 16 54 4c a0  |......_......TL.|
+00000010  57 34 92 34 4d 37 fb 27  2b 71 f7 cf ac 93 96 87  |W4.4M7.'+q......|
+00000020  9a 1f 8d 58 cf 3a 0d 8c  00 e2 03 b1 6e e1 9f d3  |...X.:......n...|
+00000030  f4 dc 17 73 70 59 52 03  a7 fc 99 cb d2 2d 0e c8  |...spYR......-..|
+00000040  91 5c 18 42 a3 20 9b 1c  20 86 bc 15 71 5b b4 7d  |.\.B. .. ...q[.}|
+00000050  80 8d cf 1d 15 33 b8 aa  66 9d f0 f9 08 dc 7c 78  |.....3..f.....|x|
+00000060  b7 12 48 11 e1 00 1c e7  3e b3 8b fe bf 07 6d 6d  |..H.....>.....mm|
+00000070  4c 7b 16 90 cb 8c da 03  a8 81 94 5c 76 09 c4 bf  |L{.........\v...|
+00000080  26 b4 2b fd 9c 44 b5 c0  49 4b 83 58 70 80 8f 7f  |&.+..D..IK.Xp...|
+00000090  1e f8 d0 b4 5d 6e a2 78  f0 8c 9d 0b e8 1a 0b b4  |....]n.x........|
+000000a0  66 7e 74 88 35 a4 d0 a3  ab 6c b5 2a 90 3c ba 09  |f~t.5....l.*.<..|
+000000b0  9c 4e 72 b7 9a ba f9 1f  bb a9 bf 03 94 43 7a d2  |.Nr..........Cz.|
+000000c0  25 2f c5 e8 83 89 37 1f  ac 7b 22 7c 01 7e dc 97  |%/....7..{"|.~..|
+000000d0  b3 05 5c 60 5b 22 2f be  8c 05 e8 1a a6 51 45 13  |..\`["/......QE.|
+000000e0  7f 20 b9 24 f0 a6 7c 1d  21 37 b8 6c 47 9e e8 17  |. .$..|.!7.lG...|
+000000f0  03 03 00 ea c1 05 ef 9c  bf 4c 1a d9 36 0d d4 d0  |.........L..6...|
+00000100  68 47 ac 8b c6 13 71 17  94 e7 74 8e 21 78 91 79  |hG....q...t.!x.y|
+00000110  50 19 4e 43 0d f7 e9 a9  62 e5 25 17 67 3e 38 27  |P.NC....b.%.g>8'|
+00000120  dd 3b 5d e9 ec cb 0f b7  1f aa bd 75 76 f7 88 b8  |.;]........uv...|
+00000130  c6 60 2f b7 ad 89 17 bb  bd d2 86 55 72 bd 52 10  |.`/........Ur.R.|
+00000140  21 4d 92 2d c1 a8 24 18  63 ca 0a 38 90 6b 39 5c  |!M.-..$.c..8.k9\|
+00000150  76 58 ad 62 e5 57 e0 b5  d5 af c9 9b 64 84 76 48  |vX.b.W......d.vH|
+00000160  4d 7f a7 32 09 50 f7 9e  92 ad ed 8e b5 0f 10 27  |M..2.P.........'|
+00000170  45 bc 58 fd be 91 35 97  ec 71 af d5 6a e1 04 26  |E.X...5..q..j..&|
+00000180  00 b3 91 4f a2 be ba b8  06 f1 2f 43 21 a6 0b ba  |...O....../C!...|
+00000190  43 b5 dd a6 cd a6 b1 1c  37 28 90 26 c4 af 71 56  |C.......7(.&..qV|
+000001a0  26 4d 39 39 60 88 8d ae  d1 3e 6e 7e 15 cb 60 1c  |&M99`....>n~..`.|
+000001b0  d2 00 c3 02 b6 2b 81 ea  60 1b 3a a8 a4 dc 29 c0  |.....+..`.:...).|
+000001c0  df 86 41 b8 27 89 3a ca  bc 31 19 ca 18 08 9e 96  |..A.'.:..1......|
+000001d0  e7 b4 6b 78 8d d4 9a 75  1a 48 fb 49 6a 29        |..kx...u.H.Ij)|
+>>> Flow 5 (client to server)
+00000000  17 03 03 00 13 d5 5b 3c  bb 8b 4d f2 c2 d8 dc 0b  |......[<..M.....|
+00000010  5a 94 49 38 ed 11 91 8a                           |Z.I8....|
diff --git a/src/crypto/tls/testdata/Client-TLSv13-AES256-SHA384 b/src/crypto/tls/testdata/Client-TLSv13-AES256-SHA384
index be6eea0f66..306d6c85da 100644
--- a/src/crypto/tls/testdata/Client-TLSv13-AES256-SHA384
+++ b/src/crypto/tls/testdata/Client-TLSv13-AES256-SHA384
@@ -16,76 +16,109 @@
 000000e0  a3 47 cd 62 43 15 28 da  ac 5f bb 29 07 30 ff f6  |.G.bC.(.._.).0..|
 000000f0  84 af c4 cf c2 ed 90 99  5f 58 cb 3b 74           |........_X.;t|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 7a 02 00 00  76 03 03 14 19 73 05 2c  |....z...v....s.,|
-00000010  b8 2b 70 cd 16 84 60 f5  61 03 95 f1 ac 51 2b eb  |.+p...`.a....Q+.|
-00000020  d5 6a e9 65 c9 35 ed 88  c2 aa bd 20 00 00 00 00  |.j.e.5..... ....|
+00000000  16 03 03 00 7a 02 00 00  76 03 03 d0 99 92 ec 66  |....z...v......f|
+00000010  25 e2 c4 9f 90 fa 7c 03  49 b9 19 3e 75 1b 37 42  |%.....|.I..>u.7B|
+00000020  2b cf b4 b7 93 81 29 ef  5a e7 c2 20 00 00 00 00  |+.....).Z.. ....|
 00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000040  00 00 00 00 00 00 00 00  00 00 00 00 13 02 00 00  |................|
-00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 0a  |..+.....3.$... .|
-00000060  ab 07 ce b5 0b 2d 94 fa  8b 55 ff 09 7a 69 35 a5  |.....-...U..zi5.|
-00000070  01 d8 5c c5 84 92 ef e5  f5 45 09 48 78 48 28 14  |..\......E.HxH(.|
-00000080  03 03 00 01 01 17 03 03  00 17 77 e1 72 79 f2 fc  |..........w.ry..|
-00000090  a1 c2 e5 04 92 0a 63 0b  d3 a3 b8 15 6c e7 2a c2  |......c.....l.*.|
-000000a0  3d 17 03 03 02 6d 6d a1  64 08 b2 95 9f 65 d8 bc  |=....mm.d....e..|
-000000b0  fc 1c 6e 4d 75 20 e6 08  ea 58 cc db b2 6f d5 58  |..nMu ...X...o.X|
-000000c0  97 e8 8f 62 b0 a2 c0 84  20 4b 2d 43 a2 eb a1 98  |...b.... K-C....|
-000000d0  93 c0 04 12 b4 9e 17 9b  45 f2 59 f0 9d ed 27 53  |........E.Y...'S|
-000000e0  14 a5 c3 e0 46 5b 22 e4  76 b6 71 7e f6 cb 35 6a  |....F[".v.q~..5j|
-000000f0  ab 34 f9 da 93 b2 21 41  6b 72 73 5e 0c 5f 4e 70  |.4....!Akrs^._Np|
-00000100  ff fe d3 50 48 de c8 e1  16 f7 c4 f3 24 ef 7f 0a  |...PH.......$...|
-00000110  0d bc 24 86 13 93 6e e3  8c d5 a2 a9 97 ee cd 40  |..$...n........@|
-00000120  d6 6b 5a ef 88 62 b0 a0  f3 aa ac f1 7f 7c 0a ad  |.kZ..b.......|..|
-00000130  b7 98 57 aa 7d 89 bb 1e  88 3b 66 9c 34 98 1a 8e  |..W.}....;f.4...|
-00000140  5a a1 2a 3e 10 be 1b bd  86 43 b4 3f cc a4 0b d1  |Z.*>.....C.?....|
-00000150  0c 36 a3 a5 f2 e3 40 a6  c3 5c ed aa 43 57 3e 22  |.6....@..\..CW>"|
-00000160  4f eb 5c d6 e4 4e 8e 83  2a f8 25 db 63 49 d0 cc  |O.\..N..*.%.cI..|
-00000170  b2 6b 29 3a bc b4 f0 04  58 60 be 9d ab 8c 9e 06  |.k):....X`......|
-00000180  df 1c 9b cf 49 a9 d2 cd  42 d3 5c 5a d6 2f b8 91  |....I...B.\Z./..|
-00000190  76 a6 df 3a a2 6e 24 1c  de 1f 63 7e c1 bc 1f 2a  |v..:.n$...c~...*|
-000001a0  20 4c af 9e 47 02 6f fd  8b ed 66 69 d6 76 cc d8  | L..G.o...fi.v..|
-000001b0  f2 b4 ec 71 79 2d 1f 46  22 cb 28 6b be 8e 77 d8  |...qy-.F".(k..w.|
-000001c0  24 34 9b 00 c8 e3 8d d6  5d 2a 58 a9 dc ae 21 0f  |$4......]*X...!.|
-000001d0  92 94 33 b9 cb 1a 89 79  2a eb e8 11 c9 d3 5a af  |..3....y*.....Z.|
-000001e0  f8 f4 1b ce 34 c8 79 24  ed 08 bd 80 a5 4a cc cd  |....4.y$.....J..|
-000001f0  21 b0 8b 89 b5 ff f4 03  ee cc 88 16 d9 cf 5f 38  |!............._8|
-00000200  8b 67 ac c4 51 b9 f4 44  0c e4 47 83 ba 24 60 8a  |.g..Q..D..G..$`.|
-00000210  75 0d c2 3d 77 38 46 b1  db 37 57 af 78 aa 06 97  |u..=w8F..7W.x...|
-00000220  ab 83 42 f1 96 8c 00 3f  6c 7f b8 ae 1d fb e1 10  |..B....?l.......|
-00000230  4d fd 73 bb 37 a6 7d 5a  26 79 5d 7b e4 98 84 9c  |M.s.7.}Z&y]{....|
-00000240  a2 c4 12 5a b3 a4 bc 6e  35 bd a1 2d 58 e8 27 77  |...Z...n5..-X.'w|
-00000250  e1 d6 c4 d5 fb 5a cb 64  6f 6e 4e e0 77 11 ca ba  |.....Z.donN.w...|
-00000260  30 f4 96 dd fd 95 36 d7  23 4d 87 17 b9 66 9e 23  |0.....6.#M...f.#|
-00000270  54 d7 b2 0a 18 f3 11 6e  61 d1 b6 86 94 fb 5c 63  |T......na.....\c|
-00000280  ed 6e 5b 60 80 01 51 47  7a d9 2e c1 8f ff 23 ba  |.n[`..QGz.....#.|
-00000290  75 8d 59 a6 5e 93 c5 10  44 6e 8f a5 59 ab 06 5b  |u.Y.^...Dn..Y..[|
-000002a0  e9 b6 85 8d 11 6c f8 9a  45 ac 57 b4 04 52 cd fd  |.....l..E.W..R..|
-000002b0  29 dc 50 ba 9f ec 5a 67  33 35 6b a8 88 2f 86 1b  |).P...Zg35k../..|
-000002c0  eb 44 54 5b 1d 7e 8a 3b  01 b6 9f d1 99 58 6a bb  |.DT[.~.;.....Xj.|
-000002d0  9e ab 03 ff 18 00 16 7c  3b 16 a4 d7 4e 1a 63 4f  |.......|;...N.cO|
-000002e0  69 2b ea 88 54 ed fe 21  45 7a 6e 3a ef aa 89 e7  |i+..T..!Ezn:....|
-000002f0  b0 87 93 d8 99 12 6e 1c  fd 81 f4 92 4f a3 17 c2  |......n.....O...|
-00000300  78 e2 ef a6 eb be 01 6a  1b 4d 49 f7 1a 8f 0f 01  |x......j.MI.....|
-00000310  72 bd 9e 17 03 03 00 99  01 71 8b a7 7e 19 d2 27  |r........q..~..'|
-00000320  e5 dc 92 fd 6f 90 69 5a  b7 7e 64 bd 82 5d 92 06  |....o.iZ.~d..]..|
-00000330  6d 0c 65 67 a0 af 23 06  68 15 49 3e 02 65 45 dd  |m.eg..#.h.I>.eE.|
-00000340  6d 21 04 3e b8 26 de 4b  b4 d0 14 77 26 43 79 16  |m!.>.&.K...w&Cy.|
-00000350  70 7d f7 97 38 52 5c fd  6f f0 89 df 4e d7 56 4b  |p}..8R\.o...N.VK|
-00000360  03 10 b3 75 e8 55 8e bb  b3 8d 7b 4e 8e a3 81 20  |...u.U....{N... |
-00000370  08 1e ce db ee 31 9b 50  49 00 75 0f 96 97 63 98  |.....1.PI.u...c.|
-00000380  6e 5e ae fe 8b 33 c5 6e  ad 0c 7c 33 e6 ad e9 ba  |n^...3.n..|3....|
-00000390  74 ef b3 29 8c cc 7e 92  9c 36 4a ad 7e bf c8 09  |t..)..~..6J.~...|
-000003a0  e7 1d 70 9a db 8c e6 78  56 70 31 41 2c f1 b1 54  |..p....xVp1A,..T|
-000003b0  0b 17 03 03 00 45 0c b9  ad a0 58 fe 16 91 07 e5  |.....E....X.....|
-000003c0  c3 e1 76 ee 5e 8a 42 02  80 fc e2 89 cd 6c 2d 7f  |..v.^.B......l-.|
-000003d0  f1 dc 41 44 e5 d2 d2 86  8b 51 f3 d4 cc 3b 8d 11  |..AD.....Q...;..|
-000003e0  3e a9 ae 34 38 8b 5f 15  c5 fd 34 55 e8 47 58 9e  |>..48._...4U.GX.|
-000003f0  80 02 de 43 b8 42 e3 63  6b 3f c1                 |...C.B.ck?.|
+00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 7a  |..+.....3.$... z|
+00000060  cc 5a 50 25 51 9c 6f 4d  5a d4 dc a0 fa 55 00 33  |.ZP%Q.oMZ....U.3|
+00000070  26 0e f7 12 14 9b c2 e0  77 8e ff d3 95 3f 0c 14  |&.......w....?..|
+00000080  03 03 00 01 01 17 03 03  00 17 b1 10 59 e2 0b 67  |............Y..g|
+00000090  69 df ef 28 e4 f3 9c fc  df 48 25 d2 b6 86 68 48  |i..(.....H%...hH|
+000000a0  a2 17 03 03 02 6d 91 c1  dd 49 92 5c 77 c1 3f 38  |.....m...I.\w.?8|
+000000b0  7d 78 80 21 d1 cc 15 d4  30 ba 77 fb 64 2c ca 05  |}x.!....0.w.d,..|
+000000c0  ea bc 88 46 51 47 fd bb  39 08 a8 a8 db 3d 22 86  |...FQG..9....=".|
+000000d0  fd b0 78 17 ac 19 18 b4  bb 00 df bf 02 47 75 fb  |..x..........Gu.|
+000000e0  34 06 ea 66 1b ae 06 5c  03 2d 5a 8e a5 55 20 3a  |4..f...\.-Z..U :|
+000000f0  ca 1f e9 53 58 6f 7b e7  c4 fa fd 22 7a 7a 45 df  |...SXo{...."zzE.|
+00000100  7c a7 53 58 92 a4 f9 75  c6 17 b1 bb 68 7b 4e 59  ||.SX...u....h{NY|
+00000110  26 af 4d 1d 18 6c 6a f9  9d 14 52 89 7a 1a dd 97  |&.M..lj...R.z...|
+00000120  67 4c 4d cd 1c 3f 66 95  d0 9b 4f 77 cf 22 bf 80  |gLM..?f...Ow."..|
+00000130  49 17 45 a9 8e 8c 88 3b  21 ce d7 b9 43 e4 ff ac  |I.E....;!...C...|
+00000140  44 c2 6a 48 60 77 a1 39  8a 92 0c 9b ca f7 da 66  |D.jH`w.9.......f|
+00000150  36 9a 86 9f 6e 2d 9b 49  2a 25 30 72 4f 09 41 e5  |6...n-.I*%0rO.A.|
+00000160  37 34 30 a4 f9 f9 59 14  22 89 e7 10 2e 71 ee ac  |740...Y."....q..|
+00000170  82 e9 30 f0 1a 09 2d b5  51 26 ba 71 6b 06 dd fb  |..0...-.Q&.qk...|
+00000180  e4 e3 be 96 60 04 1c c9  45 7c 1c 58 9f b1 ae d7  |....`...E|.X....|
+00000190  6a b2 41 ce 2c b8 fb 07  0a 2d 47 92 53 95 c2 65  |j.A.,....-G.S..e|
+000001a0  3c a2 b5 84 58 c2 ae 67  46 9d 79 1e f6 52 59 36  |<...X..gF.y..RY6|
+000001b0  1b 72 fb 2a b7 6f 74 38  d7 c6 35 9d f5 ce 12 89  |.r.*.ot8..5.....|
+000001c0  25 c5 3e 0e 40 f2 75 30  2b ee 02 61 54 c6 d5 8a  |%.>.@.u0+..aT...|
+000001d0  19 b0 be 03 83 cf c7 0b  bc 56 88 62 3b 7f 80 4e  |.........V.b;..N|
+000001e0  e7 8b bd 7f 99 c4 63 76  3e da d7 51 96 c4 52 2d  |......cv>..Q..R-|
+000001f0  49 7a 8d 8e fe d0 01 bb  29 84 2e 55 70 69 fb ba  |Iz......)..Upi..|
+00000200  f8 6a 8e f4 7d e3 98 46  1b 52 f5 0f 9c 9d 73 29  |.j..}..F.R....s)|
+00000210  4d a6 f4 32 ee 2e 67 5c  f2 03 a4 12 5e 16 2b 1b  |M..2..g\....^.+.|
+00000220  98 b2 d3 6c ee f4 10 db  3d b1 7d 75 6e c0 6a bd  |...l....=.}un.j.|
+00000230  56 56 c1 7f ef f5 c5 fe  f9 48 6e 8f 93 1f 5d c2  |VV.......Hn...].|
+00000240  35 ee 2f 15 f5 bf d1 10  14 dd c8 69 08 f0 be a2  |5./........i....|
+00000250  45 4b 96 9e 12 0a 7f fa  4b 41 78 9c 54 9f 10 97  |EK......KAx.T...|
+00000260  4f a7 4b 06 af b3 ab 1a  b9 b0 b3 02 11 08 c4 f4  |O.K.............|
+00000270  21 fb 86 c5 e9 d9 87 37  d3 79 14 0a 09 c2 4f 7a  |!......7.y....Oz|
+00000280  1c c2 8e ee 00 b1 0a 78  4f ac f1 78 95 5e 93 95  |.......xO..x.^..|
+00000290  a7 ad 44 87 a1 30 d9 5b  1b 13 c5 d8 93 77 2d 2c  |..D..0.[.....w-,|
+000002a0  68 02 ff c5 91 78 8b 1f  19 eb 53 ae 5c b7 8a e9  |h....x....S.\...|
+000002b0  76 ad 62 6a 03 1f f1 ad  01 32 3f 9a 07 36 6b 0a  |v.bj.....2?..6k.|
+000002c0  80 df 8a 87 f3 76 60 53  1f a7 a9 87 92 87 0a 3f  |.....v`S.......?|
+000002d0  7d 6e f3 94 23 b6 6e ae  cd 32 4f 1c e4 06 42 cc  |}n..#.n..2O...B.|
+000002e0  33 50 81 dc e3 7b 2b 7a  e4 b9 40 63 b7 13 a9 1c  |3P...{+z..@c....|
+000002f0  6f 30 53 17 4a 6f 18 d7  98 e5 bd 2d ef c3 90 04  |o0S.Jo.....-....|
+00000300  da 3b eb 3d 79 4f 34 fb  af b1 1b b0 99 6a 7b 11  |.;.=yO4......j{.|
+00000310  e0 34 b9 17 03 03 00 99  43 66 96 ed b4 0d 38 fa  |.4......Cf....8.|
+00000320  e5 41 89 50 30 42 59 f2  35 1e 55 7f ba 7e c8 d2  |.A.P0BY.5.U..~..|
+00000330  c8 34 d1 68 56 22 99 09  76 44 51 e2 5d ba 54 d1  |.4.hV"..vDQ.].T.|
+00000340  7d ea a7 15 37 0a c9 b0  3b b5 42 97 34 4e 47 21  |}...7...;.B.4NG!|
+00000350  f8 4e 94 38 3a 29 c6 6a  e6 c7 f8 fe ef 9a 7f 42  |.N.8:).j.......B|
+00000360  d3 08 33 b2 c4 fb 63 a0  76 2d ff e9 e2 83 66 35  |..3...c.v-....f5|
+00000370  b4 1c 7e 10 4a 1d 02 ea  b3 ab 77 b2 05 08 ae d3  |..~.J.....w.....|
+00000380  33 5b f0 68 dd 4f 7e 05  99 82 b2 86 a3 49 55 b2  |3[.h.O~......IU.|
+00000390  71 52 8b d5 fe a7 ee 75  8c b9 6d 3b 24 eb 1b 0a  |qR.....u..m;$...|
+000003a0  70 f2 89 19 2e ed ff 66  06 bd 28 ee df 4f 53 60  |p......f..(..OS`|
+000003b0  66 17 03 03 00 45 6a 8f  40 5a f8 80 ff a6 e4 aa  |f....Ej.@Z......|
+000003c0  bc 7f 25 8d 99 4c 4a 87  31 39 1a 11 88 ca f5 c6  |..%..LJ.19......|
+000003d0  55 fb 6c 53 27 f8 c9 83  cd fc 91 dc cd ce 5d 9b  |U.lS'.........].|
+000003e0  70 9f 8d ca 17 82 7c d4  3a 57 87 22 4c 50 f6 ce  |p.....|.:W."LP..|
+000003f0  73 74 64 2d 83 3b 78 d2  29 d6 a3                 |std-.;x.)..|
 >>> Flow 3 (client to server)
-00000000  17 03 03 00 45 3b b4 6d  08 6d 86 92 01 79 ac 23  |....E;.m.m...y.#|
-00000010  49 ba 86 5a cc 31 5b 50  6c f2 49 51 17 9a 63 ad  |I..Z.1[Pl.IQ..c.|
-00000020  11 ba a2 84 8c d4 25 c1  02 63 f8 23 9f a8 8e 6e  |......%..c.#...n|
-00000030  5e 6f ba 97 10 16 84 cf  3f 97 0f cc 5a 11 6c 79  |^o......?...Z.ly|
-00000040  54 eb 2c 81 6c da 61 60  6a ed 17 03 03 00 17 66  |T.,.l.a`j......f|
-00000050  41 78 50 23 cc b7 43 2b  b9 6e 4c 8c 8c 68 3a 1a  |AxP#..C+.nL..h:.|
-00000060  ca 35 c8 79 62 dc 17 03  03 00 13 96 1f 8f 80 2c  |.5.yb..........,|
-00000070  4c a8 fa 30 1b 19 e7 34  a9 55 56 06 00 5a        |L..0...4.UV..Z|
+00000000  14 03 03 00 01 01 17 03  03 00 45 8b d1 99 f6 dd  |..........E.....|
+00000010  80 21 59 2a 8a 12 a2 e3  1b 57 50 bd 49 90 95 c0  |.!Y*.....WP.I...|
+00000020  17 59 0a c1 55 ff 14 f1  3d 95 e6 c9 ce 60 c7 94  |.Y..U...=....`..|
+00000030  24 a3 a2 45 69 7a b0 0d  9f 1e f4 79 2c a7 73 f3  |$..Eiz.....y,.s.|
+00000040  d1 2a f5 cb f6 86 79 3f  84 77 58 66 6d 96 0e eb  |.*....y?.wXfm...|
+00000050  17 03 03 00 17 26 45 2f  9c 9d 50 44 2d e4 a0 ce  |.....&E/..PD-...|
+00000060  fa b5 0b 37 a4 52 bb f6  ec 86 80 64              |...7.R.....d|
+>>> Flow 4 (server to client)
+00000000  17 03 03 00 ea 66 4c 54  52 a3 b4 4a 24 0b 2f 8b  |.....fLTR..J$./.|
+00000010  03 f7 61 70 3b 2a 69 cf  93 95 57 88 b6 1b 6d 2f  |..ap;*i...W...m/|
+00000020  81 88 7f a9 fd 47 ee 88  00 1d 94 96 1e 37 09 d4  |.....G.......7..|
+00000030  e0 fe 47 fe 7f 33 5a 5a  74 b8 ae 63 b8 12 b2 07  |..G..3ZZt..c....|
+00000040  a6 7c 8c cd 15 6e 88 c1  41 f9 c5 c6 b6 62 08 9a  |.|...n..A....b..|
+00000050  f2 30 e5 cd 2b a8 be f1  b6 73 2d 97 21 b3 ac 42  |.0..+....s-.!..B|
+00000060  2c 35 cb 3b 9f 4a f6 3d  82 b1 91 a5 15 0a 43 e5  |,5.;.J.=......C.|
+00000070  3d 0b 86 db bf bb cf 5a  ab 67 0a 32 4b e1 ec 7b  |=......Z.g.2K..{|
+00000080  9a ea ee 8f 82 f2 0d 27  58 3d d5 85 ea 13 2c ed  |.......'X=....,.|
+00000090  87 77 95 65 55 1f ca 55  83 01 6f ee 56 74 1f 97  |.w.eU..U..o.Vt..|
+000000a0  f7 e5 aa b8 7a 76 24 51  fd 14 71 0f 34 58 99 0b  |....zv$Q..q.4X..|
+000000b0  da cf 99 38 a5 27 83 37  a8 73 6f 84 11 9c 67 d5  |...8.'.7.so...g.|
+000000c0  bc ce aa 07 73 30 2d 13  d0 6a f4 d0 51 92 89 b4  |....s0-..j..Q...|
+000000d0  d1 86 ed 50 a4 bf 95 63  77 d6 dc bc 40 75 f8 00  |...P...cw...@u..|
+000000e0  f6 b2 16 30 65 1b 46 25  8e 2d c6 f7 f4 5b 70 17  |...0e.F%.-...[p.|
+000000f0  03 03 00 ea 8e 55 c9 38  ba 01 57 ff 88 1b c0 b0  |.....U.8..W.....|
+00000100  d5 de 46 e9 17 43 2d 38  e3 c9 c2 ea 07 67 d7 8d  |..F..C-8.....g..|
+00000110  ab 36 e0 86 06 b4 ba d7  0d 93 9c da 10 fe b9 8c  |.6..............|
+00000120  7f 2e aa 8f a8 67 fd 72  fa 7e 8c 17 79 69 b7 3e  |.....g.r.~..yi.>|
+00000130  02 15 4d 72 02 80 1f f1  c6 d2 55 a8 67 07 63 db  |..Mr......U.g.c.|
+00000140  c8 92 1e fb e4 73 cd f9  48 5e aa 9b 76 c4 3e 85  |.....s..H^..v.>.|
+00000150  b7 2a 68 52 4d d9 4d be  ba 74 f5 e0 5e 4b 3d d3  |.*hRM.M..t..^K=.|
+00000160  78 24 bc ba 89 c4 6e ac  54 04 7d fd 6b ee 71 f9  |x$....n.T.}.k.q.|
+00000170  19 02 77 3a a3 d4 27 ab  c4 95 38 f4 16 b6 18 77  |..w:..'...8....w|
+00000180  8d 2a 7e d7 45 64 64 39  6f 4d 87 be 99 53 a8 ac  |.*~.Edd9oM...S..|
+00000190  f9 5e a6 e0 3d 1f 64 26  c6 f5 27 34 c8 8d 2b 1b  |.^..=.d&..'4..+.|
+000001a0  ad 12 0c 95 59 5c 07 5e  44 bf aa b0 0f b3 8c 13  |....Y\.^D.......|
+000001b0  a4 6f ed 6a af 58 dc 87  32 70 e4 6b 64 f8 44 37  |.o.j.X..2p.kd.D7|
+000001c0  cf 4a b0 3f 57 34 05 1c  b8 47 5e ba f2 93 cc b2  |.J.?W4...G^.....|
+000001d0  8e 86 ef b0 3c ea 4f 75  cf 85 ba 6e 9d 22        |....<.Ou...n."|
+>>> Flow 5 (client to server)
+00000000  17 03 03 00 13 9b cd 58  dd 0c e0 fa bd 3b 5e 25  |.......X.....;^%|
+00000010  e4 9a 24 33 39 f0 b7 bf                           |..$39...|
diff --git a/src/crypto/tls/testdata/Client-TLSv13-ALPN b/src/crypto/tls/testdata/Client-TLSv13-ALPN
index 291f49ad86..f46efbf287 100644
--- a/src/crypto/tls/testdata/Client-TLSv13-ALPN
+++ b/src/crypto/tls/testdata/Client-TLSv13-ALPN
@@ -18,75 +18,108 @@
 00000100  ac 5f bb 29 07 30 ff f6  84 af c4 cf c2 ed 90 99  |._.).0..........|
 00000110  5f 58 cb 3b 74                                    |_X.;t|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 7a 02 00 00  76 03 03 0a 4d aa 31 08  |....z...v...M.1.|
-00000010  a9 02 77 7b 6e 39 6d cd  dc 26 a1 21 15 64 b4 a8  |..w{n9m..&.!.d..|
-00000020  c5 61 98 3c 41 c0 20 1a  58 0e 15 20 00 00 00 00  |.a.<A. .X.. ....|
+00000000  16 03 03 00 7a 02 00 00  76 03 03 ad d5 7d b8 f6  |....z...v....}..|
+00000010  04 29 51 7d 2c e9 69 ed  5d e5 3a 92 bc ad f8 93  |.)Q},.i.].:.....|
+00000020  dc e7 93 bd 0f 2a 3f 46  fd fd 1d 20 00 00 00 00  |.....*?F... ....|
 00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000040  00 00 00 00 00 00 00 00  00 00 00 00 13 01 00 00  |................|
-00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 f9  |..+.....3.$... .|
-00000060  8d 85 0e 95 63 58 e1 f2  bb c9 3b fe 19 72 01 f0  |....cX....;..r..|
-00000070  8c 16 7a f3 ab ed d0 d3  8d b3 30 24 db f0 34 14  |..z.......0$..4.|
-00000080  03 03 00 01 01 17 03 03  00 24 dc 0d 5f ee de 81  |.........$.._...|
-00000090  49 b6 e1 fb 6b 4d 78 fd  9b c5 95 06 a4 6e c2 d9  |I...kMx......n..|
-000000a0  e5 12 9e ab 6e fe e7 e3  fb bc 92 9e d0 50 17 03  |....n........P..|
-000000b0  03 02 6d 7a 58 09 43 b9  12 57 77 eb 47 02 78 a3  |..mzX.C..Ww.G.x.|
-000000c0  b3 f8 1e 58 c2 27 8d d8  44 40 49 3d a3 d9 70 1c  |...X.'..D@I=..p.|
-000000d0  6f b0 51 97 87 20 a0 9c  7d 05 10 d9 35 b7 5f 31  |o.Q.. ..}...5._1|
-000000e0  cb 18 87 82 a8 03 be c8  e0 a9 5b 59 a2 98 c4 0e  |..........[Y....|
-000000f0  03 77 c9 06 77 a7 96 aa  3f 72 10 62 5c 5f f0 13  |.w..w...?r.b\_..|
-00000100  c6 a4 53 48 6a b5 2f 9d  c3 50 cc 9d a2 a4 53 6a  |..SHj./..P....Sj|
-00000110  a9 ac e1 82 b6 6f 1a 60  15 3f 23 0d 45 ac 12 5a  |.....o.`.?#.E..Z|
-00000120  26 e4 16 87 48 8c 64 25  f2 f5 41 b7 26 ac 52 6d  |&...H.d%..A.&.Rm|
-00000130  f5 83 bf d1 3d 12 3d b0  2f 36 87 c8 e9 04 e8 69  |....=.=./6.....i|
-00000140  5c 6b 60 a0 e0 0a ff f0  ae eb 42 b3 09 dd cd 1e  |\k`.......B.....|
-00000150  5d 00 d8 23 fb 4f cf fb  15 57 ac d6 e8 16 f4 8d  |]..#.O...W......|
-00000160  02 2d 3b d5 7c 9f 7c b4  33 5c 77 32 74 5c 18 90  |.-;.|.|.3\w2t\..|
-00000170  d8 5f f6 5b c5 ac 73 c0  48 ab e9 88 95 7a d4 67  |._.[..s.H....z.g|
-00000180  6f 13 3d 63 26 35 d1 7d  3b 4e fd 27 7f ac d2 bb  |o.=c&5.};N.'....|
-00000190  4a 57 f4 55 b5 93 aa ff  cb a7 51 4c 20 07 d5 a6  |JW.U......QL ...|
-000001a0  4a 05 e2 b7 c2 ac b9 25  0f de 42 a7 0e 4d b6 b8  |J......%..B..M..|
-000001b0  e6 3d b0 ba 9d bf 13 51  43 31 3e f2 51 d5 28 a7  |.=.....QC1>.Q.(.|
-000001c0  62 81 2d 8e 4c 86 2f e2  8a 87 79 bc 43 89 ce af  |b.-.L./...y.C...|
-000001d0  f5 08 4e 36 4f 0b 17 cf  a3 05 a7 27 7c 21 2c 18  |..N6O......'|!,.|
-000001e0  a0 51 f8 ef 38 de 80 99  54 bb 16 2d d2 65 76 95  |.Q..8...T..-.ev.|
-000001f0  91 7b 81 36 ed 43 5e 44  f5 d5 6d 74 37 37 56 cb  |.{.6.C^D..mt77V.|
-00000200  7d 79 7b 7c 96 42 ba 74  8f 5c 6c aa 3d e4 57 90  |}y{|.B.t.\l.=.W.|
-00000210  07 a7 d1 50 7e 16 54 ec  92 a6 e4 e2 6f cf 10 c7  |...P~.T.....o...|
-00000220  1e 6f 24 4c 1a 5d 44 72  0f 10 22 2f 04 aa ca 55  |.o$L.]Dr.."/...U|
-00000230  c6 d0 54 45 80 6d 87 ed  85 44 64 07 c5 71 ff 68  |..TE.m...Dd..q.h|
-00000240  ae c5 f1 5c 8d 8a 4d 85  3b 68 65 b2 97 c7 2b bf  |...\..M.;he...+.|
-00000250  49 d8 76 ac 58 de ba 31  7f 10 92 85 4c cd f5 d7  |I.v.X..1....L...|
-00000260  bc db aa f4 c8 81 95 fd  77 e8 9f 03 74 0e 15 a7  |........w...t...|
-00000270  73 0c 6d 07 27 ce c3 23  cc 68 f0 82 ce 2b 8d 25  |s.m.'..#.h...+.%|
-00000280  4e b3 e8 31 b6 e4 2b 4e  bf b8 09 f7 ef 6e 64 89  |N..1..+N.....nd.|
-00000290  23 03 03 bf 93 dd 3a 89  e1 cf d1 7b b8 72 8d 40  |#.....:....{.r.@|
-000002a0  30 d4 06 be c4 78 a7 70  66 a5 90 36 86 e4 a1 53  |0....x.pf..6...S|
-000002b0  59 81 68 04 bc 1b 5b b8  28 ff d0 78 75 2a 46 a7  |Y.h...[.(..xu*F.|
-000002c0  3b 11 08 e3 cc fd 39 a4  d0 fa d0 ed cf 34 ce 6e  |;.....9......4.n|
-000002d0  02 a6 6c 1c 04 c3 a7 53  08 6c dc 8c 71 51 7c 9c  |..l....S.l..qQ|.|
-000002e0  f0 da 86 91 a0 f1 0d 04  fb 18 c3 89 1a b8 58 f7  |..............X.|
-000002f0  50 9c cb 62 a6 d4 64 6b  cd 7b 5c 33 1e d8 45 43  |P..b..dk.{\3..EC|
-00000300  f6 72 cd 04 1a 7f e4 48  b2 16 17 9d 79 97 5c bc  |.r.....H....y.\.|
-00000310  fa 0a 06 b1 92 f1 b3 db  98 83 04 01 6a 2b 51 38  |............j+Q8|
-00000320  17 03 03 00 99 82 ea 5b  85 f2 b1 05 63 fa 98 d3  |.......[....c...|
-00000330  ad 0d ac ab 0a a2 95 81  1a 04 52 c0 9e 18 da 3d  |..........R....=|
-00000340  b6 36 a6 6f 35 1d c2 e0  e6 82 d6 0d ec b4 e1 02  |.6.o5...........|
-00000350  95 43 e0 1e 3c 2b 96 8f  39 d0 49 33 ef 30 4f 05  |.C..<+..9.I3.0O.|
-00000360  7a 2e 1b 04 39 d7 b3 4a  1a 24 20 11 1e d7 fb ea  |z...9..J.$ .....|
-00000370  28 57 68 79 53 7d f8 08  35 c4 c2 7a f5 73 19 76  |(WhyS}..5..z.s.v|
-00000380  dc 56 fb 35 aa 6a b7 73  7b da 41 f3 9f 71 14 14  |.V.5.j.s{.A..q..|
-00000390  b8 61 8e ab 82 5e 57 e8  af d2 31 95 ec 4f a7 01  |.a...^W...1..O..|
-000003a0  f2 2b cc 75 1b b1 cd c6  25 c0 69 32 4d 02 53 73  |.+.u....%.i2M.Ss|
-000003b0  80 ef c3 af 62 68 a7 82  15 dc e5 f2 8e 0f 17 03  |....bh..........|
-000003c0  03 00 35 ca d4 d7 83 55  19 de 32 ec b2 9c 79 13  |..5....U..2...y.|
-000003d0  e2 99 3b ae 9d 90 d1 ec  76 e9 89 be b0 59 9b e1  |..;.....v....Y..|
-000003e0  fc 37 a7 84 5c 3c 03 e2  92 72 f9 ee d6 85 fc 42  |.7..\<...r.....B|
-000003f0  f2 2f f6 ac bb 2b 25 a0                           |./...+%.|
+00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 fe  |..+.....3.$... .|
+00000060  4b d7 8f 01 60 9e 75 40  11 72 06 64 f7 66 62 a7  |K...`.u@.r.d.fb.|
+00000070  49 81 d2 f6 65 59 10 4f  2c 68 d8 4c f0 f0 60 14  |I...eY.O,h.L..`.|
+00000080  03 03 00 01 01 17 03 03  00 24 e3 64 26 bd f9 1c  |.........$.d&...|
+00000090  ce 83 56 88 a0 a5 eb e7  a5 c5 13 53 2d 61 69 8a  |..V........S-ai.|
+000000a0  74 32 46 dc fa b2 63 58  f2 31 6a 21 8f 18 17 03  |t2F...cX.1j!....|
+000000b0  03 02 6d 5f 4f bf d0 9d  00 9d 2e c6 86 0b d5 37  |..m_O..........7|
+000000c0  01 0b a5 ac d5 ee 9c 91  87 98 89 c9 bd 2f b3 b4  |............./..|
+000000d0  10 7e 40 eb bb 6b 9e d6  cc 0b 1d 3a 18 06 a2 a5  |.~@..k.....:....|
+000000e0  1d d4 53 82 a7 3b 28 3f  3f d5 0e 23 5a f7 ff e4  |..S..;(??..#Z...|
+000000f0  3d a4 66 95 a8 d0 18 52  2c 94 c4 84 89 0f d1 05  |=.f....R,.......|
+00000100  a2 34 95 da 7b 65 e2 9c  62 b1 11 cc 15 78 58 8f  |.4..{e..b....xX.|
+00000110  43 d8 d0 04 9b db bf 06  34 d6 33 3d 55 0b 53 39  |C.......4.3=U.S9|
+00000120  9f 96 8f 67 34 6a f6 13  09 9b ae 61 b8 c5 cf 65  |...g4j.....a...e|
+00000130  f1 b5 43 bb ee fb 9c d4  2d b1 7e 3a 59 4b 56 45  |..C.....-.~:YKVE|
+00000140  d4 1f 75 b7 07 35 18 e7  bd ad b7 36 2f 63 0f 67  |..u..5.....6/c.g|
+00000150  68 3f 42 4c 53 22 bc b9  41 2c e0 a3 95 54 6b 4d  |h?BLS"..A,...TkM|
+00000160  b9 e4 00 3f 89 11 53 7e  cc 4d 8c 72 d7 d0 fe bf  |...?..S~.M.r....|
+00000170  20 81 20 d3 d3 a1 e6 c8  ba 5b 49 d7 96 9e 8f fb  | . ......[I.....|
+00000180  f8 30 d6 7e e5 4a 3b e6  a6 0d 0a 42 80 68 cf 06  |.0.~.J;....B.h..|
+00000190  19 d7 86 63 8e 23 c0 37  71 f6 bc 8b bd ab 62 a5  |...c.#.7q.....b.|
+000001a0  45 f4 37 ea 50 cc 82 c9  f4 28 11 1c 1b 90 9d f7  |E.7.P....(......|
+000001b0  67 dc 58 d2 10 59 49 26  17 68 50 a9 6c d9 e6 46  |g.X..YI&.hP.l..F|
+000001c0  c5 e8 b3 ba 01 a9 ff 33  5e 2c 7c d3 eb d2 35 56  |.......3^,|...5V|
+000001d0  b2 21 37 94 40 c7 15 d6  6f 29 ee 02 c9 98 e7 04  |.!7.@...o)......|
+000001e0  0c 56 e9 f9 21 91 e7 75  7c 8d a1 50 28 b3 da 76  |.V..!..u|..P(..v|
+000001f0  45 af 22 80 77 17 2e 96  d8 5e 05 0f 63 21 c9 32  |E.".w....^..c!.2|
+00000200  2b c0 69 e9 8a 07 40 0c  21 73 1f 7d e8 b1 11 45  |+.i...@.!s.}...E|
+00000210  37 40 c8 26 66 98 e9 0a  95 ed 08 26 12 f3 79 17  |7@.&f......&..y.|
+00000220  6d d8 92 11 4f c7 ee db  5d 77 98 1a 31 cd cc db  |m...O...]w..1...|
+00000230  1d 96 e8 b5 a1 ba be 0f  b1 84 4a a0 55 c5 41 78  |..........J.U.Ax|
+00000240  8d 96 ca a0 4e 4d 1e ed  34 54 2b 95 08 1f 00 a6  |....NM..4T+.....|
+00000250  a8 d7 35 66 0a ad 2a ac  c4 4b 5d 60 b8 89 1f af  |..5f..*..K]`....|
+00000260  65 c3 a6 10 4b 4c c1 d6  07 1b 3a dc 7c 00 3e a1  |e...KL....:.|.>.|
+00000270  06 8e ac f6 4c 4f d4 88  31 3e df 5b 6b 95 19 ed  |....LO..1>.[k...|
+00000280  6e b5 d1 0a 5e bc 5e 69  3f 5a fc ed 71 14 66 c4  |n...^.^i?Z..q.f.|
+00000290  a3 ef 82 d4 2b bc 7c 5a  34 20 33 77 e4 48 4b 82  |....+.|Z4 3w.HK.|
+000002a0  66 51 12 ac cf 9b e5 5f  17 34 2f a5 47 fd ab 53  |fQ....._.4/.G..S|
+000002b0  85 8e d2 d5 c7 b2 58 a5  d2 fa eb d8 59 f6 2a bd  |......X.....Y.*.|
+000002c0  37 fc 68 65 75 e4 5f be  a7 d8 6a da 41 36 6a 33  |7.heu._...j.A6j3|
+000002d0  f1 8d 6a 9d f0 23 73 6a  33 42 52 6f 41 80 a3 40  |..j..#sj3BRoA..@|
+000002e0  48 65 16 d9 23 dd 66 93  eb c5 d3 84 10 8b 0b ec  |He..#.f.........|
+000002f0  d8 c1 c3 3f 08 07 18 ed  d9 8e 1d a3 85 d1 70 ef  |...?..........p.|
+00000300  cd c1 90 e1 80 70 94 9d  05 41 3d 4e 8f 6b 91 d7  |.....p...A=N.k..|
+00000310  5d b4 9c 72 c0 de 2d bb  f0 d7 dd 29 c4 4e 82 56  |]..r..-....).N.V|
+00000320  17 03 03 00 99 ed 9c 42  76 9b 6c 6d 4f db 8d ca  |.......Bv.lmO...|
+00000330  4f a9 6b de 10 6e 5e 9a  1b b8 5a bd 35 0f a6 0a  |O.k..n^...Z.5...|
+00000340  cd bd 9d 60 ac 4b c9 35  4e 2a 70 5f 13 07 3f 4a  |...`.K.5N*p_..?J|
+00000350  bd 3c 9e 85 ef 6d cd 4e  91 c0 83 3e bc ac c7 03  |.<...m.N...>....|
+00000360  fa 9d 3b 11 28 de d1 8e  de c5 d3 3f cf cc ff 7b  |..;.(......?...{|
+00000370  63 27 51 4c ea 11 24 43  c5 24 20 69 f3 71 9f 1c  |c'QL..$C.$ i.q..|
+00000380  c5 a8 6f 4a 10 1b 4f 20  6c fa bc ab 79 b3 c7 15  |..oJ..O l...y...|
+00000390  de 47 4d 74 19 65 49 38  31 15 cd c8 51 68 fa 74  |.GMt.eI81...Qh.t|
+000003a0  c8 2f cf 34 17 35 0a 29  0c 45 c7 8a 99 1e 3e 18  |./.4.5.).E....>.|
+000003b0  29 74 b6 be 9d ea b1 ab  f4 0c d7 7f f3 16 17 03  |)t..............|
+000003c0  03 00 35 e6 eb 90 3b 27  87 1b d4 7b a6 77 95 4a  |..5...;'...{.w.J|
+000003d0  2f b7 52 59 c7 4c 44 75  80 ca a3 04 ea 1a ba df  |/.RY.LDu........|
+000003e0  69 4c 42 97 a5 ad a8 67  4d c3 7d a7 83 33 8a c5  |iLB....gM.}..3..|
+000003f0  ec af 2b c9 bc 32 91 8b                           |..+..2..|
 >>> Flow 3 (client to server)
-00000000  17 03 03 00 35 cc 3b 0d  48 9a 16 49 7c 30 93 a1  |....5.;.H..I|0..|
-00000010  ad ad f3 1d 8c ba 5b 16  af bd 40 36 31 0c aa 64  |......[...@61..d|
-00000020  0c b0 2b bd d2 24 6e e8  07 30 94 e2 22 c8 c4 b8  |..+..$n..0.."...|
-00000030  3c 7a 36 f6 dd 4c be 4c  ef 68 17 03 03 00 17 f6  |<z6..L.L.h......|
-00000040  d1 ea 13 82 3e 34 42 2c  b9 33 d7 7f f6 cc 16 96  |....>4B,.3......|
-00000050  b5 32 fd a4 5c f1 17 03  03 00 13 d6 00 df 9b 19  |.2..\...........|
-00000060  38 a4 5e 5a 95 53 b6 10  80 79 1a 31 6b 4d        |8.^Z.S...y.1kM|
+00000000  14 03 03 00 01 01 17 03  03 00 35 0c 04 d4 20 a9  |..........5... .|
+00000010  67 8e 45 d1 59 75 b8 1d  89 da a3 97 ae 3f f7 a4  |g.E.Yu.......?..|
+00000020  64 3f d4 e2 05 45 da 2e  e7 a0 c3 32 a4 19 40 b6  |d?...E.....2..@.|
+00000030  af 8f cf 2c fe d2 14 88  18 cf 65 06 e3 91 a5 de  |...,......e.....|
+00000040  17 03 03 00 17 f9 61 2b  d5 c3 68 88 6f d8 86 23  |......a+..h.o..#|
+00000050  f1 7d 58 5c 75 8c 70 24  5b 4f de 74              |.}X\u.p$[O.t|
+>>> Flow 4 (server to client)
+00000000  17 03 03 00 ea 33 85 9d  72 d6 99 11 8b 5d b1 a2  |.....3..r....]..|
+00000010  e8 b6 7c 00 b6 0b 4f cd  08 89 51 a5 86 4e db 28  |..|...O...Q..N.(|
+00000020  67 50 03 f7 a6 6e 02 0a  3a 3b 7c 35 74 cc 87 d8  |gP...n..:;|5t...|
+00000030  eb da 9a 07 9a 66 ce 1d  4d eb 62 51 fb 59 6f 45  |.....f..M.bQ.YoE|
+00000040  14 18 40 5b 8d e6 35 17  fe dd 8d d3 56 3d 81 18  |..@[..5.....V=..|
+00000050  83 a8 af 95 90 0a cf 6a  76 d0 a6 07 7e 1c 71 1c  |.......jv...~.q.|
+00000060  e6 c5 2f ce 47 b7 73 6d  8b 06 3a fd e8 ce 7e 34  |../.G.sm..:...~4|
+00000070  7e 6c 5c ae d3 8d 3a c0  61 b6 f9 73 07 7b 4a 3f  |~l\...:.a..s.{J?|
+00000080  0d b9 fc f2 5e 70 13 09  c1 a6 16 04 2e 13 db 12  |....^p..........|
+00000090  ab 1a 10 df c5 53 00 f8  58 46 63 86 e1 47 8a 25  |.....S..XFc..G.%|
+000000a0  88 95 d4 53 dd 8c df ae  38 15 86 70 ad 8f c0 c7  |...S....8..p....|
+000000b0  a6 ba 2a ac 4b c3 54 aa  00 41 43 1c 2e 30 47 a5  |..*.K.T..AC..0G.|
+000000c0  bf 6c e5 c2 78 67 b4 07  3e fb 11 b5 87 8d 51 92  |.l..xg..>.....Q.|
+000000d0  47 81 6b 8e 2f f9 5d 4e  66 25 5a b5 3b 92 9a d0  |G.k./.]Nf%Z.;...|
+000000e0  e0 b6 63 28 d2 80 ba c7  97 95 1a ef d9 1c c8 17  |..c(............|
+000000f0  03 03 00 ea 6a 98 5d 82  1c f0 42 0a 87 39 0c 0c  |....j.]...B..9..|
+00000100  cd e7 0b 16 1b 93 0f 1f  ce 03 1a 1c c1 64 89 a2  |.............d..|
+00000110  bb b3 73 33 0e 1b b5 7f  6f 53 73 86 cb 37 57 1a  |..s3....oSs..7W.|
+00000120  8e 1d 59 c8 5c 81 29 19  1b ca 8e 42 31 34 06 e7  |..Y.\.)....B14..|
+00000130  43 a9 4c cd 91 45 4d 1e  48 31 57 50 10 fd 9e aa  |C.L..EM.H1WP....|
+00000140  b6 f4 14 a3 ff b2 c3 47  3e f2 3e 5a b9 5c 7a c6  |.......G>.>Z.\z.|
+00000150  26 1a 91 7e c3 3a e3 7e  a4 38 cd 83 89 85 8f f2  |&..~.:.~.8......|
+00000160  fa c1 e3 1e 53 3d bd 54  ed 21 74 fb ff f0 d9 e9  |....S=.T.!t.....|
+00000170  d5 b7 46 1c 6e 1d 9c 79  5e a7 32 97 79 8f 69 70  |..F.n..y^.2.y.ip|
+00000180  e7 5c ad 7f 58 1a 0b af  16 dc fe 35 01 e3 bf 42  |.\..X......5...B|
+00000190  be 78 6f 39 d0 a9 c8 6c  48 bd b0 c8 fb 5c f7 1d  |.xo9...lH....\..|
+000001a0  1a 3f 79 7a d9 7c 07 ab  11 1b 0b bb 30 88 bf 59  |.?yz.|......0..Y|
+000001b0  36 79 5e 0b 23 2e 70 4e  84 f5 ab 6d b3 5d f6 ff  |6y^.#.pN...m.]..|
+000001c0  40 09 66 f2 89 af 58 fb  0c 29 fb 7d f6 be 97 b6  |@.f...X..).}....|
+000001d0  1b 84 53 b5 a2 f2 2b a6  d5 f4 c9 16 70 b8        |..S...+.....p.|
+>>> Flow 5 (client to server)
+00000000  17 03 03 00 13 3c 30 88  da 6f 10 92 66 99 de 69  |.....<0..o..f..i|
+00000010  ea 74 e4 a2 7a d3 b8 d4                           |.t..z...|
diff --git a/src/crypto/tls/testdata/Client-TLSv13-CHACHA20-SHA256 b/src/crypto/tls/testdata/Client-TLSv13-CHACHA20-SHA256
index 1cc7a4f4ad..8f606cd56f 100644
--- a/src/crypto/tls/testdata/Client-TLSv13-CHACHA20-SHA256
+++ b/src/crypto/tls/testdata/Client-TLSv13-CHACHA20-SHA256
@@ -16,74 +16,107 @@
 000000e0  a3 47 cd 62 43 15 28 da  ac 5f bb 29 07 30 ff f6  |.G.bC.(.._.).0..|
 000000f0  84 af c4 cf c2 ed 90 99  5f 58 cb 3b 74           |........_X.;t|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 7a 02 00 00  76 03 03 7b 81 36 84 98  |....z...v..{.6..|
-00000010  a3 9c d6 2d a5 38 91 94  a3 df 3a d2 ad 4b b6 60  |...-.8....:..K.`|
-00000020  12 f2 fa 04 f4 1c a1 e4  55 43 f3 20 00 00 00 00  |........UC. ....|
+00000000  16 03 03 00 7a 02 00 00  76 03 03 8d 7b 1d 2a 66  |....z...v...{.*f|
+00000010  8f 54 f0 d0 59 a6 ef ba  aa 1a ba 98 bf 02 45 f5  |.T..Y.........E.|
+00000020  56 69 80 67 e4 72 f4 d7  56 a1 ec 20 00 00 00 00  |Vi.g.r..V.. ....|
 00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000040  00 00 00 00 00 00 00 00  00 00 00 00 13 03 00 00  |................|
-00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 eb  |..+.....3.$... .|
-00000060  45 9d e3 42 6c 04 45 5c  46 28 7d 88 60 44 32 74  |E..Bl.E\F(}.`D2t|
-00000070  e8 8c ca 9d f6 71 ec c4  11 d5 11 1d 04 aa 47 14  |.....q........G.|
-00000080  03 03 00 01 01 17 03 03  00 17 db ed 81 c0 66 7b  |..............f{|
-00000090  80 d4 91 4c 78 75 7f af  d2 60 c8 bd 35 45 7e 36  |...Lxu...`..5E~6|
-000000a0  5a 17 03 03 02 6d a5 9c  0f 75 69 8d 43 05 50 35  |Z....m...ui.C.P5|
-000000b0  39 ec 82 e2 ba 01 09 c7  f0 47 1f ab 50 f3 6b aa  |9........G..P.k.|
-000000c0  83 8c eb db 0d 5c 86 ba  fd 8f 63 30 1a 48 3e 62  |.....\....c0.H>b|
-000000d0  ed 6a bc 9c 71 2c 33 e4  55 43 bb 67 86 c2 45 06  |.j..q,3.UC.g..E.|
-000000e0  fd 9c 50 3e a8 5e 94 14  58 65 27 cc 12 0d 98 c3  |..P>.^..Xe'.....|
-000000f0  68 79 8a 20 b5 a5 0d 0a  d6 93 d8 a2 ee 79 64 2e  |hy. .........yd.|
-00000100  be f3 20 ff d4 2e 6b b0  4e 76 3c 0f 28 85 bc e6  |.. ...k.Nv<.(...|
-00000110  91 bd f3 cb 60 75 41 4c  d0 23 b4 df c2 c9 4b 8b  |....`uAL.#....K.|
-00000120  6d 3b fd 7c 93 90 a5 f8  5f d0 70 42 aa a6 c1 02  |m;.|...._.pB....|
-00000130  10 ae 24 71 33 43 98 4a  96 d1 de de 6c 8e a1 98  |..$q3C.J....l...|
-00000140  bf 08 bb 0c 08 ad 31 bf  25 19 cd c2 54 93 15 e6  |......1.%...T...|
-00000150  e4 da c3 da 98 67 fc 1f  7a ce 57 d6 6a 53 82 67  |.....g..z.W.jS.g|
-00000160  50 f5 c8 9d b5 92 46 4f  84 a4 e7 14 e0 03 4f 40  |P.....FO......O@|
-00000170  a9 df 76 c3 14 06 36 4f  be 03 8f e9 cd a6 57 9c  |..v...6O......W.|
-00000180  da 98 61 a0 2e ba 74 fc  9f f2 c8 87 9d ed fb 87  |..a...t.........|
-00000190  de db 9c 15 a0 5c 7b 5a  ab af c7 fa 5a ab d1 c0  |.....\{Z....Z...|
-000001a0  13 64 12 c0 5d 36 b5 fd  4d 80 df 26 cd ef c0 ca  |.d..]6..M..&....|
-000001b0  83 e5 3a 55 58 2a 63 5c  38 e7 e0 9c 15 cb 76 14  |..:UX*c\8.....v.|
-000001c0  5f 7a 9a 8f 9f 03 83 3e  7d 9e 61 17 2a 6b c8 ff  |_z.....>}.a.*k..|
-000001d0  dc f9 01 aa 5f e1 44 ea  2c 09 60 ac 0b 25 e4 52  |...._.D.,.`..%.R|
-000001e0  0e 21 86 6f d4 92 2d eb  95 0a 87 6d 91 ee 27 05  |.!.o..-....m..'.|
-000001f0  e2 e2 88 13 eb ac 8b f8  45 c4 88 eb 76 43 10 d8  |........E...vC..|
-00000200  26 de de b0 9b 4c 14 1b  2c db 93 8e de 46 a9 9e  |&....L..,....F..|
-00000210  df 87 df 88 69 a8 15 ae  cf 3c a7 3d ae 70 3d 2a  |....i....<.=.p=*|
-00000220  22 eb 01 2e e1 29 23 2f  8a ad cf 54 25 fb 8b 0a  |"....)#/...T%...|
-00000230  1c 70 b8 0c 34 e5 49 9e  c1 cd 98 02 85 42 22 56  |.p..4.I......B"V|
-00000240  b8 da 9b 48 cc 87 84 f9  f1 94 e1 bc 5a 01 a1 3f  |...H........Z..?|
-00000250  de 7c ac 03 d3 75 88 8d  22 6e f8 6e e1 f8 4b 9c  |.|...u.."n.n..K.|
-00000260  0b 13 7e f6 1b 0e 22 ce  62 69 3d 66 55 87 a2 a1  |..~...".bi=fU...|
-00000270  01 9e 2b 3c 60 80 b3 c6  d9 fc 9a 4c 0e 89 83 44  |..+<`......L...D|
-00000280  8c 02 64 70 e7 71 b5 e0  6c f1 44 cc bf 3e 03 95  |..dp.q..l.D..>..|
-00000290  a9 46 6a f3 f6 1e ea 19  bb 8c 62 92 17 bc cf 2d  |.Fj.......b....-|
-000002a0  e5 af ca 2d 66 6d ed c1  13 f6 89 55 fc 5c 51 12  |...-fm.....U.\Q.|
-000002b0  30 02 78 58 96 7c 8b 28  68 56 7b f7 c4 48 03 5b  |0.xX.|.(hV{..H.[|
-000002c0  5f 46 ef 9c 1d 7e 4c 0a  b9 de 37 df 90 86 7c 1d  |_F...~L...7...|.|
-000002d0  e6 af dc 85 c5 03 6f a2  38 d2 2a f3 33 5c 27 06  |......o.8.*.3\'.|
-000002e0  c4 1e 44 61 1b 7b 28 3c  3d ca 32 d2 9b 8b 59 9a  |..Da.{(<=.2...Y.|
-000002f0  42 7c b8 23 4d 81 ca ce  02 f1 bc 87 f2 dd 42 2f  |B|.#M.........B/|
-00000300  f0 c4 97 32 b9 a5 44 c2  12 96 ca cf fd 95 14 c8  |...2..D.........|
-00000310  12 47 0a 17 03 03 00 99  ff 36 e6 aa 19 66 0f 3d  |.G.......6...f.=|
-00000320  c1 cd b3 8b b3 51 78 a1  bb d6 c7 dc 1a ee ae 82  |.....Qx.........|
-00000330  35 b5 b9 71 a9 0e a2 d0  d2 0f d7 cf c9 29 a3 2e  |5..q.........)..|
-00000340  57 21 ac 8e 37 01 47 1c  26 83 f7 15 69 44 c6 27  |W!..7.G.&...iD.'|
-00000350  f9 4c e3 b2 5e 2f 7a 57  55 05 ef c6 89 1c f0 23  |.L..^/zWU......#|
-00000360  ce 46 44 26 5b d8 2b ff  8a 8b 8b dc 94 73 1a a3  |.FD&[.+......s..|
-00000370  46 15 57 d3 8b 03 2b d3  83 7b 45 d9 28 b0 2b 96  |F.W...+..{E.(.+.|
-00000380  6a de 74 2a dd ca 12 ab  55 1e 8a b7 a2 6a b6 8e  |j.t*....U....j..|
-00000390  42 fe c0 35 16 d8 3f f7  f5 58 5d 7a 6c 3c 8d 71  |B..5..?..X]zl<.q|
-000003a0  a3 8e 88 91 97 69 1d 35  e0 47 5d 3d 99 48 96 29  |.....i.5.G]=.H.)|
-000003b0  1b 17 03 03 00 35 da 2c  98 c0 1b 27 40 d0 89 d0  |.....5.,...'@...|
-000003c0  90 76 97 c1 0a 76 33 17  0e a0 cb 15 5a eb ce 78  |.v...v3.....Z..x|
-000003d0  6f ba db da 20 38 94 75  dc 1a 42 c6 2e ef f4 46  |o... 8.u..B....F|
-000003e0  12 ac 0e 56 56 32 e6 1c  2e 29 31                 |...VV2...)1|
+00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 c8  |..+.....3.$... .|
+00000060  b8 1d 9b 00 85 3c 1c 1d  1f 5e 88 e8 ea 38 1d 63  |.....<...^...8.c|
+00000070  f4 99 b0 89 a5 c4 4e 7d  15 49 ca 27 05 26 10 14  |......N}.I.'.&..|
+00000080  03 03 00 01 01 17 03 03  00 17 07 34 7c 5e 3f 52  |...........4|^?R|
+00000090  c4 42 ed d9 50 e2 a6 cc  6e 0e 93 27 bf c1 97 d6  |.B..P...n..'....|
+000000a0  78 17 03 03 02 6d 1c 60  91 f4 1b fd 8f 9b 89 8b  |x....m.`........|
+000000b0  65 50 19 c9 41 25 9e 35  8d 75 aa ec 5f 88 bf 6c  |eP..A%.5.u.._..l|
+000000c0  85 33 02 c3 01 6d 3c 5c  86 aa 12 22 35 49 e0 81  |.3...m<\..."5I..|
+000000d0  4b e3 f2 ec 75 12 95 ed  b4 aa f3 0e 7d bf e6 a8  |K...u.......}...|
+000000e0  5d a3 6c 82 f7 f0 1e f7  e7 e8 73 af 14 77 24 ea  |].l.......s..w$.|
+000000f0  5f bc 25 88 95 93 bb 61  84 f9 36 95 b9 12 31 ff  |_.%....a..6...1.|
+00000100  f8 19 f0 76 d7 4a 1f a6  77 33 75 82 70 a7 98 71  |...v.J..w3u.p..q|
+00000110  5b dc c0 d6 9c 85 c2 41  e3 d0 32 b1 e5 c0 42 8c  |[......A..2...B.|
+00000120  e8 32 38 ad 03 3a db 46  66 0c 63 0f 65 f6 ed 66  |.28..:.Ff.c.e..f|
+00000130  34 ec c6 23 db e3 25 3e  ec eb 44 21 76 7c 35 0f  |4..#..%>..D!v|5.|
+00000140  f2 2c 0f 92 9c db 8f 3e  de 46 e8 af f8 6e c4 82  |.,.....>.F...n..|
+00000150  91 5e a3 c2 de f7 73 3c  1c e2 84 42 02 a8 bf fb  |.^....s<...B....|
+00000160  04 96 a4 a7 f4 4c c2 d7  1e 1e 6a e2 82 68 58 07  |.....L....j..hX.|
+00000170  a0 f4 e9 91 c1 bc f7 d6  d7 d7 63 6a e7 a3 9c fa  |..........cj....|
+00000180  69 57 28 e9 db 4e d1 4d  65 9a 05 41 a9 71 47 97  |iW(..N.Me..A.qG.|
+00000190  17 0b 95 79 8e 60 90 ee  4c 75 e0 c4 10 c8 21 e7  |...y.`..Lu....!.|
+000001a0  ab 62 ab a9 e7 25 86 80  93 76 f7 a2 2a c4 d2 9f  |.b...%...v..*...|
+000001b0  59 2a 15 7a 88 c0 8d 57  01 ab f2 8e 40 5d b5 49  |Y*.z...W....@].I|
+000001c0  7f d4 1e 7f 4e ae ad bd  8c bc 2d 5f 91 3f a7 6c  |....N.....-_.?.l|
+000001d0  ce 0a 8c c7 53 66 4e 28  31 16 ab 05 dc 78 f6 f4  |....SfN(1....x..|
+000001e0  5d b3 eb 38 e1 c1 53 11  11 97 69 4a 86 14 fa 34  |]..8..S...iJ...4|
+000001f0  c7 ab 6d 2d 31 17 bf a7  d8 1a 9f bf 2f 4c c9 50  |..m-1......./L.P|
+00000200  5e 21 30 b1 98 ac f3 46  a2 d9 4b 67 e7 44 cd 0c  |^!0....F..Kg.D..|
+00000210  77 2b 72 1c 6d e6 65 1b  28 6d d1 05 bb a6 15 54  |w+r.m.e.(m.....T|
+00000220  5d 93 22 e0 e4 e8 3e 99  8c 18 18 27 a7 18 c2 0c  |]."...>....'....|
+00000230  6c fb 16 b6 ab f1 91 f1  ad 84 b3 53 30 27 b8 29  |l..........S0'.)|
+00000240  82 c8 28 06 19 c8 44 3f  45 10 67 92 6a ff 94 47  |..(...D?E.g.j..G|
+00000250  49 b2 fd 08 03 15 bd f7  c9 34 cc ad 84 9c 6d 08  |I........4....m.|
+00000260  15 e8 df 10 3c 7d 28 5f  9d 77 07 49 47 2f ae 61  |....<}(_.w.IG/.a|
+00000270  af 3b 8f 19 63 f7 b3 29  3c 45 4e 0d 9d 03 97 74  |.;..c..)<EN....t|
+00000280  fc d0 bc 99 24 f5 32 af  92 a9 65 4f 06 cb 96 1d  |....$.2...eO....|
+00000290  42 46 2c 8c 77 47 99 62  6b 04 2d df 3c 2e 2a 59  |BF,.wG.bk.-.<.*Y|
+000002a0  1b 58 e5 b9 64 5d e9 34  5a 76 40 2f 50 f3 04 0e  |.X..d].4Zv@/P...|
+000002b0  b3 98 e9 fe 8e dd 3a db  e7 ff fa 10 60 17 ab 18  |......:.....`...|
+000002c0  40 bd 5b 10 48 b8 ae 98  79 f4 6a 8d 71 85 25 f3  |@.[.H...y.j.q.%.|
+000002d0  74 de 84 fe a4 ed 24 67  c2 74 37 61 be 4e 06 74  |t.....$g.t7a.N.t|
+000002e0  86 b8 4d e7 6f 90 d3 20  6c 61 02 62 45 0d 57 70  |..M.o.. la.bE.Wp|
+000002f0  3e f1 37 c9 f6 8c 45 29  f7 56 eb e3 dd 5f 56 47  |>.7...E).V..._VG|
+00000300  c2 4f cb ca 7c 86 8e ed  72 3d 3f e9 bc 38 a7 c1  |.O..|...r=?..8..|
+00000310  59 8b a2 17 03 03 00 99  dc 71 24 a3 c4 ab 62 4c  |Y........q$...bL|
+00000320  26 c3 7c 73 d3 e9 fd 4b  82 95 30 b8 3f 87 7e bf  |&.|s...K..0.?.~.|
+00000330  c1 60 40 5f 6c 7f 8d db  0e 4e 91 d4 b4 02 66 ef  |.`@_l....N....f.|
+00000340  b8 b1 a8 af 42 a3 7d 5c  6a 97 81 f6 cb c8 d2 8b  |....B.}\j.......|
+00000350  7e 1d 09 e5 f1 a4 aa 5e  c9 b6 f4 b7 43 2f 21 ba  |~......^....C/!.|
+00000360  90 d6 74 ab 8e 03 8b 54  79 57 b6 ae 77 a0 87 96  |..t....TyW..w...|
+00000370  42 0f 95 66 74 6c 1b 0d  ea 66 5c 62 57 32 b7 dd  |B..ftl...f\bW2..|
+00000380  03 65 b6 ad af 15 20 52  39 af 33 e6 08 5c 38 dd  |.e.... R9.3..\8.|
+00000390  40 42 c1 4c f6 48 0b 59  96 a0 04 c3 09 b6 bf ac  |@B.L.H.Y........|
+000003a0  7a 9d 96 8a ce 3f 7f 68  00 9e 1c 9a db e3 25 56  |z....?.h......%V|
+000003b0  54 17 03 03 00 35 55 48  0b d0 5c c0 8c a4 5e 1e  |T....5UH..\...^.|
+000003c0  30 64 b7 b5 f7 d0 0d 50  64 a8 f1 79 36 9a 0f 00  |0d.....Pd..y6...|
+000003d0  ac cb 25 c7 62 5f c1 05  e9 c2 ee 7a 87 00 19 fc  |..%.b_.....z....|
+000003e0  5b fd 4c 0a 73 ec dc f4  51 66 bd                 |[.L.s...Qf.|
 >>> Flow 3 (client to server)
-00000000  17 03 03 00 35 23 ee 53  57 90 ba 6c b8 81 73 49  |....5#.SW..l..sI|
-00000010  50 0b a2 6f 9c bc b4 84  c5 31 e7 1d 57 ef fe c2  |P..o.....1..W...|
-00000020  00 0b 1b 67 f7 2c 7d d3  e1 24 fa 4c 7a 90 5a 52  |...g.,}..$.Lz.ZR|
-00000030  c4 78 2c 4a a4 81 3a ca  70 3e 17 03 03 00 17 d1  |.x,J..:.p>......|
-00000040  04 00 5a 55 c2 9d ed 7d  32 a0 94 80 f7 2a f1 ee  |..ZU...}2....*..|
-00000050  e7 28 20 f8 27 3b 17 03  03 00 13 99 71 80 30 28  |.( .';......q.0(|
-00000060  79 f2 88 36 2d a4 b5 b8  f0 1a e8 4e 26 ec        |y..6-......N&.|
+00000000  14 03 03 00 01 01 17 03  03 00 35 36 71 be 3a 8d  |..........56q.:.|
+00000010  ee 01 10 3e 7b a9 7a 5a  81 2f 2a 65 bd 56 8f b9  |...>{.zZ./*e.V..|
+00000020  0f a2 e9 80 eb ae 63 b0  60 69 ea f3 f7 66 d4 2c  |......c.`i...f.,|
+00000030  fd 13 2c 00 22 55 85 58  4e cf 4f 45 45 a1 ba 89  |..,."U.XN.OEE...|
+00000040  17 03 03 00 17 bc cf b6  f9 13 87 04 83 9e 1d dd  |................|
+00000050  ff 33 77 cb a1 71 bb df  23 97 2c b6              |.3w..q..#.,.|
+>>> Flow 4 (server to client)
+00000000  17 03 03 00 ea 6c b0 c3  6b ed 51 ec 1e 57 a4 3e  |.....l..k.Q..W.>|
+00000010  f6 d0 e8 10 b6 b4 cd e6  0b 12 50 8f a2 26 b9 87  |..........P..&..|
+00000020  19 ad a5 25 33 ab 5e 2e  58 d4 68 c5 85 42 6c 1d  |...%3.^.X.h..Bl.|
+00000030  34 02 b0 47 59 f0 cd c2  d5 a5 bb 27 3f 60 9d 07  |4..GY......'?`..|
+00000040  22 3c 9a 25 d0 a6 2a b4  e4 52 20 18 07 f3 f8 b4  |"<.%..*..R .....|
+00000050  ad 4f 2c ec 8d 41 5f dd  b9 e1 bb 90 88 94 5e 73  |.O,..A_.......^s|
+00000060  75 a1 ed 88 cf 97 a6 67  02 02 78 be a4 20 29 ad  |u......g..x.. ).|
+00000070  91 63 a6 39 e8 42 1a 65  76 c7 17 f0 39 7a c4 62  |.c.9.B.ev...9z.b|
+00000080  d2 3e f4 12 eb ab da 7b  1f e6 94 b5 a1 b0 40 5c  |.>.....{......@\|
+00000090  e3 66 a3 7b 40 53 ce 74  10 77 d7 17 9f d0 b3 b2  |.f.{@S.t.w......|
+000000a0  a2 97 fd 42 08 5f af 79  a3 c0 c0 98 fa 71 58 8b  |...B._.y.....qX.|
+000000b0  a5 81 50 8a fc 51 d5 82  19 fb a7 6f 9f b3 6a 96  |..P..Q.....o..j.|
+000000c0  c3 d4 90 88 88 c2 96 df  70 ec 60 ca 71 9c 53 ef  |........p.`.q.S.|
+000000d0  fc a1 92 11 c9 a3 f8 b7  bc a2 6b f5 c5 dc dd b8  |..........k.....|
+000000e0  cb 7b 1b af 60 0f 16 8f  a8 d4 85 34 76 3c 35 17  |.{..`......4v<5.|
+000000f0  03 03 00 ea 7a 0f ef f0  87 83 1d 23 30 ed 14 d4  |....z......#0...|
+00000100  dc 97 19 38 71 e2 94 b1  54 e5 86 61 20 21 cd 57  |...8q...T..a !.W|
+00000110  29 e6 b3 01 8a 69 7f 06  f2 a0 3e 87 38 3c 7c 9d  |)....i....>.8<|.|
+00000120  d5 83 e3 58 26 0d 16 13  b8 af 13 a9 c3 21 27 ae  |...X&........!'.|
+00000130  32 df fb 3d fa 2c cd 7c  4e af d3 e0 32 29 7e f3  |2..=.,.|N...2)~.|
+00000140  b5 d2 56 58 bc 83 e2 c7  cd cc e7 e7 8d ff b1 70  |..VX...........p|
+00000150  c6 c6 51 ac 6a 12 de 28  4c 99 73 6d 38 4f 74 76  |..Q.j..(L.sm8Otv|
+00000160  ae 48 c8 ec a3 65 9c 3a  c3 b5 6d 47 1c 0f 5d 63  |.H...e.:..mG..]c|
+00000170  8c bb 85 61 51 89 f3 3c  9d 65 03 58 06 13 b2 d7  |...aQ..<.e.X....|
+00000180  d8 13 53 d1 11 7a cf 10  c9 8d b1 70 ac 20 7e af  |..S..z.....p. ~.|
+00000190  f5 fc cc a4 ab 91 a8 dd  2a db d6 e2 44 73 c5 57  |........*...Ds.W|
+000001a0  b8 ad 32 d4 98 ee 65 90  ee b7 c6 bf 78 b1 06 59  |..2...e.....x..Y|
+000001b0  b8 74 c9 54 e0 fc 79 92  bd ff 6f 42 c5 39 13 b3  |.t.T..y...oB.9..|
+000001c0  20 f7 e5 28 27 0e 22 4e  b5 38 81 46 14 f6 d3 a8  | ..('."N.8.F....|
+000001d0  f8 32 ca 3f da 1c d3 44  8f 21 da 5c f4 ad        |.2.?...D.!.\..|
+>>> Flow 5 (client to server)
+00000000  17 03 03 00 13 6b f9 43  f6 f1 44 ba cc 47 cf 09  |.....k.C..D..G..|
+00000010  4d 94 dd 31 1e 65 ce 32                           |M..1.e.2|
diff --git a/src/crypto/tls/testdata/Client-TLSv13-ECDSA b/src/crypto/tls/testdata/Client-TLSv13-ECDSA
index 2d370669f8..55b8cc5263 100644
--- a/src/crypto/tls/testdata/Client-TLSv13-ECDSA
+++ b/src/crypto/tls/testdata/Client-TLSv13-ECDSA
@@ -16,70 +16,101 @@
 000000e0  a3 47 cd 62 43 15 28 da  ac 5f bb 29 07 30 ff f6  |.G.bC.(.._.).0..|
 000000f0  84 af c4 cf c2 ed 90 99  5f 58 cb 3b 74           |........_X.;t|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 7a 02 00 00  76 03 03 ea 51 d2 17 98  |....z...v...Q...|
-00000010  38 87 56 24 96 d8 d2 5b  19 30 72 26 67 8b 3c 00  |8.V$...[.0r&g.<.|
-00000020  88 61 ca f2 2f 46 d2 06  72 75 58 20 00 00 00 00  |.a../F..ruX ....|
+00000000  16 03 03 00 7a 02 00 00  76 03 03 48 a3 75 25 ac  |....z...v..H.u%.|
+00000010  19 49 b6 e7 5a 9a c2 15  3e e3 a6 21 c0 f5 09 40  |.I..Z...>..!...@|
+00000020  b7 ad fc 0c 39 1b 3c 44  36 13 9e 20 00 00 00 00  |....9.<D6.. ....|
 00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000040  00 00 00 00 00 00 00 00  00 00 00 00 13 01 00 00  |................|
-00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 88  |..+.....3.$... .|
-00000060  e1 24 f3 7f 61 5a 52 d9  5c d6 a1 11 68 e8 fc 00  |.$..aZR.\...h...|
-00000070  db d5 de 59 73 b2 a7 75  ac 7e 2b b0 1f a9 4d 14  |...Ys..u.~+...M.|
-00000080  03 03 00 01 01 17 03 03  00 17 ae bf 1f bc 4e 27  |..............N'|
-00000090  37 3e 57 af 20 b4 4a 7b  4a da e0 47 8e 32 63 69  |7>W. .J{J..G.2ci|
-000000a0  2f 17 03 03 02 22 3d 8b  c2 4f 07 ac cc e2 64 53  |/...."=..O....dS|
-000000b0  8c 1f 79 c7 f0 00 6e 99  27 e4 1b a1 9b df b4 89  |..y...n.'.......|
-000000c0  e5 31 a0 b9 5f 86 4a 87  2c d1 41 96 d6 e1 9d 7f  |.1.._.J.,.A.....|
-000000d0  07 50 84 86 ae dd f7 46  53 4e 60 2d 6a 7b 99 3a  |.P.....FSN`-j{.:|
-000000e0  af 8c 8c fb ee 66 f6 3d  f2 87 56 ed cb 8f 99 3f  |.....f.=..V....?|
-000000f0  a0 1c bf c4 60 09 b3 01  4c 04 3f 10 c6 3e 36 9b  |....`...L.?..>6.|
-00000100  be e3 ee aa df df 58 78  c5 21 e4 98 0d 98 de 71  |......Xx.!.....q|
-00000110  45 63 c3 b2 39 9e d2 c0  83 e6 b7 e0 6f b0 b0 04  |Ec..9.......o...|
-00000120  fe c0 2f c4 32 98 82 6c  ee f5 68 1c 21 e7 f2 2e  |../.2..l..h.!...|
-00000130  2f bf d1 17 21 ac da 03  d1 42 c3 85 78 c7 4f d8  |/...!....B..x.O.|
-00000140  cf ca 1e 3f e1 ac a3 06  de 29 21 86 ee bb cc b0  |...?.....)!.....|
-00000150  68 4a c5 65 a8 7f 90 8f  48 a1 df 24 57 36 6b da  |hJ.e....H..$W6k.|
-00000160  64 cb 52 56 76 9a 47 86  d1 8e ed d7 c0 85 9c 74  |d.RVv.G........t|
-00000170  89 05 01 43 0b 69 dc 4a  ed 61 eb 55 bf e5 3a a4  |...C.i.J.a.U..:.|
-00000180  b9 39 6b 3b 71 cf 33 83  b1 54 59 71 b2 24 a0 1f  |.9k;q.3..TYq.$..|
-00000190  70 fe 58 ff 90 88 d9 91  55 d6 a5 ef 3d c9 0d 3b  |p.X.....U...=..;|
-000001a0  a0 57 de d4 c4 82 50 bd  ff 9d 85 b9 90 10 df 92  |.W....P.........|
-000001b0  5b 41 ec c2 41 2a 1d b6  d7 e1 51 08 92 a3 ef 98  |[A..A*....Q.....|
-000001c0  4d 79 d8 37 11 df a1 3f  43 ed 0d 20 44 ca f2 94  |My.7...?C.. D...|
-000001d0  ff e2 5e 05 b7 9c 4d b7  70 83 73 b1 d9 5a ed 7e  |..^...M.p.s..Z.~|
-000001e0  3a c6 08 3a 49 1d 4f 08  30 02 8f d8 3f cb 14 a3  |:..:I.O.0...?...|
-000001f0  d5 74 7e 85 e8 f6 ab 6a  61 54 84 79 21 2a aa f4  |.t~....jaT.y!*..|
-00000200  3d b3 42 df b7 d6 6f e8  29 50 cc f8 18 a9 f0 99  |=.B...o.)P......|
-00000210  6b 44 c3 37 ef 3d 20 0b  28 10 b3 f9 ea f2 65 df  |kD.7.= .(.....e.|
-00000220  ae c6 28 24 c5 ea e1 bc  ba 79 ad 02 c3 fc b2 cb  |..($.....y......|
-00000230  8a f3 70 80 5a d0 4b 2c  78 43 2a 18 71 2c 0c c0  |..p.Z.K,xC*.q,..|
-00000240  45 f5 1b 47 1d f6 fb 75  53 ed d7 a0 e4 c4 2a 48  |E..G...uS.....*H|
-00000250  e4 e8 37 33 fe d1 f0 96  dc 27 bb 40 41 b6 e6 9e  |..73.....'.@A...|
-00000260  18 bb 2d 5b b1 05 7c 5b  94 ef f6 af f4 64 b2 e8  |..-[..|[.....d..|
-00000270  08 4c 1b 01 11 de 53 b5  f1 15 ff 6f 8a 08 ef cb  |.L....S....o....|
-00000280  74 d1 81 a6 c0 b5 ac 41  ec 30 5e f0 dc ec b1 70  |t......A.0^....p|
-00000290  5f 53 e9 56 dd 48 05 4f  0c f0 7d a7 13 2a 33 d6  |_S.V.H.O..}..*3.|
-000002a0  2b 4b 22 7f a9 b5 cf 1f  63 f4 c2 6c ee 0c 10 d0  |+K".....c..l....|
-000002b0  96 06 2f aa 2b df 69 01  ee 3c b4 e9 f3 9d 7b 8b  |../.+.i..<....{.|
-000002c0  5f ff b3 a1 3a 03 df c6  17 03 03 00 a4 da 63 32  |_...:.........c2|
-000002d0  c2 d8 9b 78 bc fa 59 d8  5a 4c 8c f1 f6 e0 26 39  |...x..Y.ZL....&9|
-000002e0  fd 27 c7 0c 11 ad 3e 34  2e 0c 3c aa 83 a8 96 d9  |.'....>4..<.....|
-000002f0  0c be 5d a7 8a 79 f9 08  67 8f 74 82 88 a1 0f f0  |..]..y..g.t.....|
-00000300  1b 52 c3 7a 89 25 14 72  3b 0b 4c 82 e5 9c df ac  |.R.z.%.r;.L.....|
-00000310  e3 49 b1 ef 35 c0 df 6c  0e 5e b4 48 38 d1 d7 73  |.I..5..l.^.H8..s|
-00000320  01 30 04 b4 67 37 32 92  79 9c 45 52 06 bd 25 af  |.0..g72.y.ER..%.|
-00000330  5a 0f 8d 98 4f c6 12 31  78 90 32 78 8c a4 49 a0  |Z...O..1x.2x..I.|
-00000340  6e fb 2b 94 31 0d 05 a8  96 05 04 3b f5 80 a7 3c  |n.+.1......;...<|
-00000350  92 c9 ee ea c6 cb 24 a2  e2 c9 88 3e 09 50 8c 75  |......$....>.P.u|
-00000360  d5 95 10 8f b0 f9 5b ec  b5 d7 be aa 3c b0 e9 d0  |......[.....<...|
-00000370  67 17 03 03 00 35 da 1d  4c 65 79 5b 84 e9 60 3e  |g....5..Ley[..`>|
-00000380  ac de 29 ad 8d 7e a1 9b  ad 25 35 08 39 f1 75 6f  |..)..~...%5.9.uo|
-00000390  6b 11 66 fc 66 ff c7 88  7a fc d5 a6 24 c3 fc 7f  |k.f.f...z...$...|
-000003a0  6a aa 94 36 56 cd 75 66  1f 0b 7c                 |j..6V.uf..||
+00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 20  |..+.....3.$...  |
+00000060  db 3f 51 79 d2 24 e1 e1  a4 b6 f8 84 2d 25 27 ca  |.?Qy.$......-%'.|
+00000070  9a d2 5e cc 28 ac 5e 74  2a ea 1b 56 28 24 76 14  |..^.(.^t*..V($v.|
+00000080  03 03 00 01 01 17 03 03  00 17 bc dd d4 00 24 28  |..............$(|
+00000090  82 e2 0a 74 8f a6 06 9b  14 2d ca c1 90 6c 1c 8f  |...t.....-...l..|
+000000a0  7f 17 03 03 02 22 f9 8f  72 d6 f1 34 fa 90 0e 42  |....."..r..4...B|
+000000b0  2d 2e a0 1d 9e 1f ce ee  79 af b6 b3 bd c2 6b 8f  |-.......y.....k.|
+000000c0  62 4c 5d 1c 1e 47 a7 77  97 ca 04 c5 16 f8 58 3a  |bL]..G.w......X:|
+000000d0  b7 33 15 bc 5f f0 13 7f  02 4d f2 80 95 84 6f 41  |.3.._....M....oA|
+000000e0  df 03 c8 64 23 91 e5 8c  e9 01 45 fe 8e 37 27 e0  |...d#.....E..7'.|
+000000f0  47 83 43 a2 0f ef 3d eb  11 fb ba 52 2f 8e 43 97  |G.C...=....R/.C.|
+00000100  1b fe 49 28 e7 ce 73 c4  3e 9d 18 9d 34 a4 b4 5e  |..I(..s.>...4..^|
+00000110  ee ec bf e3 75 fc 00 be  b7 0e 80 f8 a2 db 90 a9  |....u...........|
+00000120  62 74 35 c6 8e 36 55 68  4e 6c 94 b6 61 d7 d0 34  |bt5..6UhNl..a..4|
+00000130  e8 83 ae c3 75 2d eb 35  95 d3 5f 28 3e 05 f3 ea  |....u-.5.._(>...|
+00000140  18 76 6b 6d b9 98 c0 d5  ea 6d 62 9b 15 d8 be 55  |.vkm.....mb....U|
+00000150  8c f5 5a 3d 14 81 82 cc  8c 6c 34 2f e8 50 87 ef  |..Z=.....l4/.P..|
+00000160  c6 fe 92 39 e0 f4 6d ca  d1 97 c9 df 81 6d dc 3f  |...9..m......m.?|
+00000170  6f 60 58 30 e1 c7 87 d0  fb 40 f6 ce 44 96 e9 19  |o`X0.....@..D...|
+00000180  21 d3 3a 56 fd c1 60 22  96 f7 d9 07 30 15 40 f9  |!.:V..`"....0.@.|
+00000190  b3 0c 9c cf f7 38 94 43  41 8a 76 92 4a 71 55 22  |.....8.CA.v.JqU"|
+000001a0  8d ce 03 ed 97 98 54 0e  94 8c b7 a4 ee ce d6 60  |......T........`|
+000001b0  5d a2 4e 9f ff e6 90 23  69 b1 a2 0e c5 e7 5b 58  |].N....#i.....[X|
+000001c0  7b d1 13 ba f2 d3 ff 6a  48 ff 77 2d 61 05 4b 15  |{......jH.w-a.K.|
+000001d0  cc 6f 52 4a 69 1c e2 38  b3 2a 96 ff 10 bb 55 02  |.oRJi..8.*....U.|
+000001e0  50 e9 f2 09 92 66 cc 43  ea f4 4e ad aa 18 fc 9b  |P....f.C..N.....|
+000001f0  05 52 3b f1 44 3b 6e 25  47 cd 20 4d 69 86 8b 64  |.R;.D;n%G. Mi..d|
+00000200  61 31 0a 03 92 0e 21 9d  67 d5 af 00 de 88 a4 f5  |a1....!.g.......|
+00000210  3d 3e 45 0f f4 02 15 ae  bf 45 76 80 0d 8d 7a 04  |=>E......Ev...z.|
+00000220  58 d7 e5 5a 81 41 a9 04  7e aa 67 af 27 92 cf 51  |X..Z.A..~.g.'..Q|
+00000230  13 c4 e6 84 2e 28 dc 53  c8 73 11 f9 f7 d9 28 ac  |.....(.S.s....(.|
+00000240  a6 00 af cb 38 bc f2 b7  1c 6d e8 21 f0 6e e5 35  |....8....m.!.n.5|
+00000250  12 c0 a9 57 2f 87 39 bc  a6 7a ab ab 04 02 48 e8  |...W/.9..z....H.|
+00000260  13 a3 20 a4 c9 09 64 b2  2a 66 39 91 d7 3a 7a 41  |.. ...d.*f9..:zA|
+00000270  1c a4 15 4e 84 d3 72 66  31 3a ba 7a b8 18 ee 0c  |...N..rf1:.z....|
+00000280  e2 17 1a 8f f7 af 38 49  e3 4d d7 ed be 7a 1e bd  |......8I.M...z..|
+00000290  ae 70 c1 fc 6a 09 05 29  bb fc 78 5b 8f a4 f7 81  |.p..j..)..x[....|
+000002a0  34 fd ad 9b 22 87 67 15  0f ee d4 99 90 e7 af 4b  |4...".g........K|
+000002b0  14 bd af f3 ab 04 e0 d1  58 f5 34 b2 e1 ee 65 92  |........X.4...e.|
+000002c0  80 05 68 c3 b2 6a bc 6d  17 03 03 00 a4 f4 d6 df  |..h..j.m........|
+000002d0  b6 61 6a c2 6c a6 25 f9  b2 95 8f 73 10 05 e2 63  |.aj.l.%....s...c|
+000002e0  37 22 63 bd 50 af 18 0c  71 17 61 40 c9 a1 b1 6d  |7"c.P...q.a@...m|
+000002f0  d7 a6 2f c6 c2 46 9d 40  06 e3 30 04 e1 d9 97 c1  |../..F.@..0.....|
+00000300  a8 6c ce 97 47 4e 9e 54  bc 8e 2c 77 e8 21 c3 0b  |.l..GN.T..,w.!..|
+00000310  8f 51 0c c2 8f 0d 64 b9  79 26 c0 33 07 e0 df 08  |.Q....d.y&.3....|
+00000320  50 98 26 b1 2b 69 6a 5d  b4 9c b7 4e 20 97 cc d9  |P.&.+ij]...N ...|
+00000330  43 94 9f 4d 2b d1 72 24  a7 a8 3e 7d 9e 84 7a 98  |C..M+.r$..>}..z.|
+00000340  23 64 7b b9 17 15 d6 27  80 6c 60 2d 38 c7 4d cd  |#d{....'.l`-8.M.|
+00000350  9a 87 d6 ab 31 8d 59 62  58 b4 11 f4 2e d5 81 10  |....1.YbX.......|
+00000360  87 e5 58 3e 37 99 37 af  68 6f 11 cc 0b a2 f1 d1  |..X>7.7.ho......|
+00000370  b0 17 03 03 00 35 be f6  19 d0 66 ec cd 14 d5 28  |.....5....f....(|
+00000380  b8 bf 0d f4 37 5d 55 3d  2e 2c 1e 0c 62 0a 49 3e  |....7]U=.,..b.I>|
+00000390  df cf c2 dc 2c 27 df 54  64 67 8d 33 8b f0 b1 50  |....,'.Tdg.3...P|
+000003a0  c5 dd fc 47 5c e7 58 5b  74 57 4b                 |...G\.X[tWK|
 >>> Flow 3 (client to server)
-00000000  17 03 03 00 35 50 19 ff  67 64 b8 80 c8 ed 81 0c  |....5P..gd......|
-00000010  00 ab e0 d6 d4 3b 74 0f  89 a6 23 f3 0b 84 e3 a9  |.....;t...#.....|
-00000020  73 67 14 03 ba b4 42 69  0a dc dc 99 d6 be 9b 61  |sg....Bi.......a|
-00000030  96 21 57 1e 54 ca dc 1b  df e7 17 03 03 00 17 ef  |.!W.T...........|
-00000040  42 23 91 2c b5 5d 1f 2c  1f db 5e d1 24 be 79 7a  |B#.,.].,..^.$.yz|
-00000050  9f 1a 2f 0c 71 4c 17 03  03 00 13 ad 90 35 ea 7f  |../.qL.......5..|
-00000060  3b 23 ca da 36 fd 02 97  d6 cd d2 84 c6 57        |;#..6........W|
+00000000  14 03 03 00 01 01 17 03  03 00 35 2d 01 39 11 82  |..........5-.9..|
+00000010  67 c7 e5 db 3f dd 18 c3  0b 0a 25 8a 24 2e e1 f4  |g...?.....%.$...|
+00000020  5e a2 0f 8a 1c 70 83 26  d0 5d b1 8d cf c6 69 a9  |^....p.&.]....i.|
+00000030  38 8c 14 22 74 4a 85 fe  f5 86 e6 c2 07 44 bf 87  |8.."tJ.......D..|
+00000040  17 03 03 00 17 a8 2f 45  46 d9 59 7e 5f 4c 9e 46  |....../EF.Y~_L.F|
+00000050  09 e4 38 e1 e3 e3 5e ab  62 14 eb 2f              |..8...^.b../|
+>>> Flow 4 (server to client)
+00000000  17 03 03 00 da 41 7f 38  18 5c d5 fc c7 ba 60 66  |.....A.8.\....`f|
+00000010  d6 92 60 81 83 bc f3 35  ff 00 ef 4b 99 48 de 1c  |..`....5...K.H..|
+00000020  aa 1c f8 80 6d 59 48 30  83 03 ad fd e3 15 23 16  |....mYH0......#.|
+00000030  aa c8 d7 71 58 df 65 fc  8c d3 77 56 f4 19 f2 5e  |...qX.e...wV...^|
+00000040  c2 d5 15 1b b7 9a 46 68  81 68 c6 2b be 81 f2 f5  |......Fh.h.+....|
+00000050  5a 71 81 55 10 0f 09 9a  9a 9e c4 be 28 db fa 50  |Zq.U........(..P|
+00000060  f6 fa 88 5b c6 63 35 77  8c d0 1b 4a 50 b8 42 6d  |...[.c5w...JP.Bm|
+00000070  5d f5 b7 5a 5e 73 0f 12  ba 86 92 44 23 bc 70 e1  |]..Z^s.....D#.p.|
+00000080  3d f4 1b 20 87 e6 c2 89  43 2a 76 7f e3 8f 2c db  |=.. ....C*v...,.|
+00000090  86 31 4a 38 5b 5e 44 3e  6c 72 be 13 a5 77 d2 90  |.1J8[^D>lr...w..|
+000000a0  95 80 35 c6 c9 1b 0e ea  b8 0a 18 65 78 23 e4 0e  |..5........ex#..|
+000000b0  bc 67 86 5b 6a 77 32 66  f3 38 89 01 86 d3 c2 3e  |.g.[jw2f.8.....>|
+000000c0  93 70 57 11 07 1a be 26  3c 69 f8 8b 3b c3 4a 1c  |.pW....&<i..;.J.|
+000000d0  e5 bf 9c 48 20 6b 9c 91  eb ff 14 af 44 93 35 17  |...H k......D.5.|
+000000e0  03 03 00 da 42 0b c1 73  60 66 cf c6 f1 25 bc d2  |....B..s`f...%..|
+000000f0  da 72 0b 8d aa 32 82 35  70 3a e2 fa 4c 30 fd d4  |.r...2.5p:..L0..|
+00000100  12 3c 29 a5 41 71 7e e9  3a 64 61 7d e6 c3 60 3f  |.<).Aq~.:da}..`?|
+00000110  d8 e3 db b4 f9 f6 59 02  96 e3 2a 2a d1 96 70 8e  |......Y...**..p.|
+00000120  98 ec a0 84 79 46 53 3c  b1 0b a5 d8 78 6b 82 06  |....yFS<....xk..|
+00000130  43 af 5a 5a 68 b6 4e 6d  30 eb 81 63 1a 2d 72 0a  |C.ZZh.Nm0..c.-r.|
+00000140  0e 2b 68 b4 20 12 77 ef  9b d6 c4 f0 4a 59 47 86  |.+h. .w.....JYG.|
+00000150  05 59 9e 68 25 54 8d 72  04 bf 50 cf 44 0a fc 0c  |.Y.h%T.r..P.D...|
+00000160  6a bf af 26 08 7d e6 c4  3b 69 a5 7f f0 11 0c 7f  |j..&.}..;i......|
+00000170  87 bf 84 02 7b af 2e 03  35 c4 d3 36 aa da 4a e7  |....{...5..6..J.|
+00000180  eb 77 23 bd 4d e6 df 08  2a 76 47 6b 7d 04 42 20  |.w#.M...*vGk}.B |
+00000190  be 82 51 d3 af df 98 c1  6e 5d 21 da a0 da 7c 5c  |..Q.....n]!...|\|
+000001a0  29 ee 62 bb a3 aa f8 76  09 77 f4 5c 56 94 75 27  |).b....v.w.\V.u'|
+000001b0  30 4a 60 18 e8 67 9f 7d  38 ec 34 6d 9c 0e        |0J`..g.}8.4m..|
+>>> Flow 5 (client to server)
+00000000  17 03 03 00 13 d2 5d 20  07 4c 51 50 40 86 e8 36  |......] .LQP@..6|
+00000010  59 ba c4 f6 13 ab 29 1f                           |Y.....).|
diff --git a/src/crypto/tls/testdata/Client-TLSv13-ExportKeyingMaterial b/src/crypto/tls/testdata/Client-TLSv13-ExportKeyingMaterial
index 5778ef7b56..2045af72f4 100644
--- a/src/crypto/tls/testdata/Client-TLSv13-ExportKeyingMaterial
+++ b/src/crypto/tls/testdata/Client-TLSv13-ExportKeyingMaterial
@@ -16,74 +16,107 @@
 000000e0  a3 47 cd 62 43 15 28 da  ac 5f bb 29 07 30 ff f6  |.G.bC.(.._.).0..|
 000000f0  84 af c4 cf c2 ed 90 99  5f 58 cb 3b 74           |........_X.;t|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 7a 02 00 00  76 03 03 a6 29 2f 1c 88  |....z...v...)/..|
-00000010  12 96 7a 88 1c dc f7 ca  dc 1e 6e e2 a7 09 65 01  |..z.......n...e.|
-00000020  28 3a c1 58 01 6a ed 8d  18 fe b7 20 00 00 00 00  |(:.X.j..... ....|
+00000000  16 03 03 00 7a 02 00 00  76 03 03 da 33 a6 d1 76  |....z...v...3..v|
+00000010  5f 72 df d4 59 9b 94 e8  e3 04 a6 c3 f0 58 4d 44  |_r..Y........XMD|
+00000020  08 e8 1e 41 c0 25 4c 0c  de c0 36 20 00 00 00 00  |...A.%L...6 ....|
 00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000040  00 00 00 00 00 00 00 00  00 00 00 00 13 01 00 00  |................|
-00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 ab  |..+.....3.$... .|
-00000060  5a f1 b4 52 1d 1c 87 fb  b3 9e f2 f9 ee d1 f1 ff  |Z..R............|
-00000070  66 3e 01 70 41 6f 01 45  4a d0 3a 98 d3 e4 50 14  |f>.pAo.EJ.:...P.|
-00000080  03 03 00 01 01 17 03 03  00 17 38 75 a9 bf e3 61  |..........8u...a|
-00000090  2f 8a 58 1d 28 6b b5 25  83 c9 d8 86 31 38 ee 6d  |/.X.(k.%....18.m|
-000000a0  c1 17 03 03 02 6d cb 78  87 73 70 3d c4 e4 de d9  |.....m.x.sp=....|
-000000b0  2d 22 f0 cf 35 9e c1 0a  ac 97 88 75 20 8f 63 b1  |-"..5......u .c.|
-000000c0  2f c0 c9 4d 86 7f d6 6b  3a 2e b6 c1 e3 d4 73 f4  |/..M...k:.....s.|
-000000d0  f7 2b 4f 86 6f f0 fd ed  2a dd 17 98 5e e6 32 e9  |.+O.o...*...^.2.|
-000000e0  48 5e 48 36 e0 f8 d3 a4  93 54 7b 17 c5 46 ea d5  |H^H6.....T{..F..|
-000000f0  6b 0f 5b bd 1d 3c 15 b1  c2 3f 2f 91 e5 d3 dd 75  |k.[..<...?/....u|
-00000100  c5 c7 73 f7 ce a2 6e e1  bc 10 2a b7 0f 5e 7d cc  |..s...n...*..^}.|
-00000110  3e 22 3c 71 37 3f ba f0  44 3b 55 c8 5c a7 19 f2  |>"<q7?..D;U.\...|
-00000120  41 e9 55 82 3c ea 9b d3  d8 04 28 35 e4 6b bf 6c  |A.U.<.....(5.k.l|
-00000130  26 12 f0 e1 9f 5d b5 f3  71 68 b7 3f 8c 6f 43 f4  |&....]..qh.?.oC.|
-00000140  e9 f2 e4 aa ca 47 ba 65  d4 f4 82 c3 4b 9a 06 05  |.....G.e....K...|
-00000150  65 28 74 85 f1 52 ac 37  da 1e 63 84 3e 9a c2 a2  |e(t..R.7..c.>...|
-00000160  28 a4 ac 75 1b 3b 7f 85  cb 2c 9c 64 09 38 75 59  |(..u.;...,.d.8uY|
-00000170  33 0e 7f fe 93 0f 8a 67  5f 5e 86 c4 74 40 7f 0b  |3......g_^..t@..|
-00000180  f8 82 03 9c 8d 37 39 12  a9 20 cb 31 c5 40 f6 23  |.....79.. .1.@.#|
-00000190  78 71 20 e3 8a a8 81 ab  6c 98 43 67 f8 2b a9 6f  |xq .....l.Cg.+.o|
-000001a0  41 2a 80 7f 1c 11 6d ae  ea cf d9 6a 3c 11 74 72  |A*....m....j<.tr|
-000001b0  86 e4 ab ee 1a f2 58 ce  e2 8f d6 4e 06 57 e9 33  |......X....N.W.3|
-000001c0  e9 ef 5a af 19 5c eb 9a  a4 df ed 9f d3 55 00 d9  |..Z..\.......U..|
-000001d0  2c 09 3f c5 58 4f 08 22  2e 9c 63 9b 53 92 07 83  |,.?.XO."..c.S...|
-000001e0  b7 96 82 de 46 5b 35 b8  ff d2 52 96 66 2a ce ed  |....F[5...R.f*..|
-000001f0  93 b1 6a be ab 91 6b 1f  b1 bc 35 1f 11 6a 48 a6  |..j...k...5..jH.|
-00000200  20 63 62 8f e4 e4 07 4b  be 79 37 d6 98 00 64 9e  | cb....K.y7...d.|
-00000210  17 f4 48 65 71 21 0c 79  30 32 a1 eb f5 9a be 5a  |..Heq!.y02.....Z|
-00000220  8d 7b 17 dd af c4 06 78  3b 0d a9 4a d8 f1 a8 6d  |.{.....x;..J...m|
-00000230  3d cf 52 a6 34 9d 3a 1c  ee ff 83 7a d1 23 47 f1  |=.R.4.:....z.#G.|
-00000240  65 9d 57 61 66 d9 66 bd  e7 63 ca b9 22 07 36 0b  |e.Waf.f..c..".6.|
-00000250  5b 9a 20 59 19 25 49 54  a0 3b bf 28 24 5c 58 76  |[. Y.%IT.;.($\Xv|
-00000260  1a a9 68 e9 90 dd 6a 66  d8 f3 d3 60 e4 3d af 3a  |..h...jf...`.=.:|
-00000270  49 d1 0e b8 39 a2 b6 e3  15 6e c0 ff 0d 57 48 05  |I...9....n...WH.|
-00000280  c1 44 01 59 fa 9b f7 90  bc 7b 05 c4 f0 1f e8 9f  |.D.Y.....{......|
-00000290  02 c5 2a 89 7d 1e c4 75  bc b9 af d2 17 89 79 9d  |..*.}..u......y.|
-000002a0  3c aa 55 db 24 e7 35 08  a0 6d 88 79 61 af 01 82  |<.U.$.5..m.ya...|
-000002b0  82 b7 4a f0 d4 89 38 6a  fc 82 97 5e 77 09 87 45  |..J...8j...^w..E|
-000002c0  5e 2f 21 8c 39 4e 98 76  76 ab 16 25 8e f0 d2 5c  |^/!.9N.vv..%...\|
-000002d0  a6 ad bd 18 f3 78 f4 2a  b2 ac 36 67 2b 67 6a 43  |.....x.*..6g+gjC|
-000002e0  95 d6 63 f8 b5 9f 7d 84  26 83 83 3c d3 7a 3b 52  |..c...}.&..<.z;R|
-000002f0  68 de f0 d8 49 7f bc 56  b4 70 16 74 ee fa 5b 7b  |h...I..V.p.t..[{|
-00000300  36 50 6a 54 26 02 7a 3c  ee 0b f9 2e a1 20 5c 44  |6PjT&.z<..... \D|
-00000310  fd fe fc 17 03 03 00 99  69 60 73 ea a0 71 1a 5e  |........i`s..q.^|
-00000320  c4 ea 67 f7 b2 e0 34 7c  cc 55 67 f3 87 43 c9 68  |..g...4|.Ug..C.h|
-00000330  a6 02 84 1d 6c de 1d 90  4c 82 01 5c a5 16 39 97  |....l...L..\..9.|
-00000340  67 45 7f fb 0e 43 24 4e  ea c5 7b eb f5 bc 1f b6  |gE...C$N..{.....|
-00000350  70 2e 95 e4 61 20 f0 8b  24 54 2e 43 9c f1 82 56  |p...a ..$T.C...V|
-00000360  9c ca 28 96 64 57 85 a4  e1 d0 f4 be ea b4 7b a2  |..(.dW........{.|
-00000370  23 aa 4f c6 06 9c e7 81  eb 4b 62 93 af 93 1c cf  |#.O......Kb.....|
-00000380  2b fd 5f bd a7 07 e9 c3  c8 97 c1 e4 df f4 74 06  |+._...........t.|
-00000390  62 01 32 0c ec a2 40 86  c1 7e da e9 1e 7e 46 67  |b.2...@..~...~Fg|
-000003a0  8a c6 ef b5 ce ac 3e 44  fa b0 ff b6 c4 20 aa 65  |......>D..... .e|
-000003b0  fb 17 03 03 00 35 c1 a6  e0 e5 bf 91 7a ec 17 85  |.....5......z...|
-000003c0  38 1e 32 1e 92 4e 9c 38  8c 02 1b 08 03 0e a3 a2  |8.2..N.8........|
-000003d0  8f 2b 73 76 c1 99 48 de  e7 39 cf a8 97 e4 30 e6  |.+sv..H..9....0.|
-000003e0  75 52 3a f4 6f bf 67 bd  87 c5 30                 |uR:.o.g...0|
+00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 44  |..+.....3.$... D|
+00000060  7f a7 d1 f1 38 fa c2 00  dd 48 44 20 b9 32 0b 16  |....8....HD .2..|
+00000070  d4 a6 72 da cb c9 23 52  c9 fb b9 b5 2d a0 62 14  |..r...#R....-.b.|
+00000080  03 03 00 01 01 17 03 03  00 17 d5 8b b4 47 9e 59  |.............G.Y|
+00000090  ff 8b 7e bd 0b 61 97 62  14 78 56 85 a4 45 37 0a  |..~..a.b.xV..E7.|
+000000a0  fa 17 03 03 02 6d 2d e1  4d 15 4f 8b 0a 55 f4 ed  |.....m-.M.O..U..|
+000000b0  eb a8 ba e3 ba 65 b2 94  ed ca 94 18 cb e9 31 86  |.....e........1.|
+000000c0  38 0a 61 78 e6 19 38 28  7c e6 8e a3 d2 01 4f 16  |8.ax..8(|.....O.|
+000000d0  90 ce a9 db 64 e8 ec a1  97 01 04 4a ce dd f2 0f  |....d......J....|
+000000e0  f8 1c 25 4d 28 d5 07 33  f9 fd c4 f3 f9 26 15 2f  |..%M(..3.....&./|
+000000f0  66 ef f0 82 49 1b 3d a0  99 ee 27 61 d3 0f 9c d5  |f...I.=...'a....|
+00000100  85 3b 49 54 5d 58 7b 0c  e2 97 e5 ac b1 10 d5 73  |.;IT]X{........s|
+00000110  f8 18 57 2d 7a e2 15 7f  a0 e2 07 c1 7a 16 d0 05  |..W-z.......z...|
+00000120  df 2e 29 fc c4 59 2a 7c  63 2e 7e e2 b8 75 92 35  |..)..Y*|c.~..u.5|
+00000130  f6 92 e4 1e e4 43 dc 25  64 e0 32 9f fe 0a 76 d7  |.....C.%d.2...v.|
+00000140  ee 08 f0 e3 e9 02 bc 93  d8 db d2 11 28 df b1 05  |............(...|
+00000150  fa fe 70 ef 73 e7 ca f1  a1 e1 95 a1 c6 05 30 0c  |..p.s.........0.|
+00000160  23 5c 5f d0 77 f0 7e 85  cc 2d 0b 88 41 7a 95 11  |#\_.w.~..-..Az..|
+00000170  6b 87 df 6e 5b 4a e4 7a  7a bf 42 f6 d1 fa 8e e5  |k..n[J.zz.B.....|
+00000180  96 5f 3b 2e 02 ba c9 f8  40 77 9c ed 81 82 29 2b  |._;.....@w....)+|
+00000190  8f 97 5e 97 de ff 5f 30  c1 06 66 c7 b4 33 b9 eb  |..^..._0..f..3..|
+000001a0  ca ee ff 42 db 8e 9c 18  0c 19 0a a4 d0 b7 e2 74  |...B...........t|
+000001b0  be d1 6f 79 ea a0 32 44  50 16 86 41 2d d8 4f 5c  |..oy..2DP..A-.O\|
+000001c0  c1 16 b2 6c a6 5a 49 e9  a1 ff 79 9c b1 23 41 eb  |...l.ZI...y..#A.|
+000001d0  35 1a a8 f2 21 ff f5 54  a2 92 26 61 f6 53 2c e8  |5...!..T..&a.S,.|
+000001e0  c9 4d 1e 42 2b bd de c0  78 f5 9f d0 b4 1e 30 e9  |.M.B+...x.....0.|
+000001f0  0a e0 71 50 f6 72 c2 15  1f 93 72 15 c9 3e bc ab  |..qP.r....r..>..|
+00000200  96 04 e3 5c 4a ee 6f 64  87 b1 ec d4 ca 76 ab 4e  |...\J.od.....v.N|
+00000210  cf 6e 32 7a 39 15 66 3e  e0 67 10 9c 3c 59 d1 31  |.n2z9.f>.g..<Y.1|
+00000220  77 21 4c b3 7d 85 82 b6  7d a0 89 5f 08 39 d8 37  |w!L.}...}.._.9.7|
+00000230  67 b3 0b b9 eb dd d8 11  ab 8f 9e 7b bb c0 c4 60  |g..........{...`|
+00000240  0e 62 31 3b 80 4c fd c5  08 9b 32 b0 0d af b5 1b  |.b1;.L....2.....|
+00000250  23 9a 18 66 ad 75 85 62  fc da e5 2f 0c 9a 26 d4  |#..f.u.b.../..&.|
+00000260  47 26 58 cc 1d 0b 7a e3  f9 a9 52 ac 69 31 73 b6  |G&X...z...R.i1s.|
+00000270  31 61 99 6b 38 d7 0d 09  4f 95 72 fc b1 a5 0b 48  |1a.k8...O.r....H|
+00000280  f1 66 41 69 e9 4c 33 73  fd 55 32 93 a3 92 55 ee  |.fAi.L3s.U2...U.|
+00000290  0c aa ef ed 46 70 68 1b  4e 87 32 53 21 fd 5e da  |....Fph.N.2S!.^.|
+000002a0  0a 27 81 88 46 ba 10 08  f7 7d 43 e0 e5 41 22 8d  |.'..F....}C..A".|
+000002b0  dd 39 b3 ee 02 7d c7 27  63 7a d0 f1 78 5c cf 56  |.9...}.'cz..x\.V|
+000002c0  32 7d 29 2d 90 c7 bc cf  fb 44 79 dc c2 03 eb 03  |2})-.....Dy.....|
+000002d0  88 7a 57 fc cc 74 de 28  d3 5e 9f f1 1a 50 34 25  |.zW..t.(.^...P4%|
+000002e0  34 37 36 94 c6 61 d5 00  c7 da 4d d4 7b 22 9d dc  |476..a....M.{"..|
+000002f0  ea 4e ff c8 94 4b 4a a6  af a4 fa 81 01 92 cb 08  |.N...KJ.........|
+00000300  42 08 6e 7e cc 89 2f de  2e 4d 89 e3 58 48 0d 20  |B.n~../..M..XH. |
+00000310  8c 5c 0e 17 03 03 00 99  d0 d0 4f ec e9 40 14 8d  |.\........O..@..|
+00000320  12 aa c8 dd b9 64 62 02  6c 76 be 3d 97 77 65 36  |.....db.lv.=.we6|
+00000330  43 da 7f 60 90 d5 1e 69  bf bb c7 d8 e1 25 54 38  |C..`...i.....%T8|
+00000340  44 72 ee c2 fb 3d 07 bc  44 82 74 48 4a c9 c2 28  |Dr...=..D.tHJ..(|
+00000350  6e 95 67 85 49 24 99 e6  fb 72 60 84 3a 98 15 21  |n.g.I$...r`.:..!|
+00000360  ff fd bc 1b 2e 7d 43 db  dc 70 ea 1c 19 67 f6 55  |.....}C..p...g.U|
+00000370  52 c5 03 91 4d 0a cb 59  d4 76 b0 53 7b 99 2a a3  |R...M..Y.v.S{.*.|
+00000380  60 71 36 55 27 d7 16 bb  a4 dc e8 a9 e8 8f e8 a4  |`q6U'...........|
+00000390  f6 43 1f 73 d9 b9 65 a9  06 55 e6 0a 17 32 40 34  |.C.s..e..U...2@4|
+000003a0  d4 23 7d c1 d2 ae 5d 9e  c4 d9 35 22 2c c4 71 cd  |.#}...]...5",.q.|
+000003b0  e0 17 03 03 00 35 3f 7b  f8 cd 3b e4 7b 52 3a ed  |.....5?{..;.{R:.|
+000003c0  04 2e 80 d1 bc d7 3f 0b  2f 03 98 ee a6 9b 4b fe  |......?./.....K.|
+000003d0  ff 0c 3b 8d 81 b4 e2 50  d0 07 a4 9c f7 f8 8b 59  |..;....P.......Y|
+000003e0  fe 78 e0 21 d7 9b 50 99  df 01 a9                 |.x.!..P....|
 >>> Flow 3 (client to server)
-00000000  17 03 03 00 35 be 06 09  fb e0 58 83 8e 27 5a c0  |....5.....X..'Z.|
-00000010  8a 4c 56 ad 79 29 90 99  47 21 2f d4 f4 98 81 a8  |.LV.y)..G!/.....|
-00000020  e8 55 d6 bd 26 b1 a9 48  34 ff 40 66 7e 2e 83 ea  |.U..&..H4.@f~...|
-00000030  ed fe a0 01 73 0b 91 1f  c0 1d 17 03 03 00 17 ee  |....s...........|
-00000040  58 ac 2a e7 26 72 e3 c7  81 2c 02 0f 57 39 56 4f  |X.*.&r...,..W9VO|
-00000050  43 7a 2d a7 f4 d8 17 03  03 00 13 94 2c 15 0b 04  |Cz-.........,...|
-00000060  7a aa 78 3b a6 b8 23 f1  75 b4 b5 2e e7 94        |z.x;..#.u.....|
+00000000  14 03 03 00 01 01 17 03  03 00 35 c3 68 6c 59 46  |..........5.hlYF|
+00000010  70 ff b5 04 41 bd c5 66  a4 da cd df 04 f8 7e f9  |p...A..f......~.|
+00000020  a2 7b 0d f2 e6 cc 0c 30  df a9 66 4d 09 09 dc bf  |.{.....0..fM....|
+00000030  f4 5c 5e 30 5a 6d 2f bc  48 33 21 2b cb 6a ce f7  |.\^0Zm/.H3!+.j..|
+00000040  17 03 03 00 17 9a d0 31  9a c5 c4 4b 59 e3 a4 74  |.......1...KY..t|
+00000050  c5 d1 c5 09 a0 5e 08 48  fd 49 df 61              |.....^.H.I.a|
+>>> Flow 4 (server to client)
+00000000  17 03 03 00 ea c7 4f b3  d0 32 fa 3d 4e e8 58 ea  |......O..2.=N.X.|
+00000010  d1 8c 9a ed 6d bc 41 ae  22 58 d2 cb 9b 16 4f 45  |....m.A."X....OE|
+00000020  91 86 8d 9f 9f 50 be 4d  f7 11 c9 ea 20 57 29 f8  |.....P.M.... W).|
+00000030  f3 78 8e e3 99 a1 8d 53  52 f0 1d 0a ef 64 cf 19  |.x.....SR....d..|
+00000040  9f 6f b7 c3 11 27 07 d6  1a 61 39 75 26 9b 41 a1  |.o...'...a9u&.A.|
+00000050  4d a2 a2 cd 59 c5 35 f3  58 ff 52 60 ba 04 54 3c  |M...Y.5.X.R`..T<|
+00000060  1b 2d 55 81 76 c9 59 af  b8 5e 46 4d 09 58 6c 55  |.-U.v.Y..^FM.XlU|
+00000070  66 1e d2 f5 7c bb 5e b0  e5 91 19 b0 be 32 04 46  |f...|.^......2.F|
+00000080  20 10 f2 75 55 5e 30 96  9d da 37 07 dc df 1d 6f  | ..uU^0...7....o|
+00000090  c3 f1 d5 b6 db 85 d9 04  d4 13 5b ba 83 20 17 ae  |..........[.. ..|
+000000a0  68 05 71 d5 72 46 ba 23  ad ab 76 60 68 6a d7 12  |h.q.rF.#..v`hj..|
+000000b0  91 55 07 bb b4 2b 40 9f  d1 75 6c 36 28 89 89 3d  |.U...+@..ul6(..=|
+000000c0  9a 73 25 7a 7e 49 56 4c  92 32 74 ad 49 52 a1 09  |.s%z~IVL.2t.IR..|
+000000d0  3f 02 62 fe a5 de 80 8c  93 01 de bd 59 5b 95 01  |?.b.........Y[..|
+000000e0  f1 62 5f 22 f6 e3 e6 27  ed b7 4b 81 7f 13 13 17  |.b_"...'..K.....|
+000000f0  03 03 00 ea 24 b0 f9 84  63 59 2b 30 09 4d 6e 44  |....$...cY+0.MnD|
+00000100  13 db 38 db 42 9f 20 7f  df f0 73 12 76 0d a5 57  |..8.B. ...s.v..W|
+00000110  0c 36 21 7d f6 26 98 66  67 4f 07 8d b0 25 6b 7b  |.6!}.&.fgO...%k{|
+00000120  7c d7 c0 3d b0 33 8b 87  15 e6 23 6f b5 5a 77 98  ||..=.3....#o.Zw.|
+00000130  d8 a7 d2 94 84 2a 7e 05  b2 ba 95 87 1d f5 44 54  |.....*~.......DT|
+00000140  33 32 9f 8e df ff 91 77  21 fe db 6e f6 bd 9f 2b  |32.....w!..n...+|
+00000150  63 43 a9 c4 94 e8 b7 22  ed 6f 03 42 12 95 17 fb  |cC.....".o.B....|
+00000160  7f 83 ca 8e dd 29 08 52  40 fe 2a aa f1 f2 29 b8  |.....).R@.*...).|
+00000170  5e e4 8f b7 67 a5 71 4d  4b 79 cf 5d 5d f2 72 44  |^...g.qMKy.]].rD|
+00000180  c2 3e a2 54 18 fc 58 33  d6 4c 2c bd d9 52 08 1f  |.>.T..X3.L,..R..|
+00000190  3e c3 58 bf 86 80 ad cc  8f 55 a1 b0 fb 96 e6 94  |>.X......U......|
+000001a0  43 be a6 14 b0 10 d4 27  38 93 b6 de 1d e1 3e e8  |C......'8.....>.|
+000001b0  8a 06 3c 65 49 5a fb 70  4b f7 01 eb 2a ff b0 e0  |..<eIZ.pK...*...|
+000001c0  74 ab fe bf a8 fb f8 45  c8 d6 92 f4 0c a3 d3 fb  |t......E........|
+000001d0  35 32 51 98 04 84 95 75  62 d9 8a 4d 0c b7        |52Q....ub..M..|
+>>> Flow 5 (client to server)
+00000000  17 03 03 00 13 4b 79 39  94 f7 13 0c 77 5a 78 47  |.....Ky9....wZxG|
+00000010  fe e6 e8 41 96 49 84 53                           |...A.I.S|
diff --git a/src/crypto/tls/testdata/Client-TLSv13-HelloRetryRequest b/src/crypto/tls/testdata/Client-TLSv13-HelloRetryRequest
index 76961c6be7..8dac31adb6 100644
--- a/src/crypto/tls/testdata/Client-TLSv13-HelloRetryRequest
+++ b/src/crypto/tls/testdata/Client-TLSv13-HelloRetryRequest
@@ -24,95 +24,126 @@
 00000050  0c 00 2b 00 02 03 04 00  33 00 02 00 17 14 03 03  |..+.....3.......|
 00000060  00 01 01                                          |...|
 >>> Flow 3 (client to server)
-00000000  16 03 03 01 15 01 00 01  11 03 03 00 00 00 00 00  |................|
-00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000020  00 00 00 00 00 00 00 00  00 00 00 20 00 00 00 00  |........... ....|
-00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000040  00 00 00 00 00 00 00 00  00 00 00 00 00 32 cc a8  |.............2..|
-00000050  cc a9 c0 2f c0 2b c0 30  c0 2c c0 27 c0 13 c0 23  |.../.+.0.,.'...#|
-00000060  c0 09 c0 14 c0 0a 00 9c  00 9d 00 3c 00 2f 00 35  |...........<./.5|
-00000070  c0 12 00 0a 00 05 c0 11  c0 07 13 01 13 03 13 02  |................|
-00000080  01 00 00 96 00 05 00 05  01 00 00 00 00 00 0a 00  |................|
-00000090  06 00 04 00 1d 00 17 00  0b 00 02 01 00 00 0d 00  |................|
-000000a0  18 00 16 08 04 08 05 08  06 04 01 04 03 05 01 05  |................|
-000000b0  03 06 01 06 03 02 01 02  03 ff 01 00 01 00 00 12  |................|
-000000c0  00 00 00 2b 00 09 08 03  04 03 03 03 02 03 01 00  |...+............|
-000000d0  33 00 47 00 45 00 17 00  41 04 1e 18 37 ef 0d 19  |3.G.E...A...7...|
-000000e0  51 88 35 75 71 b5 e5 54  5b 12 2e 8f 09 67 fd a7  |Q.5uq..T[....g..|
-000000f0  24 20 3e b2 56 1c ce 97  28 5e f8 2b 2d 4f 9e f1  |$ >.V...(^.+-O..|
-00000100  07 9f 6c 4b 5b 83 56 e2  32 42 e9 58 b6 d7 49 a6  |..lK[.V.2B.X..I.|
-00000110  b5 68 1a 41 03 56 6b dc  5a 89                    |.h.A.Vk.Z.|
+00000000  14 03 03 00 01 01 16 03  03 01 15 01 00 01 11 03  |................|
+00000010  03 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
+00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
+00000030  00 20 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |. ..............|
+00000040  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
+00000050  00 00 00 32 cc a8 cc a9  c0 2f c0 2b c0 30 c0 2c  |...2...../.+.0.,|
+00000060  c0 27 c0 13 c0 23 c0 09  c0 14 c0 0a 00 9c 00 9d  |.'...#..........|
+00000070  00 3c 00 2f 00 35 c0 12  00 0a 00 05 c0 11 c0 07  |.<./.5..........|
+00000080  13 01 13 03 13 02 01 00  00 96 00 05 00 05 01 00  |................|
+00000090  00 00 00 00 0a 00 06 00  04 00 1d 00 17 00 0b 00  |................|
+000000a0  02 01 00 00 0d 00 18 00  16 08 04 08 05 08 06 04  |................|
+000000b0  01 04 03 05 01 05 03 06  01 06 03 02 01 02 03 ff  |................|
+000000c0  01 00 01 00 00 12 00 00  00 2b 00 09 08 03 04 03  |.........+......|
+000000d0  03 03 02 03 01 00 33 00  47 00 45 00 17 00 41 04  |......3.G.E...A.|
+000000e0  1e 18 37 ef 0d 19 51 88  35 75 71 b5 e5 54 5b 12  |..7...Q.5uq..T[.|
+000000f0  2e 8f 09 67 fd a7 24 20  3e b2 56 1c ce 97 28 5e  |...g..$ >.V...(^|
+00000100  f8 2b 2d 4f 9e f1 07 9f  6c 4b 5b 83 56 e2 32 42  |.+-O....lK[.V.2B|
+00000110  e9 58 b6 d7 49 a6 b5 68  1a 41 03 56 6b dc 5a 89  |.X..I..h.A.Vk.Z.|
 >>> Flow 4 (server to client)
-00000000  16 03 03 00 9b 02 00 00  97 03 03 7b 87 0f 37 7b  |...........{..7{|
-00000010  8a c3 85 98 1c 19 61 a4  bd 12 06 b5 72 58 09 24  |......a.....rX.$|
-00000020  c7 ab c0 12 f7 b7 b5 69  c2 05 46 20 00 00 00 00  |.......i..F ....|
+00000000  16 03 03 00 9b 02 00 00  97 03 03 40 bb fc 8b c3  |...........@....|
+00000010  21 f3 14 d1 8d 63 52 bd  36 eb 78 47 3c 6e 8e 11  |!....cR.6.xG<n..|
+00000020  9e 51 c4 58 8c 32 6f b5  23 31 e7 20 00 00 00 00  |.Q.X.2o.#1. ....|
 00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000040  00 00 00 00 00 00 00 00  00 00 00 00 13 01 00 00  |................|
 00000050  4f 00 2b 00 02 03 04 00  33 00 45 00 17 00 41 04  |O.+.....3.E...A.|
-00000060  95 47 67 c9 ae 36 1b 3f  b7 b7 21 15 ab 11 9f de  |.Gg..6.?..!.....|
-00000070  4d 06 76 61 be 86 9e 79  c9 e9 9d 62 95 8e b7 f9  |M.va...y...b....|
-00000080  c7 e1 9f 79 08 f0 98 76  54 22 90 c1 fa 15 56 99  |...y...vT"....V.|
-00000090  21 64 93 92 78 9a 52 3c  4e e7 b1 39 be 25 88 af  |!d..x.R<N..9.%..|
-000000a0  17 03 03 00 17 bb 8b df  b4 49 c6 1a 38 40 74 97  |.........I..8@t.|
-000000b0  4a c1 5f 9c 34 a4 b3 19  5c 90 e3 6a 17 03 03 02  |J._.4...\..j....|
-000000c0  6d 2a 17 d7 28 77 3c 60  4f 8b 1a 55 2b a4 16 fd  |m*..(w<`O..U+...|
-000000d0  ce 37 a1 48 4a 39 ac a9  b1 a6 d2 b2 9c 59 12 a3  |.7.HJ9.......Y..|
-000000e0  31 f3 92 d1 13 bc c4 43  f9 28 1b 97 63 9d ce df  |1......C.(..c...|
-000000f0  aa 71 b4 c8 16 03 53 09  8a b1 f2 ff 08 15 b0 c7  |.q....S.........|
-00000100  2a d2 13 23 ba 26 4e f1  df 78 4f d4 ff 93 11 7f  |*..#.&N..xO.....|
-00000110  04 47 08 fd b7 9c 5d 8e  5e 95 d0 85 a7 cc 01 09  |.G....].^.......|
-00000120  9a 8e fb 8d ab 39 e8 60  8d 58 6c 66 9d 2b a4 76  |.....9.`.Xlf.+.v|
-00000130  58 9f d5 57 ad a8 65 82  c8 d1 12 1b c5 25 47 fe  |X..W..e......%G.|
-00000140  4e f5 46 54 fc 43 5a a4  a6 b8 ae 24 cc 6a dd ab  |N.FT.CZ....$.j..|
-00000150  3e 17 6d d2 d4 b6 51 41  6c 9e 86 e8 c6 e9 b4 74  |>.m...QAl......t|
-00000160  ac 8c 12 df ba c6 bb e9  90 1c e9 ed e1 9c 28 d4  |..............(.|
-00000170  50 89 88 09 06 61 2e 27  c6 60 26 86 91 f2 37 a2  |P....a.'.`&...7.|
-00000180  83 67 ac c4 3f e7 6d 9c  30 de 74 a0 2e b9 0e 6b  |.g..?.m.0.t....k|
-00000190  de 4a 73 4d 67 9a ee 45  c7 5e bc d1 bb bb 01 67  |.JsMg..E.^.....g|
-000001a0  cd b2 e6 c6 fa 3c e1 59  d9 e0 c9 85 5d 76 8d c8  |.....<.Y....]v..|
-000001b0  ed 83 cd eb 88 51 d6 05  9f 0c 45 81 66 07 7c 2d  |.....Q....E.f.|-|
-000001c0  dd 6f 35 fd 76 d0 03 00  46 d9 f7 87 fe e4 8f bc  |.o5.v...F.......|
-000001d0  1b 69 6a 97 38 82 46 5e  fe f6 a6 8a 0c 1a 6d 7f  |.ij.8.F^......m.|
-000001e0  4d b2 1b dd df 5c f3 43  21 cd 26 47 09 32 3a cc  |M....\.C!.&G.2:.|
-000001f0  b6 30 5a 1d 27 7a ad 6d  da 2d 51 dc 67 84 09 8f  |.0Z.'z.m.-Q.g...|
-00000200  8f 86 2d 6f af 04 15 ce  90 53 4d 0d 32 a5 c4 c3  |..-o.....SM.2...|
-00000210  41 94 0b 08 33 b9 2c 23  d3 d5 c2 42 f1 e4 d6 cf  |A...3.,#...B....|
-00000220  b2 cd 45 8e dd 9f 52 cb  e5 dd ec aa 40 55 fd 94  |..E...R.....@U..|
-00000230  99 cc 97 88 6d b0 71 80  4d 31 34 5e 92 a0 7d 1d  |....m.q.M14^..}.|
-00000240  1e fe 6e d6 47 81 f1 db  a5 00 37 32 f2 98 87 f8  |..n.G.....72....|
-00000250  83 48 31 c1 5f 28 7a 59  de fd 5a 56 b0 e4 39 78  |.H1._(zY..ZV..9x|
-00000260  38 d4 68 b3 ef 16 a1 3e  41 ee 57 94 2e fb 16 4c  |8.h....>A.W....L|
-00000270  fd 02 3a c1 57 c6 4b 3b  2b 63 79 67 e1 cf 07 21  |..:.W.K;+cyg...!|
-00000280  27 c7 9e 4a b0 bf e1 c2  4a 6e 9a 82 2a 8c 05 8d  |'..J....Jn..*...|
-00000290  93 48 0d 1c 15 60 66 d0  da b3 2f dc 90 fd 9e 6b  |.H...`f.../....k|
-000002a0  c2 62 ee a4 25 c5 52 e3  44 00 b8 6c 2d 6b 16 d7  |.b..%.R.D..l-k..|
-000002b0  bc a4 2b b9 71 b7 b0 fc  a4 e7 78 a3 39 1e 54 6f  |..+.q.....x.9.To|
-000002c0  7f c5 4c 20 4d b5 84 db  00 1d d0 ad 7a b8 13 e6  |..L M.......z...|
-000002d0  06 f1 c2 f9 06 b5 c1 23  50 b1 0d f9 38 4d 80 65  |.......#P...8M.e|
-000002e0  e1 56 7c 04 3f d8 07 b7  46 5a ff 29 f3 d4 43 fa  |.V|.?...FZ.)..C.|
-000002f0  be 32 47 76 58 7a c4 50  76 b7 65 5f 56 83 f9 06  |.2GvXz.Pv.e_V...|
-00000300  44 30 65 0a 4b b1 e9 5c  80 4e 3c 1b 67 6f e1 53  |D0e.K..\.N<.go.S|
-00000310  09 a8 3b 0f a6 85 f7 2f  51 08 48 94 9b 5a 0f b6  |..;..../Q.H..Z..|
-00000320  b8 24 52 e0 c2 67 55 1d  bc e1 e3 1b 15 8e 17 03  |.$R..gU.........|
-00000330  03 00 99 58 f7 33 99 2c  8c 8c 18 78 60 49 6d 44  |...X.3.,...x`ImD|
-00000340  f7 b4 25 5f 29 2b 37 7d  ff 40 07 42 dd b3 9b a1  |..%_)+7}.@.B....|
-00000350  10 a5 d6 d0 de 6d ca a0  df 41 82 0b e6 8a 35 8c  |.....m...A....5.|
-00000360  b7 52 aa 1c 8c f4 c2 31  2c 92 0b be 99 70 b0 84  |.R.....1,....p..|
-00000370  c1 f4 9f d4 ff c7 ab e0  64 9e 17 34 aa 58 2d 32  |........d..4.X-2|
-00000380  6d 74 90 ec f1 87 11 8f  9c 86 e2 26 2a 51 3e d4  |mt.........&*Q>.|
-00000390  4b e4 01 13 13 6b cf 96  c6 ba 8e cf 8a 2b 5a 72  |K....k.......+Zr|
-000003a0  df d7 43 47 ef 33 10 53  22 5c ab 8b b3 b4 6d 3c  |..CG.3.S"\....m<|
-000003b0  a6 31 58 f2 d7 bc 1c 46  48 4f 34 a1 62 5c ed 33  |.1X....FHO4.b\.3|
-000003c0  01 3f ae 63 15 d5 94 96  b6 a1 d5 00 17 03 03 00  |.?.c............|
-000003d0  35 34 66 3e 16 07 f3 ea  c0 61 a6 30 c7 6f e9 1d  |54f>.....a.0.o..|
-000003e0  8b 6d 66 11 3c eb 27 88  9e 1a 94 86 85 0e da a0  |.mf.<.'.........|
-000003f0  d7 1e 9e 2c d8 55 3e 53  b7 0f bc 96 be 82 00 34  |...,.U>S.......4|
-00000400  a1 b3 3e c6 d3 bf                                 |..>...|
+00000060  68 4b 33 bf 83 bd ff 25  68 0f b8 79 da c5 68 5e  |hK3....%h..y..h^|
+00000070  c7 ca 00 07 f1 79 17 22  41 c6 e0 24 c2 97 f7 07  |.....y."A..$....|
+00000080  b5 f1 04 20 26 17 90 6b  31 3f 25 15 bc 3b 4f 59  |... &..k1?%..;OY|
+00000090  54 b3 4f 75 4e 7a c0 2c  17 0f ea 2a 7e 5f 54 7f  |T.OuNz.,...*~_T.|
+000000a0  17 03 03 00 17 c3 10 7e  45 b9 96 05 4f a7 f1 bd  |.......~E...O...|
+000000b0  9f 79 b1 b5 88 e7 90 b1  44 b0 7d f6 17 03 03 02  |.y......D.}.....|
+000000c0  6d c3 e9 2e 7e 18 e5 0b  51 bb eb 55 62 44 6e bd  |m...~...Q..UbDn.|
+000000d0  03 6c 85 0d f5 39 52 58  b4 6b 44 cc f6 f6 0d 7c  |.l...9RX.kD....||
+000000e0  71 f1 0a 24 a7 c9 19 2a  87 92 5c f7 b9 af 4e 84  |q..$...*..\...N.|
+000000f0  94 69 df 28 a1 a0 18 2e  56 a1 15 3e 41 e2 f8 0c  |.i.(....V..>A...|
+00000100  73 98 d5 3c 04 93 d1 80  b3 21 11 a4 93 f9 2e 01  |s..<.....!......|
+00000110  bd d1 63 4b ed aa 31 3d  5d 9a ec 39 03 97 78 3c  |..cK..1=]..9..x<|
+00000120  a4 1c ee cd 72 10 a6 05  44 ff 43 09 66 b5 c4 f4  |....r...D.C.f...|
+00000130  9e fb 36 5b 73 6b 13 55  9e d5 ce 20 77 72 19 1b  |..6[sk.U... wr..|
+00000140  20 ea db d0 0f a7 ae 06  7d 95 4d d5 71 74 64 63  | .......}.M.qtdc|
+00000150  4d 88 6b f3 f8 d6 7d 56  97 b5 c4 4d a6 b7 86 a8  |M.k...}V...M....|
+00000160  9c 4d fb 53 65 7b 4b 2d  d4 49 4d 97 64 ca 39 d5  |.M.Se{K-.IM.d.9.|
+00000170  cb c7 38 a6 5b 0d 65 f6  12 d9 a4 26 a4 dd aa 2d  |..8.[.e....&...-|
+00000180  af f9 d4 2e a2 3f 28 51  87 c2 a5 b2 59 b4 23 e9  |.....?(Q....Y.#.|
+00000190  e5 e5 21 5e 90 29 1b 7c  21 3c 17 b5 96 71 4a d3  |..!^.).|!<...qJ.|
+000001a0  e4 60 58 ea 03 1c d4 b1  4a da 19 9e 75 83 1f 82  |.`X.....J...u...|
+000001b0  38 ea fe f4 3a db 36 0e  11 1d d6 09 76 52 cb 72  |8...:.6.....vR.r|
+000001c0  9f 67 44 83 c0 57 c3 1e  86 bd 73 c5 68 1c 0a ac  |.gD..W....s.h...|
+000001d0  f4 70 08 2d 9f 96 70 ca  08 c7 12 6d 58 12 6e 02  |.p.-..p....mX.n.|
+000001e0  7b 4f 1c 30 73 66 8c ce  05 35 ed 0f 19 41 88 c8  |{O.0sf...5...A..|
+000001f0  5a ed f0 c1 ff dd f9 c7  b0 0c 82 16 98 98 ec 0e  |Z...............|
+00000200  59 e5 9f e0 b2 a2 8a 62  46 21 d1 5d f3 3e e9 6d  |Y......bF!.].>.m|
+00000210  62 5f 66 0a 41 34 c7 75  05 62 ea 60 7a 9e 5e 56  |b_f.A4.u.b.`z.^V|
+00000220  32 6d 94 0a 08 ff 73 55  04 98 50 c3 d8 d6 10 cd  |2m....sU..P.....|
+00000230  80 77 29 84 d3 24 d3 dd  0a 0a 50 95 5f 41 f9 95  |.w)..$....P._A..|
+00000240  82 11 39 b3 c8 32 90 4f  6f 67 1f 14 c6 fb c5 0a  |..9..2.Oog......|
+00000250  a7 79 85 a2 0c 11 a2 d9  d1 07 66 5d 50 63 43 fb  |.y........f]PcC.|
+00000260  b5 e1 70 49 86 15 2d db  1c 8a 86 d3 97 9e 24 5c  |..pI..-.......$\|
+00000270  40 95 89 47 7a a5 0e dc  ba bd eb 0a 77 b9 42 58  |@..Gz.......w.BX|
+00000280  8b d1 18 ce 08 c5 3a eb  da 89 57 15 f0 00 9d 6f  |......:...W....o|
+00000290  ee be dc 1f e3 54 a3 ba  eb 39 61 0a f6 a6 21 26  |.....T...9a...!&|
+000002a0  d0 8e 0a ff a5 c4 53 37  5d fd b7 47 90 0d 79 dd  |......S7]..G..y.|
+000002b0  23 c4 94 54 d0 bd 59 93  68 f9 94 f0 00 ea 5a b1  |#..T..Y.h.....Z.|
+000002c0  88 79 bb e8 9b 5e 77 93  f0 36 fb 12 57 fc 3b c1  |.y...^w..6..W.;.|
+000002d0  15 d5 45 77 b5 35 ee fb  60 7f a8 cc da 99 1b 1e  |..Ew.5..`.......|
+000002e0  5c 7f 61 c0 9c 41 54 02  bc db af 48 ef a7 a8 62  |\.a..AT....H...b|
+000002f0  42 2d 1c b6 60 f8 1b ef  56 03 1d 79 68 79 a9 e9  |B-..`...V..yhy..|
+00000300  e6 78 62 66 c6 2e b4 6a  3c db 7a ee 1b f9 fa f3  |.xbf...j<.z.....|
+00000310  0a f1 10 55 18 da 2f 6d  35 67 9f c6 c6 d0 40 eb  |...U../m5g....@.|
+00000320  09 0b 6b a2 72 71 5c 77  b5 8e cf d5 ec 2b 17 03  |..k.rq\w.....+..|
+00000330  03 00 99 e4 93 85 ef 4e  a3 15 ca d2 76 f9 5a 20  |.......N....v.Z |
+00000340  40 08 b9 ad 74 93 12 7f  37 37 ab 9f 17 05 9c 0d  |@...t...77......|
+00000350  6a 84 85 c9 3e d2 3e 50  0b 7c 4e 51 6b 88 0a 91  |j...>.>P.|NQk...|
+00000360  82 67 90 99 f8 69 74 80  b8 75 4f c4 04 42 68 58  |.g...it..uO..BhX|
+00000370  26 8b 70 66 e1 b2 60 ac  63 92 3c 35 79 90 53 a2  |&.pf..`.c.<5y.S.|
+00000380  8b 37 8b c1 84 d9 ac 1f  36 83 95 25 75 89 d7 f0  |.7......6..%u...|
+00000390  44 81 be 9a 52 e7 a3 51  6d 28 50 80 e4 ea b4 db  |D...R..Qm(P.....|
+000003a0  89 68 9b 61 6e 88 7f 10  1e d7 f9 ea 12 a7 16 3c  |.h.an..........<|
+000003b0  2b 73 62 9b af 98 eb d1  7a 67 b1 6e 38 29 9d c1  |+sb.....zg.n8)..|
+000003c0  94 18 7e 2a 50 96 72 25  7a 23 21 13 17 03 03 00  |..~*P.r%z#!.....|
+000003d0  35 1f f9 91 ac 1f 78 93  2b 39 35 7e 52 22 e8 79  |5.....x.+95~R".y|
+000003e0  84 4a a6 de 74 21 c8 a5  c7 d1 35 0d 53 bd 85 7d  |.J..t!....5.S..}|
+000003f0  e0 2f 51 74 b9 69 f1 7b  a9 b2 2c b1 89 99 06 48  |./Qt.i.{..,....H|
+00000400  f8 b2 b4 c7 5d 06                                 |....].|
 >>> Flow 5 (client to server)
-00000000  17 03 03 00 35 df 1b 3b  a9 e7 cd 63 2c a6 09 65  |....5..;...c,..e|
-00000010  66 df 94 09 d1 c4 ce 44  22 8b b5 48 2e 23 62 3a  |f......D"..H.#b:|
-00000020  9f e3 b2 58 a7 b2 e3 2a  27 a9 4d 34 41 0c 31 41  |...X...*'.M4A.1A|
-00000030  92 b7 48 02 d2 51 d6 97  3e 70 17 03 03 00 17 f1  |..H..Q..>p......|
-00000040  b7 28 75 42 2a 8b 20 2a  97 ed 47 ac a0 ee fd 38  |.(uB*. *..G....8|
-00000050  cb 00 e3 b2 b1 87 17 03  03 00 13 bc 5a f3 ee 64  |............Z..d|
-00000060  4d a5 1a 64 35 f2 f6 82  e3 e4 7d 82 08 c4        |M..d5.....}...|
+00000000  17 03 03 00 35 fa 53 f3  c8 84 37 c3 c8 b9 b6 0a  |....5.S...7.....|
+00000010  41 bb 27 76 d5 7a 32 b6  3a fe 5b d5 28 d9 a6 81  |A.'v.z2.:.[.(...|
+00000020  21 63 ee 43 03 3d b6 c0  0c 5f 3c cc 2a 2a 7f ee  |!c.C.=..._<.**..|
+00000030  f6 5e 02 f5 c9 06 c8 56  de b1 17 03 03 00 17 9a  |.^.....V........|
+00000040  8f 68 ac 18 fc f4 87 b4  fb 1e 33 b9 77 51 04 57  |.h........3.wQ.W|
+00000050  f6 34 a4 f9 62 05                                 |.4..b.|
+>>> Flow 6 (server to client)
+00000000  17 03 03 00 da 4b cf 84  da 4f 53 58 d4 24 69 e4  |.....K...OSX.$i.|
+00000010  4f e1 92 ae 27 23 7e ac  05 95 aa e3 c1 fb 41 7b  |O...'#~.......A{|
+00000020  5a 94 eb bc 0b 03 df 95  77 f7 9a 47 4a 88 52 83  |Z.......w..GJ.R.|
+00000030  4d a4 c1 a6 e9 79 dd 77  76 a0 fc 9b 50 55 72 8e  |M....y.wv...PUr.|
+00000040  c8 0a d6 e4 d4 b8 18 b4  0e cc 06 05 2a 40 17 7d  |............*@.}|
+00000050  f6 ef b5 76 93 85 fc 0b  e1 ca d7 e6 06 d0 e0 34  |...v...........4|
+00000060  86 e2 62 a4 35 fe 5d 63  6c 4a 2e 0f 3d dd ea a1  |..b.5.]clJ..=...|
+00000070  bf a8 86 56 e2 2e 21 79  47 c4 9a c4 6f 07 82 59  |...V..!yG...o..Y|
+00000080  d7 55 a9 32 97 de 5a af  0c ab fa 46 d4 2e ab b0  |.U.2..Z....F....|
+00000090  8d c8 36 0f d7 a5 cc 27  31 6e 42 a6 d0 61 72 45  |..6....'1nB..arE|
+000000a0  d7 43 8d 74 51 da a8 bb  6b 7a 69 30 79 f3 ff 92  |.C.tQ...kzi0y...|
+000000b0  dc 0a d7 52 b0 9a d8 c3  d6 c9 2b 3d 7e 60 63 5b  |...R......+=~`c[|
+000000c0  02 8c 5e 76 92 9d ad 4e  18 c3 67 a7 40 62 41 04  |..^v...N..g.@bA.|
+000000d0  0b c9 29 26 d8 0c 51 51  d1 5b a4 bf 69 d5 31 17  |..)&..QQ.[..i.1.|
+000000e0  03 03 00 da fa d6 36 16  4c 85 87 4f 4b 17 b8 65  |......6.L..OK..e|
+000000f0  3f dc c3 5d 09 c5 ed 80  b1 d4 3d aa dc f8 78 1e  |?..]......=...x.|
+00000100  c0 d5 e3 87 74 57 f4 3c  ec 7c d0 09 e6 88 fa 16  |....tW.<.|......|
+00000110  30 de 10 7c 25 14 d2 23  71 63 e5 bb 97 bf 5c 9e  |0..|%..#qc....\.|
+00000120  e4 81 cc 5d 0e b0 e4 06  0e 6b 87 93 6c ce 7c fc  |...].....k..l.|.|
+00000130  2b 66 c2 48 53 65 31 40  b8 ce 7e a2 f2 69 a0 b8  |+f.HSe1@..~..i..|
+00000140  41 ff 18 f1 1a db 96 7e  b0 e5 9a 40 de 4e d0 4f  |A......~...@.N.O|
+00000150  95 37 81 15 e9 b2 a5 fa  af 26 97 1b d7 e5 2b 17  |.7.......&....+.|
+00000160  51 5c ee d6 cd 20 6a 19  5c 80 41 f5 ca 52 d5 c8  |Q\... j.\.A..R..|
+00000170  70 e5 3a 0f 17 3e b4 b4  c5 bc f8 90 49 df ee 3b  |p.:..>......I..;|
+00000180  c5 33 43 14 16 d5 f7 f6  85 ef f2 ee cb 23 5a e8  |.3C..........#Z.|
+00000190  09 5d 15 73 98 b9 d3 1e  74 27 3e ff 7b 9d 63 13  |.].s....t'>.{.c.|
+000001a0  5c d4 b5 6a 34 b8 9e 1b  4b cf d8 5a da 4a 73 5e  |\..j4...K..Z.Js^|
+000001b0  5c ae 38 78 ba 12 00 bc  98 15 f3 c7 69 6b        |\.8x........ik|
+>>> Flow 7 (client to server)
+00000000  17 03 03 00 13 d0 9e 34  0a 13 b3 c3 d9 22 79 a9  |.......4....."y.|
+00000010  66 e6 3a 8b 3e bc cf de                           |f.:.>...|
diff --git a/src/crypto/tls/testdata/Client-TLSv13-KeyUpdate b/src/crypto/tls/testdata/Client-TLSv13-KeyUpdate
index 6ba717e8be..3d6c21bcee 100644
--- a/src/crypto/tls/testdata/Client-TLSv13-KeyUpdate
+++ b/src/crypto/tls/testdata/Client-TLSv13-KeyUpdate
@@ -16,115 +16,117 @@
 000000e0  a3 47 cd 62 43 15 28 da  ac 5f bb 29 07 30 ff f6  |.G.bC.(.._.).0..|
 000000f0  84 af c4 cf c2 ed 90 99  5f 58 cb 3b 74           |........_X.;t|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 7a 02 00 00  76 03 03 91 02 b1 d0 21  |....z...v......!|
-00000010  d1 5d ff 00 e2 ab f3 af  0d 22 45 1a a0 7d f1 c7  |.]......."E..}..|
-00000020  73 fd 01 af f5 6e b4 d8  51 a7 26 20 00 00 00 00  |s....n..Q.& ....|
+00000000  16 03 03 00 7a 02 00 00  76 03 03 0f 9a 86 30 a4  |....z...v.....0.|
+00000010  0a 88 2e ae a6 b9 ca ee  46 9c 87 f8 38 b3 5f d4  |........F...8._.|
+00000020  2c 42 29 e3 e7 44 e4 d3  e2 00 53 20 00 00 00 00  |,B)..D....S ....|
 00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000040  00 00 00 00 00 00 00 00  00 00 00 00 13 01 00 00  |................|
-00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 d4  |..+.....3.$... .|
-00000060  6c db da 9b 60 3b 55 58  d2 7b 00 7c 85 8f 97 92  |l...`;UX.{.|....|
-00000070  b6 02 a7 9f c2 fc cd 7f  e4 45 37 ff f0 85 51 14  |.........E7...Q.|
-00000080  03 03 00 01 01 17 03 03  00 17 c0 42 45 55 77 7d  |...........BEUw}|
-00000090  3c 65 5a 6a 1f d2 57 ff  9b b6 fe bf 2f 50 04 c9  |<eZj..W...../P..|
-000000a0  5d 17 03 03 02 6d 8f f3  b8 02 b6 22 f2 de 83 41  |]....m....."...A|
-000000b0  82 89 17 99 bf 18 bc 07  1b 75 02 3f ff 6b 54 dd  |.........u.?.kT.|
-000000c0  67 e6 81 2d 0b 10 5e b5  f5 e8 13 fd 4f 6a 49 2a  |g..-..^.....OjI*|
-000000d0  af 8e b0 2f 04 fe db 56  e5 71 f1 66 38 b4 62 82  |.../...V.q.f8.b.|
-000000e0  5b dd 8f c4 ef f7 e9 bb  35 47 4e 3d a6 a7 0b f5  |[.......5GN=....|
-000000f0  b3 4a 5a b7 92 6d 65 26  b6 94 88 f8 a4 9b 7e 33  |.JZ..me&......~3|
-00000100  36 47 11 a2 53 44 f7 8e  f6 b0 a7 b6 ba e1 0a ad  |6G..SD..........|
-00000110  00 7d eb 57 3b 18 54 cc  10 59 42 87 2a d0 99 27  |.}.W;.T..YB.*..'|
-00000120  e4 25 6d 97 0f 6b d2 ec  3d 17 51 99 9d 6f af 57  |.%m..k..=.Q..o.W|
-00000130  1e fc f2 32 2a bb 6e 05  cd eb 99 af 8e 6b 79 a8  |...2*.n......ky.|
-00000140  23 60 e4 3f 1a 1c 2a 33  82 b1 bd 7d 7f 39 75 18  |#`.?..*3...}.9u.|
-00000150  a6 94 91 6b 89 5c 9b c9  94 cc 09 65 8a 72 df 22  |...k.\.....e.r."|
-00000160  6d ac 89 7b 59 0e 89 04  09 f7 15 7d 07 7b 26 49  |m..{Y......}.{&I|
-00000170  da 66 1b b2 5b 0d aa 71  40 01 a2 53 ef da 55 ea  |.f..[..q@..S..U.|
-00000180  f0 22 33 e2 ff db 10 a5  67 3a ee f4 57 08 75 ea  |."3.....g:..W.u.|
-00000190  d1 c2 8c 7e 9b ab ca f8  38 86 92 5f 10 11 57 c9  |...~....8.._..W.|
-000001a0  e5 ba 3c d2 82 61 0c aa  3f 2a e8 9e 1b 9a c0 55  |..<..a..?*.....U|
-000001b0  74 1c b3 12 a3 26 a1 2e  a8 b0 09 cf f8 92 4b aa  |t....&........K.|
-000001c0  b8 ec ff c0 f0 be 38 5e  68 39 58 47 1f ad b3 ba  |......8^h9XG....|
-000001d0  99 bd 21 da 63 50 73 37  8f 5b 92 3a 0e d9 d3 7a  |..!.cPs7.[.:...z|
-000001e0  26 df 07 6c 0b f0 f8 73  23 c9 9f b9 d0 79 aa b0  |&..l...s#....y..|
-000001f0  17 cb 85 f6 47 55 c2 31  aa b0 77 54 b7 a1 dc 12  |....GU.1..wT....|
-00000200  d6 d3 aa 5b 9c c6 ad 7b  b5 34 77 a9 35 7f 7b 25  |...[...{.4w.5.{%|
-00000210  b0 5f d2 c5 8d 41 3c eb  4b 4a 94 a0 07 25 d4 31  |._...A<.KJ...%.1|
-00000220  80 93 13 a8 0c ae 7a 56  b2 52 de e6 30 66 ec 3e  |......zV.R..0f.>|
-00000230  6c 69 fd b2 4a f8 85 54  99 25 35 f7 66 50 fe 3f  |li..J..T.%5.fP.?|
-00000240  3f a3 2e b6 a1 f3 df d0  0b 2c 81 04 37 83 bd fe  |?........,..7...|
-00000250  15 69 2a 28 93 25 7e be  a7 a2 54 14 ce ad 8c 93  |.i*(.%~...T.....|
-00000260  5d 4b e8 bf 07 27 c3 ec  91 2f 55 39 4f 70 1d 17  |]K...'.../U9Op..|
-00000270  3a f9 a5 71 0f 41 a6 17  fc 71 b6 50 43 aa 14 b6  |:..q.A...q.PC...|
-00000280  38 ab af 0b 30 92 77 4d  02 97 fc fb 0d a9 50 96  |8...0.wM......P.|
-00000290  68 30 49 6f 80 0e d3 99  27 a9 50 37 42 51 04 e1  |h0Io....'.P7BQ..|
-000002a0  e8 88 93 1b 0a bf 86 14  c3 d9 b3 49 1a ce 2d 65  |...........I..-e|
-000002b0  72 47 2a 3c b1 fd a3 4a  fb a1 e8 c1 69 24 3a 51  |rG*<...J....i$:Q|
-000002c0  17 1d 7b e7 33 77 21 94  67 5e f0 e7 93 5c 84 97  |..{.3w!.g^...\..|
-000002d0  25 00 cd b2 d9 a1 40 06  6b f8 df a3 4b 7e 48 4c  |%.....@.k...K~HL|
-000002e0  14 30 93 17 cd 6b 8e e7  56 a0 34 1f d9 ba 14 16  |.0...k..V.4.....|
-000002f0  cf 2c 1e c5 35 84 31 6f  e8 81 f5 7c b2 11 5c 9d  |.,..5.1o...|..\.|
-00000300  5d 05 1c 12 41 74 ad 20  74 0c 0c 72 5e f2 43 1c  |]...At. t..r^.C.|
-00000310  91 1a 4d 17 03 03 00 99  d6 a2 b9 7b 55 6b d2 13  |..M........{Uk..|
-00000320  9d 89 e6 7b d4 b2 e9 1c  f6 7d 91 0a 87 00 ba 03  |...{.....}......|
-00000330  c3 ae 47 e9 79 1b 75 e8  8b fe a8 15 4d 33 93 a5  |..G.y.u.....M3..|
-00000340  df e7 d0 40 de 7c f2 63  2d 46 7a 1d e8 2d c6 dd  |...@.|.c-Fz..-..|
-00000350  56 ec cc 49 87 05 ad 2a  c3 e4 89 2c c6 7c 2a 6a  |V..I...*...,.|*j|
-00000360  60 68 40 49 73 2b 29 55  9a 7b c4 e4 c6 24 5e 41  |`h@Is+)U.{...$^A|
-00000370  16 c7 c2 46 e1 cf 10 cc  1d 3d b4 96 b3 ba c4 17  |...F.....=......|
-00000380  1e dd e2 71 fc 80 45 f9  43 a1 16 4d e7 b4 ac a6  |...q..E.C..M....|
-00000390  d3 26 a6 c2 23 06 6e 1c  4f 7e 1e a3 f1 57 e1 0c  |.&..#.n.O~...W..|
-000003a0  50 a6 5f 23 f4 a9 f8 b4  56 e9 d0 8c f6 fb ac 33  |P._#....V......3|
-000003b0  b8 17 03 03 00 35 55 f6  25 b8 52 df c4 e2 2f b0  |.....5U.%.R.../.|
-000003c0  ac 41 c3 ed 49 8d 73 cf  f4 48 c2 4f 33 8c 56 df  |.A..I.s..H.O3.V.|
-000003d0  11 03 9e 7f de 78 d7 03  c3 f4 de e5 69 8e e4 9a  |.....x......i...|
-000003e0  c0 47 3b c9 99 3e 35 c9  66 b9 5a                 |.G;..>5.f.Z|
+00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 1e  |..+.....3.$... .|
+00000060  0b 5c d8 c6 44 ba ac 71  70 3c a2 20 b0 05 d5 98  |.\..D..qp<. ....|
+00000070  c4 12 e3 43 67 53 c4 2a  72 6e 59 50 03 81 0e 14  |...CgS.*rnYP....|
+00000080  03 03 00 01 01 17 03 03  00 17 cc 54 e1 4a d7 5c  |...........T.J.\|
+00000090  1b 96 70 6e c0 ea 25 c6  0e 9d bd a6 c0 08 0a 45  |..pn..%........E|
+000000a0  1b 17 03 03 02 6d 17 74  77 1a b1 00 47 8f e5 01  |.....m.tw...G...|
+000000b0  3a 29 a3 e8 94 1b 3e ef  91 f7 05 8d 9a a4 2d 9a  |:)....>.......-.|
+000000c0  9b cf d2 83 e4 74 28 b9  d5 ae c8 79 b4 f4 6b eb  |.....t(....y..k.|
+000000d0  a0 db e7 db f3 ff 0b 2b  be 0c e7 3b d3 c6 79 ea  |.......+...;..y.|
+000000e0  39 a6 66 19 88 39 04 01  f9 8d 82 04 6d e2 ce 73  |9.f..9......m..s|
+000000f0  71 f9 bd 5b f6 66 a5 c7  f8 8b be db 1a b5 1b 38  |q..[.f.........8|
+00000100  4b b4 3a 04 01 5e 68 13  e7 51 40 fe bd b8 a0 00  |K.:..^h..Q@.....|
+00000110  7a 7d b7 60 0c 9d 23 7b  6e 77 fd 71 6f 45 30 41  |z}.`..#{nw.qoE0A|
+00000120  bf 3f 5f 45 27 b1 bd 3e  39 d1 bf 80 be 74 e1 e3  |.?_E'..>9....t..|
+00000130  ae 9c a7 68 40 ac 98 ef  3f 7f e6 41 a5 f5 c9 56  |...h@...?..A...V|
+00000140  45 1c 4e ad 1f 62 58 fc  0b 1f 06 1a 12 c5 d1 c6  |E.N..bX.........|
+00000150  0a 3d f9 f7 e9 a5 16 9b  69 bf f8 39 6f 38 8c cd  |.=......i..9o8..|
+00000160  da da 97 f7 40 9b a1 9f  3b c8 a5 5b 42 2f 44 29  |....@...;..[B/D)|
+00000170  f0 d9 0b 0e 7a b8 ae 9f  7f de fd 4c 81 c4 a2 9d  |....z......L....|
+00000180  a1 40 b3 5e a5 22 1a 1a  7b f7 83 14 4d 53 c9 68  |.@.^."..{...MS.h|
+00000190  4e e0 3f 8a 88 b0 74 51  eb 3a 85 ee 45 3b 5d d5  |N.?...tQ.:..E;].|
+000001a0  8c cd ba 55 b9 89 32 4c  6e d9 81 c3 b0 68 4d 39  |...U..2Ln....hM9|
+000001b0  0e 3b 70 31 a2 e2 6e f1  07 5a 0e 4f 6a 0c 58 f1  |.;p1..n..Z.Oj.X.|
+000001c0  71 0d dc 35 a9 ea 15 50  1e fe f4 e5 c6 ff ef 6a  |q..5...P.......j|
+000001d0  46 8c 04 27 1b cc a6 0e  40 25 c5 5e 13 e0 26 e8  |F..'....@%.^..&.|
+000001e0  5f 44 bb 05 f7 1c 6e 8c  1e 58 f3 5f af 92 98 79  |_D....n..X._...y|
+000001f0  93 50 a2 22 8d 65 62 20  78 15 8e 02 16 77 53 45  |.P.".eb x....wSE|
+00000200  fd 51 a6 db 80 26 7a 69  c1 55 69 76 96 2e 49 62  |.Q...&zi.Uiv..Ib|
+00000210  0e b8 fe 58 36 0d ac 68  b7 f0 54 16 45 bc 6a a0  |...X6..h..T.E.j.|
+00000220  8b fa 2e 00 de cf ad 73  31 ff c0 5f be ff 09 76  |.......s1.._...v|
+00000230  07 b2 08 27 90 98 2f b6  08 9f 8b 31 77 0a d1 41  |...'../....1w..A|
+00000240  ee ca 97 0d 46 03 91 d6  12 02 b3 7d 13 e8 ab 83  |....F......}....|
+00000250  79 93 96 33 f0 fc 14 3a  90 06 df 0d 38 59 1e 34  |y..3...:....8Y.4|
+00000260  a6 8a 5c 19 ae 8f ba b7  b8 6d cf 59 29 81 8c b7  |..\......m.Y)...|
+00000270  86 44 e0 a5 ef c1 24 cd  21 05 2a da 4b 01 e9 2b  |.D....$.!.*.K..+|
+00000280  b6 c0 be 8e be f1 af 1c  a4 be b1 26 4c a9 e5 e7  |...........&L...|
+00000290  41 fa 74 73 03 77 9b 5b  56 69 ca bd a5 99 ff d6  |A.ts.w.[Vi......|
+000002a0  eb 77 0c b0 3e 29 dc e7  54 7d 4e 03 5f 75 1e a5  |.w..>)..T}N._u..|
+000002b0  93 73 9a bd 53 31 57 b9  63 9c 17 f2 ae 3b 21 81  |.s..S1W.c....;!.|
+000002c0  38 55 1f 56 96 0f 02 de  ad 2a a4 7e 71 52 79 21  |8U.V.....*.~qRy!|
+000002d0  b0 76 e5 59 1c 74 10 0e  e3 90 4b 69 53 4d dd 20  |.v.Y.t....KiSM. |
+000002e0  52 25 14 d1 67 ed 72 26  6a 4e 1f 1b aa b9 03 6d  |R%..g.r&jN.....m|
+000002f0  81 67 1c c3 f2 f5 2e f0  01 b5 f5 8f d3 5e 08 2d  |.g...........^.-|
+00000300  fc f5 8a c0 3d af c1 3d  3f 14 c1 b3 18 55 6b 98  |....=..=?....Uk.|
+00000310  f5 4b c0 17 03 03 00 99  44 a2 0f 9b 62 d7 b0 e0  |.K......D...b...|
+00000320  68 2e f1 90 64 fc fe 4f  e3 e0 9a 82 8d c3 14 6d  |h...d..O.......m|
+00000330  f4 22 00 d9 74 5d 98 82  9f e5 6e fd 7e e5 9e d2  |."..t]....n.~...|
+00000340  5a 1b 11 fd 05 c0 d7 4e  48 6b 8b e1 33 8d f3 04  |Z......NHk..3...|
+00000350  2c 20 00 53 86 b7 f8 34  20 2f 6a e0 f9 c3 3a 85  |, .S...4 /j...:.|
+00000360  f2 32 4e a0 3e 3c 2d c6  91 86 d3 4b 09 ef d2 93  |.2N.><-....K....|
+00000370  3f a3 9a ad 0f f6 a3 04  ba 88 fe 9a 80 12 c5 0d  |?...............|
+00000380  f9 86 2b b8 cb 7e 46 28  16 2d 58 bf 5a 0a 2e f8  |..+..~F(.-X.Z...|
+00000390  cd c2 2e 01 c2 cf ca f7  5e b1 1d 8b 9d 1b 4b 8e  |........^.....K.|
+000003a0  62 a2 c2 17 14 e7 00 be  00 3a 0c 4c 84 d7 c1 47  |b........:.L...G|
+000003b0  61 17 03 03 00 35 7d 84  99 5a 9f b5 26 b5 f6 ce  |a....5}..Z..&...|
+000003c0  56 ca a6 25 60 84 e3 5b  c1 b8 7c ed ed 02 f1 13  |V..%`..[..|.....|
+000003d0  50 2a e8 a2 65 65 f9 88  b1 a5 01 24 0f 52 4a da  |P*..ee.....$.RJ.|
+000003e0  5d ea 2b 88 b3 9c b7 ed  d8 70 38                 |].+......p8|
 >>> Flow 3 (client to server)
-00000000  17 03 03 00 35 03 e0 6c  82 55 1c 8a cb 82 4e 3d  |....5..l.U....N=|
-00000010  4a 5c 4f 94 3b 9c 23 fe  9d 5f 66 22 6a 83 31 98  |J\O.;.#.._f"j.1.|
-00000020  e9 5b 0c 17 54 86 11 5f  85 2c 8c a8 fa 80 a0 d5  |.[..T.._.,......|
-00000030  5f c5 02 30 0a 93 1f 42  b1 a9 17 03 03 00 17 3f  |_..0...B.......?|
-00000040  82 d9 94 f8 84 d1 9f 87  67 c2 37 b5 17 09 0a 99  |........g.7.....|
-00000050  81 6d 0b 70 0b 6e                                 |.m.p.n|
+00000000  14 03 03 00 01 01 17 03  03 00 35 e7 50 0e 48 d7  |..........5.P.H.|
+00000010  8f 45 ff 48 48 1d 0c 94  b8 61 e2 ad 89 eb 4d 9b  |.E.HH....a....M.|
+00000020  20 f5 73 41 85 0c 7b c1  9b 1e d1 a1 27 b3 83 51  | .sA..{.....'..Q|
+00000030  05 51 a9 fc 98 7e fe ef  e2 43 6b a8 da f0 d0 d5  |.Q...~...Ck.....|
+00000040  17 03 03 00 17 f3 bb 74  b9 31 69 37 87 c9 eb 04  |.......t.1i7....|
+00000050  49 95 8f 30 e7 cf c5 67  27 3d 11 66              |I..0...g'=.f|
 >>> Flow 4 (server to client)
-00000000  17 03 03 00 da 94 6d 10  ed 89 9a e2 a8 d4 87 52  |......m........R|
-00000010  7e ff c2 55 79 a7 9d a6  41 6d 1c d0 b5 75 10 95  |~..Uy...Am...u..|
-00000020  8f 02 f4 49 b8 ad e7 29  77 d3 ed ab ee 4d db 6c  |...I...)w....M.l|
-00000030  fa 1b 42 d2 fe f7 d3 a2  a5 ed d5 0a d9 33 13 00  |..B..........3..|
-00000040  6b 7b a0 79 08 c6 80 8c  74 c4 15 18 50 a4 b3 93  |k{.y....t...P...|
-00000050  73 89 85 eb e6 d2 3d 64  db aa ec 68 22 64 22 ae  |s.....=d...h"d".|
-00000060  35 a5 7f 01 5b de eb ba  f9 0e 5b 89 30 a8 5e 47  |5...[.....[.0.^G|
-00000070  39 06 cb 4a bb ce 2c e5  87 36 3f b7 4f 02 6d 32  |9..J..,..6?.O.m2|
-00000080  38 86 15 b2 17 60 af 95  8a 6c f1 29 ac e6 da 05  |8....`...l.)....|
-00000090  78 42 e0 5f 7c a7 1e 3b  1c 85 5f 2d 2f 8f de c2  |xB._|..;.._-/...|
-000000a0  a4 fb 53 ed 74 06 76 08  ef af 8b 59 f2 5e d2 2f  |..S.t.v....Y.^./|
-000000b0  a0 09 81 cb 41 e4 7d 11  6e 64 49 ff dc bf ac f3  |....A.}.ndI.....|
-000000c0  13 d8 d5 a2 69 60 ef cd  82 7a 72 78 c3 58 5b 73  |....i`...zrx.X[s|
-000000d0  7b 77 7a 4d cd 66 a0 fb  ab 46 37 6d 4f 4e 57 17  |{wzM.f...F7mONW.|
-000000e0  03 03 00 da d8 64 ed 87  a6 ac ae d1 16 25 ee 7a  |.....d.......%.z|
-000000f0  e1 2d 0a 61 1b db 33 c9  72 92 75 04 1f af 6b fb  |.-.a..3.r.u...k.|
-00000100  73 e6 55 fe 3c cb c8 93  0b 15 ae d1 dc 39 f2 a9  |s.U.<........9..|
-00000110  52 29 69 0f cd 3a 9d c6  8a c6 e0 57 c0 29 19 dc  |R)i..:.....W.)..|
-00000120  26 4d ec b8 49 d3 11 6f  83 c3 a3 71 bb 70 ca 07  |&M..I..o...q.p..|
-00000130  bf 7a 94 15 58 6f a0 f8  b4 23 70 e7 c4 1a 3d 03  |.z..Xo...#p...=.|
-00000140  c9 55 da 35 47 8c 08 79  09 f6 0e 67 b0 ea 35 ed  |.U.5G..y...g..5.|
-00000150  37 72 02 92 41 ef 6f 05  db 04 e2 17 35 22 2c c9  |7r..A.o.....5",.|
-00000160  98 4b 86 a9 b3 bf 4a 21  9f 01 b1 9b b2 6e 08 d4  |.K....J!.....n..|
-00000170  04 9d 60 1d af 79 b5 cd  c1 5d c3 26 92 60 c7 7b  |..`..y...].&.`.{|
-00000180  b2 6f 11 21 58 7d 28 75  92 f3 7c 43 d2 60 0c 8b  |.o.!X}(u..|C.`..|
-00000190  51 a0 ec a7 b9 1e bb 31  52 ca 48 7e 77 fe 24 d7  |Q......1R.H~w.$.|
-000001a0  a5 f6 51 ab 7a 1d ad dd  e3 6e 9c 6a a3 46 f5 5d  |..Q.z....n.j.F.]|
-000001b0  22 33 c7 86 c9 08 d1 1c  07 b7 93 ac f3 93 17 03  |"3..............|
-000001c0  03 00 16 51 14 60 dd e3  6f 3d ae 8e b0 da 29 b3  |...Q.`..o=....).|
-000001d0  ef 24 61 5b 10 52 da ba  b0                       |.$a[.R...|
+00000000  17 03 03 00 ea 04 c2 4b  8d b2 6b 4e d5 f1 84 03  |.......K..kN....|
+00000010  22 ec f6 d5 61 ba fe 8a  e2 23 75 f3 9e b5 9f 9f  |"...a....#u.....|
+00000020  f7 23 a6 45 46 72 c1 90  cf 30 42 22 f4 7b 0b ca  |.#.EFr...0B".{..|
+00000030  6e b3 4a 74 98 3c 5b a4  1e 27 af 25 a9 af 45 ad  |n.Jt.<[..'.%..E.|
+00000040  70 0a 61 2a b3 0b 17 e6  ea 99 d5 d9 be 8e e9 97  |p.a*............|
+00000050  7a 8b 95 4b 50 91 86 35  ef c5 67 0a 10 0f fb 26  |z..KP..5..g....&|
+00000060  11 cb f7 7b 35 5a 58 79  80 38 cf f8 e8 77 c2 84  |...{5ZXy.8...w..|
+00000070  3a 91 f5 26 23 79 2c ac  8b f7 40 f1 38 dd 0f d6  |:..&#y,...@.8...|
+00000080  3c 0e be e3 12 37 5a 98  0c c8 6a 86 33 df e3 ef  |<....7Z...j.3...|
+00000090  7d a1 9b 3b 1b 1e 3e 17  58 8d 39 7b 28 c2 02 bd  |}..;..>.X.9{(...|
+000000a0  8a 5e 20 17 cb 0b 4c 01  df 36 a4 c0 0d de 26 67  |.^ ...L..6....&g|
+000000b0  18 b0 a8 b2 98 b2 01 2a  8c 0e 29 ce 2f c7 4a c5  |.......*..)./.J.|
+000000c0  ea 2a 86 06 33 62 93 ad  7a 08 15 d1 ab 46 14 43  |.*..3b..z....F.C|
+000000d0  8d 44 b8 6f ac 4a bc fe  e2 91 2f ca 03 6d 49 66  |.D.o.J..../..mIf|
+000000e0  7c bd ca 7b e1 da 73 45  c1 c2 79 02 02 55 52 17  ||..{..sE..y..UR.|
+000000f0  03 03 00 ea 3c fa 1d 62  22 67 f0 44 ac ab 17 a0  |....<..b"g.D....|
+00000100  f2 7d 44 ce 6a 3f dd 2c  d5 45 8f 2c 5d 6f 8e a6  |.}D.j?.,.E.,]o..|
+00000110  c8 97 ea e9 df 35 fd 00  57 98 33 d1 87 f4 1a ee  |.....5..W.3.....|
+00000120  8d 68 a7 ac b0 18 84 e3  26 df 08 85 8f e0 65 48  |.h......&.....eH|
+00000130  a9 94 f1 e5 09 78 6c 76  4a 1a 14 35 93 cc 44 ea  |.....xlvJ..5..D.|
+00000140  8c 8d f7 ee 33 4f cf e0  54 db ba 49 4b 5c b9 ea  |....3O..T..IK\..|
+00000150  de a9 6d eb bc f4 43 85  27 a4 d6 64 6d 1e 9d 9d  |..m...C.'..dm...|
+00000160  e1 81 22 30 b9 a1 c4 c9  b4 0b 4b 23 25 58 34 33  |.."0......K#%X43|
+00000170  40 fc ea 84 fa f5 ba 40  6d 60 cc 60 1b 95 19 f6  |@......@m`.`....|
+00000180  c6 9e ba 00 d8 fd 93 cd  bb 50 91 55 f1 e3 34 ea  |.........P.U..4.|
+00000190  f8 99 7e fd 18 02 69 e3  54 cf 15 3f d3 54 0e e9  |..~...i.T..?.T..|
+000001a0  30 4e 67 94 2e 48 49 45  b8 ae 1a 3c 6d 78 f0 2c  |0Ng..HIE...<mx.,|
+000001b0  04 15 9e 36 7d f5 c1 5c  d6 4c 16 9e a4 93 53 12  |...6}..\.L....S.|
+000001c0  08 c0 b9 c0 3c 2f b2 52  f1 5a 2f a4 8f 6c 55 57  |....</.R.Z/..lUW|
+000001d0  5b 0e d7 ef c4 a1 ee 90  99 a0 77 63 71 49 17 03  |[.........wcqI..|
+000001e0  03 00 16 cc 75 7c b6 21  9d ac 22 06 3a 15 90 e8  |....u|.!..".:...|
+000001f0  15 43 08 c7 02 aa 40 cb  d5                       |.C....@..|
 >>> Flow 5 (client to server)
-00000000  17 03 03 00 16 28 82 46  cd 7d f4 b8 ad 95 3d 87  |.....(.F.}....=.|
-00000010  6f 95 c2 b5 84 1e 5b fc  f9 9b 15                 |o.....[....|
+00000000  17 03 03 00 16 38 87 e3  aa 7a 6f 28 c7 6f bd cf  |.....8...zo(.o..|
+00000010  d0 50 21 a4 e0 44 9f fe  29 47 e9                 |.P!..D..)G.|
 >>> Flow 6 (server to client)
-00000000  17 03 03 00 1a 3b 79 64  b2 54 a9 0f e7 76 a3 47  |.....;yd.T...v.G|
-00000010  bc c1 e2 e0 0d 3d c3 60  43 d2 29 cb e4 89 de     |.....=.`C.)....|
+00000000  17 03 03 00 1a 3c be d6  90 e8 ad 97 7c 0f c9 b6  |.....<......|...|
+00000010  3d 66 52 35 57 1e 01 c5  a2 27 8b c4 17 25 20     |=fR5W....'...% |
 >>> Flow 7 (client to server)
-00000000  17 03 03 00 1d fc 2f 64  89 dc 2d 83 18 7e 48 20  |....../d..-..~H |
-00000010  33 32 5c bf 2c a6 c6 4d  26 f6 75 cd 9d ce 20 1e  |32\.,..M&.u... .|
-00000020  d9 b8 17 03 03 00 13 6b  c6 68 a6 50 07 18 2b f3  |.......k.h.P..+.|
-00000030  73 29 e5 f4 0d f1 ce c9  c0 39                    |s).......9|
+00000000  17 03 03 00 1d 21 5f dc  8c da b2 e4 b2 9c 1e c6  |.....!_.........|
+00000010  dc 2c a5 f6 51 0d 18 03  13 e5 f3 b2 00 c8 4d 1f  |.,..Q.........M.|
+00000020  f9 1b 17 03 03 00 13 f0  2a 99 bd b7 c6 3c 9b da  |........*....<..|
+00000030  b8 c3 3d ee b3 f8 a3 0d  59 f8                    |..=.....Y.|
diff --git a/src/crypto/tls/testdata/Client-TLSv13-P256-ECDHE b/src/crypto/tls/testdata/Client-TLSv13-P256-ECDHE
index 7c8997db0a..826fd7aea8 100644
--- a/src/crypto/tls/testdata/Client-TLSv13-P256-ECDHE
+++ b/src/crypto/tls/testdata/Client-TLSv13-P256-ECDHE
@@ -18,76 +18,109 @@
 00000100  6c 4b 5b 83 56 e2 32 42  e9 58 b6 d7 49 a6 b5 68  |lK[.V.2B.X..I..h|
 00000110  1a 41 03 56 6b dc 5a 89                           |.A.Vk.Z.|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 9b 02 00 00  97 03 03 9b 6d 68 8f c5  |............mh..|
-00000010  57 3c 87 82 4c 88 98 ec  51 3c bd 18 c7 02 b4 5a  |W<..L...Q<.....Z|
-00000020  ed 76 16 f9 54 87 1c 83  3f 76 1a 20 00 00 00 00  |.v..T...?v. ....|
+00000000  16 03 03 00 9b 02 00 00  97 03 03 43 72 ac ef 29  |...........Cr..)|
+00000010  8f 37 16 cf c9 d8 4c ce  9b d9 c1 93 f6 bb 47 a9  |.7....L.......G.|
+00000020  2d 23 83 b5 ff b0 e0 93  34 01 52 20 00 00 00 00  |-#......4.R ....|
 00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000040  00 00 00 00 00 00 00 00  00 00 00 00 13 01 00 00  |................|
 00000050  4f 00 2b 00 02 03 04 00  33 00 45 00 17 00 41 04  |O.+.....3.E...A.|
-00000060  a8 5f cf 31 63 1e 59 63  80 b9 59 47 ee 50 d6 68  |._.1c.Yc..YG.P.h|
-00000070  af fe 1f 1f b0 4f ae 67  a8 d1 f1 a7 ff f4 43 f8  |.....O.g......C.|
-00000080  15 74 ae a7 64 1f 35 2b  29 b3 16 54 91 5c 0f 7d  |.t..d.5+)..T.\.}|
-00000090  c5 63 64 2c 16 f4 99 e3  76 52 6f f6 b6 e8 c7 78  |.cd,....vRo....x|
-000000a0  14 03 03 00 01 01 17 03  03 00 17 47 98 e0 19 54  |...........G...T|
-000000b0  3e f3 78 0a 24 92 23 bb  c0 03 5d 51 8b fb c1 c2  |>.x.$.#...]Q....|
-000000c0  8e e6 17 03 03 02 6d ba  0a a6 e1 a8 13 0c 3c fd  |......m.......<.|
-000000d0  0d ae 7e 47 76 78 9d 17  13 03 53 ba 7a 22 a4 55  |..~Gvx....S.z".U|
-000000e0  3b a3 30 51 d0 e6 33 c3  95 63 07 99 aa 12 82 c3  |;.0Q..3..c......|
-000000f0  be 5d b0 88 2e 91 9c 87  a7 a0 a5 79 d8 5e 1c b2  |.].........y.^..|
-00000100  9b 27 6e da 98 63 a6 9a  e0 f2 51 83 f0 49 85 a4  |.'n..c....Q..I..|
-00000110  63 0f 1a 48 85 29 c1 31  78 c0 66 61 36 d2 ec 7c  |c..H.).1x.fa6..||
-00000120  ed ba 35 42 ed 7f be a5  2c 91 11 8f 95 f9 8f 7a  |..5B....,......z|
-00000130  04 32 14 01 5c 78 21 86  f5 70 09 59 7e dc b3 7f  |.2..\x!..p.Y~...|
-00000140  fd ed 14 d2 40 65 cc b3  1b d7 c6 4b 30 d0 72 59  |....@e.....K0.rY|
-00000150  db 1a 13 3c b8 f4 ea 8f  22 f2 13 b7 3f 9c 99 fd  |...<...."...?...|
-00000160  91 c2 bc e4 e0 71 63 30  81 24 26 2e 9e ff 16 8e  |.....qc0.$&.....|
-00000170  47 e4 e0 e4 12 2f ba 2c  7e c5 dd 91 79 4f bd 5f  |G..../.,~...yO._|
-00000180  0f 0e 66 5f da 0e f2 4d  9e 46 f3 c7 7f 65 f6 d4  |..f_...M.F...e..|
-00000190  cd f1 cb c6 d7 5e a2 db  58 e1 d1 c5 05 63 90 a0  |.....^..X....c..|
-000001a0  96 18 64 29 92 95 88 6c  9f f8 9b 54 b6 d2 e2 bc  |..d)...l...T....|
-000001b0  3d 6f f2 c0 56 76 66 05  21 47 80 e9 63 85 a1 12  |=o..Vvf.!G..c...|
-000001c0  c9 e8 80 c4 fe b5 63 86  cf ae 8f 83 ff ae ff 63  |......c........c|
-000001d0  77 20 ae 9c f7 88 1f 6d  18 4a 33 e9 2b e0 12 ca  |w .....m.J3.+...|
-000001e0  05 4c b7 25 35 b6 8d a4  ba 00 5c f2 be ab a7 d6  |.L.%5.....\.....|
-000001f0  0e 02 1c 58 da af c9 51  4c e8 8e b8 fa 27 78 76  |...X...QL....'xv|
-00000200  9d 50 2e 36 98 09 23 12  37 f0 c6 4a 32 00 cd 09  |.P.6..#.7..J2...|
-00000210  9e ca 6b e4 1e d6 7f 9c  72 b3 81 13 29 2c fe 49  |..k.....r...),.I|
-00000220  99 92 2f 8f c9 f0 86 9d  fa 56 b8 6c 7b 76 fc 12  |../......V.l{v..|
-00000230  c5 1f e7 a1 ea 13 99 ac  2c 6b 9c 23 3e 0b 78 0c  |........,k.#>.x.|
-00000240  41 9a 47 51 0c 64 87 a3  b8 1b 7f 2c d9 c5 b2 28  |A.GQ.d.....,...(|
-00000250  36 13 7e b5 8c ab 32 50  64 a0 eb 9f 57 19 eb fa  |6.~...2Pd...W...|
-00000260  1e 1d b3 73 81 18 14 de  6b ef 68 ed 37 da 29 0e  |...s....k.h.7.).|
-00000270  9a 7d c1 31 c5 bd 76 60  2b 40 3a 85 c2 1c b1 de  |.}.1..v`+@:.....|
-00000280  9f 41 00 22 5a 63 72 9f  57 4e 02 1b 5a 2c 5f 0a  |.A."Zcr.WN..Z,_.|
-00000290  c0 e2 c8 4c ca 18 39 7e  c0 b8 67 58 b4 bd 0c 5b  |...L..9~..gX...[|
-000002a0  3a bd 1e 39 fd 09 73 63  e9 41 86 6b ed fe 35 f0  |:..9..sc.A.k..5.|
-000002b0  64 ed 14 c9 d3 6c 65 97  96 fc dd bf 9f dd e4 01  |d....le.........|
-000002c0  1b 02 ad 5a 55 f5 86 9f  c1 56 ce 59 30 16 bb 9c  |...ZU....V.Y0...|
-000002d0  c8 9f 13 5a fd 61 7d 40  3f ec e7 9c 1e 61 0d c7  |...Z.a}@?....a..|
-000002e0  44 87 84 2b fd 80 9d dd  00 a0 ce 19 fa 9a 3c f5  |D..+..........<.|
-000002f0  59 3b 03 27 10 93 64 15  f4 a5 bd 3b f2 91 38 03  |Y;.'..d....;..8.|
-00000300  a4 4f a4 6a dd 7e 3e 8c  5c 40 19 59 f9 7f a7 7c  |.O.j.~>.\@.Y...||
-00000310  22 3b e8 55 88 b4 99 1f  cb d9 2f 49 74 4d 3c 8b  |";.U....../ItM<.|
-00000320  81 7a 0c 31 77 87 aa 9d  57 9b cd 8a 16 6a cc 06  |.z.1w...W....j..|
-00000330  51 83 1b 00 17 03 03 00  99 a8 77 b4 5b 03 63 c5  |Q.........w.[.c.|
-00000340  fb 02 54 c7 56 aa fb ba  3d 19 52 34 c8 1a d5 3f  |..T.V...=.R4...?|
-00000350  ef bc b9 62 96 e6 42 be  13 4c 67 7a 4c 01 21 14  |...b..B..LgzL.!.|
-00000360  12 5a 91 80 0b ff 19 90  b4 a9 d6 66 bc 50 9c 6c  |.Z.........f.P.l|
-00000370  a2 63 57 d2 78 e7 cb 1a  ed 55 02 64 05 f8 7b 4f  |.cW.x....U.d..{O|
-00000380  1f 5f af a4 ce 9c 9c 82  e2 80 36 77 e6 9b be 82  |._........6w....|
-00000390  25 bd 30 a5 e9 7f f8 a3  f8 f7 56 eb a1 8f f3 e5  |%.0.......V.....|
-000003a0  6d 9f c0 30 e6 95 83 e3  1b 45 49 10 50 e1 7f 27  |m..0.....EI.P..'|
-000003b0  cd 2c da e4 4b da 0d 77  d3 87 fe d2 38 55 e6 ea  |.,..K..w....8U..|
-000003c0  ec 12 90 ba f5 c7 5d 87  cd f1 35 5b 5b 8e d9 a4  |......]...5[[...|
-000003d0  a5 04 17 03 03 00 35 84  59 aa d7 a6 cb 73 41 df  |......5.Y....sA.|
-000003e0  55 60 eb 39 3d 38 e4 84  96 72 40 ac 90 f4 38 59  |U`.9=8...r@...8Y|
-000003f0  be 17 59 ee fa 51 cf 03  1a ec 6a 88 c2 bb 82 3a  |..Y..Q....j....:|
-00000400  11 3b 62 50 3c a5 4a c7  0e e7 e5 a8              |.;bP<.J.....|
+00000060  3b 16 53 b1 b9 87 04 07  c6 35 62 02 6b d1 d6 e6  |;.S......5b.k...|
+00000070  06 54 aa eb 03 ab b3 69  79 0f 86 77 1b 09 0c 70  |.T.....iy..w...p|
+00000080  2e 7d 09 86 1c df d9 a0  67 5c 87 75 f6 0d 1b 3b  |.}......g\.u...;|
+00000090  fd 0a 21 e2 2c 47 e4 be  60 79 f8 b4 e0 36 9f 1e  |..!.,G..`y...6..|
+000000a0  14 03 03 00 01 01 17 03  03 00 17 b5 fa 96 8c 5b  |...............[|
+000000b0  2b 29 ea 48 bb 2f ef d2  f2 b6 46 6c 06 9a a6 6d  |+).H./....Fl...m|
+000000c0  b5 d9 17 03 03 02 6d 54  d1 a7 bb 4a 57 68 0f 8d  |......mT...JWh..|
+000000d0  d9 1f 9c 8d da a4 30 4f  03 74 3e b7 5f 62 9e cc  |......0O.t>._b..|
+000000e0  5d bb df 24 57 db 11 f4  84 e4 65 a2 98 cf bf 27  |]..$W.....e....'|
+000000f0  75 ae 70 3b f8 15 b0 d4  3f e5 50 76 1b 12 fe 41  |u.p;....?.Pv...A|
+00000100  cb d3 f4 7b b8 e5 93 2f  25 87 e0 da ba ce 2e ee  |...{.../%.......|
+00000110  dc ee 2d ae dd e0 d2 2c  55 f8 ff e3 53 d2 c4 b5  |..-....,U...S...|
+00000120  0e dc cd 5f d9 4b dc 6b  6f e1 c8 bb 05 aa 6c 4f  |..._.K.ko.....lO|
+00000130  e9 ee 89 c8 fe 90 ee 37  21 94 c5 7b 06 3c e0 d6  |.......7!..{.<..|
+00000140  bd 94 45 96 9c 72 d3 24  cd e7 a4 14 67 5a b3 24  |..E..r.$....gZ.$|
+00000150  8c a4 5e 95 bb 5a 1a 83  a5 75 00 b6 9c 3f b4 23  |..^..Z...u...?.#|
+00000160  57 ae 19 cb c8 ae ed 17  9a 1a ed 9a c7 51 48 2b  |W............QH+|
+00000170  1e 35 a5 a3 fa 58 3d 6b  e2 06 93 4d 7b 0b 22 cd  |.5...X=k...M{.".|
+00000180  11 22 33 59 b0 21 88 97  ca 11 a6 35 4d 7a ef d0  |."3Y.!.....5Mz..|
+00000190  01 b7 da 3c 32 ce ee 50  d5 cf 3f 17 a5 8f 6c 61  |...<2..P..?...la|
+000001a0  8c b0 d2 4f c5 53 43 9a  d7 24 1f b0 75 ef fb 14  |...O.SC..$..u...|
+000001b0  c6 96 fd 2e 80 d2 9a 8a  9b 69 e0 f5 78 60 a3 47  |.........i..x`.G|
+000001c0  36 41 c1 7e 26 d9 9c c3  93 f8 c7 7c 20 77 de 1a  |6A.~&......| w..|
+000001d0  d9 33 0c 9f 60 89 e2 ac  08 df 34 92 23 fe 6a e6  |.3..`.....4.#.j.|
+000001e0  ec bc 51 3f 2f ec 95 38  39 5a e1 12 3b ca ca bb  |..Q?/..89Z..;...|
+000001f0  be 5d 87 71 4d 9a 2e 04  6c 8b 01 34 bb 71 09 45  |.].qM...l..4.q.E|
+00000200  60 a6 bd e2 33 30 04 bb  89 bc 79 01 84 06 73 04  |`...30....y...s.|
+00000210  c7 5e af 9f ad f6 62 c5  32 46 69 41 7a 31 56 e9  |.^....b.2FiAz1V.|
+00000220  01 5f 65 9f 6b 15 21 d4  a6 ba 3c 45 d7 9e cd 4a  |._e.k.!...<E...J|
+00000230  8c 19 18 ca 17 18 e9 4f  3f fb ec d8 c5 56 41 50  |.......O?....VAP|
+00000240  f9 d6 61 be 19 52 f5 a2  3d b4 27 6a a6 a2 1f 41  |..a..R..=.'j...A|
+00000250  57 e5 a5 e7 76 4e 9e ec  63 8a 45 89 04 3a 33 15  |W...vN..c.E..:3.|
+00000260  18 eb f6 71 fb 2d bc ac  c7 4f cd ed 03 e1 c9 4e  |...q.-...O.....N|
+00000270  27 0c 66 d2 c9 0d fd d7  a2 87 b5 67 29 1c 17 37  |'.f........g)..7|
+00000280  15 09 d8 e8 1b 8e f0 81  20 00 7e 7c 4b 7e 12 88  |........ .~|K~..|
+00000290  02 9c 82 81 22 95 b0 0a  58 e8 b2 85 cd f9 07 53  |...."...X......S|
+000002a0  f9 78 36 fb 8f 93 80 92  14 1d b3 07 9f 36 4f f7  |.x6..........6O.|
+000002b0  44 d6 df 7c f5 19 a6 49  aa 20 29 6e e5 df c5 07  |D..|...I. )n....|
+000002c0  30 76 6c fc f0 1e 2f d6  93 ec 55 8c 08 ce 7b e2  |0vl.../...U...{.|
+000002d0  29 f1 21 c8 eb 32 42 7b  05 21 8b 01 77 25 7f e4  |).!..2B{.!..w%..|
+000002e0  e9 52 76 87 91 2b 47 52  4c 91 40 cc 4f 81 29 6f  |.Rv..+GRL.@.O.)o|
+000002f0  57 28 6a 84 b8 6f a8 31  ef 5c f5 bd ef 96 2e e4  |W(j..o.1.\......|
+00000300  55 e2 2a 07 4d be 49 a2  89 00 41 38 a4 fa 7f 90  |U.*.M.I...A8....|
+00000310  a4 93 63 11 cf f3 36 50  dc 7a 1c f5 7a a0 1e a8  |..c...6P.z..z...|
+00000320  60 ac 41 33 79 e1 65 d2  0e 51 13 65 49 4d 52 78  |`.A3y.e..Q.eIMRx|
+00000330  0a c5 6a e2 17 03 03 00  99 80 e9 ac 5c c7 cb d1  |..j.........\...|
+00000340  47 bf 49 15 11 b6 8f 04  33 ae 0a 37 cd 3e 8a 11  |G.I.....3..7.>..|
+00000350  02 21 70 2c 25 a3 23 42  08 63 9b 34 0d 88 62 ae  |.!p,%.#B.c.4..b.|
+00000360  2c 8f ed 91 c6 2d 78 9f  bf e3 16 bb b1 83 99 e4  |,....-x.........|
+00000370  72 fd 31 ec c3 4f 16 b6  98 d8 d5 d8 46 85 a7 32  |r.1..O......F..2|
+00000380  51 d8 b4 0c 9e 31 a3 e6  80 31 ee d1 d8 e6 ad f2  |Q....1...1......|
+00000390  d5 3d 73 1d 17 5a 73 e4  f1 ac a8 ca 7f 24 a9 76  |.=s..Zs......$.v|
+000003a0  77 28 33 60 c3 fb dd d8  bd bd 38 f5 e5 fc 12 aa  |w(3`......8.....|
+000003b0  34 c4 c8 24 07 db 59 fe  46 ab ab a6 20 77 44 25  |4..$..Y.F... wD%|
+000003c0  d5 27 7c 97 14 ef 01 8a  4c 3a 2b e8 ac 8d c9 05  |.'|.....L:+.....|
+000003d0  d8 12 17 03 03 00 35 7b  1a ff 01 f0 d6 9b 24 e2  |......5{......$.|
+000003e0  e4 50 54 33 21 2b 58 6d  88 4c d7 fd a9 5a d8 6d  |.PT3!+Xm.L...Z.m|
+000003f0  78 13 9f 09 8f 8c 1d 3a  bc 76 c7 f6 95 9c 4d 04  |x......:.v....M.|
+00000400  92 06 e4 82 d1 77 24 da  05 49 4e 52              |.....w$..INR|
 >>> Flow 3 (client to server)
-00000000  17 03 03 00 35 ea 0d 79  a3 d3 98 d9 41 c1 f0 0f  |....5..y....A...|
-00000010  43 e6 77 23 c7 e2 ca 20  27 ed de 0b 89 fd 2b 60  |C.w#... '.....+`|
-00000020  cc c0 09 b2 d1 9c 50 c2  de 79 1f af cb 18 1b df  |......P..y......|
-00000030  e5 63 33 21 f7 36 35 f5  83 bd 17 03 03 00 17 a4  |.c3!.65.........|
-00000040  03 32 95 72 e9 81 7a dc  86 92 d4 d3 6e 27 31 6e  |.2.r..z.....n'1n|
-00000050  fb 5e f3 4d f7 cb 17 03  03 00 13 69 ad fb c5 d1  |.^.M.......i....|
-00000060  8e 3f 20 f5 70 18 41 8f  91 9d 23 58 26 75        |.? .p.A...#X&u|
+00000000  14 03 03 00 01 01 17 03  03 00 35 6f 4f 2f 2f c7  |..........5oO//.|
+00000010  73 95 d9 6a ea 12 1f e4  a0 ea a0 c5 10 8b 57 99  |s..j..........W.|
+00000020  5b 6f 33 ae 14 f8 97 55  7d c2 4a 18 a7 6c 5d a8  |[o3....U}.J..l].|
+00000030  3b 33 6f fd 1e b2 78 4a  02 3f 50 b6 f5 0a 52 88  |;3o...xJ.?P...R.|
+00000040  17 03 03 00 17 c6 b1 65  78 2e 41 4e a8 a6 68 21  |.......ex.AN..h!|
+00000050  27 41 d6 8b cf 69 c4 79  6a a9 93 1e              |'A...i.yj...|
+>>> Flow 4 (server to client)
+00000000  17 03 03 00 ea 38 4c b2  c8 55 46 fe 6f e7 fe 59  |.....8L..UF.o..Y|
+00000010  16 64 0d 78 97 f3 13 b1  6a 64 2b ed 64 d8 c0 96  |.d.x....jd+.d...|
+00000020  5c 52 45 ba ac 9c b0 42  14 81 15 99 79 c9 75 7c  |\RE....B....y.u||
+00000030  41 a4 15 90 7c 2c 8d 7f  75 43 37 1e 26 8f 74 a2  |A...|,..uC7.&.t.|
+00000040  13 45 40 1b ec df f6 a8  fa 75 3d e0 29 7e b9 00  |.E@......u=.)~..|
+00000050  aa b9 c5 60 dd 87 ac dc  44 74 17 0d ed 5a 50 b6  |...`....Dt...ZP.|
+00000060  8f 4e ee 4e d0 a7 97 fc  73 ef 9b 09 d3 ca aa 92  |.N.N....s.......|
+00000070  e9 32 61 9e 18 62 67 20  10 2c e5 18 fd 49 d9 76  |.2a..bg .,...I.v|
+00000080  68 9a 61 c3 be fc 1e 7c  9e ca ed 8c c5 40 dc 03  |h.a....|.....@..|
+00000090  3f 54 39 7e 3a 2a ec 78  a4 a0 91 14 30 cf 8f 9d  |?T9~:*.x....0...|
+000000a0  a9 c3 5b ba 1b 47 93 83  49 e2 dd fc c7 2b a3 11  |..[..G..I....+..|
+000000b0  27 3c dd 35 46 ef 06 d6  89 e6 81 13 c4 61 7f 47  |'<.5F........a.G|
+000000c0  5b ea b1 55 4e 6b 04 75  d1 4a a2 dc 1e 22 20 24  |[..UNk.u.J..." $|
+000000d0  f3 13 2a 63 b7 f4 51 ca  32 3c 82 75 49 e4 29 76  |..*c..Q.2<.uI.)v|
+000000e0  eb 19 20 d5 98 b0 03 9a  02 9f 1f 7e de ca 19 17  |.. ........~....|
+000000f0  03 03 00 ea 72 3d f9 82  80 34 d2 b3 a3 bd e8 cc  |....r=...4......|
+00000100  34 a2 0b 9f 40 c2 07 28  e8 55 5b 73 ce e5 4c 64  |4...@..(.U[s..Ld|
+00000110  54 8e 6b 16 22 b4 00 1c  81 1b c4 ec 2b 0b a1 9c  |T.k.".......+...|
+00000120  10 27 a4 d1 14 d7 4c 65  1e 0f 84 de a3 3e 0e eb  |.'....Le.....>..|
+00000130  46 db 04 f6 dd c4 7f 17  42 96 39 0d e7 2a ca f3  |F.......B.9..*..|
+00000140  ab fb 9b f2 4b a0 fc 8f  ba 16 97 bc ce 39 78 b9  |....K........9x.|
+00000150  fe 81 c9 de e2 c0 56 df  15 d0 ef d6 02 14 52 4b  |......V.......RK|
+00000160  a7 70 ee 46 34 22 6c 53  df b0 61 4e 79 de ad ad  |.p.F4"lS..aNy...|
+00000170  d0 c7 e7 0f fe 02 cd 68  6b e0 57 40 54 f9 7d 57  |.......hk.W@T.}W|
+00000180  42 bb 0b 63 a7 68 a0 c6  c9 92 af 5b e6 d6 ec e3  |B..c.h.....[....|
+00000190  10 a3 07 ac 2e 9a 88 a9  ec 20 47 77 22 c8 54 08  |......... Gw".T.|
+000001a0  90 19 ca 1e 01 a9 92 3e  c9 cf 70 92 5b 90 7a 75  |.......>..p.[.zu|
+000001b0  95 15 d5 e2 e2 13 6e 45  1a 51 ae e0 e0 6c 39 ed  |......nE.Q...l9.|
+000001c0  6c ef c4 c0 c4 29 f5 a2  c1 b4 a9 e9 73 fc dc a4  |l....)......s...|
+000001d0  ea 90 ec bc 33 bf 7c 94  7f e8 ed 54 e2 19        |....3.|....T..|
+>>> Flow 5 (client to server)
+00000000  17 03 03 00 13 ca f6 56  a8 93 c9 5c ad 35 01 39  |.......V...\.5.9|
+00000010  17 11 3c fb a7 94 d6 e5                           |..<.....|
diff --git a/src/crypto/tls/testdata/Client-TLSv13-X25519-ECDHE b/src/crypto/tls/testdata/Client-TLSv13-X25519-ECDHE
index c8ecf83536..3dea0ac4cb 100644
--- a/src/crypto/tls/testdata/Client-TLSv13-X25519-ECDHE
+++ b/src/crypto/tls/testdata/Client-TLSv13-X25519-ECDHE
@@ -16,74 +16,105 @@
 000000e0  28 da ac 5f bb 29 07 30  ff f6 84 af c4 cf c2 ed  |(.._.).0........|
 000000f0  90 99 5f 58 cb 3b 74                              |.._X.;t|
 >>> Flow 2 (server to client)
-00000000  16 03 03 00 7a 02 00 00  76 03 03 89 a2 c7 e7 3a  |....z...v......:|
-00000010  1e 5c a5 51 bd ad 35 de  3d 36 f6 ac ce 57 d0 f1  |.\.Q..5.=6...W..|
-00000020  e4 c4 42 3f 1d c3 2b 13  a7 0f 20 20 00 00 00 00  |..B?..+...  ....|
+00000000  16 03 03 00 7a 02 00 00  76 03 03 ff 75 f5 a2 e7  |....z...v...u...|
+00000010  a6 49 83 90 e7 aa ad d6  71 53 82 9d 1c 0b 4a 8a  |.I......qS....J.|
+00000020  ea 06 7d e6 95 72 d8 f5  52 31 9a 20 00 00 00 00  |..}..r..R1. ....|
 00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
 00000040  00 00 00 00 00 00 00 00  00 00 00 00 13 01 00 00  |................|
-00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 94  |..+.....3.$... .|
-00000060  b6 b9 7b 23 f1 28 d5 b6  96 5a ec e4 03 52 68 5a  |..{#.(...Z...RhZ|
-00000070  23 2e bf c3 cc 2b 0b e8  06 c1 b4 34 52 1f 28 14  |#....+.....4R.(.|
-00000080  03 03 00 01 01 17 03 03  00 17 31 ef c3 81 8c d9  |..........1.....|
-00000090  9d 98 71 b8 08 27 0e d6  c1 35 09 58 36 38 bc cc  |..q..'...5.X68..|
-000000a0  a9 17 03 03 02 6d 25 2e  10 a3 aa b1 6a cd 7c ed  |.....m%.....j.|.|
-000000b0  78 ab 43 5d c8 1f 60 51  00 83 49 59 ac 95 bd 87  |x.C]..`Q..IY....|
-000000c0  98 a7 cd 1e 4d 65 d6 bd  76 78 a9 77 e5 0e 44 73  |....Me..vx.w..Ds|
-000000d0  1f 5f 24 64 fc 05 02 9e  0d 70 de 04 dc b2 7e d3  |._$d.....p....~.|
-000000e0  ee 8d 2e e4 1e 6d 02 dd  45 b8 69 14 46 f5 02 a6  |.....m..E.i.F...|
-000000f0  f1 53 10 02 3a 84 1b 12  d9 cb 64 70 87 8b 1f f5  |.S..:.....dp....|
-00000100  51 d7 02 a8 93 2c 48 14  f6 d6 bd f3 48 f0 7c 10  |Q....,H.....H.|.|
-00000110  82 f7 b2 97 22 26 15 1a  67 4a 0e ca 7c 41 ee 08  |...."&..gJ..|A..|
-00000120  78 b6 44 e1 17 78 9a a1  32 d6 68 99 9d a1 4f e1  |x.D..x..2.h...O.|
-00000130  88 7e 3c 73 67 76 47 68  5c 88 21 e1 2b 5c 87 37  |.~<sgvGh\.!.+\.7|
-00000140  21 89 02 f0 0e e4 e8 48  f9 0a 8c 43 50 79 58 10  |!......H...CPyX.|
-00000150  55 e3 d2 01 24 e3 a3 ea  62 90 38 8a e7 43 9c 9e  |U...$...b.8..C..|
-00000160  e0 9b 91 7a 89 e0 c3 86  27 1a 05 4f 81 92 ba 16  |...z....'..O....|
-00000170  ff b9 15 fa 5e 43 d6 0d  d0 90 a8 62 24 17 ba b5  |....^C.....b$...|
-00000180  6f d5 5a d5 a4 c9 e6 41  19 9e 40 a4 9b 56 90 60  |o.Z....A..@..V.`|
-00000190  15 cb 02 fa e4 9b bd a9  0c a0 8e 9f a5 4b 70 bf  |.............Kp.|
-000001a0  5b e2 0b e3 16 0e 80 77  ff e2 d4 3b da bd 56 2d  |[......w...;..V-|
-000001b0  dd 2f 0d 35 d3 00 3c 04  58 13 1b 11 d4 05 3e 18  |./.5..<.X.....>.|
-000001c0  76 71 d1 ba 52 2e 7c e8  01 49 b6 61 e0 e7 17 c1  |vq..R.|..I.a....|
-000001d0  38 35 fd fa 4d 90 02 eb  c6 b2 a4 d7 a1 ef 4a 4c  |85..M.........JL|
-000001e0  61 90 a3 0c 00 f2 9b d4  de ce 98 77 fc 54 ef 57  |a..........w.T.W|
-000001f0  81 93 06 60 a1 9a da 9d  92 23 28 db 1e 60 3b 6e  |...`.....#(..`;n|
-00000200  15 18 2d 60 ee f6 60 ed  e6 1a 41 a2 62 0a de f5  |..-`..`...A.b...|
-00000210  c4 a1 53 d2 16 e8 92 dd  43 7b 6a 26 8b 83 27 42  |..S.....C{j&..'B|
-00000220  85 36 6f 73 e9 e2 68 aa  32 e2 28 58 0a eb 1a 7e  |.6os..h.2.(X...~|
-00000230  d3 b1 cf e7 02 3f c4 25  85 89 80 ab 57 b4 82 2c  |.....?.%....W..,|
-00000240  90 2a f7 ea 2f 97 59 16  21 d1 79 a8 67 53 a3 61  |.*../.Y.!.y.gS.a|
-00000250  1b fa 9a a4 4f dc 66 72  fd 0e ff 31 e0 8f 3a 54  |....O.fr...1..:T|
-00000260  63 ee 13 2a d7 af 62 53  3c 19 b5 7d fc 8b 4b 12  |c..*..bS<..}..K.|
-00000270  e1 a6 16 a7 28 54 b9 d9  a9 30 08 42 18 11 3b 53  |....(T...0.B..;S|
-00000280  98 b1 72 9a 3e 46 9a b5  86 5e e2 6d d7 00 17 6b  |..r.>F...^.m...k|
-00000290  00 78 35 66 46 03 cb c7  6e 24 32 1b 1d 06 59 96  |.x5fF...n$2...Y.|
-000002a0  43 e1 1a bb e5 b6 df 58  bd ec 90 bf b2 2f dd 79  |C......X...../.y|
-000002b0  74 21 8d bd 6a ed 63 ee  ed 19 43 96 58 c8 55 b5  |t!..j.c...C.X.U.|
-000002c0  2f 6e a8 7f 5c fe cd 56  b0 9e e8 03 63 ab be e4  |/n..\..V....c...|
-000002d0  45 e0 b8 a0 6c cb 37 dc  b8 a4 a1 cd bc c5 09 78  |E...l.7........x|
-000002e0  ea d7 00 26 bf f1 fb 02  1e 46 1a ce ca f5 5c 56  |...&.....F....\V|
-000002f0  73 42 a7 32 20 09 70 4b  1c bb ca 79 6d ad 8a 6c  |sB.2 .pK...ym..l|
-00000300  3f 4a e1 b1 1e d4 76 9d  89 91 20 76 cd f6 99 92  |?J....v... v....|
-00000310  de 64 00 17 03 03 00 99  7f af 97 d5 ba 57 8a e8  |.d...........W..|
-00000320  c7 c7 7c a6 fc 46 50 80  aa 49 36 3a d0 61 42 7e  |..|..FP..I6:.aB~|
-00000330  8d 0e 3d b4 b2 82 d5 79  51 47 1c 72 79 ed 56 ff  |..=....yQG.ry.V.|
-00000340  0d 95 dd a5 84 b1 ac 6d  3d 87 66 ce bf 41 c9 64  |.......m=.f..A.d|
-00000350  8f 6f 91 e7 24 ff 04 30  83 77 40 33 17 da 57 5b  |.o..$..0.w@3..W[|
-00000360  55 be a9 a6 bd 62 2c 24  56 c8 cb a1 68 24 73 97  |U....b,$V...h$s.|
-00000370  2b ab d3 a8 3b 7d df ac  81 3c 85 d3 35 16 86 c8  |+...;}...<..5...|
-00000380  92 a9 a6 95 f2 1d 40 7c  a1 85 a9 6d ac 4a 44 82  |......@|...m.JD.|
-00000390  ec 92 26 04 b8 e2 65 3e  e9 dc cb e5 d1 0a 1f a7  |..&...e>........|
-000003a0  2f a5 7a 9c 7c 62 0f 4e  8a 99 53 99 02 18 09 6f  |/.z.|b.N..S....o|
-000003b0  64 17 03 03 00 35 62 08  e9 3d d4 bc 4c 22 ef fb  |d....5b..=..L"..|
-000003c0  e0 30 cc fb 85 c9 0a 2d  71 f5 06 da 17 dc 94 e0  |.0.....-q.......|
-000003d0  11 7d bb 45 cf b4 32 e5  56 1d 51 e1 74 11 ef 52  |.}.E..2.V.Q.t..R|
-000003e0  27 e6 3f 18 3f 72 65 6d  b3 79 7a                 |'.?.?rem.yz|
+00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 37  |..+.....3.$... 7|
+00000060  7b a6 43 94 9b 0f 95 5e  65 65 f3 50 25 27 d2 c6  |{.C....^ee.P%'..|
+00000070  40 03 1e a3 2f f4 8f c3  a0 f5 62 21 86 0e 32 14  |@.../.....b!..2.|
+00000080  03 03 00 01 01 17 03 03  00 17 4c 11 25 b7 37 16  |..........L.%.7.|
+00000090  50 0f b8 58 72 30 37 e2  25 10 6c 39 9f 7b bf b5  |P..Xr07.%.l9.{..|
+000000a0  53 17 03 03 02 6d 03 5c  76 8c 92 4d 9e f7 75 8b  |S....m.\v..M..u.|
+000000b0  31 48 b9 f9 43 c1 cf 87  3d 5e dc 10 e4 4a 57 86  |1H..C...=^...JW.|
+000000c0  f4 45 f0 9f e2 c3 ac eb  c0 c0 0e 9c d5 7f 8a 07  |.E..............|
+000000d0  c7 ca d4 9a cd a0 7b 14  c7 b3 da d2 29 19 c6 e3  |......{.....)...|
+000000e0  f5 78 e0 fc 61 4e 6a f1  1a 3d b1 ba 91 5b 5d c5  |.x..aNj..=...[].|
+000000f0  77 51 13 6a 6b 6a 68 ba  76 11 df af 6f 75 cf e9  |wQ.jkjh.v...ou..|
+00000100  08 a8 69 05 ae 1f d4 b2  aa a8 95 a2 22 2d 6e e5  |..i........."-n.|
+00000110  fb 18 ac 8c 84 77 56 17  8d 94 c3 25 59 59 b9 c6  |.....wV....%YY..|
+00000120  1a c1 f2 cd f9 41 75 64  3b 19 ff 1c 4e 7c fc 84  |.....Aud;...N|..|
+00000130  bb 42 12 57 2c d4 e1 0f  73 ae 1a 80 af e5 66 9f  |.B.W,...s.....f.|
+00000140  24 93 68 ef 41 6e 52 c7  c4 8a 50 66 2c dd ec fb  |$.h.AnR...Pf,...|
+00000150  75 e7 cd c0 83 cd d3 ce  fc 9c 2c af 2b 86 8d 58  |u.........,.+..X|
+00000160  50 05 82 dd 03 5a 89 cd  59 13 aa d6 dd 50 86 48  |P....Z..Y....P.H|
+00000170  64 a6 ad 12 90 6a 72 78  30 77 dc e1 f1 f5 30 a3  |d....jrx0w....0.|
+00000180  d3 86 60 9c bc 7f ae 28  9a f6 0c 8a 54 0c 78 a8  |..`....(....T.x.|
+00000190  e5 1f 61 73 a2 25 11 7a  92 50 59 af 67 e4 67 bf  |..as.%.z.PY.g.g.|
+000001a0  c6 36 02 fc 83 77 b4 2c  b2 a3 ab f6 43 68 29 ff  |.6...w.,....Ch).|
+000001b0  28 1c 9c bb c9 bb dc 89  d1 fa b9 1d 54 d8 bf 2b  |(...........T..+|
+000001c0  98 8c c6 df 5c bf 22 db  2d 95 2a 22 89 aa 10 98  |....\.".-.*"....|
+000001d0  66 a8 04 24 6d 44 19 2c  44 f5 80 fb be a5 84 41  |f..$mD.,D......A|
+000001e0  17 ab 01 81 a4 3e 1f 6a  fc d0 c2 af d4 fb 48 d3  |.....>.j......H.|
+000001f0  d8 a7 d6 af e7 f6 0d 6f  84 76 e5 27 6d 61 a0 95  |.......o.v.'ma..|
+00000200  cd 3c 72 c3 c3 12 61 d1  23 6f a3 3a 15 3c e1 56  |.<r...a.#o.:.<.V|
+00000210  70 74 62 67 be 0a 9e fc  f0 85 51 07 70 30 36 58  |ptbg......Q.p06X|
+00000220  5f d1 72 71 e3 1e cc e5  66 08 a8 05 c3 c9 40 f2  |_.rq....f.....@.|
+00000230  31 8a f2 bb e5 05 06 37  93 38 eb ce b8 2a f8 e6  |1......7.8...*..|
+00000240  ff fe f6 21 d1 20 96 81  29 5a bc d5 94 12 ca ed  |...!. ..)Z......|
+00000250  be 80 d4 d2 0b 39 78 af  a7 84 21 bd 4f b1 63 b3  |.....9x...!.O.c.|
+00000260  24 26 75 b9 69 0c f3 37  e5 c9 d6 1e fd 75 00 87  |$&u.i..7.....u..|
+00000270  84 97 4f 21 bc 74 3d 14  c2 36 0d 80 08 59 2e c2  |..O!.t=..6...Y..|
+00000280  e7 62 01 5a 87 48 e9 a9  a5 d2 c6 fa 50 93 bf 3e  |.b.Z.H......P..>|
+00000290  ec b5 d2 15 9c 44 cd f6  f2 65 01 ac d4 b0 7b 31  |.....D...e....{1|
+000002a0  96 5d d3 cb ee ba 29 ee  da 20 dc 39 25 f9 b8 77  |.]....).. .9%..w|
+000002b0  b1 56 e2 72 a2 1d ca 65  69 e6 31 79 b8 cd bb 70  |.V.r...ei.1y...p|
+000002c0  00 15 0b 47 e3 b5 00 e1  f1 4e 83 ca e9 2d 84 c3  |...G.....N...-..|
+000002d0  69 99 95 43 bf 89 b3 22  7b ca 17 9b 46 b6 fa 3f  |i..C..."{...F..?|
+000002e0  21 05 87 ea 60 f6 3b ea  a8 e8 30 2a c8 aa d9 9a  |!...`.;...0*....|
+000002f0  e8 4f 15 48 f1 50 54 68  b3 4e 7b e8 8c f2 78 ea  |.O.H.PTh.N{...x.|
+00000300  32 7c ed e1 32 96 90 6e  46 be 28 bb e0 d6 60 4b  |2|..2..nF.(...`K|
+00000310  48 fe 5a 17 03 03 00 99  bc bd b8 1f c4 f4 be 7e  |H.Z............~|
+00000320  e0 cc 0d 79 fe d7 ed 73  d9 c4 80 f3 e3 0a d3 26  |...y...s.......&|
+00000330  d5 d7 7d f4 5f c1 56 6a  2c 03 b4 70 46 4d 88 67  |..}._.Vj,..pFM.g|
+00000340  d2 43 6c 67 4d 2f e1 89  ff bc 9d 70 c7 de 24 0f  |.ClgM/.....p..$.|
+00000350  01 53 82 53 d4 20 30 93  8d 70 5d 3f bd b1 a8 d3  |.S.S. 0..p]?....|
+00000360  d3 46 aa fa d0 2b 9b 70  de 3c f3 1c a4 75 d8 a0  |.F...+.p.<...u..|
+00000370  6a 14 7d ec ad 6f 01 c1  d4 e0 f2 33 1a 1b 71 a8  |j.}..o.....3..q.|
+00000380  74 3d 4c dc 64 fe b9 3b  52 22 39 13 71 19 78 7c  |t=L.d..;R"9.q.x||
+00000390  bf 9d 06 0d 0d 27 4d b6  35 8a 44 f4 4f b9 f7 55  |.....'M.5.D.O..U|
+000003a0  d4 ba f5 ac 05 5b e5 ac  07 8e 49 7a 93 cf 3f 78  |.....[....Iz..?x|
+000003b0  fe 17 03 03 00 35 07 76  8c 10 f4 e8 70 e9 c6 12  |.....5.v....p...|
+000003c0  2d c8 ee 2f b3 6a 72 59  93 ae 8d af 00 8b 7e 5f  |-../.jrY......~_|
+000003d0  2a 33 87 dc 92 a9 7f e4  eb b4 09 8e 57 0f 02 16  |*3..........W...|
+000003e0  31 13 32 fe c5 88 fc b2  28 56 e5                 |1.2.....(V.|
 >>> Flow 3 (client to server)
-00000000  17 03 03 00 35 92 2e 10  eb db 73 85 b8 85 d6 a3  |....5.....s.....|
-00000010  87 c6 18 71 f7 63 06 ed  7e 54 3b 5b a6 dd a8 70  |...q.c..~T;[...p|
-00000020  c4 94 12 e2 c3 cd 5c a5  af e2 64 9d eb 36 f5 dc  |......\...d..6..|
-00000030  16 f1 12 ea 5c 95 65 1e  4b dd 17 03 03 00 17 ba  |....\.e.K.......|
-00000040  be 5d 51 b5 c3 d6 b8 dc  a5 38 85 4a 51 0e c7 ca  |.]Q......8.JQ...|
-00000050  a9 70 0b c7 1c 59 17 03  03 00 13 4d c9 3f 33 6b  |.p...Y.....M.?3k|
-00000060  27 87 88 73 da 3e 74 b2  18 fc 04 59 fc d9        |'..s.>t....Y..|
+00000000  14 03 03 00 01 01 17 03  03 00 35 73 82 31 66 2c  |..........5s.1f,|
+00000010  6e 22 2d 6f b5 30 4d db  eb f0 91 2e b1 11 6d 0e  |n"-o.0M.......m.|
+00000020  ca 50 e6 ce 92 bc 44 8c  e4 e4 3b 8f 13 82 6e 9c  |.P....D...;...n.|
+00000030  bb 25 bc 36 e8 27 5a c1  8f ed 6d fc f1 8c 8a e1  |.%.6.'Z...m.....|
+00000040  17 03 03 00 17 66 bb ee  75 14 79 25 af 92 97 ad  |.....f..u.y%....|
+00000050  ac 26 bf 2e 37 c1 12 e2  ab 65 1f ac              |.&..7....e..|
+>>> Flow 4 (server to client)
+00000000  17 03 03 00 da 19 f9 46  cf 64 be 58 bf d0 24 37  |.......F.d.X..$7|
+00000010  9d 7a 91 0d 24 60 d7 a7  b8 8f dc ca db e2 b3 c6  |.z..$`..........|
+00000020  ec 6e 30 f6 88 8b c9 18  92 b8 f1 06 09 82 49 c5  |.n0...........I.|
+00000030  89 9b a0 76 8e 55 e0 52  ca 12 88 ef dc 62 7c ad  |...v.U.R.....b|.|
+00000040  b1 66 cb 23 b9 3b 7f 4f  d9 da 02 d8 9c c2 f8 66  |.f.#.;.O.......f|
+00000050  26 60 57 a7 99 76 d2 de  15 98 e5 9f b5 b0 54 82  |&`W..v........T.|
+00000060  a9 88 76 25 aa bd 10 7b  47 0b 3d e4 c4 a2 fd 5f  |..v%...{G.=...._|
+00000070  71 da aa 6b 4b e4 77 1e  85 7c f0 6d b8 f2 5b f3  |q..kK.w..|.m..[.|
+00000080  df 73 1e df a0 60 bb 8e  53 4b 5b ac 16 49 aa 15  |.s...`..SK[..I..|
+00000090  11 bf e1 91 a1 03 df 3d  5f 68 a0 93 08 53 c8 98  |.......=_h...S..|
+000000a0  77 b9 22 70 63 44 21 23  22 0c 27 2f b3 22 fd 47  |w."pcD!#".'/.".G|
+000000b0  a1 b9 27 8c 10 b0 e7 db  36 d1 0f 45 d4 59 24 cd  |..'.....6..E.Y$.|
+000000c0  84 db 5f e1 db 8f f8 a6  d7 11 04 6f b4 10 e7 48  |.._........o...H|
+000000d0  f7 50 4e 32 f4 a0 ed 37  04 0d 6b f9 7d 30 e8 17  |.PN2...7..k.}0..|
+000000e0  03 03 00 da 22 55 eb fb  b6 0d 36 a1 46 10 2c 0a  |...."U....6.F.,.|
+000000f0  22 00 59 c0 e2 69 98 4d  f8 38 4b 23 d0 49 a2 3e  |".Y..i.M.8K#.I.>|
+00000100  d6 f3 64 f7 e1 47 39 a4  90 a5 17 81 c4 9a 2a 0f  |..d..G9.......*.|
+00000110  6f e9 71 9a 9e e5 c6 e4  5b fe 91 4a 78 68 9b d7  |o.q.....[..Jxh..|
+00000120  3e 2b c4 81 cd 0b 7a 1a  a0 5d 85 5b 49 db 15 0b  |>+....z..].[I...|
+00000130  c8 90 34 e6 8e 5f 44 4e  85 07 23 4c aa 41 8a 94  |..4.._DN..#L.A..|
+00000140  49 87 69 39 e3 0c 6f 80  19 7c 81 4a 8a 42 5b ed  |I.i9..o..|.J.B[.|
+00000150  1d 65 0b 7e f0 28 60 87  24 ce 23 4e 34 6e f2 10  |.e.~.(`.$.#N4n..|
+00000160  91 85 b1 a0 10 6c ec 30  c0 c3 dd b7 d8 eb 59 71  |.....l.0......Yq|
+00000170  80 20 8a 58 f1 79 f7 70  e9 fa d5 12 58 fd 68 06  |. .X.y.p....X.h.|
+00000180  66 3e 0a 21 4d 9c aa df  92 fc b4 1f 20 e4 df 98  |f>.!M....... ...|
+00000190  c4 11 e1 7b 1f 55 6c e5  75 c1 b9 b6 29 91 85 58  |...{.Ul.u...)..X|
+000001a0  85 a0 7c 9f 29 ea 51 3e  4a 93 21 e6 3a ce 69 c5  |..|.).Q>J.!.:.i.|
+000001b0  60 77 ca fc 04 13 f7 6e  ce 14 73 8d 21 b1        |`w.....n..s.!.|
+>>> Flow 5 (client to server)
+00000000  17 03 03 00 13 03 3a 80  ef 54 48 49 d8 a1 d8 66  |......:..THI...f|
+00000010  3d 5b 76 16 c0 d6 68 5e                           |=[v...h^|
diff --git a/src/crypto/tls/testdata/Server-TLSv13-AES128-SHA256 b/src/crypto/tls/testdata/Server-TLSv13-AES128-SHA256
index 049d2ff962..fcc1a49d0a 100644
--- a/src/crypto/tls/testdata/Server-TLSv13-AES128-SHA256
+++ b/src/crypto/tls/testdata/Server-TLSv13-AES128-SHA256
@@ -1,9 +1,9 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 dc 01 00 00  d8 03 03 f8 75 ee c1 65  |............u..e|
-00000010  31 d9 dd 36 00 f6 b0 f0  a8 d6 a0 42 da d1 8a a3  |1..6.......B....|
-00000020  17 82 1a 44 14 6e bc 43  e0 4b 89 20 88 b8 53 ac  |...D.n.C.K. ..S.|
-00000030  16 d5 64 58 23 21 20 c4  0b 8d 96 d7 db 59 44 3d  |..dX#! ......YD=|
-00000040  9e 67 9b f8 a8 21 6c 6d  02 54 a9 b6 00 04 13 01  |.g...!lm.T......|
+00000000  16 03 01 00 dc 01 00 00  d8 03 03 f7 9c d1 5f 55  |.............._U|
+00000010  eb 97 fd e1 e6 95 50 97  d0 c6 ad ca e0 08 a0 f5  |......P.........|
+00000020  ae 38 9e 60 28 e9 dc 06  3c 54 c5 20 46 14 c7 70  |.8.`(...<T. F..p|
+00000030  69 0d f2 97 27 19 5e 26  3a 1a 3a 70 ec bd 5b 98  |i...'.^&:.:p..[.|
+00000040  37 15 49 09 f9 6a e5 d9  24 a7 df 49 00 04 13 01  |7.I..j..$..I....|
 00000050  00 ff 01 00 00 8b 00 00  00 0e 00 0c 00 00 09 31  |...............1|
 00000060  32 37 2e 30 2e 30 2e 31  00 0b 00 04 03 00 01 02  |27.0.0.1........|
 00000070  00 0a 00 0c 00 0a 00 1d  00 17 00 1e 00 19 00 18  |................|
@@ -11,80 +11,80 @@
 00000090  05 03 06 03 08 07 08 08  08 09 08 0a 08 0b 08 04  |................|
 000000a0  08 05 08 06 04 01 05 01  06 01 00 2b 00 03 02 03  |...........+....|
 000000b0  04 00 2d 00 02 01 01 00  33 00 26 00 24 00 1d 00  |..-.....3.&.$...|
-000000c0  20 be 01 5d e4 e9 b4 66  52 bf 5f 5f ab 82 80 be  | ..]...fR.__....|
-000000d0  25 13 b3 e7 28 5e 00 a6  b0 a6 d5 f1 f0 20 42 e5  |%...(^....... B.|
-000000e0  2e                                                |.|
+000000c0  20 c3 51 8d 67 9c 81 e9  70 8e 8c 4f 85 79 7f ad  | .Q.g...p..O.y..|
+000000d0  a9 63 8d 2a 48 84 a5 05  03 58 c7 c0 0b ab 9f 7c  |.c.*H....X.....||
+000000e0  1d                                                |.|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 7a 02 00 00  76 03 03 00 00 00 00 00  |....z...v.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000020  00 00 00 00 00 00 00 00  00 00 00 20 88 b8 53 ac  |........... ..S.|
-00000030  16 d5 64 58 23 21 20 c4  0b 8d 96 d7 db 59 44 3d  |..dX#! ......YD=|
-00000040  9e 67 9b f8 a8 21 6c 6d  02 54 a9 b6 13 01 00 00  |.g...!lm.T......|
+00000020  00 00 00 00 00 00 00 00  00 00 00 20 46 14 c7 70  |........... F..p|
+00000030  69 0d f2 97 27 19 5e 26  3a 1a 3a 70 ec bd 5b 98  |i...'.^&:.:p..[.|
+00000040  37 15 49 09 f9 6a e5 d9  24 a7 df 49 13 01 00 00  |7.I..j..$..I....|
 00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 2f  |..+.....3.$... /|
 00000060  e5 7d a3 47 cd 62 43 15  28 da ac 5f bb 29 07 30  |.}.G.bC.(.._.).0|
-00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 17  |.........._X.;t.|
-00000080  03 03 00 17 ff de 7b 26  44 70 00 05 64 fc 65 e3  |......{&Dp..d.e.|
-00000090  23 fd ea 4b b3 d0 e6 80  db 2b 4c 17 03 03 02 6d  |#..K.....+L....m|
-000000a0  8f 7b 9c 1f b5 a8 26 b3  89 76 13 7f a2 9a 9b e3  |.{....&..v......|
-000000b0  b8 06 c3 ff 02 c2 41 8e  29 fd f4 45 43 d3 57 23  |......A.)..EC.W#|
-000000c0  71 32 03 31 24 2b 73 ca  7a df e9 79 4e 96 7c d5  |q2.1$+s.z..yN.|.|
-000000d0  f1 19 05 11 1c cf 5f 85  30 e5 32 2c 61 2c d2 40  |......_.0.2,a,.@|
-000000e0  25 c0 72 2c f8 ef d2 8d  d9 4f 81 88 cc 9f c0 71  |%.r,.....O.....q|
-000000f0  97 9e 79 f4 33 e8 75 47  1e 5a c1 02 20 48 6f a4  |..y.3.uG.Z.. Ho.|
-00000100  41 d6 37 73 07 ad 90 37  80 d7 f9 c1 59 96 9f a8  |A.7s...7....Y...|
-00000110  e4 f5 e4 65 99 02 a3 69  95 e1 39 07 fb a8 ac 6d  |...e...i..9....m|
-00000120  40 fb de 64 05 5b b4 32  ba 09 da 92 0a ba 1e 11  |@..d.[.2........|
-00000130  3f d3 bd 6d 68 f7 15 d3  74 60 18 cd 96 04 2f db  |?..mh...t`..../.|
-00000140  c5 09 f2 05 5f 82 8b 23  65 00 7c b7 d5 ef 1d 0e  |...._..#e.|.....|
-00000150  3a 08 2b c9 6d 99 9b 9a  a6 55 2c df 08 c0 4a b1  |:.+.m....U,...J.|
-00000160  b3 69 9c d9 68 49 43 28  8e 00 c5 e1 60 07 25 4d  |.i..hIC(....`.%M|
-00000170  aa 61 2e 74 82 49 62 e0  a8 f0 53 6c 64 ea fc cc  |.a.t.Ib...Sld...|
-00000180  84 ab 26 b6 b8 ef 55 cd  3d 34 1a 65 25 8f 76 f4  |..&...U.=4.e%.v.|
-00000190  dc 06 9b 67 98 59 c1 37  86 0f 24 34 86 b5 a3 dd  |...g.Y.7..$4....|
-000001a0  5b d4 c8 04 cb 73 e1 67  bb 66 d7 94 16 eb 3b 73  |[....s.g.f....;s|
-000001b0  7e 67 8d 7f bf e9 f9 89  6d d8 6a a9 3c 97 eb 67  |~g......m.j.<..g|
-000001c0  f0 6f fa 9b 4d f0 25 25  a2 30 1d 3c 93 14 6e 33  |.o..M.%%.0.<..n3|
-000001d0  fa bf 5b 3c c3 cc f4 0e  fa 55 e2 20 46 3f 1c b7  |..[<.....U. F?..|
-000001e0  9d d3 ec d8 54 18 0b 4a  be 45 bd 5e a1 3a f2 e9  |....T..J.E.^.:..|
-000001f0  15 b0 15 a4 b4 a6 f5 52  36 9b 6b 18 ce ac 37 ae  |.......R6.k...7.|
-00000200  76 e6 2c d1 6b 3f 95 eb  37 79 fe ec cc a6 34 4a  |v.,.k?..7y....4J|
-00000210  27 68 0e d0 80 d8 5c 1c  9c ac aa 02 18 e7 c1 72  |'h....\........r|
-00000220  08 52 07 63 04 65 13 53  23 51 ce 0e f4 1d 4f ca  |.R.c.e.S#Q....O.|
-00000230  51 13 ad 10 1b f3 a4 c3  69 ce c0 ed d1 25 6c 60  |Q.......i....%l`|
-00000240  e7 21 9e d7 9f 8b a1 20  61 75 f6 e0 06 c4 dd bb  |.!..... au......|
-00000250  8e e2 05 86 ef fe 75 0e  47 ae 54 82 e9 32 9b 87  |......u.G.T..2..|
-00000260  fb eb e4 14 e3 f0 90 1d  48 72 00 02 53 52 24 47  |........Hr..SR$G|
-00000270  98 a1 cc b9 b3 8d ab a7  db b0 f5 83 db 56 a1 ad  |.............V..|
-00000280  7d 45 e7 5f 6a bd a9 65  87 8c 48 1f de dc b4 ce  |}E._j..e..H.....|
-00000290  47 7c ec 63 fb 77 f3 5a  a0 3b 84 53 cf 8b 73 30  |G|.c.w.Z.;.S..s0|
-000002a0  bd 0f ac 5a 9b e8 a1 88  f6 45 96 ca b9 48 c3 be  |...Z.....E...H..|
-000002b0  8b 7e f1 1a fd 8a 54 9e  5a 76 e7 9a bc 06 7e 04  |.~....T.Zv....~.|
-000002c0  bd e1 a1 a3 4d 52 56 3b  64 29 70 87 89 c5 f5 ce  |....MRV;d)p.....|
-000002d0  1f 65 7d 55 9f 28 32 3e  6b c7 b6 17 0b dd 7e ea  |.e}U.(2>k.....~.|
-000002e0  ef 7b a0 f0 6f 84 2a 11  93 d5 d8 99 dc ee 17 57  |.{..o.*........W|
-000002f0  3f d7 7f a7 da c0 30 77  13 31 60 9c ca 32 67 09  |?.....0w.1`..2g.|
-00000300  70 ce 05 0d c8 b6 e1 a2  df e4 f1 3c 67 17 03 03  |p..........<g...|
-00000310  00 99 fb 8f 18 6d bc 39  45 b6 8e 22 8d f2 c7 1a  |.....m.9E.."....|
-00000320  79 5b 03 1a 99 e3 23 48  b6 de e2 f8 7b b0 7b 64  |y[....#H....{.{d|
-00000330  6d 4e 78 2e fa ff fd 1e  84 76 53 6f 7c 38 19 83  |mNx......vSo|8..|
-00000340  67 fa c4 80 74 f5 21 3d  d3 08 60 f0 d3 25 b9 87  |g...t.!=..`..%..|
-00000350  2c 59 7d 91 86 02 a5 23  81 dc 1c b8 bd 51 6f 19  |,Y}....#.....Qo.|
-00000360  69 e3 06 11 a0 77 02 8e  3e db ed 64 af d8 b0 42  |i....w..>..d...B|
-00000370  39 15 00 13 c3 c8 35 66  21 d0 1f 94 0b 21 79 22  |9.....5f!....!y"|
-00000380  5b 32 89 d4 81 28 6c c7  55 74 a7 a4 22 62 a9 cb  |[2...(l.Ut.."b..|
-00000390  76 9f e9 af 55 d5 1f b5  51 f7 40 2c fb 3b 03 30  |v...U...Q.@,.;.0|
-000003a0  13 ca a0 79 ba 80 1b 0e  57 3d 84 17 03 03 00 35  |...y....W=.....5|
-000003b0  fb 34 92 6a 46 f2 59 1a  94 39 63 d1 9d 58 40 e8  |.4.jF.Y..9c..X@.|
-000003c0  f0 bb e7 fe 4d 1c 42 a2  38 9e cd a2 01 1c b6 a7  |....M.B.8.......|
-000003d0  e3 9a cb 28 73 5f 8a 1e  b3 40 41 80 85 2c 49 54  |...(s_...@A..,IT|
-000003e0  3d 13 dc cc 6c                                    |=...l|
+00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 14  |.........._X.;t.|
+00000080  03 03 00 01 01 17 03 03  00 17 65 99 0a bb fc 0a  |..........e.....|
+00000090  a1 c2 2d 9c 7f 2e 0f 8d  50 5b 17 d3 66 6b 08 d1  |..-.....P[..fk..|
+000000a0  cd 17 03 03 02 6d e6 e8  30 95 96 f8 18 a4 0e a9  |.....m..0.......|
+000000b0  18 eb 1a 61 d4 57 c4 69  5c fa bf 26 cb d3 6d e7  |...a.W.i\..&..m.|
+000000c0  d9 cd b7 d1 a2 46 c2 2d  b2 83 f0 02 30 51 73 ac  |.....F.-....0Qs.|
+000000d0  8c 47 b3 5a b0 ae 13 7f  ad a0 15 da 48 96 da 84  |.G.Z........H...|
+000000e0  69 e3 a4 8a 71 33 63 1b  6d 42 6d 57 f4 9c 46 fb  |i...q3c.mBmW..F.|
+000000f0  c0 4a ad 77 6b 99 81 0c  2a 2d a2 d0 98 89 7b 8c  |.J.wk...*-....{.|
+00000100  ee 56 a4 e0 94 1a 83 07  5f 64 b2 7a 11 77 98 df  |.V......_d.z.w..|
+00000110  32 85 14 19 5b 97 4e 47  48 7c 6d bf f8 34 eb d4  |2...[.NGH|m..4..|
+00000120  38 90 0e 78 df f4 94 49  11 5e 7f d3 65 d3 36 e8  |8..x...I.^..e.6.|
+00000130  26 bc a1 ba 28 c8 2e 51  86 77 ea f0 91 4b 7e 31  |&...(..Q.w...K~1|
+00000140  9c 42 63 f9 17 7f b4 6d  68 69 76 a2 3c 7f af 01  |.Bc....mhiv.<...|
+00000150  d6 e2 72 c3 c9 2a d9 b9  e4 a1 e9 6b 05 07 7f d3  |..r..*.....k....|
+00000160  e3 55 d5 9e df 5e 02 ad  3f 84 8f 17 47 f8 c1 6f  |.U...^..?...G..o|
+00000170  3a 98 63 f7 5f a6 3c a9  79 31 74 3d 99 c2 6c 91  |:.c._.<.y1t=..l.|
+00000180  3f 72 5d 96 d4 55 de 46  44 44 d9 99 6f ef d4 96  |?r]..U.FDD..o...|
+00000190  f7 a9 e1 2b fc d3 e7 0a  a2 01 36 50 b6 8b 29 97  |...+......6P..).|
+000001a0  4e 5b 7f f0 20 82 79 3e  ea e3 f1 df 40 c5 02 66  |N[.. .y>....@..f|
+000001b0  ba f9 fc c1 cf 08 0a ef  18 16 11 4a 78 9b 94 82  |...........Jx...|
+000001c0  07 e1 a7 45 b4 7d 47 f9  ae 4b d1 86 d4 86 10 b3  |...E.}G..K......|
+000001d0  7e 18 23 12 2f a0 5b 89  fb 82 0d 44 2b cb 4a 05  |~.#./.[....D+.J.|
+000001e0  61 f6 9b 66 41 d2 37 9c  3c 05 4e 84 6d 67 65 6f  |a..fA.7.<.N.mgeo|
+000001f0  0e 0e 97 5c 92 19 f1 b8  14 08 f2 0e a9 a6 93 1e  |...\............|
+00000200  c5 8c a6 e2 da f1 fe e2  87 67 1b 88 c8 50 73 49  |.........g...PsI|
+00000210  2b 27 7a 86 24 d7 55 03  44 a3 45 13 b8 e9 d2 62  |+'z.$.U.D.E....b|
+00000220  a5 27 7c 95 31 6d cf aa  a1 21 57 c5 1a 7e 4e 63  |.'|.1m...!W..~Nc|
+00000230  ad 94 78 7a 42 61 16 19  9c c4 39 de a4 78 71 c3  |..xzBa....9..xq.|
+00000240  00 e8 01 4e 1a 84 8b 70  83 cc 09 12 1f 31 18 80  |...N...p.....1..|
+00000250  70 92 4e 7e 77 4a d9 05  92 44 e2 03 8e 8e 9b 3c  |p.N~wJ...D.....<|
+00000260  25 d3 a9 a4 6d 42 06 35  bd 5c 7b e6 b2 99 3f 8f  |%...mB.5.\{...?.|
+00000270  ba 53 3c e5 45 41 17 19  0e 74 3b 9b 00 93 bb a1  |.S<.EA...t;.....|
+00000280  b6 a6 08 a9 58 7b b1 f2  4b 03 c3 d8 2e a4 79 18  |....X{..K.....y.|
+00000290  08 8f 1e 10 8d 72 04 76  a9 18 6c 11 8f 19 87 e2  |.....r.v..l.....|
+000002a0  6f a6 b1 46 b7 0c 75 e7  a4 87 c1 c5 b4 93 82 85  |o..F..u.........|
+000002b0  99 76 41 57 d3 ca 8d 7e  4c e5 83 b0 e7 dd 9e 61  |.vAW...~L......a|
+000002c0  11 3c 21 f6 c5 1a 91 25  d5 20 5d 20 55 74 bb 04  |.<!....%. ] Ut..|
+000002d0  dc cb 98 f2 5b b0 2a 09  40 f0 ea 31 97 a9 f8 34  |....[.*.@..1...4|
+000002e0  6e 6f 19 24 aa fe b9 18  51 a4 dd 75 26 c4 ee a5  |no.$....Q..u&...|
+000002f0  55 ef bd e5 7e 5a 72 c4  2f 1c d6 b6 24 6d 56 3d  |U...~Zr./...$mV=|
+00000300  67 3b 56 ce 65 79 21 70  63 ed a5 09 b9 77 67 f8  |g;V.ey!pc....wg.|
+00000310  38 43 0b 17 03 03 00 99  65 f3 0c 81 6f 7f 86 50  |8C......e...o..P|
+00000320  37 41 7f 02 e2 79 ae 03  fc 45 aa 5b 47 e1 75 55  |7A...y...E.[G.uU|
+00000330  d7 80 9c 62 f4 24 c9 40  d2 cf b8 d0 8c 6e 7f b8  |...b.$.@.....n..|
+00000340  76 9d 31 9a 96 8f 3f 60  a8 72 e5 6b 46 fe 13 7c  |v.1...?`.r.kF..||
+00000350  c9 5d 56 c9 c8 b4 4c c8  81 bd d7 4d 6f 12 b4 b6  |.]V...L....Mo...|
+00000360  bf fb f0 37 54 0f 79 5a  e1 19 93 9f 13 91 4b 7b  |...7T.yZ......K{|
+00000370  f4 96 36 58 ed 82 26 60  fe 1c 1a 19 a3 47 3e 58  |..6X..&`.....G>X|
+00000380  b2 05 25 a3 54 a6 1f b8  84 02 3c e4 e0 18 db b9  |..%.T.....<.....|
+00000390  1f 35 26 b5 98 68 bd 3e  0b 7c 8c da 8b a8 fe 95  |.5&..h.>.|......|
+000003a0  59 39 0c 78 9a c4 d4 21  6b fe 35 c5 1b a9 47 5d  |Y9.x...!k.5...G]|
+000003b0  50 17 03 03 00 35 ce 61  ce fa 4a ed f7 a7 b1 09  |P....5.a..J.....|
+000003c0  f4 ca 2b 94 9d a6 70 39  4a eb b1 e3 63 9f d7 85  |..+...p9J...c...|
+000003d0  cc dc 6a 0b 30 1f d8 fa  12 4b ef eb 25 1f e8 1d  |..j.0....K..%...|
+000003e0  85 e3 f2 04 52 17 ec 78  ed b2 1b                 |....R..x...|
 >>> Flow 3 (client to server)
-00000000  14 03 03 00 01 01 17 03  03 00 35 c5 aa 6e cd 44  |..........5..n.D|
-00000010  2f f6 09 74 33 13 e1 c1  32 6f 94 cd 55 2c 45 88  |/..t3...2o..U,E.|
-00000020  f1 f8 51 c7 3e 64 62 e1  8a 48 cc bd c8 ac 91 a3  |..Q.>db..H......|
-00000030  90 ea 45 1b 21 52 d4 81  84 88 0d ed a2 86 d4 64  |..E.!R.........d|
+00000000  14 03 03 00 01 01 17 03  03 00 35 ad 1b 33 af 8e  |..........5..3..|
+00000010  ab 81 7c f3 9f 2b 76 19  d8 37 9f ef ef b7 76 33  |..|..+v..7....v3|
+00000020  1b a9 05 4d 2b 79 d7 ae  f7 87 c9 1f c3 4f 8e 50  |...M+y.......O.P|
+00000030  02 5b 34 b0 b3 4b f7 ce  bf 4c 3c b0 db 31 28 ab  |.[4..K...L<..1(.|
 >>> Flow 4 (server to client)
-00000000  17 03 03 00 1e 4c e5 b2  aa 21 9e 56 24 62 da a7  |.....L...!.V$b..|
-00000010  af ef 76 b5 8a 9a a1 3b  2e cd e8 68 27 ac 08 e1  |..v....;...h'...|
-00000020  c1 37 52 17 03 03 00 13  8e 91 11 5b cf c4 28 e3  |.7R........[..(.|
-00000030  a5 ea bb 89 93 fc 94 bc  e6 28 32                 |.........(2|
+00000000  17 03 03 00 1e c7 45 aa  04 3f d4 29 33 fd 40 17  |......E..?.)3.@.|
+00000010  c3 60 4d 05 54 f7 f0 68  82 19 dd 00 97 1c 93 e1  |.`M.T..h........|
+00000020  01 19 33 17 03 03 00 13  50 d4 21 09 db 6d ce f8  |..3.....P.!..m..|
+00000030  d0 ab 2d ba e7 c0 b2 7e  5b 62 e0                 |..-....~[b.|
diff --git a/src/crypto/tls/testdata/Server-TLSv13-AES256-SHA384 b/src/crypto/tls/testdata/Server-TLSv13-AES256-SHA384
index ab98f48cf2..d7fa9980c8 100644
--- a/src/crypto/tls/testdata/Server-TLSv13-AES256-SHA384
+++ b/src/crypto/tls/testdata/Server-TLSv13-AES256-SHA384
@@ -1,9 +1,9 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 dc 01 00 00  d8 03 03 35 42 f3 56 6d  |...........5B.Vm|
-00000010  cd 58 c6 08 54 f1 6c 64  c5 16 eb 39 b0 d9 1b 22  |.X..T.ld...9..."|
-00000020  88 d6 36 a7 70 a8 27 c8  e8 1a 20 20 cc c6 13 bc  |..6.p.'...  ....|
-00000030  f4 3a ed 6a d2 59 ac 02  18 68 e9 80 50 4a a3 df  |.:.j.Y...h..PJ..|
-00000040  1e 6b 54 0c 85 3a 17 5c  23 7f e0 fc 00 04 13 02  |.kT..:.\#.......|
+00000000  16 03 01 00 dc 01 00 00  d8 03 03 f2 41 21 15 42  |............A!.B|
+00000010  77 2a a0 81 3d 0e f8 66  c0 9d 10 e6 0d b2 ea 15  |w*..=..f........|
+00000020  ad 7b 23 a4 63 a9 8e 06  fd a5 fb 20 38 22 f7 e8  |.{#.c...... 8"..|
+00000030  9d 36 66 18 6a 38 41 49  0c 42 9d 56 11 3d 74 cb  |.6f.j8AI.B.V.=t.|
+00000040  9b 55 93 bb 68 4e 4d de  a9 96 fc 45 00 04 13 02  |.U..hNM....E....|
 00000050  00 ff 01 00 00 8b 00 00  00 0e 00 0c 00 00 09 31  |...............1|
 00000060  32 37 2e 30 2e 30 2e 31  00 0b 00 04 03 00 01 02  |27.0.0.1........|
 00000070  00 0a 00 0c 00 0a 00 1d  00 17 00 1e 00 19 00 18  |................|
@@ -11,82 +11,82 @@
 00000090  05 03 06 03 08 07 08 08  08 09 08 0a 08 0b 08 04  |................|
 000000a0  08 05 08 06 04 01 05 01  06 01 00 2b 00 03 02 03  |...........+....|
 000000b0  04 00 2d 00 02 01 01 00  33 00 26 00 24 00 1d 00  |..-.....3.&.$...|
-000000c0  20 de c8 19 7a 66 cb db  c3 04 b9 96 f4 5c 2e 52  | ...zf.......\.R|
-000000d0  1b 63 0b 11 87 a2 a9 14  f8 54 10 a4 de 5f 9f 13  |.c.......T..._..|
-000000e0  09                                                |.|
+000000c0  20 97 44 9d 4b c2 e5 38  dd 18 d5 79 ac 7e 65 b7  | .D.K..8...y.~e.|
+000000d0  e9 0e 89 ff f8 ab 81 81  ad 7f 9a c3 59 12 5a 55  |............Y.ZU|
+000000e0  4e                                                |N|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 7a 02 00 00  76 03 03 00 00 00 00 00  |....z...v.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000020  00 00 00 00 00 00 00 00  00 00 00 20 cc c6 13 bc  |........... ....|
-00000030  f4 3a ed 6a d2 59 ac 02  18 68 e9 80 50 4a a3 df  |.:.j.Y...h..PJ..|
-00000040  1e 6b 54 0c 85 3a 17 5c  23 7f e0 fc 13 02 00 00  |.kT..:.\#.......|
+00000020  00 00 00 00 00 00 00 00  00 00 00 20 38 22 f7 e8  |........... 8"..|
+00000030  9d 36 66 18 6a 38 41 49  0c 42 9d 56 11 3d 74 cb  |.6f.j8AI.B.V.=t.|
+00000040  9b 55 93 bb 68 4e 4d de  a9 96 fc 45 13 02 00 00  |.U..hNM....E....|
 00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 2f  |..+.....3.$... /|
 00000060  e5 7d a3 47 cd 62 43 15  28 da ac 5f bb 29 07 30  |.}.G.bC.(.._.).0|
-00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 17  |.........._X.;t.|
-00000080  03 03 00 17 de 82 46 36  68 05 6c 4d 4c 79 da 2a  |......F6h.lMLy.*|
-00000090  a2 de 70 e3 64 66 79 ba  1d 4f d3 17 03 03 02 6d  |..p.dfy..O.....m|
-000000a0  66 1a 81 1c 38 21 0d 17  ef 4c 0f ad 52 c1 f3 d5  |f...8!...L..R...|
-000000b0  d6 3f ee 05 dd bb ec e3  cd 00 a3 e5 42 90 f6 b8  |.?..........B...|
-000000c0  2f d3 95 b8 27 3d 70 63  55 ef 32 e8 55 1a 20 0e  |/...'=pcU.2.U. .|
-000000d0  c8 47 7b 0c 15 30 86 37  72 25 d7 3b 97 a3 d1 90  |.G{..0.7r%.;....|
-000000e0  5c a4 07 e4 b8 3c 3b bc  74 ea 93 d5 a8 30 dc bc  |\....<;.t....0..|
-000000f0  f9 2b 62 4e 15 84 c6 1c  67 a3 85 e2 8e 71 1d 6a  |.+bN....g....q.j|
-00000100  8d 26 97 96 ba 08 9d 09  e5 21 fa 4c 72 d9 7a df  |.&.......!.Lr.z.|
-00000110  39 69 02 82 58 0c ba 79  2a c1 73 d7 97 44 62 56  |9i..X..y*.s..DbV|
-00000120  b6 7f 08 91 a3 ed 95 18  84 99 31 f6 64 54 59 bc  |..........1.dTY.|
-00000130  e0 c6 a2 e1 5f 51 5d 03  fd 5b cf 8f 97 1b 41 4b  |...._Q]..[....AK|
-00000140  c6 fa 78 06 c4 4d 3c e0  ba d9 3c 5f 5f f8 72 79  |..x..M<...<__.ry|
-00000150  53 a0 cc bc aa 92 be 78  15 08 35 36 1f 53 91 89  |S......x..56.S..|
-00000160  ec 74 0b b4 9e 97 85 86  d0 15 ff b6 62 9c 89 07  |.t..........b...|
-00000170  9f 5d e8 9f 9d 7e b9 17  0e 33 78 06 ea 84 db 9e  |.]...~...3x.....|
-00000180  90 37 8a db c1 66 e2 a1  72 40 91 c5 49 e6 04 d9  |.7...f..r@..I...|
-00000190  35 7c 50 1b 2e d6 63 44  c8 44 f9 e3 72 9c 1c 29  |5|P...cD.D..r..)|
-000001a0  63 0f 5e fd a8 ab 09 c8  b8 02 7b 6f 40 35 85 3e  |c.^.......{o@5.>|
-000001b0  bb ae c9 b2 06 6d 0d 70  7e 65 b9 30 20 8f 54 da  |.....m.p~e.0 .T.|
-000001c0  9d 55 6e 70 7a a3 b0 15  5a 29 72 51 61 84 57 5c  |.Unpz...Z)rQa.W\|
-000001d0  f0 65 0a 9b 6e fb a4 d9  22 70 45 de c1 a6 5f 95  |.e..n..."pE..._.|
-000001e0  3e 95 c8 3f 6b fa 69 01  ab e8 e0 61 6d 76 7b 5b  |>..?k.i....amv{[|
-000001f0  b2 33 e9 c1 67 99 33 99  03 75 e3 2c 29 b8 0f 75  |.3..g.3..u.,)..u|
-00000200  b8 00 c5 dd cf f3 2e 24  fc 55 cc d5 d4 2d cc f4  |.......$.U...-..|
-00000210  f1 59 20 d5 7a c1 ef f5  3b 8b b0 2a 0d c0 2a ad  |.Y .z...;..*..*.|
-00000220  2c ce c6 91 4d 17 1e 5c  e8 d1 98 1e 58 cc d9 42  |,...M..\....X..B|
-00000230  42 e9 ff b8 f7 33 f0 af  df 8f 1e 7f 52 79 7e 4f  |B....3......Ry~O|
-00000240  48 e1 21 10 8c aa 7c 84  5d 42 f0 01 73 ff bb e1  |H.!...|.]B..s...|
-00000250  de cb 61 a9 d0 9a be 2a  cd 18 60 91 0c 20 86 db  |..a....*..`.. ..|
-00000260  4a e7 08 eb ab af 1b 7a  bb 04 f6 49 29 b9 20 65  |J......z...I). e|
-00000270  da a6 09 f3 8e 57 b4 5f  b0 53 07 86 06 cf 44 de  |.....W._.S....D.|
-00000280  ba bd 16 ca 88 df 65 50  1a 0d 4b 30 41 ee 04 6a  |......eP..K0A..j|
-00000290  90 71 27 1b 05 b2 5e 0b  9c 77 ec fb 8a 02 82 18  |.q'...^..w......|
-000002a0  34 3e af ea 43 71 4b 9c  12 75 f2 59 32 04 76 87  |4>..CqK..u.Y2.v.|
-000002b0  2a ea 31 f6 c8 29 30 41  3f cf 4e c5 2b 38 d0 15  |*.1..)0A?.N.+8..|
-000002c0  e6 fa 8d de 2a ec 3e 49  b9 bb 2e 46 ef 8b 8f a4  |....*.>I...F....|
-000002d0  e0 96 39 67 d6 2f 56 fb  8b 9c 7c 49 65 3d b3 8e  |..9g./V...|Ie=..|
-000002e0  1f 48 02 24 53 10 43 49  6d 31 fc d6 99 f6 50 73  |.H.$S.CIm1....Ps|
-000002f0  b3 fd b7 57 72 c6 81 a2  df 16 13 0a da 67 8f 3c  |...Wr........g.<|
-00000300  ff 94 b7 8a 26 0c f2 fe  c9 f6 67 a2 f2 17 03 03  |....&.....g.....|
-00000310  00 99 1d 59 bb 70 37 f6  a7 72 d1 27 3b 5a d5 1d  |...Y.p7..r.';Z..|
-00000320  f6 e6 02 84 3c 8b 24 0e  78 ed 88 73 e8 e4 d2 8d  |....<.$.x..s....|
-00000330  97 c4 cc a3 22 b7 c1 ba  2d df ef d4 84 0d 78 ce  |...."...-.....x.|
-00000340  70 c9 4f 60 dc fb 13 50  2d d1 52 ba e9 d4 5a 5e  |p.O`...P-.R...Z^|
-00000350  ed eb 93 ae 99 b8 08 91  61 ee a5 9c 3e 63 07 ed  |........a...>c..|
-00000360  17 b1 29 5f 03 ae 5b 0d  a7 0a 4a 3a f5 6b 9c 6f  |..)_..[...J:.k.o|
-00000370  28 ad 16 6d f5 31 17 87  f5 10 b5 53 13 c8 a2 a1  |(..m.1.....S....|
-00000380  7a 9a 12 10 04 0b e7 b6  c7 3b 55 25 05 d3 0c 5e  |z........;U%...^|
-00000390  32 60 bf 43 e6 62 d0 cc  cd a6 61 9b 19 dc 83 34  |2`.C.b....a....4|
-000003a0  9f f2 2d 8f ca 9e 96 73  4d e9 52 17 03 03 00 45  |..-....sM.R....E|
-000003b0  28 21 db ab 2f da c8 33  af a5 44 5b f4 2f 18 bd  |(!../..3..D[./..|
-000003c0  72 74 6d a7 c0 16 fb 13  de 8b d4 f8 03 8f ba 28  |rtm............(|
-000003d0  06 89 08 0f 82 14 9b 6d  9b 61 7c 6c c3 de 76 2e  |.......m.a|l..v.|
-000003e0  f3 2b ff db 2d bc 6f 84  75 19 b3 df eb a1 a7 69  |.+..-.o.u......i|
-000003f0  a7 a7 70 27 48                                    |..p'H|
+00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 14  |.........._X.;t.|
+00000080  03 03 00 01 01 17 03 03  00 17 c8 4d 76 95 99 66  |...........Mv..f|
+00000090  62 83 71 d0 1f 1a 84 b9  11 37 57 e3 49 cc fd d4  |b.q......7W.I...|
+000000a0  c9 17 03 03 02 6d 94 79  d5 d0 c7 a0 74 d4 96 53  |.....m.y....t..S|
+000000b0  b2 d7 c0 a6 95 2a c9 ba  d3 85 16 98 66 4b 6d f8  |.....*......fKm.|
+000000c0  b6 c7 6d 2f 48 71 1d bc  12 6b 84 4a 29 89 7f 4d  |..m/Hq...k.J)..M|
+000000d0  39 89 55 8d 26 6d 68 e8  62 38 0c a2 1f 2b 53 fe  |9.U.&mh.b8...+S.|
+000000e0  0b 9d c0 8c 73 8b ae 13  03 e6 cc af 4f e1 78 29  |....s.......O.x)|
+000000f0  be ec d6 c0 6c 9f 18 d2  3f 44 36 b9 0e 97 fc 1c  |....l...?D6.....|
+00000100  b3 94 62 8d a3 b1 3f e8  e8 c3 77 d9 49 13 d2 db  |..b...?...w.I...|
+00000110  93 9a 8b c5 51 85 c0 40  a6 0f f3 ca 66 13 e2 3f  |....Q..@....f..?|
+00000120  29 f1 65 0e ad cc eb bc  de 68 18 c0 b7 05 c7 6b  |).e......h.....k|
+00000130  83 66 a1 5c 5e 97 68 5f  0e ae b2 19 e0 ab b0 ee  |.f.\^.h_........|
+00000140  b9 44 64 20 5d 7a 77 ee  77 db a1 77 cb 7b ce d5  |.Dd ]zw.w..w.{..|
+00000150  c5 e1 78 b2 75 ea e6 2e  3b 8c 39 e3 51 c9 48 37  |..x.u...;.9.Q.H7|
+00000160  60 d5 68 4f 15 a7 29 56  76 c3 2c 5a 68 1c 6a b2  |`.hO..)Vv.,Zh.j.|
+00000170  20 c4 f0 df 35 87 72 c5  1a ed fa 24 66 b4 87 12  | ...5.r....$f...|
+00000180  f5 b3 79 d4 b6 fe c9 4e  31 14 f3 e2 5d 13 fc ed  |..y....N1...]...|
+00000190  6d 88 04 9d 8d 11 ed fd  6a fb e6 b4 53 20 51 e6  |m.......j...S Q.|
+000001a0  49 24 55 b1 5b 86 36 5a  ed 68 02 eb 43 97 da 49  |I$U.[.6Z.h..C..I|
+000001b0  da 7a 21 61 27 f6 24 6e  cc b3 25 76 e9 ce c2 d2  |.z!a'.$n..%v....|
+000001c0  b5 ef f7 63 a6 c9 7c 9b  dd 12 ea 7c 15 bd 29 fb  |...c..|....|..).|
+000001d0  20 f5 37 96 07 cc 2c 22  4a c1 11 ef 22 4e 7a 05  | .7...,"J..."Nz.|
+000001e0  80 ff 1f cd c9 a7 11 80  1e 3c 11 0d 10 ed 56 c6  |.........<....V.|
+000001f0  13 64 55 13 44 ce cc b7  9d 1a 57 11 b6 ef 27 02  |.dU.D.....W...'.|
+00000200  62 3e aa 81 14 ab 79 a5  cc 96 7d e3 bf c1 d3 98  |b>....y...}.....|
+00000210  da 9d 34 f1 7a c6 1a 1a  0d b4 3d ed 40 41 49 39  |..4.z.....=.@AI9|
+00000220  a7 8d a0 85 50 c1 b3 6c  e9 51 be 44 8c 7d d8 3b  |....P..l.Q.D.}.;|
+00000230  d6 e2 77 cb ab 01 98 87  d4 94 53 e4 f6 04 8f d2  |..w.......S.....|
+00000240  a4 36 35 9f df dc 2e 72  22 94 db 58 f7 77 c3 96  |.65....r"..X.w..|
+00000250  2b 0f 4a 7a 3d 94 12 5a  18 90 6c 87 18 a0 0b 80  |+.Jz=..Z..l.....|
+00000260  eb 44 de 79 4f 0e 66 fa  62 e7 26 73 06 af 44 e7  |.D.yO.f.b.&s..D.|
+00000270  7a 36 84 68 3d 3d 79 ac  cd 33 97 6a ad 95 ca 6d  |z6.h==y..3.j...m|
+00000280  c8 a9 75 98 21 b0 d2 dc  72 5d 61 15 67 0c 3e f8  |..u.!...r]a.g.>.|
+00000290  54 18 52 bd 46 75 81 3f  a6 6d c9 84 7a 97 4e db  |T.R.Fu.?.m..z.N.|
+000002a0  96 73 ad 53 09 ab 1c d6  c3 4d 1a 5c e9 b2 e7 aa  |.s.S.....M.\....|
+000002b0  2a f1 d5 be 1b c6 01 d1  8b 54 24 e9 16 d1 02 d0  |*........T$.....|
+000002c0  dc cb c1 37 71 e1 01 74  b1 5f 91 60 09 01 31 e2  |...7q..t._.`..1.|
+000002d0  2a f0 5b 34 e6 d0 52 db  a2 cf f1 f1 b7 da b6 76  |*.[4..R........v|
+000002e0  8e fd a5 fd 6e f5 c5 0c  34 74 2e f0 c0 44 b4 57  |....n...4t...D.W|
+000002f0  e1 50 f5 68 06 a3 14 1d  f5 ac 2b 61 f8 ec cf 05  |.P.h......+a....|
+00000300  c9 ef e6 a8 31 aa a5 a8  15 65 36 58 e0 da 96 03  |....1....e6X....|
+00000310  57 05 4e 17 03 03 00 99  ec a2 db dd 9e a8 d8 10  |W.N.............|
+00000320  fc d4 1b 45 02 b5 2c f1  fc 05 44 30 27 55 63 3e  |...E..,...D0'Uc>|
+00000330  41 45 ea be e1 a8 0b 2e  4d 70 18 3a 9b ae d2 b5  |AE......Mp.:....|
+00000340  ed 0d 3e 08 5f b6 86 b0  e0 06 66 45 91 67 bc fd  |..>._.....fE.g..|
+00000350  7b 8f 6a 73 d4 29 df 17  74 e7 f8 92 f9 2b e4 31  |{.js.)..t....+.1|
+00000360  dc 8a 6c 1c 53 1f c2 d6  fc 83 33 15 58 e1 ea 49  |..l.S.....3.X..I|
+00000370  cc 74 7c f3 00 37 ca bc  ae 31 e8 b2 aa 19 18 e2  |.t|..7...1......|
+00000380  7d 60 8c 15 f8 ce e2 7d  86 1b a1 2c 59 5a 2a b2  |}`.....}...,YZ*.|
+00000390  81 f3 22 12 8a 6e 28 b9  22 ba 15 03 3d 24 09 50  |.."..n(."...=$.P|
+000003a0  b5 81 43 c0 a1 62 cf c6  9d 69 be ba 89 d1 74 19  |..C..b...i....t.|
+000003b0  85 17 03 03 00 45 45 29  37 b5 5d ee db 9c 73 85  |.....EE)7.]...s.|
+000003c0  4f 69 2b 32 b7 d7 16 c6  73 f1 59 89 38 10 63 88  |Oi+2....s.Y.8.c.|
+000003d0  81 72 5e 60 72 d5 6a 26  c9 50 18 03 d3 bd 50 83  |.r^`r.j&.P....P.|
+000003e0  1b ea c1 e3 4b f4 31 b0  e7 90 af aa e3 10 fd 77  |....K.1........w|
+000003f0  97 49 ef 8b 63 f3 c0 af  82 06 c3                 |.I..c......|
 >>> Flow 3 (client to server)
-00000000  14 03 03 00 01 01 17 03  03 00 45 5b 1d b7 49 6d  |..........E[..Im|
-00000010  d0 f1 9a 16 cc e8 08 84  c0 80 23 1f 4f fc 15 b1  |..........#.O...|
-00000020  20 28 d0 65 1b 58 8b 67  fa 30 c2 37 86 ac b2 47  | (.e.X.g.0.7...G|
-00000030  d6 b8 ac 8a 69 bc a3 09  10 c8 47 15 54 b3 a4 79  |....i.....G.T..y|
-00000040  1f 12 2d c1 ca e1 ce 54  c0 ce e5 fc 61 f2 7c 07  |..-....T....a.|.|
+00000000  14 03 03 00 01 01 17 03  03 00 45 59 c5 37 de 55  |..........EY.7.U|
+00000010  de 8c 48 e6 2e 1c c6 d9  12 58 ad 58 97 af f3 09  |..H......X.X....|
+00000020  0c 86 38 94 c8 a3 d0 67  b2 3a 36 80 d8 ac f9 7e  |..8....g.:6....~|
+00000030  42 58 7a a1 0b a3 06 a3  32 0a e3 21 01 cb 7b 55  |BXz.....2..!..{U|
+00000040  73 1a 8b 32 ba cd 85 28  f7 ed 9a c8 dd 2b d7 66  |s..2...(.....+.f|
 >>> Flow 4 (server to client)
-00000000  17 03 03 00 1e ba d7 68  39 2c 76 30 fb 0e 36 47  |.......h9,v0..6G|
-00000010  d9 b8 7c 2d e2 1c fd 13  86 9b 2c 07 ab 66 03 2d  |..|-......,..f.-|
-00000020  1e 7d 69 17 03 03 00 13  eb 7b d8 47 8a 5e 53 83  |.}i......{.G.^S.|
-00000030  17 87 b3 aa c5 80 71 ba  df 1b 60                 |......q...`|
+00000000  17 03 03 00 1e ee 52 21  e0 e3 c5 ae ac 1b 26 91  |......R!......&.|
+00000010  0e b3 a0 b8 70 cc 71 c8  c3 10 0f e8 b4 79 eb 47  |....p.q......y.G|
+00000020  fc 13 b7 17 03 03 00 13  02 ef f4 ef 4b a2 83 93  |............K...|
+00000030  4b ea 6b 63 d9 29 69 79  0e 8d 34                 |K.kc.)iy..4|
diff --git a/src/crypto/tls/testdata/Server-TLSv13-ALPN b/src/crypto/tls/testdata/Server-TLSv13-ALPN
index c78bf3e9ca..31d7be34bc 100644
--- a/src/crypto/tls/testdata/Server-TLSv13-ALPN
+++ b/src/crypto/tls/testdata/Server-TLSv13-ALPN
@@ -1,9 +1,9 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 f8 01 00 00  f4 03 03 c6 52 45 ca ae  |............RE..|
-00000010  9b 43 49 d4 01 e2 af b0  e8 9b f4 9b f6 ef 38 c6  |.CI...........8.|
-00000020  71 9f ed 84 a6 2c 01 92  1f 3f 1b 20 5b cb 8a 16  |q....,...?. [...|
-00000030  b3 d2 a8 19 41 d5 0c 6a  fa 39 0a b2 6d 65 18 d1  |....A..j.9..me..|
-00000040  67 88 16 6b e0 9b e4 7a  d2 95 f9 93 00 08 13 02  |g..k...z........|
+00000000  16 03 01 00 f8 01 00 00  f4 03 03 ff d4 51 5f e2  |.............Q_.|
+00000010  dd 9d 8f 57 03 9e ce ae  23 c2 e6 17 33 de df f9  |...W....#...3...|
+00000020  49 f3 42 76 dc fe 7a 91  db 67 a0 20 1b a9 d2 90  |I.Bv..z..g. ....|
+00000030  d4 cb ec 3c e5 ea 1f 43  51 dd 0c 57 88 d1 a4 52  |...<...CQ..W...R|
+00000040  31 48 6b a2 5c 6d 5b 53  ab 05 7b ac 00 08 13 02  |1Hk.\m[S..{.....|
 00000050  13 03 13 01 00 ff 01 00  00 a3 00 00 00 0e 00 0c  |................|
 00000060  00 00 09 31 32 37 2e 30  2e 30 2e 31 00 0b 00 04  |...127.0.0.1....|
 00000070  03 00 01 02 00 0a 00 0c  00 0a 00 1d 00 17 00 1e  |................|
@@ -12,83 +12,83 @@
 000000a0  00 17 00 00 00 0d 00 1e  00 1c 04 03 05 03 06 03  |................|
 000000b0  08 07 08 08 08 09 08 0a  08 0b 08 04 08 05 08 06  |................|
 000000c0  04 01 05 01 06 01 00 2b  00 03 02 03 04 00 2d 00  |.......+......-.|
-000000d0  02 01 01 00 33 00 26 00  24 00 1d 00 20 d8 72 8f  |....3.&.$... .r.|
-000000e0  a6 3b a1 1c f7 73 ea b0  d5 85 03 31 46 d6 6b 8b  |.;...s.....1F.k.|
-000000f0  e0 e6 e0 e6 20 09 a7 f8  a2 fd d1 a7 6b           |.... .......k|
+000000d0  02 01 01 00 33 00 26 00  24 00 1d 00 20 39 8f 57  |....3.&.$... 9.W|
+000000e0  2f 4c ec 9a 34 c2 9a 00  63 8d 55 d0 41 61 6b bf  |/L..4...c.U.Aak.|
+000000f0  81 28 57 ea dc aa 36 11  aa bf 73 89 6a           |.(W...6...s.j|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 7a 02 00 00  76 03 03 00 00 00 00 00  |....z...v.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000020  00 00 00 00 00 00 00 00  00 00 00 20 5b cb 8a 16  |........... [...|
-00000030  b3 d2 a8 19 41 d5 0c 6a  fa 39 0a b2 6d 65 18 d1  |....A..j.9..me..|
-00000040  67 88 16 6b e0 9b e4 7a  d2 95 f9 93 13 02 00 00  |g..k...z........|
+00000020  00 00 00 00 00 00 00 00  00 00 00 20 1b a9 d2 90  |........... ....|
+00000030  d4 cb ec 3c e5 ea 1f 43  51 dd 0c 57 88 d1 a4 52  |...<...CQ..W...R|
+00000040  31 48 6b a2 5c 6d 5b 53  ab 05 7b ac 13 02 00 00  |1Hk.\m[S..{.....|
 00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 2f  |..+.....3.$... /|
 00000060  e5 7d a3 47 cd 62 43 15  28 da ac 5f bb 29 07 30  |.}.G.bC.(.._.).0|
-00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 17  |.........._X.;t.|
-00000080  03 03 00 24 9b af d8 42  6e 75 12 c4 10 c3 42 72  |...$...Bnu....Br|
-00000090  de e6 50 f9 2b 15 68 6d  b1 32 2f fb 63 b1 80 1a  |..P.+.hm.2/.c...|
-000000a0  f0 b3 3e 22 c9 d4 ed ba  17 03 03 02 6d c9 fc b7  |..>"........m...|
-000000b0  3c 02 17 dc 26 56 b6 1f  3d 2c 07 0e 96 52 a8 9f  |<...&V..=,...R..|
-000000c0  a2 2a 6e e9 c7 93 2e c7  98 af 9b 63 99 25 14 f1  |.*n........c.%..|
-000000d0  45 29 63 26 35 62 af d7  37 f3 33 03 2e a8 02 f2  |E)c&5b..7.3.....|
-000000e0  a4 a5 9e 85 19 ad a8 20  81 85 6a 19 c5 bb 8f d7  |....... ..j.....|
-000000f0  ea 4d af ee 9d 95 78 26  5a 24 da ee 5b 96 97 34  |.M....x&Z$..[..4|
-00000100  7c e6 2c c1 b0 e8 d3 3a  7f 4c b5 c9 44 ad d5 35  ||.,....:.L..D..5|
-00000110  99 b2 99 d9 c3 10 97 03  ac fe c9 6d cf 1a c0 6a  |...........m...j|
-00000120  ec d0 b7 ed b8 79 d6 48  8b eb df 0b 42 87 8e 50  |.....y.H....B..P|
-00000130  9a c9 47 e7 e3 6a c6 03  85 8e b4 57 58 b2 aa 5f  |..G..j.....WX.._|
-00000140  53 8d 00 43 7e 36 4a 9b  2a 0a b7 45 e5 8b 4c 71  |S..C~6J.*..E..Lq|
-00000150  62 b3 07 e1 1d 07 16 7b  4b c7 4b ac b3 e0 8b 4b  |b......{K.K....K|
-00000160  ec 3c 48 2f be eb 32 f6  f5 fa 24 86 76 e6 df ec  |.<H/..2...$.v...|
-00000170  bc 77 3b 80 86 78 37 23  49 28 f8 1b ad ea 2a fb  |.w;..x7#I(....*.|
-00000180  ea 90 28 5e 95 99 03 80  15 c8 71 e0 41 2e 24 87  |..(^......q.A.$.|
-00000190  ee 07 b2 f9 d8 ff 45 65  31 f2 68 ce e0 3a 4f b1  |......Ee1.h..:O.|
-000001a0  ed b8 a0 6f 86 17 ce 27  75 9e 9b ec 00 7a cd 28  |...o...'u....z.(|
-000001b0  e1 8d 77 3f b8 06 0f 8a  76 1b 10 fc 63 ed ce 11  |..w?....v...c...|
-000001c0  b6 73 02 3a 87 7a 93 83  ee d1 5f 4a 40 11 2b 93  |.s.:.z...._J@.+.|
-000001d0  17 60 7e 18 ab a9 be e2  32 bb ec ca e8 33 96 ab  |.`~.....2....3..|
-000001e0  7e b8 3e 72 7b a0 bb 17  e6 a5 53 d3 b9 9e 7c 35  |~.>r{.....S...|5|
-000001f0  54 38 8a 0b 11 35 90 02  3c 2b ef 3c 9c 81 80 0b  |T8...5..<+.<....|
-00000200  9e a5 5a d0 07 37 ec b2  4b c9 2d 8a 22 45 20 60  |..Z..7..K.-."E `|
-00000210  71 58 e0 a0 99 40 06 62  d4 19 cb 9d 62 65 a8 d6  |qX...@.b....be..|
-00000220  dd bd 82 c9 01 ba ce 17  04 d2 09 3a 6b f6 12 9c  |...........:k...|
-00000230  41 1d 1f f9 f5 42 93 36  70 0b 3a ba 49 f9 54 dc  |A....B.6p.:.I.T.|
-00000240  d2 30 02 7d 04 0b 4a 3b  12 37 4e a7 96 8c 8b 8c  |.0.}..J;.7N.....|
-00000250  2e a7 84 78 22 18 d4 2d  93 0a da e1 97 bc ad b5  |...x"..-........|
-00000260  2b 81 39 8e d3 5e 81 a1  51 c7 3e 40 3a fb ce 89  |+.9..^..Q.>@:...|
-00000270  cf f3 dc 3e 18 0f f1 80  19 00 25 ca 5d e5 0e 0d  |...>......%.]...|
-00000280  76 4f de 4c eb 92 fa bf  4c 72 01 1d 26 38 88 f1  |vO.L....Lr..&8..|
-00000290  9f d1 5f e4 ca e8 19 db  dc f3 ba 0a 14 d4 63 b3  |.._...........c.|
-000002a0  04 f4 4f ea 1c 0e 93 89  ad 6a 00 e0 64 fd 22 ae  |..O......j..d.".|
-000002b0  a7 58 dd e8 73 1e 89 b5  ed de ae b3 1e fb 54 1e  |.X..s.........T.|
-000002c0  70 ab 1e 38 2f bc 1d 16  3b e0 51 9f d9 dd 28 f2  |p..8/...;.Q...(.|
-000002d0  2c 24 80 e7 76 b9 d2 25  53 5e c0 df 07 19 0a 8c  |,$..v..%S^......|
-000002e0  13 ed cd d7 0f dc 4d 92  66 49 41 b1 1f a8 92 c3  |......M.fIA.....|
-000002f0  80 26 44 4f f8 49 86 b5  28 1e 3c 0c 1f 42 b9 ae  |.&DO.I..(.<..B..|
-00000300  27 57 f1 46 d3 61 23 8e  39 cf 50 ad fb 10 ba 7d  |'W.F.a#.9.P....}|
-00000310  a0 94 c5 b3 6e ad a1 15  71 00 17 03 03 00 99 87  |....n...q.......|
-00000320  b6 bb fc 79 5f 53 43 73  bc 7f 0a 49 78 70 48 61  |...y_SCs...IxpHa|
-00000330  22 e8 a5 f2 64 55 67 8b  68 de f4 12 64 52 2b 22  |"...dUg.h...dR+"|
-00000340  e4 55 53 94 30 a4 7e 10  36 fc 98 9f 0a 32 df 02  |.US.0.~.6....2..|
-00000350  b5 bf 58 34 cc 30 31 7b  b8 79 54 56 38 48 94 1f  |..X4.01{.yTV8H..|
-00000360  df 98 b9 c6 dc 29 3c 94  12 ef 47 98 91 0a 81 44  |.....)<...G....D|
-00000370  93 f4 96 a2 b2 05 09 d9  6e 25 9f 59 17 0f 41 8b  |........n%.Y..A.|
-00000380  f7 5c 81 e0 71 25 eb 24  eb bd cf 9a d9 24 8d c6  |.\..q%.$.....$..|
-00000390  04 4e 10 0f 92 41 59 df  5c 77 c4 4d c8 30 e0 70  |.N...AY.\w.M.0.p|
-000003a0  0c 5d 1b 49 b4 ea 06 bd  c5 de 1d b5 19 63 46 72  |.].I.........cFr|
-000003b0  98 72 48 e0 aa 76 6c d8  17 03 03 00 45 72 a8 f6  |.rH..vl.....Er..|
-000003c0  c0 00 8a 52 91 57 bf 8d  63 87 31 df 97 17 af 41  |...R.W..c.1....A|
-000003d0  88 44 19 1e 32 b9 32 d5  16 92 1b c7 6b 6e 29 8c  |.D..2.2.....kn).|
-000003e0  cc 42 59 05 8d 76 e4 4c  7e 46 5f 42 84 0d 28 37  |.BY..v.L~F_B..(7|
-000003f0  15 53 d9 fc de 4b 04 d4  9a 14 6e 9f e8 c9 20 13  |.S...K....n... .|
-00000400  00 c4                                             |..|
+00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 14  |.........._X.;t.|
+00000080  03 03 00 01 01 17 03 03  00 24 6b 2e 09 93 7b 47  |.........$k...{G|
+00000090  92 5b ec 7a 94 83 04 a4  fc 5d 9c b0 ca 11 3f 94  |.[.z.....]....?.|
+000000a0  fd cb 36 55 be e8 20 34  6e fd db 23 61 d7 17 03  |..6U.. 4n..#a...|
+000000b0  03 02 6d 75 74 6c 3e ca  77 66 06 c7 26 76 83 9f  |..mutl>.wf..&v..|
+000000c0  54 23 47 53 d6 b7 7f 6f  a1 fb 78 c5 aa 85 fb 40  |T#GS...o..x....@|
+000000d0  9f 34 48 a3 ad 47 70 9f  5f b4 96 f6 5b c8 ac ba  |.4H..Gp._...[...|
+000000e0  cc f7 ee 3e 9c 7a ad 48  57 44 ce 77 4f 17 13 6c  |...>.z.HWD.wO..l|
+000000f0  90 f4 c5 53 92 37 16 aa  59 60 51 9d f2 b7 9f 31  |...S.7..Y`Q....1|
+00000100  a6 a9 15 86 fe 01 04 36  22 b0 48 45 a0 b5 dd 0f  |.......6".HE....|
+00000110  87 a7 33 dd 8b 76 66 af  e6 a3 7c 1d 1b fb 1d 77  |..3..vf...|....w|
+00000120  5e d4 c7 51 50 6f 36 b2  48 c7 a2 7e 3a 1c ad 76  |^..QPo6.H..~:..v|
+00000130  01 43 6a bf 8a 2b a8 02  71 3b 9b aa 80 63 35 20  |.Cj..+..q;...c5 |
+00000140  b9 37 05 9c 09 41 1d 07  31 2a 43 f9 36 5e 38 62  |.7...A..1*C.6^8b|
+00000150  cc 2f 08 6f ff 91 28 98  4b 69 a3 0d 61 c3 cd b7  |./.o..(.Ki..a...|
+00000160  06 84 f8 fc a9 e0 46 ac  f7 df ba 12 aa c5 d4 4c  |......F........L|
+00000170  34 4e c3 6c 46 3c d5 d6  63 91 28 b5 32 9a f0 70  |4N.lF<..c.(.2..p|
+00000180  15 e6 5e c3 06 de 3b 3b  ac a8 b6 78 04 d1 d4 78  |..^...;;...x...x|
+00000190  73 10 7d 80 ce c1 56 9d  0e ea 0d 6a 16 75 34 04  |s.}...V....j.u4.|
+000001a0  32 bc d4 52 5f 54 90 8a  ad a7 7a bc 68 be ba cc  |2..R_T....z.h...|
+000001b0  60 14 a4 b7 d5 b4 51 b7  11 9a c8 4e 5d d1 a3 71  |`.....Q....N]..q|
+000001c0  75 d6 47 d7 03 68 34 a5  32 09 b3 98 43 21 b5 0c  |u.G..h4.2...C!..|
+000001d0  50 e5 1a 5e d3 0c c3 2d  93 d7 d6 42 4d 98 76 66  |P..^...-...BM.vf|
+000001e0  b3 a0 94 25 fc 88 17 33  6d 22 7c 3a da 0c 8e ec  |...%...3m"|:....|
+000001f0  fa cf 92 20 e0 f7 8f 1e  b5 e3 4c 13 4d 4d 45 10  |... ......L.MME.|
+00000200  8e e3 4e 0f 4e 9d 63 ec  ad 73 7f a3 11 88 69 f2  |..N.N.c..s....i.|
+00000210  6f 4e 91 c4 d4 ad 2c a4  21 89 50 a9 f9 2d 9c ff  |oN....,.!.P..-..|
+00000220  ff 0e db b9 fb 14 1b c1  8c 9b cf 94 49 a3 85 2c  |............I..,|
+00000230  2d d2 15 12 0c 7d 70 12  01 07 62 1f 05 f0 88 51  |-....}p...b....Q|
+00000240  82 84 ac 2a b9 c5 56 ee  6e a5 5f cd 3f 92 0b cc  |...*..V.n._.?...|
+00000250  8a d2 92 91 93 a1 11 4c  42 3d c9 87 29 e7 13 7d  |.......LB=..)..}|
+00000260  33 b4 14 0f 1b ed d4 94  17 a1 31 5b 44 e9 1d 78  |3.........1[D..x|
+00000270  6a 0f dd d4 0a 3b 40 f1  a2 a2 ab 84 4c 25 7f cd  |j....;@.....L%..|
+00000280  09 45 36 d8 b8 c3 3c 80  2a 00 67 dd eb 9b 67 b1  |.E6...<.*.g...g.|
+00000290  d5 22 d6 84 a7 15 fe 56  b3 b0 a2 6e 64 7e 74 23  |.".....V...nd~t#|
+000002a0  9f 20 72 ca f1 b9 03 02  56 a5 d4 d3 f7 bb 53 67  |. r.....V.....Sg|
+000002b0  27 1f 2c b2 4e f1 05 17  8b 72 f5 27 cc 66 62 5b  |'.,.N....r.'.fb[|
+000002c0  95 cf 6e 5b e8 b9 ee d0  f8 b2 6b 4c 3e 99 c4 ed  |..n[......kL>...|
+000002d0  da 9d 12 73 9e 80 bc 83  6f f1 09 8f 74 47 01 df  |...s....o...tG..|
+000002e0  f5 ff b0 21 8b 4e 7c 3e  16 47 18 48 51 e0 e2 7f  |...!.N|>.G.HQ...|
+000002f0  dc 9f e3 2e 35 b0 5b e1  55 29 d7 11 85 5b c3 10  |....5.[.U)...[..|
+00000300  5c dc 61 30 52 5f 53 83  08 87 6d b6 1c f2 2b ff  |\.a0R_S...m...+.|
+00000310  3e 60 17 5b ff fc a2 db  5c 24 6a 70 19 28 ba 14  |>`.[....\$jp.(..|
+00000320  17 03 03 00 99 64 2f 8f  76 2f 84 aa c9 ca 55 00  |.....d/.v/....U.|
+00000330  16 e4 22 b7 88 be 72 3b  7a db b7 85 0f 44 df dc  |.."...r;z....D..|
+00000340  7e fa 2c 76 37 c1 dd 95  96 ac c3 0e 4f ce ee ea  |~.,v7.......O...|
+00000350  71 91 5a 98 af e5 50 4f  5d 42 2d 57 b5 cf a6 a3  |q.Z...PO]B-W....|
+00000360  db df 73 a2 1d b4 02 e4  b5 23 ae f5 da b7 f6 cd  |..s......#......|
+00000370  7d 48 d2 5e 7c 40 4f c6  9b 3e f7 51 8a 58 df b6  |}H.^|@O..>.Q.X..|
+00000380  56 ac 3f 17 a4 95 ce 06  5b a3 b4 df 72 08 35 20  |V.?.....[...r.5 |
+00000390  0f 92 fd 48 45 48 e1 c2  cf 1f b4 fb 9b 7d b8 6c  |...HEH.......}.l|
+000003a0  6d fa 10 04 d6 14 a9 59  0e 97 c9 33 85 ca d4 62  |m......Y...3...b|
+000003b0  46 b7 0b e8 78 67 ca 6b  e5 66 b3 72 f8 90 17 03  |F...xg.k.f.r....|
+000003c0  03 00 45 c6 c1 e4 ff 98  d3 4f 79 cd 61 7b 31 42  |..E......Oy.a{1B|
+000003d0  f6 db 92 92 f8 ee 41 98  cd 8c db 4f ab e1 84 43  |......A....O...C|
+000003e0  d9 35 5a 3a ab 86 0f 3a  5a e3 e4 f6 41 1d 98 6b  |.5Z:...:Z...A..k|
+000003f0  b2 ac e7 e3 5a 38 c9 54  29 4a ba 13 ed 80 d8 71  |....Z8.T)J.....q|
+00000400  6f b9 15 8a 39 3b 89 24                           |o...9;.$|
 >>> Flow 3 (client to server)
-00000000  14 03 03 00 01 01 17 03  03 00 45 ac 55 3c 0a 23  |..........E.U<.#|
-00000010  d7 29 fa 16 c2 df a7 42  9e 15 7e 93 a7 0a 31 79  |.).....B..~...1y|
-00000020  38 96 95 4a 0b 61 d8 f5  bb e5 51 a8 c3 ea 2b 92  |8..J.a....Q...+.|
-00000030  a2 b0 9c 59 e1 52 b9 80  26 1b 84 c3 1a 68 f4 40  |...Y.R..&....h.@|
-00000040  82 45 42 47 2f c7 3d ba  77 88 8b 5c 3b 03 a8 a7  |.EBG/.=.w..\;...|
+00000000  14 03 03 00 01 01 17 03  03 00 45 93 c5 37 2f 37  |..........E..7/7|
+00000010  8d ae 7f be 77 25 59 77  39 37 d7 f0 29 68 25 cb  |....w%Yw97..)h%.|
+00000020  fb 2d 8a 7e 83 d4 60 09  84 69 1a bd 05 fd d8 53  |.-.~..`..i.....S|
+00000030  98 f7 40 f5 ba 1b 5e 62  03 50 be 25 65 1b d8 d1  |..@...^b.P.%e...|
+00000040  32 a9 6d bf 3d ad bc 0a  1e f1 f6 52 45 5e 98 6c  |2.m.=......RE^.l|
 >>> Flow 4 (server to client)
-00000000  17 03 03 00 1e 86 2e cf  5b 32 e1 e0 db 51 51 55  |........[2...QQU|
-00000010  ef c3 05 87 ea 90 a8 37  8c 28 5d da 9f 64 70 33  |.......7.(]..dp3|
-00000020  8f 94 f0 17 03 03 00 13  ba 81 00 ec 23 57 05 42  |............#W.B|
-00000030  aa f4 ca b2 4e 98 d0 22  3b fc 38                 |....N..";.8|
+00000000  17 03 03 00 1e e2 90 5e  4a be d1 94 5f 64 9e 3a  |.......^J..._d.:|
+00000010  92 3c e2 bc be df 1b da  b2 c0 eb 0d f3 2e 7d 23  |.<............}#|
+00000020  fe 71 13 17 03 03 00 13  2a 3e 5b dc 81 c5 2f 73  |.q......*>[.../s|
+00000030  81 90 29 95 13 64 59 a3  40 cc d6                 |..)..dY.@..|
diff --git a/src/crypto/tls/testdata/Server-TLSv13-ALPN-NoMatch b/src/crypto/tls/testdata/Server-TLSv13-ALPN-NoMatch
index 8d524a9109..0abc7171ba 100644
--- a/src/crypto/tls/testdata/Server-TLSv13-ALPN-NoMatch
+++ b/src/crypto/tls/testdata/Server-TLSv13-ALPN-NoMatch
@@ -1,9 +1,9 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 f8 01 00 00  f4 03 03 7d 4e fc 70 f4  |...........}N.p.|
-00000010  ca f8 bc d4 12 5d 8f 66  37 a0 c8 30 1a 4d 1b 4f  |.....].f7..0.M.O|
-00000020  0e 0b 86 1a 16 6d 77 2f  ff eb a8 20 09 1f f5 06  |.....mw/... ....|
-00000030  2c 4d 55 28 be dd 24 02  70 4c 0d 73 c4 c0 a1 d8  |,MU(..$.pL.s....|
-00000040  b3 f0 13 26 76 df 47 bd  2e 27 1d 81 00 08 13 02  |...&v.G..'......|
+00000000  16 03 01 00 f8 01 00 00  f4 03 03 d8 28 7b f8 3a  |............({.:|
+00000010  90 13 9b b7 92 e5 33 de  3c 0a 29 bf 0b d8 1b a6  |......3.<.).....|
+00000020  d4 8b a5 f9 fa 72 37 b5  6c 0d 4b 20 6b a5 56 0d  |.....r7.l.K k.V.|
+00000030  86 c6 28 d5 7e 10 c3 6f  36 c3 d1 d2 90 41 34 ee  |..(.~..o6....A4.|
+00000040  0c ef 47 5f 17 43 ac 86  59 70 44 14 00 08 13 02  |..G_.C..YpD.....|
 00000050  13 03 13 01 00 ff 01 00  00 a3 00 00 00 0e 00 0c  |................|
 00000060  00 00 09 31 32 37 2e 30  2e 30 2e 31 00 0b 00 04  |...127.0.0.1....|
 00000070  03 00 01 02 00 0a 00 0c  00 0a 00 1d 00 17 00 1e  |................|
@@ -12,82 +12,82 @@
 000000a0  00 17 00 00 00 0d 00 1e  00 1c 04 03 05 03 06 03  |................|
 000000b0  08 07 08 08 08 09 08 0a  08 0b 08 04 08 05 08 06  |................|
 000000c0  04 01 05 01 06 01 00 2b  00 03 02 03 04 00 2d 00  |.......+......-.|
-000000d0  02 01 01 00 33 00 26 00  24 00 1d 00 20 a9 8a 27  |....3.&.$... ..'|
-000000e0  a2 7c b7 26 1d c6 ad f7  3a d0 97 81 ac 05 6c 10  |.|.&....:.....l.|
-000000f0  a0 0d 3c 96 24 ce 55 ef  43 76 87 d4 31           |..<.$.U.Cv..1|
+000000d0  02 01 01 00 33 00 26 00  24 00 1d 00 20 71 31 a3  |....3.&.$... q1.|
+000000e0  98 a9 e0 5b f1 45 57 46  18 1a 9b d9 04 a7 30 16  |...[.EWF......0.|
+000000f0  c5 e7 f3 11 e7 16 92 ed  f1 54 4d d2 29           |.........TM.)|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 7a 02 00 00  76 03 03 00 00 00 00 00  |....z...v.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000020  00 00 00 00 00 00 00 00  00 00 00 20 09 1f f5 06  |........... ....|
-00000030  2c 4d 55 28 be dd 24 02  70 4c 0d 73 c4 c0 a1 d8  |,MU(..$.pL.s....|
-00000040  b3 f0 13 26 76 df 47 bd  2e 27 1d 81 13 02 00 00  |...&v.G..'......|
+00000020  00 00 00 00 00 00 00 00  00 00 00 20 6b a5 56 0d  |........... k.V.|
+00000030  86 c6 28 d5 7e 10 c3 6f  36 c3 d1 d2 90 41 34 ee  |..(.~..o6....A4.|
+00000040  0c ef 47 5f 17 43 ac 86  59 70 44 14 13 02 00 00  |..G_.C..YpD.....|
 00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 2f  |..+.....3.$... /|
 00000060  e5 7d a3 47 cd 62 43 15  28 da ac 5f bb 29 07 30  |.}.G.bC.(.._.).0|
-00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 17  |.........._X.;t.|
-00000080  03 03 00 17 74 38 f2 8b  ac 52 87 0d e3 a9 77 eb  |....t8...R....w.|
-00000090  af 7f 53 3e 5c 3c cf 49  0a f3 c1 17 03 03 02 6d  |..S>\<.I.......m|
-000000a0  1f aa 15 fd 9d 05 77 15  12 24 2d ca 2f 93 18 44  |......w..$-./..D|
-000000b0  7a 7c e3 c2 57 33 62 fe  dc 95 f7 67 c8 08 95 77  |z|..W3b....g...w|
-000000c0  1d f3 17 51 80 bc d9 3a  5d f0 a1 f9 fb 4b 21 00  |...Q...:]....K!.|
-000000d0  7a 11 2a 51 3d 83 45 ef  62 ce 31 c2 98 9e 20 95  |z.*Q=.E.b.1... .|
-000000e0  66 31 a6 3c 37 3b 91 16  d9 3e 37 0e e4 99 a6 a5  |f1.<7;...>7.....|
-000000f0  5c 71 42 79 7d de 3c 9c  51 66 ce 2d 6e 1b e4 1d  |\qBy}.<.Qf.-n...|
-00000100  d5 ee cd 2c ed f9 94 f9  46 9d d1 91 4d 1c 7f dc  |...,....F...M...|
-00000110  17 a6 5a 42 87 ee 7a bd  f3 6a d4 aa 44 b8 97 6d  |..ZB..z..j..D..m|
-00000120  a7 a3 9f 2d 14 d1 6d 64  e5 8a ed cf c9 a2 da a9  |...-..md........|
-00000130  1b f5 83 d4 c8 aa 53 6c  e9 5a ee e3 c6 c3 41 df  |......Sl.Z....A.|
-00000140  a1 17 44 17 7f ca f0 a8  ac 87 fc 2e 6d ba 0f 85  |..D.........m...|
-00000150  d4 6d 58 99 8c 19 c1 0a  b1 d8 9f 2c 93 36 e3 d3  |.mX........,.6..|
-00000160  b6 0e 16 f1 8f a5 04 ee  3a 4f c5 fb 4c 7d d9 1c  |........:O..L}..|
-00000170  d4 d0 dd b5 59 9e 11 df  46 6c 6c cb f6 76 7a 03  |....Y...Fll..vz.|
-00000180  b3 3e a2 45 38 03 56 e6  5a 23 ff 83 ee 0e d1 51  |.>.E8.V.Z#.....Q|
-00000190  cc 94 51 82 6c 1a 8b 15  7e bd cd 09 44 72 42 65  |..Q.l...~...DrBe|
-000001a0  45 0c 6c ff d7 4d 32 8a  b1 9c 3f fa c0 8e 9e 86  |E.l..M2...?.....|
-000001b0  5c d7 23 29 bf dd 40 fa  d6 db 25 cb 63 74 33 15  |\.#)..@...%.ct3.|
-000001c0  23 79 ab 22 39 e2 9e 41  89 01 9f 2e 58 8c 4b fe  |#y."9..A....X.K.|
-000001d0  b9 a5 cd 5e df be b2 d1  36 9e 8a c5 3f c4 53 db  |...^....6...?.S.|
-000001e0  29 95 33 6f 24 dd 84 5d  da c2 5c 2c 1d cc de 40  |).3o$..]..\,...@|
-000001f0  6c e7 07 a5 e3 95 f9 08  62 75 db dd ca e1 4c ab  |l.......bu....L.|
-00000200  12 3a 16 14 4a b6 78 58  42 81 91 8e b9 48 e0 a3  |.:..J.xXB....H..|
-00000210  e4 1e 5f 18 e1 cf 3b 2f  b3 2d 81 4c 4c b5 e4 24  |.._...;/.-.LL..$|
-00000220  2c f0 e6 b7 43 9c e2 e4  25 88 5d 07 be e3 7b e5  |,...C...%.]...{.|
-00000230  d5 7f 2a ad 28 72 54 92  73 19 39 6e f4 d9 3e 13  |..*.(rT.s.9n..>.|
-00000240  f3 ed 37 66 22 8a 89 df  7b 99 b3 34 18 0f 7a 76  |..7f"...{..4..zv|
-00000250  86 d4 da bd fd b5 f9 75  70 51 de e9 28 75 72 00  |.......upQ..(ur.|
-00000260  f5 3f 11 f7 15 01 7e b3  bd b5 a2 05 33 dc 9d 69  |.?....~.....3..i|
-00000270  26 f3 cb 45 a8 68 37 0b  c6 6f b1 ca 3c 52 01 3c  |&..E.h7..o..<R.<|
-00000280  4e c7 da 0a 11 1d e0 a6  33 1d ba 6e f7 56 2a 16  |N.......3..n.V*.|
-00000290  28 66 0b 01 20 21 09 0c  56 ef 3e 2a 68 c0 e9 cb  |(f.. !..V.>*h...|
-000002a0  c8 83 75 75 d1 95 84 83  c9 e1 2d 0e 1c 37 9f 14  |..uu......-..7..|
-000002b0  3a 78 86 01 c6 bb 04 eb  68 c3 26 ed 96 b7 49 43  |:x......h.&...IC|
-000002c0  a5 ae 54 c0 d3 23 40 08  26 2f 3a 7e 63 04 2f 62  |..T..#@.&/:~c./b|
-000002d0  3e ce 3d b6 70 bb 79 c6  c9 dc 14 24 de 02 96 08  |>.=.p.y....$....|
-000002e0  d9 64 a2 c6 26 29 9d 58  a1 85 63 16 db a6 8d 3b  |.d..&).X..c....;|
-000002f0  0b 1a 15 9c 13 cb 8c cb  ff 22 aa 59 da bd 81 78  |.........".Y...x|
-00000300  90 f4 86 52 ad ae fc e4  1c ec ff 08 47 17 03 03  |...R........G...|
-00000310  00 99 e6 54 8e c8 05 45  8c cb d1 44 df 88 d8 7d  |...T...E...D...}|
-00000320  1b 07 e1 06 d1 2b c4 fb  75 dd 63 4c b0 14 ee a4  |.....+..u.cL....|
-00000330  7f 05 f3 e6 76 04 04 0b  0a 31 23 27 b1 ee 65 36  |....v....1#'..e6|
-00000340  50 d9 cb 12 90 a8 6c 73  37 91 3a 57 fa fd 80 79  |P.....ls7.:W...y|
-00000350  17 42 f9 27 36 e3 8a 75  3d 95 d6 17 a3 4e 73 5c  |.B.'6..u=....Ns\|
-00000360  4b e8 fc 58 d3 56 a2 e2  32 26 a0 2d 69 24 31 1e  |K..X.V..2&.-i$1.|
-00000370  6a 83 8e 5f 3f c4 9f d9  8b f8 59 3e ec 27 d0 96  |j.._?.....Y>.'..|
-00000380  6f d6 28 d1 54 e6 f5 14  b4 55 67 de 90 ee f7 ef  |o.(.T....Ug.....|
-00000390  69 03 b7 d7 80 bd a9 ee  a5 30 89 d6 5b ce 07 9e  |i........0..[...|
-000003a0  0a 09 03 90 4e 5d 75 8c  02 f2 7d 17 03 03 00 45  |....N]u...}....E|
-000003b0  43 81 6f 9c bf c2 3c 14  23 f4 4b 9e 1e 17 0e d4  |C.o...<.#.K.....|
-000003c0  bd 3a eb 33 34 e3 59 ea  5c ec 9a 5d 86 27 d8 51  |.:.34.Y.\..].'.Q|
-000003d0  1f 0c bb d1 80 e0 2e 41  e5 7d 0a 50 df 26 68 cb  |.......A.}.P.&h.|
-000003e0  d5 83 aa 94 e9 1a c3 0b  ab 0d bd 13 b3 55 d8 89  |.............U..|
-000003f0  e1 e2 3b fe 01                                    |..;..|
+00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 14  |.........._X.;t.|
+00000080  03 03 00 01 01 17 03 03  00 17 65 07 84 ea dc f3  |..........e.....|
+00000090  6d 0e 15 2d 61 75 65 05  38 ca 43 ef 5d 14 fc bf  |m..-aue.8.C.]...|
+000000a0  d3 17 03 03 02 6d d3 f2  e2 97 77 75 a4 ef f1 81  |.....m....wu....|
+000000b0  33 c7 c8 ca f0 8e 26 91  78 4d 18 b7 2d d8 30 69  |3.....&.xM..-.0i|
+000000c0  8a 3e d7 f1 13 34 1a 61  43 a7 a8 44 0c 6f e5 da  |.>...4.aC..D.o..|
+000000d0  4b 5e 8d 58 16 98 c8 63  fb c9 07 cb 84 c8 2d a9  |K^.X...c......-.|
+000000e0  6b be 04 51 d4 e7 75 11  28 44 f4 8c 77 96 ab 0d  |k..Q..u.(D..w...|
+000000f0  e7 54 ff ad 43 b6 7b d2  63 46 7c 07 ee 03 a8 e1  |.T..C.{.cF|.....|
+00000100  73 98 05 32 5d 73 fc d0  6c 4c 3a 56 e4 02 e7 05  |s..2]s..lL:V....|
+00000110  8d 18 c6 dc e5 b9 4f f4  ee 8b 7c 29 12 d7 b9 22  |......O...|)..."|
+00000120  90 21 3d 1d 83 09 a4 ac  b9 bb f9 b3 0d 2b 82 b5  |.!=..........+..|
+00000130  5a ca a7 fc 46 aa 3b ae  75 14 67 3e 69 a5 95 ea  |Z...F.;.u.g>i...|
+00000140  79 58 6d 72 63 c1 64 62  88 2e 6f a1 cb 2c aa 18  |yXmrc.db..o..,..|
+00000150  5a c0 48 79 45 05 66 01  91 05 4d f7 da 61 b9 d8  |Z.HyE.f...M..a..|
+00000160  c0 49 d8 1a e5 de de 84  a1 8f 7f db 33 63 50 1c  |.I..........3cP.|
+00000170  d3 f1 0d 54 7e 00 94 89  79 70 54 8d 6d ff ad a0  |...T~...ypT.m...|
+00000180  ea 2a ac ec dd 3b 51 8c  32 56 1a e8 81 c1 48 cb  |.*...;Q.2V....H.|
+00000190  98 16 3c 5b b2 54 00 97  87 c6 ae 92 15 8a 00 1f  |..<[.T..........|
+000001a0  1b ad b8 58 a8 5c 8d ea  69 5a 60 3b e5 e2 9b 3c  |...X.\..iZ`;...<|
+000001b0  2e 9b 55 94 c2 f9 9a 5e  a1 e2 92 8d 15 16 74 90  |..U....^......t.|
+000001c0  0f 3c 2f 10 42 99 46 e9  52 7a b6 74 4b 96 2d 6e  |.</.B.F.Rz.tK.-n|
+000001d0  39 eb de d3 34 65 4d 8c  22 e9 1a 7a 19 73 6a f1  |9...4eM."..z.sj.|
+000001e0  85 c3 f6 ed 7b 13 55 c3  fa 1e 2d da ed a7 3f eb  |....{.U...-...?.|
+000001f0  44 72 38 f0 9f 8e 74 49  ef 3d aa 72 e3 83 38 b7  |Dr8...tI.=.r..8.|
+00000200  65 03 b9 76 4d 65 e8 5c  e3 c4 07 e0 b6 aa 51 17  |e..vMe.\......Q.|
+00000210  13 51 81 95 9a d8 63 ed  25 05 8a 65 99 d4 a5 1e  |.Q....c.%..e....|
+00000220  82 cd a8 24 a9 87 49 ca  80 28 53 69 0d 72 fa 19  |...$..I..(Si.r..|
+00000230  22 f6 3a dc f0 9b b9 ba  d5 2b 6f 55 f2 84 ec 74  |".:......+oU...t|
+00000240  84 da a7 96 51 ff 54 c9  e3 db d1 64 7c 8f b8 88  |....Q.T....d|...|
+00000250  fe 98 6e e1 2a cd f9 92  e5 00 7b e4 24 26 29 15  |..n.*.....{.$&).|
+00000260  64 3b bd 21 79 01 98 7d  7d 9e ab dc 28 07 73 df  |d;.!y..}}...(.s.|
+00000270  56 4a 12 32 6b 1e 67 f1  a5 a6 26 c1 8b 12 8c fe  |VJ.2k.g...&.....|
+00000280  84 a1 13 9a 15 5a bb e1  5b e8 11 e0 5f 46 c7 ab  |.....Z..[..._F..|
+00000290  70 6b 0d 1f 52 8b 35 ad  3a 3f c5 bf 7d 00 b3 bb  |pk..R.5.:?..}...|
+000002a0  4f de c1 e9 97 aa 85 be  a1 30 da 27 0f 69 2b d1  |O........0.'.i+.|
+000002b0  cd 3a 28 b2 4e b2 44 3a  33 88 49 c5 fd 11 50 6f  |.:(.N.D:3.I...Po|
+000002c0  6e df 52 75 c2 c2 53 fb  0f 92 0d bd bd a0 cb 29  |n.Ru..S........)|
+000002d0  14 ba 8a 1d 92 6a f5 8e  34 b1 7c 78 f0 64 10 ea  |.....j..4.|x.d..|
+000002e0  11 a7 75 1e 76 18 2d c5  ec 16 18 58 05 a4 ef 26  |..u.v.-....X...&|
+000002f0  a7 70 27 30 cb ed 79 9a  55 4d 2f d7 61 56 6f 96  |.p'0..y.UM/.aVo.|
+00000300  4c d1 08 a7 1a ff 87 e4  8e b0 05 4a f1 8a fe 73  |L..........J...s|
+00000310  a0 7c 3d 17 03 03 00 99  f1 c5 c2 29 cd 85 48 15  |.|=........)..H.|
+00000320  db 06 98 00 e2 17 6f 0e  c1 1b 61 b9 b5 3d d8 37  |......o...a..=.7|
+00000330  0c 0c 5d e4 08 ae 26 13  88 4c 62 18 dd 84 85 20  |..]...&..Lb.... |
+00000340  c9 73 bc 33 51 a9 19 06  49 df 8c 2c 85 ed 69 6c  |.s.3Q...I..,..il|
+00000350  2b 2c ab 35 39 8f 4e fb  cf 80 7f 7b dc dd 5d b0  |+,.59.N....{..].|
+00000360  62 bd 1d e3 a4 bd bc 05  ac c3 00 ab c6 92 56 4a  |b.............VJ|
+00000370  9f 99 0f 25 ee 3b 7f aa  08 17 64 fd f5 ae 67 29  |...%.;....d...g)|
+00000380  f7 e3 d7 35 d0 9e 7d e6  4c 0b 35 1a 41 b9 94 d7  |...5..}.L.5.A...|
+00000390  49 80 43 c1 32 53 dc 65  c6 c8 1c 29 2f 91 d1 29  |I.C.2S.e...)/..)|
+000003a0  64 b8 9c 02 f8 03 4d b3  a3 49 16 27 df 3a ff da  |d.....M..I.'.:..|
+000003b0  f5 17 03 03 00 45 59 b8  45 04 e0 6b e6 03 b7 c0  |.....EY.E..k....|
+000003c0  27 15 2e c8 17 9c 99 64  8f f2 ea af 73 e9 30 e7  |'......d....s.0.|
+000003d0  56 c4 ca 9d c2 d0 07 a7  8b 79 f8 99 05 4c 6a f0  |V........y...Lj.|
+000003e0  da 40 18 8b 7a e7 6e 43  26 b2 4f 83 ac 8a 7f f4  |.@..z.nC&.O.....|
+000003f0  f4 0e 82 5e f8 d8 af c3  8d 9e 5d                 |...^......]|
 >>> Flow 3 (client to server)
-00000000  14 03 03 00 01 01 17 03  03 00 45 ac 36 2d 53 3e  |..........E.6-S>|
-00000010  08 c7 41 f3 da 40 ad d6  03 05 c1 b5 71 86 82 df  |..A..@......q...|
-00000020  6a 84 9e df f4 c5 7f 52  29 b0 a5 97 45 69 6e 6a  |j......R)...Einj|
-00000030  69 1c 91 32 bc 5b e9 62  b1 b8 af 9b 48 06 bb 37  |i..2.[.b....H..7|
-00000040  99 45 f5 a9 cd 25 5a 41  c3 49 10 36 af 4a 56 90  |.E...%ZA.I.6.JV.|
+00000000  14 03 03 00 01 01 17 03  03 00 45 3e 0c e1 f6 9c  |..........E>....|
+00000010  ee d8 82 9d b6 e6 ef ea  09 6e 2a a3 e7 45 1b 07  |.........n*..E..|
+00000020  95 c8 d5 56 05 c4 90 10  24 eb bc de 52 d9 8e bb  |...V....$...R...|
+00000030  32 0e 5e 60 a4 bc 09 47  40 e5 30 56 b5 55 a6 ba  |2.^`...G@.0V.U..|
+00000040  b2 ad 2a 36 59 2e 33 49  54 e8 7e d6 ea 11 db 09  |..*6Y.3IT.~.....|
 >>> Flow 4 (server to client)
-00000000  17 03 03 00 1e b4 23 d9  cd 9b 2a a8 76 07 c0 1e  |......#...*.v...|
-00000010  54 bb 7f 63 d9 31 2f e8  7b 91 dc b6 c9 3c a1 48  |T..c.1/.{....<.H|
-00000020  2b 82 11 17 03 03 00 13  ae 1b 32 f4 2f 9c 1d 8c  |+.........2./...|
-00000030  98 4e 1d 80 68 f0 e2 a9  25 db f7                 |.N..h...%..|
+00000000  17 03 03 00 1e 7c c1 c4  be 47 41 b6 b4 8a 37 cb  |.....|...GA...7.|
+00000010  d0 33 f4 e3 5d a1 62 3e  9a 0b fd a5 df a3 85 f2  |.3..].b>........|
+00000020  2d 0d 9d 17 03 03 00 13  29 f1 b6 f3 3f db 71 5c  |-.......)...?.q\|
+00000030  fc af 5a 52 52 3f a8 a2  f5 03 57                 |..ZRR?....W|
diff --git a/src/crypto/tls/testdata/Server-TLSv13-CHACHA20-SHA256 b/src/crypto/tls/testdata/Server-TLSv13-CHACHA20-SHA256
index 4aa6d6b568..8c2dcefa61 100644
--- a/src/crypto/tls/testdata/Server-TLSv13-CHACHA20-SHA256
+++ b/src/crypto/tls/testdata/Server-TLSv13-CHACHA20-SHA256
@@ -1,9 +1,9 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 dc 01 00 00  d8 03 03 1d 2a 53 ec f5  |............*S..|
-00000010  20 a6 22 2e 35 9d c4 a8  9b f0 0f 89 70 ef af 2b  | .".5.......p..+|
-00000020  3c 8c 6b 8a 44 74 71 8f  e2 b6 f5 20 34 ab 1d 74  |<.k.Dtq.... 4..t|
-00000030  cc cf 78 1f 9a 92 0b 7b  77 6a 67 16 fa 45 d2 d8  |..x....{wjg..E..|
-00000040  1f c2 15 c3 91 f7 b6 1f  01 62 3e d1 00 04 13 03  |.........b>.....|
+00000000  16 03 01 00 dc 01 00 00  d8 03 03 3a 67 df d1 61  |...........:g..a|
+00000010  7e 99 9a 82 12 bc af 5e  66 ca 60 c4 a2 7f a6 a6  |~......^f.`.....|
+00000020  71 b5 ff b7 e5 96 12 21  f0 92 85 20 e6 52 d4 99  |q......!... .R..|
+00000030  4b 4a b0 43 53 5e d4 cd  8e d9 a9 f5 42 aa c4 64  |KJ.CS^......B..d|
+00000040  58 65 ec 46 ae d9 d7 0d  62 de 21 2e 00 04 13 03  |Xe.F....b.!.....|
 00000050  00 ff 01 00 00 8b 00 00  00 0e 00 0c 00 00 09 31  |...............1|
 00000060  32 37 2e 30 2e 30 2e 31  00 0b 00 04 03 00 01 02  |27.0.0.1........|
 00000070  00 0a 00 0c 00 0a 00 1d  00 17 00 1e 00 19 00 18  |................|
@@ -11,80 +11,80 @@
 00000090  05 03 06 03 08 07 08 08  08 09 08 0a 08 0b 08 04  |................|
 000000a0  08 05 08 06 04 01 05 01  06 01 00 2b 00 03 02 03  |...........+....|
 000000b0  04 00 2d 00 02 01 01 00  33 00 26 00 24 00 1d 00  |..-.....3.&.$...|
-000000c0  20 71 d3 74 f3 4c 75 f7  29 4d 65 5b 13 b4 ea 4a  | q.t.Lu.)Me[...J|
-000000d0  ad 25 d2 5c 36 e8 42 f5  1d 4e b3 3e 7c a0 87 48  |.%.\6.B..N.>|..H|
-000000e0  29                                                |)|
+000000c0  20 d0 26 0b b3 f0 56 30  0d 3b 71 2b db 78 60 62  | .&...V0.;q+.x`b|
+000000d0  e9 d1 6b e0 12 95 27 be  40 ad 40 56 e1 f3 f6 c8  |..k...'.@.@V....|
+000000e0  4f                                                |O|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 7a 02 00 00  76 03 03 00 00 00 00 00  |....z...v.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000020  00 00 00 00 00 00 00 00  00 00 00 20 34 ab 1d 74  |........... 4..t|
-00000030  cc cf 78 1f 9a 92 0b 7b  77 6a 67 16 fa 45 d2 d8  |..x....{wjg..E..|
-00000040  1f c2 15 c3 91 f7 b6 1f  01 62 3e d1 13 03 00 00  |.........b>.....|
+00000020  00 00 00 00 00 00 00 00  00 00 00 20 e6 52 d4 99  |........... .R..|
+00000030  4b 4a b0 43 53 5e d4 cd  8e d9 a9 f5 42 aa c4 64  |KJ.CS^......B..d|
+00000040  58 65 ec 46 ae d9 d7 0d  62 de 21 2e 13 03 00 00  |Xe.F....b.!.....|
 00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 2f  |..+.....3.$... /|
 00000060  e5 7d a3 47 cd 62 43 15  28 da ac 5f bb 29 07 30  |.}.G.bC.(.._.).0|
-00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 17  |.........._X.;t.|
-00000080  03 03 00 17 ed 03 2b 35  ba 39 86 ae ee 50 9e 71  |......+5.9...P.q|
-00000090  f6 0a 49 2d 6e cc f5 0a  25 00 fc 17 03 03 02 6d  |..I-n...%......m|
-000000a0  dd 4a 14 ec 14 0e 41 8c  98 3b 02 df cb 33 f1 33  |.J....A..;...3.3|
-000000b0  49 04 d2 bb 10 a1 b6 bb  92 17 09 19 4d 1e 18 03  |I...........M...|
-000000c0  0c 97 c3 f9 e1 35 fd 5e  09 58 07 e3 15 8c ca 6b  |.....5.^.X.....k|
-000000d0  19 7a e1 ac 17 84 f8 f3  1d f4 1c f7 53 d6 fc 54  |.z..........S..T|
-000000e0  5a c5 a7 4b 67 58 b9 63  85 a8 12 e4 3e 7a 87 7e  |Z..KgX.c....>z.~|
-000000f0  d6 b0 7f b9 70 b8 6f 57  23 7c 03 69 61 0a 3e bb  |....p.oW#|.ia.>.|
-00000100  65 b7 e5 48 4c c5 a3 ae  34 46 cf a4 b1 5b a5 26  |e..HL...4F...[.&|
-00000110  5b 50 01 0b b7 36 30 06  46 b1 3e ae f7 72 2b 44  |[P...60.F.>..r+D|
-00000120  7b e7 4d d0 18 c0 07 53  d4 73 80 02 cf 10 1b c9  |{.M....S.s......|
-00000130  10 a8 29 81 c4 89 78 cf  ad 3a 90 92 e3 f2 ac 9c  |..)...x..:......|
-00000140  88 64 f6 1f 96 bf f7 a8  f4 a1 ec 26 52 a7 ab 3b  |.d.........&R..;|
-00000150  0c 33 0f 46 6b cf c0 07  80 ca 46 61 28 46 9e 5a  |.3.Fk.....Fa(F.Z|
-00000160  22 98 d7 cf 1f b8 c5 b4  d1 14 3f 71 0b e8 a3 3f  |".........?q...?|
-00000170  8a 69 a4 1c a7 5a e4 e0  a0 d8 ee e4 5c ef 6b 55  |.i...Z......\.kU|
-00000180  55 e5 4e 6f 75 79 d0 53  b8 21 22 1d bf 86 65 15  |U.Nouy.S.!"...e.|
-00000190  7a 24 7f 7c 4b 82 84 6d  aa 08 9e 45 1a 5f 2b 34  |z$.|K..m...E._+4|
-000001a0  66 f2 92 cc f0 7a 7a e5  d1 2a c2 2e cb 78 c5 aa  |f....zz..*...x..|
-000001b0  18 87 d3 45 6d 39 39 25  3c f3 aa db 6c 10 8c b4  |...Em99%<...l...|
-000001c0  f7 f8 ea 49 5f 8a 5b 20  4d f2 e6 53 11 0f a5 3e  |...I_.[ M..S...>|
-000001d0  ab 0e 0f 6b fb 5f 43 cb  9f ed 0a f1 5e 21 0f 7c  |...k._C.....^!.||
-000001e0  86 4f e0 62 cb 2e be 49  2a c0 3b 53 92 8c 58 c2  |.O.b...I*.;S..X.|
-000001f0  53 82 bc 1b 84 e1 5f 85  2d 9e 5f 85 9f 4c 31 7d  |S....._.-._..L1}|
-00000200  20 ad a4 07 4f 08 06 7b  e8 47 52 cf a0 4e e5 0f  | ...O..{.GR..N..|
-00000210  ff d2 5b f6 f2 a0 5d 08  92 98 f0 d9 a0 e9 4f cd  |..[...].......O.|
-00000220  c9 bb de d9 a0 b5 e1 ec  a9 60 7b a9 37 2f 5c 77  |.........`{.7/\w|
-00000230  60 62 de dd f8 e1 63 4e  0b 7f 92 ff 81 96 02 ab  |`b....cN........|
-00000240  86 e4 f8 4e 52 60 91 cf  75 fc 1d c5 b0 74 c2 06  |...NR`..u....t..|
-00000250  15 4e be 1b f8 1c 14 ba  8c 2f 0b ab a2 cc 0e 9a  |.N......./......|
-00000260  ce fc 05 e9 21 e8 08 55  61 61 8e 98 c8 73 63 2c  |....!..Uaa...sc,|
-00000270  97 71 2e 74 a1 b1 42 dc  fe 6e 26 0f 5b 9d 13 96  |.q.t..B..n&.[...|
-00000280  47 03 5f 46 4b ae 81 d0  a0 d1 a7 a3 10 de e6 c6  |G._FK...........|
-00000290  6c bc 01 65 04 6f e5 6c  35 72 4c 65 74 a9 2c b0  |l..e.o.l5rLet.,.|
-000002a0  10 75 7b d5 c1 1a f0 f8  19 f5 7a 7e 28 f2 53 9d  |.u{.......z~(.S.|
-000002b0  a0 c4 c9 e3 e4 80 71 bc  5d cc 5f 3d 7b 2d 5f f0  |......q.]._={-_.|
-000002c0  51 94 8c d8 8e 0f f6 b8  29 44 90 c3 99 9a dc de  |Q.......)D......|
-000002d0  b6 81 ac 65 70 2b ad 1d  df 47 43 a5 a0 b6 51 6f  |...ep+...GC...Qo|
-000002e0  0e 29 de 9c cf b0 89 93  94 08 d8 f3 a5 05 b9 d3  |.)..............|
-000002f0  a0 bd 92 81 82 91 89 2d  4e df 13 98 09 67 31 c1  |.......-N....g1.|
-00000300  4d 28 d0 60 28 dc ae 40  c8 0f 33 d8 ac 17 03 03  |M(.`(..@..3.....|
-00000310  00 99 22 21 e8 35 f9 9c  29 9d 3a aa 00 ca 0c a7  |.."!.5..).:.....|
-00000320  d1 62 94 94 44 81 8f e0  56 13 29 5f c4 a9 2b ac  |.b..D...V.)_..+.|
-00000330  8a 67 fe 5f 32 4c 40 00  36 db ff 03 41 67 55 9f  |.g._2L@.6...AgU.|
-00000340  b5 a8 cc 52 89 0d 08 23  af c5 0f 02 70 3a 62 9f  |...R...#....p:b.|
-00000350  91 82 cc 1d 6f 57 d3 2b  f6 3f 75 f3 65 6b c2 ca  |....oW.+.?u.ek..|
-00000360  e9 5f 0d 1c 5a 31 8f 8f  f8 09 8f a8 4a 27 64 f7  |._..Z1......J'd.|
-00000370  18 2d fb 29 09 cd 07 fb  7c 32 47 4e 8d e2 e0 47  |.-.)....|2GN...G|
-00000380  60 76 f8 9e 2c 81 71 09  ac 7d 3a 10 30 27 07 06  |`v..,.q..}:.0'..|
-00000390  c9 7c 9d 57 5c c2 83 be  bf 67 28 70 15 4a fa b6  |.|.W\....g(p.J..|
-000003a0  56 8b 15 a8 a6 c8 65 ab  8c a4 03 17 03 03 00 35  |V.....e........5|
-000003b0  c6 0c 8f e5 57 46 d9 de  3a 13 7e 80 a9 06 76 e7  |....WF..:.~...v.|
-000003c0  a7 6d 5d 0e d1 21 dc 20  8f 2c df 86 cf cd e6 6e  |.m]..!. .,.....n|
-000003d0  71 14 69 a5 63 a1 38 80  d4 28 20 76 31 37 c6 be  |q.i.c.8..( v17..|
-000003e0  d9 65 b9 0b 74                                    |.e..t|
+00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 14  |.........._X.;t.|
+00000080  03 03 00 01 01 17 03 03  00 17 ea 45 ce e9 f5 10  |...........E....|
+00000090  95 59 6d ed 7a 9c fb 59  92 aa 50 11 a8 59 93 03  |.Ym.z..Y..P..Y..|
+000000a0  a1 17 03 03 02 6d 3c ce  b8 65 ce 05 e3 17 9d ed  |.....m<..e......|
+000000b0  f7 79 65 08 6b 3d 04 bb  8d 60 0a 38 25 e7 4c a8  |.ye.k=...`.8%.L.|
+000000c0  6b e1 ad 95 85 30 59 06  c0 0a 26 0e d6 1a 81 76  |k....0Y...&....v|
+000000d0  40 55 6a 43 26 71 95 3b  d5 73 1b 24 52 79 23 f9  |@UjC&q.;.s.$Ry#.|
+000000e0  db 97 c7 8d a7 c3 03 b8  35 56 1a 4a cc 3d 76 88  |........5V.J.=v.|
+000000f0  4f 23 75 67 c2 84 6d db  fa cc 6c 77 94 f3 eb 95  |O#ug..m...lw....|
+00000100  eb 27 f4 e2 03 41 b5 d7  e9 e1 7e 29 b4 82 01 e6  |.'...A....~)....|
+00000110  3f 76 e4 1f ef cb 39 27  a5 3b 34 f1 d5 f2 26 c7  |?v....9'.;4...&.|
+00000120  10 37 41 c1 08 81 00 9e  37 6d e4 0f a9 57 a7 1d  |.7A.....7m...W..|
+00000130  ea a8 19 23 32 a7 1a 04  8f c1 00 18 da 06 fd bc  |...#2...........|
+00000140  90 5d fb e7 03 f5 68 28  77 ed 47 5d 38 ec 66 6b  |.]....h(w.G]8.fk|
+00000150  0d c6 04 94 b9 af c0 a6  75 63 a4 8e bc 2e fd 52  |........uc.....R|
+00000160  9b c3 f5 4f b0 23 4d ed  7b 56 23 f5 fc d6 0e 3d  |...O.#M.{V#....=|
+00000170  80 e2 31 24 79 33 6c 14  54 ef 09 b7 2d 3a 27 69  |..1$y3l.T...-:'i|
+00000180  a7 18 9d cb 70 f6 bc 1a  87 61 f2 9b 37 62 d5 6e  |....p....a..7b.n|
+00000190  d1 32 b8 93 9b 83 48 48  27 f4 cb fa cd c4 66 92  |.2....HH'.....f.|
+000001a0  5d 4e 20 4b 26 b5 27 26  19 60 83 80 3c 4d a7 0a  |]N K&.'&.`..<M..|
+000001b0  8a 1d 82 29 ae bc b8 94  4c c7 ee 16 38 30 20 1f  |...)....L...80 .|
+000001c0  19 60 15 99 88 45 ca 37  8d 49 28 ac 81 0d 95 98  |.`...E.7.I(.....|
+000001d0  fd 71 b4 a8 00 59 a1 6c  56 c1 aa 75 dc 37 1b 29  |.q...Y.lV..u.7.)|
+000001e0  e1 4a 1d 90 51 4f 93 33  c8 00 7b 56 ef b7 bc 3f  |.J..QO.3..{V...?|
+000001f0  3f fe c5 b6 20 6d 15 cf  e5 87 22 ce 0f fd 6a a4  |?... m...."...j.|
+00000200  f9 80 06 ce a7 3f b8 3f  d9 25 bd b7 0f 5d d4 80  |.....?.?.%...]..|
+00000210  f1 b0 33 01 97 f5 f8 d8  93 94 e9 0b fb 86 1f ea  |..3.............|
+00000220  18 6a cc 5e b8 7e 59 3f  27 4d dd af 2c 0b b1 8c  |.j.^.~Y?'M..,...|
+00000230  4f a6 5f 0b 3f 85 ec 3c  fe 48 46 59 6f 92 77 af  |O._.?..<.HFYo.w.|
+00000240  54 da c7 b7 f2 35 e8 09  79 ef 9b 72 70 36 c5 6b  |T....5..y..rp6.k|
+00000250  a5 bd 7d ca 9e 4e 90 f1  e4 fb 87 af 1a 03 4d bd  |..}..N........M.|
+00000260  50 6b 10 88 a6 e1 fe 5c  bd 1a 20 2d 44 d6 69 d3  |Pk.....\.. -D.i.|
+00000270  67 b0 79 dd 88 fd 07 9c  ce 05 8d 36 a5 40 15 85  |g.y........6.@..|
+00000280  7c 88 51 ad 41 d3 26 a0  04 49 f8 4b 0e ad d0 e8  ||.Q.A.&..I.K....|
+00000290  46 73 e7 4d 01 52 17 15  a1 70 62 70 0f 6a 71 98  |Fs.M.R...pbp.jq.|
+000002a0  85 27 b4 4d 47 e7 01 6a  4e 21 0d b0 f7 26 9f 28  |.'.MG..jN!...&.(|
+000002b0  61 fc 4c e0 28 3d 06 a9  37 c9 ab 98 13 dd f0 06  |a.L.(=..7.......|
+000002c0  f1 6d 8b 0d 28 95 2f 1d  d6 7b 80 fe 1b e3 6d e9  |.m..(./..{....m.|
+000002d0  7c 62 ef e4 e1 08 78 5d  8d b5 2c eb e0 bf 8e de  ||b....x]..,.....|
+000002e0  f5 77 35 d2 51 ec 84 1b  c0 7f 74 c8 a7 0b 70 f4  |.w5.Q.....t...p.|
+000002f0  22 2d 3e fd 38 52 60 d3  0b d8 56 9b 38 3f 09 ca  |"->.8R`...V.8?..|
+00000300  cf 26 02 22 9e 48 30 4f  eb 24 e3 94 df 09 bc 8f  |.&.".H0O.$......|
+00000310  51 27 5f 17 03 03 00 99  aa 1e 71 5d 27 7c 0a cc  |Q'_.......q]'|..|
+00000320  a6 16 22 c9 77 45 a7 c4  a4 e5 2d 2d ac c8 1b 2b  |..".wE....--...+|
+00000330  2e 48 03 a5 94 c4 0c 4d  52 e4 2e eb eb 46 36 1e  |.H.....MR....F6.|
+00000340  57 d8 bd 8a 9b 23 9c 27  fb ac 6f 37 2b 8f 70 69  |W....#.'..o7+.pi|
+00000350  ed f4 83 56 54 fb 03 d6  58 b5 5e 0d b7 82 58 09  |...VT...X.^...X.|
+00000360  32 ce a0 e4 d7 4d 41 ea  42 39 c3 0b 5e 25 29 50  |2....MA.B9..^%)P|
+00000370  d0 5b b4 94 15 22 85 d6  52 19 38 a9 56 c4 81 2e  |.[..."..R.8.V...|
+00000380  ef 8d 3b b9 a0 9e c2 2f  24 53 4f 44 0e c1 a2 e3  |..;..../$SOD....|
+00000390  59 d8 d4 44 a9 39 19 e2  b0 d0 ab c7 7a e0 68 e1  |Y..D.9......z.h.|
+000003a0  a1 04 f0 7c 0a 12 e8 85  0a a6 6f ec 68 98 a6 98  |...|......o.h...|
+000003b0  b9 17 03 03 00 35 08 a4  e6 55 41 66 f8 c3 d4 3c  |.....5...UAf...<|
+000003c0  17 6f 54 f3 d5 91 09 53  db b1 49 15 d5 0a 2d ec  |.oT....S..I...-.|
+000003d0  fc 88 68 76 a3 8d 8d d6  b1 4b af b5 be c8 69 0c  |..hv.....K....i.|
+000003e0  08 41 a3 9d 23 c1 87 5d  33 b9 a6                 |.A..#..]3..|
 >>> Flow 3 (client to server)
-00000000  14 03 03 00 01 01 17 03  03 00 35 65 9c 9f 5e ef  |..........5e..^.|
-00000010  8f 90 79 3f a5 ff cb 00  55 e9 2d 94 62 d4 04 72  |..y?....U.-.b..r|
-00000020  0e 93 d1 5b cf 53 80 0b  72 d1 b4 e9 09 0b 9a 0f  |...[.S..r.......|
-00000030  10 81 27 bf c5 d2 6c 5a  99 f5 04 b5 3e a7 ab 77  |..'...lZ....>..w|
+00000000  14 03 03 00 01 01 17 03  03 00 35 6a 0f 9f 87 b5  |..........5j....|
+00000010  48 60 db 20 7b e9 4f ba  fd bf e5 b8 fc 14 3e 2f  |H`. {.O.......>/|
+00000020  3e e8 58 ed d4 c5 e5 da  cc 7d c4 32 d4 db c2 6a  |>.X......}.2...j|
+00000030  39 65 85 63 9c 92 7b 7c  b3 6f 45 d8 c4 c3 5e 6c  |9e.c..{|.oE...^l|
 >>> Flow 4 (server to client)
-00000000  17 03 03 00 1e 24 3a 1a  51 aa f2 9e 47 34 90 c7  |.....$:.Q...G4..|
-00000010  d9 cc 02 40 89 15 7b 47  b6 45 4a 8b fb 8b b5 1a  |...@..{G.EJ.....|
-00000020  43 4c 1e 17 03 03 00 13  01 41 14 2e 85 26 f4 d0  |CL.......A...&..|
-00000030  da a5 91 14 52 66 0c 7d  26 82 d0                 |....Rf.}&..|
+00000000  17 03 03 00 1e f5 83 ab  23 7e fa 4b 92 40 4b d3  |........#~.K.@K.|
+00000010  dd 19 de a3 32 df 90 94  86 da da b6 58 97 5a 46  |....2.......X.ZF|
+00000020  5f f5 b4 17 03 03 00 13  ef a9 5a 2c 54 8d 83 21  |_.........Z,T..!|
+00000030  79 79 0e 9e a6 f2 4f f6  f8 36 63                 |yy....O..6c|
diff --git a/src/crypto/tls/testdata/Server-TLSv13-ECDHE-ECDSA-AES b/src/crypto/tls/testdata/Server-TLSv13-ECDHE-ECDSA-AES
index 152eb24854..3cd1aafff8 100644
--- a/src/crypto/tls/testdata/Server-TLSv13-ECDHE-ECDSA-AES
+++ b/src/crypto/tls/testdata/Server-TLSv13-ECDHE-ECDSA-AES
@@ -1,9 +1,9 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 dc 01 00 00  d8 03 03 34 c0 8c 76 f5  |...........4..v.|
-00000010  c3 94 de 34 58 f6 fe 27  51 28 2d cf be 74 61 8e  |...4X..'Q(-..ta.|
-00000020  5c 25 14 22 1b b2 70 4b  c6 a5 e7 20 f5 d9 d5 d1  |\%."..pK... ....|
-00000030  5c 24 ab df 36 f1 c8 b9  4a 66 aa 52 d3 6c 3b 07  |\$..6...Jf.R.l;.|
-00000040  53 e2 e3 a5 6a bf ad 25  1e 93 06 40 00 04 13 01  |S...j..%...@....|
+00000000  16 03 01 00 dc 01 00 00  d8 03 03 9e ef 21 d2 56  |.............!.V|
+00000010  3a 1d 59 80 d2 09 8b d6  5d df fc 37 e3 b6 8d 14  |:.Y.....]..7....|
+00000020  05 7c da 8e 01 c9 cf 0e  a8 ec 5b 20 19 22 52 01  |.|........[ ."R.|
+00000030  0c d8 6e 8c 98 99 97 e5  ab b4 f9 5c fc 29 3f bd  |..n........\.)?.|
+00000040  a0 03 0d 05 78 24 dd 69  1d ad 26 39 00 04 13 01  |....x$.i..&9....|
 00000050  00 ff 01 00 00 8b 00 00  00 0e 00 0c 00 00 09 31  |...............1|
 00000060  32 37 2e 30 2e 30 2e 31  00 0b 00 04 03 00 01 02  |27.0.0.1........|
 00000070  00 0a 00 0c 00 0a 00 1d  00 17 00 1e 00 19 00 18  |................|
@@ -11,76 +11,76 @@
 00000090  05 03 06 03 08 07 08 08  08 09 08 0a 08 0b 08 04  |................|
 000000a0  08 05 08 06 04 01 05 01  06 01 00 2b 00 03 02 03  |...........+....|
 000000b0  04 00 2d 00 02 01 01 00  33 00 26 00 24 00 1d 00  |..-.....3.&.$...|
-000000c0  20 09 5c dd 14 86 ba fa  c5 6f ab b8 50 d5 1b 6f  | .\......o..P..o|
-000000d0  1b 49 12 c2 d6 e7 a0 8c  ca 95 7e 5d 62 ab 5a c8  |.I........~]b.Z.|
-000000e0  73                                                |s|
+000000c0  20 8e 46 85 be 7d 3e a5  f5 a0 41 a3 b0 d2 de 25  | .F..}>...A....%|
+000000d0  ae 1c 30 b5 b2 33 83 81  e1 1c 72 75 73 59 ba b6  |..0..3....rusY..|
+000000e0  0f                                                |.|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 7a 02 00 00  76 03 03 00 00 00 00 00  |....z...v.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000020  00 00 00 00 00 00 00 00  00 00 00 20 f5 d9 d5 d1  |........... ....|
-00000030  5c 24 ab df 36 f1 c8 b9  4a 66 aa 52 d3 6c 3b 07  |\$..6...Jf.R.l;.|
-00000040  53 e2 e3 a5 6a bf ad 25  1e 93 06 40 13 01 00 00  |S...j..%...@....|
+00000020  00 00 00 00 00 00 00 00  00 00 00 20 19 22 52 01  |........... ."R.|
+00000030  0c d8 6e 8c 98 99 97 e5  ab b4 f9 5c fc 29 3f bd  |..n........\.)?.|
+00000040  a0 03 0d 05 78 24 dd 69  1d ad 26 39 13 01 00 00  |....x$.i..&9....|
 00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 2f  |..+.....3.$... /|
 00000060  e5 7d a3 47 cd 62 43 15  28 da ac 5f bb 29 07 30  |.}.G.bC.(.._.).0|
-00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 17  |.........._X.;t.|
-00000080  03 03 00 17 57 c3 ea 50  c5 f5 d6 1f 4f e9 7e 30  |....W..P....O.~0|
-00000090  79 5b 6e 09 78 a7 f8 0d  a4 20 3d 17 03 03 02 22  |y[n.x.... =...."|
-000000a0  78 32 99 7b 8b 67 07 bc  bf 86 bc 4e 6d ba 2b 2e  |x2.{.g.....Nm.+.|
-000000b0  ba c8 bb d4 c5 10 dc 5a  9a 38 13 38 92 6f 8b 8c  |.......Z.8.8.o..|
-000000c0  73 8e 97 5e 39 3e 4e 93  b7 76 c4 c7 75 67 43 c9  |s..^9>N..v..ugC.|
-000000d0  80 a3 bb 88 71 e4 46 e2  dd 17 df a1 ba b8 af 2f  |....q.F......../|
-000000e0  47 e8 16 a5 04 08 69 66  34 f2 22 c9 28 06 70 b5  |G.....if4.".(.p.|
-000000f0  f7 c8 90 61 f4 77 32 7a  f7 e5 41 d2 dc e7 13 9b  |...a.w2z..A.....|
-00000100  41 09 df 97 e2 9a 31 33  ef 48 48 2c 64 d9 9c 11  |A.....13.HH,d...|
-00000110  e7 13 2b 1e 6d 3f 73 20  c7 5a 2f 2b aa bd f6 29  |..+.m?s .Z/+...)|
-00000120  49 c1 de 95 65 dc 7c a4  de d8 9b 80 1c 38 3b a4  |I...e.|......8;.|
-00000130  0c 7b 31 9a 27 b4 6f 38  2a 58 15 82 97 f0 99 bd  |.{1.'.o8*X......|
-00000140  d0 61 ca c9 2f 3f 71 8f  29 a6 ed 74 32 73 10 38  |.a../?q.)..t2s.8|
-00000150  c8 33 ba a0 9b c3 27 59  20 24 15 e5 02 27 b4 1c  |.3....'Y $...'..|
-00000160  62 72 9c 83 da 93 9e 03  a1 4a d3 50 df d0 5c 78  |br.......J.P..\x|
-00000170  74 58 63 c7 f6 3b 6e ba  da 13 5c 66 6e 3e cb d5  |tXc..;n...\fn>..|
-00000180  7f b1 ed 62 11 60 a1 ed  20 d8 3b 07 d6 36 f0 f2  |...b.`.. .;..6..|
-00000190  75 9a a4 3a 11 ac fa 6e  a1 2e 06 fe 44 90 06 2e  |u..:...n....D...|
-000001a0  78 8e 93 97 7f 7a 5c e2  ac be 29 cd 0f ea d2 5c  |x....z\...)....\|
-000001b0  ca 96 a1 7e 6e b2 3e b3  80 79 fb 25 a4 ee 99 29  |...~n.>..y.%...)|
-000001c0  85 f7 b7 1f dd 35 d4 3b  fb d2 a9 a1 e9 67 0f 7a  |.....5.;.....g.z|
-000001d0  ee fd 61 65 79 fc b3 8a  c2 32 1c b6 54 b9 c3 ab  |..aey....2..T...|
-000001e0  2b 32 32 2d 88 16 9e 10  60 ee ef 58 85 1a 65 eb  |+22-....`..X..e.|
-000001f0  5b 9f ae e3 fb da 37 7e  ec 73 69 57 29 e1 ab 76  |[.....7~.siW)..v|
-00000200  a3 bd fa 02 91 3d f8 6d  95 49 81 4a 44 2e d9 8c  |.....=.m.I.JD...|
-00000210  c7 00 0d ef 0c 84 a9 b2  16 ff 6a 52 79 99 37 6d  |..........jRy.7m|
-00000220  dc 5f c6 32 76 ac 3b 92  cc 21 6a 2b 26 03 43 66  |._.2v.;..!j+&.Cf|
-00000230  b2 64 79 51 11 08 7f 3f  63 ec 22 79 d7 90 4f 84  |.dyQ...?c."y..O.|
-00000240  ed 58 1f c3 fe e9 87 bf  d1 80 66 25 5a 95 53 1f  |.X........f%Z.S.|
-00000250  08 88 0c b8 7e 3b 07 c3  c7 4b 13 80 23 b1 15 3e  |....~;...K..#..>|
-00000260  e7 94 9b 91 8e 56 37 47  99 5f 5f 45 2d 11 f7 fc  |.....V7G.__E-...|
-00000270  33 b6 1f 6a 05 d8 8c 9f  1a 5f 38 d7 e8 1a d0 83  |3..j....._8.....|
-00000280  11 b6 bc 09 7b a9 31 19  b2 f1 a7 ea 8b a3 be a7  |....{.1.........|
-00000290  72 97 fb 09 19 5a d0 87  9c 01 bb e6 6e 50 91 87  |r....Z......nP..|
-000002a0  b1 e6 0c e0 83 af b2 e8  b9 fa 71 3e 3c 6e 59 91  |..........q><nY.|
-000002b0  1b ce aa 65 01 04 4b 85  3d de 9b be a8 2d e5 41  |...e..K.=....-.A|
-000002c0  07 81 17 03 03 00 a4 77  ba 74 eb 7d 2a e5 c9 c7  |.......w.t.}*...|
-000002d0  b8 b9 36 4a 59 39 59 a4  5b bf 01 b6 6f 54 2b c6  |..6JY9Y.[...oT+.|
-000002e0  51 dc 22 c1 43 6b 93 27  a9 0d 91 57 c7 2e 08 6b  |Q.".Ck.'...W...k|
-000002f0  b8 70 12 12 ff 6a bb af  49 2c 63 4d c2 ab 1d a9  |.p...j..I,cM....|
-00000300  d3 5d a0 89 8e 40 3a dc  e7 d6 e8 cd 10 d0 0a 1c  |.]...@:.........|
-00000310  c4 28 0c e1 eb 6a d7 95  7c 98 4d d7 39 3b a1 4b  |.(...j..|.M.9;.K|
-00000320  5f 2a af 52 f5 b3 81 15  ea b2 24 55 17 fc 20 cb  |_*.R......$U.. .|
-00000330  da 06 e3 51 f3 3b 03 2e  5c 07 91 e5 07 17 08 c7  |...Q.;..\.......|
-00000340  65 60 d8 c9 1c 92 7e 4b  7f 69 4d b2 47 75 bb e8  |e`....~K.iM.Gu..|
-00000350  84 9a db de 73 88 76 03  89 68 c4 0d 2e 32 89 76  |....s.v..h...2.v|
-00000360  28 d6 49 59 fe fd 1c 67  27 eb ce 17 03 03 00 35  |(.IY...g'......5|
-00000370  e5 52 97 06 d6 75 13 fd  76 67 10 9a bd 1f 52 bc  |.R...u..vg....R.|
-00000380  06 21 65 a4 a7 0b 4e e1  85 73 23 6a 8d 0d 6b 12  |.!e...N..s#j..k.|
-00000390  68 60 93 67 78 8f d1 35  42 16 ed 07 a2 64 34 c8  |h`.gx..5B....d4.|
-000003a0  ac 33 c0 04 71                                    |.3..q|
+00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 14  |.........._X.;t.|
+00000080  03 03 00 01 01 17 03 03  00 17 7d 27 14 0c e1 76  |..........}'...v|
+00000090  ac 23 c8 3f ff b6 f2 93  32 cd 6c 79 e9 c7 2d cd  |.#.?....2.ly..-.|
+000000a0  07 17 03 03 02 22 8d 6a  df 72 09 4a 7f df 86 d9  |.....".j.r.J....|
+000000b0  9a 0e e2 e6 d1 a3 86 7f  ee d2 87 15 d0 79 c5 d6  |.............y..|
+000000c0  79 d8 23 58 ff db 09 c2  0e cc b3 72 4f 51 28 3e  |y.#X.......rOQ(>|
+000000d0  0e 27 e4 dc b3 72 45 59  01 39 f9 da 5a b3 fe 61  |.'...rEY.9..Z..a|
+000000e0  e4 27 2c ba e5 b3 59 29  70 b6 3d b0 63 fa 9b 5f  |.',...Y)p.=.c.._|
+000000f0  8f c0 4c 6e 31 fd 8f 55  1a c5 36 3b 00 91 14 89  |..Ln1..U..6;....|
+00000100  87 3c 20 97 88 79 c7 05  c9 37 66 03 70 ea 60 25  |.< ..y...7f.p.`%|
+00000110  93 d4 d1 a6 d8 b8 ad 9e  1a 5b 68 30 7b 14 ce e2  |.........[h0{...|
+00000120  76 9d 7f d8 b5 5e 7d ad  5d 7b 63 be d1 16 14 60  |v....^}.]{c....`|
+00000130  d1 03 21 a8 83 5d 5b 36  13 1a 1e 2d 97 79 eb ef  |..!..][6...-.y..|
+00000140  36 28 c5 5a 23 78 53 18  59 15 28 31 0f 8b 43 a2  |6(.Z#xS.Y.(1..C.|
+00000150  e8 2d d9 87 5e 44 01 fc  94 04 32 2a 0b 8c fb 74  |.-..^D....2*...t|
+00000160  c3 40 ac 51 38 1a 87 bc  b9 58 8d 75 c2 cc ec 29  |.@.Q8....X.u...)|
+00000170  2e 93 f7 9e 6a d1 0b 18  9f b0 d7 b7 4c 3f 8e 44  |....j.......L?.D|
+00000180  0e 44 53 dc 64 24 85 35  b0 64 c1 0e 4e 8d ad 3d  |.DS.d$.5.d..N..=|
+00000190  10 91 2f 89 1d 59 94 06  0f 94 18 19 50 4d dd 9b  |../..Y......PM..|
+000001a0  ff dd 78 9f 0a 26 35 66  00 0e 13 a2 8b 83 df 3a  |..x..&5f.......:|
+000001b0  c0 ce c1 d7 8c 6a eb a7  b9 d9 68 cc 69 e9 07 9f  |.....j....h.i...|
+000001c0  0d 96 c7 3b 73 7e c3 76  96 9a 47 66 7c 66 a3 6b  |...;s~.v..Gf|f.k|
+000001d0  96 b1 9d 52 06 0a ed b5  87 8f ba ad 06 da 0b 1e  |...R............|
+000001e0  7c 1a f6 64 c9 6c 27 30  96 bc c2 1a c4 47 c5 e0  ||..d.l'0.....G..|
+000001f0  76 1f 7c db aa b5 49 a0  ac aa d9 c7 68 7d 5f 51  |v.|...I.....h}_Q|
+00000200  a1 dc 86 a1 01 d7 6a e3  b0 12 c1 d1 79 39 fe 6b  |......j.....y9.k|
+00000210  bb 6b a6 82 e1 8f f6 a5  a8 7c 06 db 74 4f 80 a8  |.k.......|..tO..|
+00000220  ec 67 f5 a8 7a e8 2a 71  be ee 56 fd 39 80 2c ba  |.g..z.*q..V.9.,.|
+00000230  74 a2 76 83 6f 83 a6 f5  9d 5e f6 23 60 f5 88 e2  |t.v.o....^.#`...|
+00000240  13 f2 7b ee cd f8 0f 2b  51 73 44 76 e2 56 32 db  |..{....+QsDv.V2.|
+00000250  e7 cd 86 6b f4 87 dd 14  47 0a a2 93 7c 53 21 84  |...k....G...|S!.|
+00000260  78 f6 c3 f3 ff fc 82 1f  d9 7c 4e f7 93 39 aa fc  |x........|N..9..|
+00000270  89 45 b0 7d 28 81 fe e9  98 94 33 49 0c 1f 3b 95  |.E.}(.....3I..;.|
+00000280  68 10 98 c9 34 59 9f ce  60 1e 09 b3 bc 94 1e 16  |h...4Y..`.......|
+00000290  cc 72 fd 4e 81 a3 57 fe  c2 10 4f 45 3a bf 2b 48  |.r.N..W...OE:.+H|
+000002a0  86 be 60 61 19 b7 30 ff  c6 83 be 97 80 85 c3 fd  |..`a..0.........|
+000002b0  f0 cb ad a3 17 6e 66 cf  16 d8 48 51 d1 da 3d a2  |.....nf...HQ..=.|
+000002c0  ad ff 36 10 09 ba 09 cf  17 03 03 00 a4 50 2a 1b  |..6..........P*.|
+000002d0  51 51 99 a8 cf 07 a8 19  ac b1 02 5c a9 16 e0 1c  |QQ.........\....|
+000002e0  24 97 de 28 e1 38 27 06  f5 b3 4e 99 6f f1 00 a5  |$..(.8'...N.o...|
+000002f0  32 eb a4 a4 6e 8f db c2  71 e7 2a 89 da 35 00 7b  |2...n...q.*..5.{|
+00000300  47 8a 21 70 94 ec 9a 34  10 7b 37 79 f5 c3 8c 34  |G.!p...4.{7y...4|
+00000310  c1 d6 b4 3f 36 50 43 16  1e a3 a6 8e a2 bc 16 f9  |...?6PC.........|
+00000320  cd 03 2c b2 6c c6 45 87  d5 10 b9 26 12 0d 6e a1  |..,.l.E....&..n.|
+00000330  0f 33 94 11 59 90 55 13  3c be c1 b3 e4 b7 43 25  |.3..Y.U.<.....C%|
+00000340  5d 41 8d 78 73 21 84 30  d8 51 64 e2 43 48 9d 40  |]A.xs!.0.Qd.CH.@|
+00000350  47 c4 6c b5 cf 7d 43 65  f1 5a ce e7 71 66 cd 98  |G.l..}Ce.Z..qf..|
+00000360  60 90 10 f9 ad 15 e3 c8  16 d5 13 ba 3b 0b e1 38  |`...........;..8|
+00000370  97 17 03 03 00 35 e0 02  c7 69 21 47 8f 99 34 90  |.....5...i!G..4.|
+00000380  03 69 0b b5 9b e6 33 63  f0 d1 c0 7c 58 2f 95 e0  |.i....3c...|X/..|
+00000390  3f 46 ed ee 1c f6 15 6d  62 d0 05 81 c3 cc 45 ac  |?F.....mb.....E.|
+000003a0  c6 9c 78 da aa cd d5 8b  b1 6b 7d                 |..x......k}|
 >>> Flow 3 (client to server)
-00000000  14 03 03 00 01 01 17 03  03 00 35 c1 5b 7a 5c 1b  |..........5.[z\.|
-00000010  3c 04 8b 1d 88 fb 64 28  08 47 4b 5e 18 f9 b9 25  |<.....d(.GK^...%|
-00000020  39 61 50 21 9b 0a 7a af  2a 26 6e 46 30 66 50 db  |9aP!..z.*&nF0fP.|
-00000030  8e 3f de c3 9e 65 e3 00  51 cd cc 38 44 92 13 5c  |.?...e..Q..8D..\|
+00000000  14 03 03 00 01 01 17 03  03 00 35 6e 4d 7c 75 a9  |..........5nM|u.|
+00000010  04 4b 9b f9 07 25 d0 c2  d9 fd f8 8b fc 22 1e 54  |.K...%.......".T|
+00000020  ff d1 62 6b 2a 3c f8 87  a3 2e 27 44 eb cc 34 8f  |..bk*<....'D..4.|
+00000030  a6 66 f0 a0 46 c2 6b b9  82 01 3d 85 f8 58 46 9b  |.f..F.k...=..XF.|
 >>> Flow 4 (server to client)
-00000000  17 03 03 00 1e 1c 4f 11  b2 e9 66 a3 ed 64 2d 23  |......O...f..d-#|
-00000010  b6 11 b0 fa 27 55 53 93  3a 70 01 c8 33 58 f8 48  |....'US.:p..3X.H|
-00000020  68 81 50 17 03 03 00 13  9c a6 6d 62 80 e3 55 f6  |h.P.......mb..U.|
-00000030  22 d5 84 59 35 8f 79 6f  1f 5e 79                 |"..Y5.yo.^y|
+00000000  17 03 03 00 1e c6 81 97  11 f3 86 a0 0f e6 7c 91  |..............|.|
+00000010  3f 97 8c db 4a 55 95 32  be 19 3d 37 36 1e 68 e4  |?...JU.2..=76.h.|
+00000020  81 7b 29 17 03 03 00 13  7e 90 5f 1f 4a 65 c0 fd  |.{).....~._.Je..|
+00000030  60 96 48 bb 22 b1 08 86  41 75 80                 |`.H."...Au.|
diff --git a/src/crypto/tls/testdata/Server-TLSv13-ExportKeyingMaterial b/src/crypto/tls/testdata/Server-TLSv13-ExportKeyingMaterial
index b1a9405448..ce9d5f170f 100644
--- a/src/crypto/tls/testdata/Server-TLSv13-ExportKeyingMaterial
+++ b/src/crypto/tls/testdata/Server-TLSv13-ExportKeyingMaterial
@@ -1,9 +1,9 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 e4 01 00 00  e0 03 03 40 35 14 01 11  |...........@5...|
-00000010  ea 27 ee ac 2d 8b d9 de  62 2d 94 4e 4f c6 97 09  |.'..-...b-.NO...|
-00000020  8a 84 1d 96 ca 1e 1c a2  a5 9f 82 20 cf 5d fb ec  |........... .]..|
-00000030  d8 3d 23 2d 89 77 a9 7b  1a 9a 72 e6 bd 17 50 53  |.=#-.w.{..r...PS|
-00000040  56 32 17 d3 50 38 0c 9d  0b e4 8d 9a 00 08 13 02  |V2..P8..........|
+00000000  16 03 01 00 e4 01 00 00  e0 03 03 ec cb e2 b2 15  |................|
+00000010  21 48 2d fd fb 7d ed 7b  44 07 8f f5 d2 e9 31 64  |!H-..}.{D.....1d|
+00000020  88 d8 38 6d 2e be e8 12  1d de 1e 20 05 c9 22 74  |..8m....... .."t|
+00000030  db c2 68 b3 88 31 3f 9e  8c 65 23 9b 90 58 03 3b  |..h..1?..e#..X.;|
+00000040  39 7b 61 a9 9f 7c 1e 61  79 dc 4d 29 00 08 13 02  |9{a..|.ay.M)....|
 00000050  13 03 13 01 00 ff 01 00  00 8f 00 00 00 0e 00 0c  |................|
 00000060  00 00 09 31 32 37 2e 30  2e 30 2e 31 00 0b 00 04  |...127.0.0.1....|
 00000070  03 00 01 02 00 0a 00 0c  00 0a 00 1d 00 17 00 1e  |................|
@@ -11,82 +11,82 @@
 00000090  00 0d 00 1e 00 1c 04 03  05 03 06 03 08 07 08 08  |................|
 000000a0  08 09 08 0a 08 0b 08 04  08 05 08 06 04 01 05 01  |................|
 000000b0  06 01 00 2b 00 03 02 03  04 00 2d 00 02 01 01 00  |...+......-.....|
-000000c0  33 00 26 00 24 00 1d 00  20 99 33 07 c3 2f 4d 4d  |3.&.$... .3../MM|
-000000d0  f1 3b 8a 93 f4 58 77 2b  69 e6 6e ae e8 1b 0a 30  |.;...Xw+i.n....0|
-000000e0  a2 35 f5 1f 9e ed 34 ed  0c                       |.5....4..|
+000000c0  33 00 26 00 24 00 1d 00  20 8b 1b 67 4d 4f 49 83  |3.&.$... ..gMOI.|
+000000d0  bd 4c b6 42 07 4e 3b 64  c9 90 64 16 ec 3c f8 9e  |.L.B.N;d..d..<..|
+000000e0  05 2f 55 11 50 ab b9 1e  54                       |./U.P...T|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 7a 02 00 00  76 03 03 00 00 00 00 00  |....z...v.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000020  00 00 00 00 00 00 00 00  00 00 00 20 cf 5d fb ec  |........... .]..|
-00000030  d8 3d 23 2d 89 77 a9 7b  1a 9a 72 e6 bd 17 50 53  |.=#-.w.{..r...PS|
-00000040  56 32 17 d3 50 38 0c 9d  0b e4 8d 9a 13 02 00 00  |V2..P8..........|
+00000020  00 00 00 00 00 00 00 00  00 00 00 20 05 c9 22 74  |........... .."t|
+00000030  db c2 68 b3 88 31 3f 9e  8c 65 23 9b 90 58 03 3b  |..h..1?..e#..X.;|
+00000040  39 7b 61 a9 9f 7c 1e 61  79 dc 4d 29 13 02 00 00  |9{a..|.ay.M)....|
 00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 2f  |..+.....3.$... /|
 00000060  e5 7d a3 47 cd 62 43 15  28 da ac 5f bb 29 07 30  |.}.G.bC.(.._.).0|
-00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 17  |.........._X.;t.|
-00000080  03 03 00 17 57 f0 44 ca  0f b9 92 0d 8f 6f 1f 11  |....W.D......o..|
-00000090  a1 03 28 76 f0 0c 46 87  5a c7 b5 17 03 03 02 6d  |..(v..F.Z......m|
-000000a0  78 f0 92 2b 56 5d b9 62  95 1b 04 8b d0 49 63 31  |x..+V].b.....Ic1|
-000000b0  1f 1d 9a 37 b3 64 e5 11  21 58 4c e2 d2 da a4 e1  |...7.d..!XL.....|
-000000c0  1b 26 e7 11 3f b5 46 18  62 46 35 8a ae b1 88 93  |.&..?.F.bF5.....|
-000000d0  5c 97 6c 66 6e a7 5d 63  fb e2 07 07 f5 59 02 38  |\.lfn.]c.....Y.8|
-000000e0  78 d5 52 97 9b 2f 06 d3  91 c0 a3 62 9b 74 7e f8  |x.R../.....b.t~.|
-000000f0  41 0b 71 df f9 ed 42 1b  51 ec db 66 86 d7 db c0  |A.q...B.Q..f....|
-00000100  a1 27 9e 51 95 fe 54 66  4a f2 72 7b d7 91 cd 00  |.'.Q..TfJ.r{....|
-00000110  b1 fd 36 a1 6f c5 c4 31  3e b8 d8 ab 0b f5 57 bf  |..6.o..1>.....W.|
-00000120  63 91 99 5e 04 63 c7 fa  c9 73 b5 23 0e e9 45 3a  |c..^.c...s.#..E:|
-00000130  15 2b a7 d3 f5 04 50 ab  17 65 40 d3 63 da 6e 2a  |.+....P..e@.c.n*|
-00000140  66 45 2d 41 1f 09 fa 62  67 86 8f e6 c5 7e 02 d0  |fE-A...bg....~..|
-00000150  27 bf 43 e8 15 8e 4f 71  67 2e 9b 13 61 44 23 0b  |'.C...Oqg...aD#.|
-00000160  29 06 81 0c 9c 28 c5 a9  f1 6e 49 84 b3 75 90 93  |)....(...nI..u..|
-00000170  0a f7 db 01 29 9f 73 5d  00 f5 41 a7 cb 0b b0 97  |....).s]..A.....|
-00000180  d7 b6 d0 71 31 56 88 88  7b 16 3b 54 5e 82 2b 87  |...q1V..{.;T^.+.|
-00000190  2c 74 2c 8f 0a ec 5f 2b  ef a6 86 55 49 d9 a2 af  |,t,..._+...UI...|
-000001a0  4a 34 48 a4 65 b6 4f f3  7f b6 30 e8 c2 f1 03 f4  |J4H.e.O...0.....|
-000001b0  89 90 02 b6 f2 6e 27 e8  33 5f c7 34 91 a7 fd 96  |.....n'.3_.4....|
-000001c0  58 a1 4b 3a e5 73 92 1c  ed 01 dd 15 a2 b5 61 01  |X.K:.s........a.|
-000001d0  1b 1d 52 0d 10 1f 1e a8  3b a4 b8 cf 50 0b ff e6  |..R.....;...P...|
-000001e0  cf b7 59 cf 60 55 f7 2d  ad 1d 7a 76 dc c0 4d d3  |..Y.`U.-..zv..M.|
-000001f0  5f 06 d2 1e 02 a8 23 12  6c ae 3a 90 d4 1a ef b1  |_.....#.l.:.....|
-00000200  31 c8 82 5c ca 92 1d db  c3 0c 5e 9e 80 1c 1d b2  |1..\......^.....|
-00000210  f5 55 b5 55 92 94 9a 43  ef 60 86 ee f0 65 68 bd  |.U.U...C.`...eh.|
-00000220  ad f8 5d f2 06 3f 2d b5  52 26 71 33 bb 0a f2 31  |..]..?-.R&q3...1|
-00000230  8a 98 41 8d 8d 59 d1 b7  c9 b1 3c e1 37 9e 70 0b  |..A..Y....<.7.p.|
-00000240  da ae 25 34 49 93 ce f3  a0 c9 b6 7e 06 34 53 07  |..%4I......~.4S.|
-00000250  ef 61 43 9d 79 2c d0 02  5a 64 bd 4a 46 98 3c 42  |.aC.y,..Zd.JF.<B|
-00000260  85 65 fb a1 56 df 4a b1  8a c5 4f e7 04 40 8a 70  |.e..V.J...O..@.p|
-00000270  88 bc 31 a1 64 9a e6 e2  f4 cd 15 79 9c de 1e 0e  |..1.d......y....|
-00000280  ae 84 c0 f3 a8 b0 ed 7b  7c a3 98 0b 19 76 b8 46  |.......{|....v.F|
-00000290  72 7f a8 32 cc f7 78 70  8f 28 43 69 df d7 53 8b  |r..2..xp.(Ci..S.|
-000002a0  9c cd d5 73 4d 14 ad 60  73 f3 d7 5e cf 04 e8 a8  |...sM..`s..^....|
-000002b0  11 04 6d 8a 58 5a 49 ad  63 53 6c b6 09 38 42 b7  |..m.XZI.cSl..8B.|
-000002c0  9a 23 ff 5c 77 15 a3 83  2e 0e fe 8e 59 30 d1 33  |.#.\w.......Y0.3|
-000002d0  a5 32 35 1f 0c 42 01 ca  30 d2 16 c1 18 1d e9 27  |.25..B..0......'|
-000002e0  f7 fd 86 1c 1f f4 ce f2  d5 a4 81 e1 6c a7 6a 8b  |............l.j.|
-000002f0  9a fd 1b 3c 4c d5 82 64  72 e2 b7 85 14 d1 2c d1  |...<L..dr.....,.|
-00000300  d6 d0 98 98 00 97 82 6b  27 1e 82 7b 59 17 03 03  |.......k'..{Y...|
-00000310  00 99 96 96 88 8a 74 73  12 90 3b b9 d6 85 6f be  |......ts..;...o.|
-00000320  b0 e3 bd 17 fe b6 b9 8b  26 b9 8a 0d 54 e7 82 10  |........&...T...|
-00000330  21 e1 87 d8 e1 f2 a5 02  8e 4b 2b 06 61 28 3b 92  |!........K+.a(;.|
-00000340  41 e3 55 e5 86 d5 4d 21  cf 4f b1 97 f2 e6 de 43  |A.U...M!.O.....C|
-00000350  f4 b7 a7 ba af 05 b6 23  8a 8c 04 5d 4d ee 87 5f  |.......#...]M.._|
-00000360  af 22 9d d1 68 ff 85 c8  a5 ca 15 bb 71 f8 ca b3  |."..h.......q...|
-00000370  bc fd 19 da 43 8d f1 c7  75 c2 2f 0e 97 04 bf a9  |....C...u./.....|
-00000380  a8 90 59 ab e6 90 86 a7  ff 24 d6 8b 87 5b 21 9c  |..Y......$...[!.|
-00000390  d0 e5 f5 87 3e 67 8c cc  94 9a ce 19 a3 f1 f9 78  |....>g.........x|
-000003a0  3f eb 55 57 d9 7b 3a 31  c8 b9 d2 17 03 03 00 45  |?.UW.{:1.......E|
-000003b0  ec 76 02 21 7b 96 9c ff  a5 ea e9 2e 92 a7 d6 f4  |.v.!{...........|
-000003c0  8e c0 a0 bc 21 11 44 df  84 dd 3c 21 5d cc 1b 2c  |....!.D...<!]..,|
-000003d0  ed 5d bf af 55 20 51 19  43 e4 40 28 44 8c dc e7  |.]..U Q.C.@(D...|
-000003e0  f2 43 88 82 27 7c 25 30  01 96 81 92 71 ca 3e 8a  |.C..'|%0....q.>.|
-000003f0  f0 29 1b 4b 6e                                    |.).Kn|
+00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 14  |.........._X.;t.|
+00000080  03 03 00 01 01 17 03 03  00 17 f1 1b 1c 50 d3 90  |.............P..|
+00000090  2b 14 76 bc 0a 21 94 58  1f 9b f1 0a 38 3f f2 54  |+.v..!.X....8?.T|
+000000a0  fb 17 03 03 02 6d 45 81  6d 58 83 be 84 b1 29 47  |.....mE.mX....)G|
+000000b0  59 99 33 5e 2e d9 7d 86  57 4c 80 74 cf 11 9f b7  |Y.3^..}.WL.t....|
+000000c0  0f 06 b2 bb b2 1d fa 18  6b f8 7a b1 e1 12 b5 15  |........k.z.....|
+000000d0  ea 3e 3b df e7 c6 5f 82  4e a5 4a 3f 3d 39 61 76  |.>;..._.N.J?=9av|
+000000e0  93 0e 7c b0 2d da 75 e3  ee 91 3a f6 0f d1 a7 9a  |..|.-.u...:.....|
+000000f0  b7 4a 7d 93 e5 05 8b 77  01 d2 21 16 94 b6 4d 60  |.J}....w..!...M`|
+00000100  ed de e6 2e 87 23 eb 4b  74 8e 5b 4f 25 67 7b cf  |.....#.Kt.[O%g{.|
+00000110  1a 43 c1 67 31 8e ca 15  f8 b9 a2 ac cc 58 b7 67  |.C.g1........X.g|
+00000120  93 c9 4a 79 9b 45 36 29  1d 80 c0 0c 0a be 38 c3  |..Jy.E6)......8.|
+00000130  97 90 2d 20 33 be 71 06  59 6d e1 b8 2f 92 f5 67  |..- 3.q.Ym../..g|
+00000140  fe e4 39 ad 86 98 c2 96  ab 89 a5 64 3b 83 33 85  |..9........d;.3.|
+00000150  a9 0a 08 89 7b 5a 95 92  b6 ab fe 0c 42 c9 a7 c2  |....{Z......B...|
+00000160  5a 49 45 7a ac 44 d9 43  8c 13 b7 cf ac e2 22 ec  |ZIEz.D.C......".|
+00000170  63 da eb b6 02 4e d7 51  cb 64 e5 9b 14 4d 0c 9e  |c....N.Q.d...M..|
+00000180  62 b5 48 97 01 8f 44 29  6b 86 0f 0b 96 40 2f 0d  |b.H...D)k....@/.|
+00000190  61 98 7a e4 bc 3d 11 4b  30 41 8f e1 b4 d1 3f 7f  |a.z..=.K0A....?.|
+000001a0  3c b0 a7 03 f8 ad b3 61  98 3c 2a 44 5a 5c ef 2f  |<......a.<*DZ\./|
+000001b0  44 f5 90 92 85 7e e1 72  cf a7 a9 b8 da 88 d5 31  |D....~.r.......1|
+000001c0  40 3b 06 d2 fc 35 86 a7  fc 5b 08 0d 97 55 41 3b  |@;...5...[...UA;|
+000001d0  1c 31 04 90 aa bb e6 76  ff 2e 9a 68 76 d7 2d 41  |.1.....v...hv.-A|
+000001e0  09 55 21 d7 7c 40 a1 65  2a 81 d3 f7 4e 0b b3 ae  |.U!.|@.e*...N...|
+000001f0  31 d3 a4 1e 92 85 65 9b  02 73 46 93 d8 bd 4a 60  |1.....e..sF...J`|
+00000200  b8 93 03 70 2f 76 dd 85  d8 d6 eb 34 b8 1a 7e dd  |...p/v.....4..~.|
+00000210  7b af b1 aa ca 80 18 74  29 c3 c5 4a d9 3e f8 2f  |{......t)..J.>./|
+00000220  9c 7b ea ca 87 37 44 fe  b3 fb 9d 6e 76 fb 19 72  |.{...7D....nv..r|
+00000230  17 6f 1d 13 ff 55 3a 8f  ce c9 c3 a6 fc 4a 34 da  |.o...U:......J4.|
+00000240  27 76 6d 1f 56 18 bb b7  16 a5 68 a2 06 74 d6 ad  |'vm.V.....h..t..|
+00000250  aa bb 79 09 06 22 cd c0  b8 12 b4 03 a0 32 bb 90  |..y..".......2..|
+00000260  f6 a3 64 53 f5 f2 6c 2c  b0 5d 4e 2d 35 bf 3d 02  |..dS..l,.]N-5.=.|
+00000270  49 3a b2 95 99 ac 4e 6b  89 38 c0 d1 e5 ea 39 a1  |I:....Nk.8....9.|
+00000280  bf 9f b5 dc be cb b6 e7  cd 88 f6 29 ad a0 a0 2e  |...........)....|
+00000290  a2 c8 1a 93 97 d3 f4 c0  4a 38 7e 15 87 7e 4d ed  |........J8~..~M.|
+000002a0  b8 fa 5f 59 2d 1c 6d fe  22 42 11 5b 02 87 d6 31  |.._Y-.m."B.[...1|
+000002b0  cb 3c 0f 93 fe 97 d1 48  4c d4 ff b0 32 e5 e9 3a  |.<.....HL...2..:|
+000002c0  49 5c a8 77 a8 af c9 e9  76 2a 53 b3 1f 1c 29 25  |I\.w....v*S...)%|
+000002d0  9f 94 b1 80 e2 f9 6c 53  c7 b2 bb a1 39 f7 42 3d  |......lS....9.B=|
+000002e0  b5 ea 02 2b ab 71 b6 18  58 2c 51 b2 34 25 64 90  |...+.q..X,Q.4%d.|
+000002f0  34 90 09 22 91 a1 41 75  fb a7 b3 80 17 d7 ca 89  |4.."..Au........|
+00000300  2a d3 8a 32 39 8b 31 5e  31 3e e2 57 ab 0b 67 3b  |*..29.1^1>.W..g;|
+00000310  32 cf 7a 17 03 03 00 99  bc 5a 9c 2b 4a 62 b4 20  |2.z......Z.+Jb. |
+00000320  bb 2e cd 7e 5d 5c ce 57  1a 6c 2e 1b 95 47 c0 0c  |...~]\.W.l...G..|
+00000330  a3 7f 0c 0d b8 58 0e 11  4c 08 75 23 8e 78 21 17  |.....X..L.u#.x!.|
+00000340  fa 30 60 e4 9b 1d d1 17  3a 3d 2f f7 48 7f bc c2  |.0`.....:=/.H...|
+00000350  35 fe 98 22 29 24 16 76  ae 41 f7 fb 97 ac 8b b1  |5..")$.v.A......|
+00000360  b5 80 8a bb 44 b9 aa cc  fc a4 d7 55 1c 7d a2 97  |....D......U.}..|
+00000370  14 29 1e d6 53 aa 2c 63  08 00 80 f8 2f 85 ee 73  |.)..S.,c..../..s|
+00000380  ef 87 fa cd d1 50 10 6c  6c ad 44 c0 22 81 a0 9e  |.....P.ll.D."...|
+00000390  6a 2f 7a 29 77 6d 22 4e  25 95 23 55 f5 9c e6 78  |j/z)wm"N%.#U...x|
+000003a0  5e ba c0 7c 18 ab 77 58  b2 9e da 1e 0f fe 50 23  |^..|..wX......P#|
+000003b0  8b 17 03 03 00 45 e9 b2  27 9b 47 5e fa 8f f2 ad  |.....E..'.G^....|
+000003c0  0e 70 e5 19 90 dc 68 4a  74 e7 7e ef 65 94 9e 6c  |.p....hJt.~.e..l|
+000003d0  f6 5d 9c 28 f1 07 5e ed  14 d0 2c f9 ae 71 a8 77  |.].(..^...,..q.w|
+000003e0  13 5d 51 58 2b cd 98 e9  47 f0 99 56 df de d7 ff  |.]QX+...G..V....|
+000003f0  36 99 4a c3 57 5b d9 28  14 12 c4                 |6.J.W[.(...|
 >>> Flow 3 (client to server)
-00000000  14 03 03 00 01 01 17 03  03 00 45 4a 89 ee af 15  |..........EJ....|
-00000010  db cf 58 6f f9 5a cd 28  a7 57 08 38 7a a4 1a a6  |..Xo.Z.(.W.8z...|
-00000020  d9 ed 5f f8 b1 f8 a9 aa  19 70 5f 8d 87 b9 d8 5c  |.._......p_....\|
-00000030  b6 4d d6 04 4b 66 1b 6a  57 25 58 bf a1 b6 72 81  |.M..Kf.jW%X...r.|
-00000040  74 b9 c9 6f 02 c9 0b f6  b2 7f 70 72 78 a6 06 bd  |t..o......prx...|
+00000000  14 03 03 00 01 01 17 03  03 00 45 b3 84 9c d1 43  |..........E....C|
+00000010  0e da 02 25 e8 03 3a 8f  21 86 d1 76 3e be 62 06  |...%..:.!..v>.b.|
+00000020  18 f5 09 d7 e2 85 eb be  c5 c0 e7 93 dc 52 37 5c  |.............R7\|
+00000030  ae dd 0c 20 49 68 15 f7  4a 9e 2a ed af 31 96 8a  |... Ih..J.*..1..|
+00000040  9f f0 63 a3 dc 99 c9 59  62 b7 39 59 0d 9d fc 8d  |..c....Yb.9Y....|
 >>> Flow 4 (server to client)
-00000000  17 03 03 00 1e ee 68 ad  7a 47 ba 93 80 26 01 37  |......h.zG...&.7|
-00000010  1b 3b b8 61 aa 60 a1 0f  21 a4 81 51 16 a5 b1 36  |.;.a.`..!..Q...6|
-00000020  b2 39 ca 17 03 03 00 13  5e 1c 9b a5 d1 02 68 96  |.9......^.....h.|
-00000030  99 41 8c a1 9e 49 38 1d  97 b6 c8                 |.A...I8....|
+00000000  17 03 03 00 1e 07 ad 4c  9d 83 85 be d5 a3 61 70  |.......L......ap|
+00000010  bc 7a a7 40 17 70 d5 97  18 80 1c 9b 52 95 97 de  |.z.@.p......R...|
+00000020  46 6c ef 17 03 03 00 13  58 d1 0f aa 71 be 1a c9  |Fl......X...q...|
+00000030  f3 ef 38 13 a6 5b ff 84  99 09 81                 |..8..[.....|
diff --git a/src/crypto/tls/testdata/Server-TLSv13-HelloRetryRequest b/src/crypto/tls/testdata/Server-TLSv13-HelloRetryRequest
index b63a5f8ab5..1fff4565a9 100644
--- a/src/crypto/tls/testdata/Server-TLSv13-HelloRetryRequest
+++ b/src/crypto/tls/testdata/Server-TLSv13-HelloRetryRequest
@@ -1,118 +1,119 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 da 01 00 00  d6 03 03 29 a2 7e 24 c3  |...........).~$.|
-00000010  02 bf 2c 29 7b 47 08 06  bf 75 ef c5 59 2d a4 f0  |..,){G...u..Y-..|
-00000020  2f fc 53 62 5d b8 4d 3c  f1 31 2d 20 96 7c 00 da  |/.Sb].M<.1- .|..|
-00000030  35 8c 39 0a f8 1c 61 b8  4a a8 28 b4 a2 de 56 7b  |5.9...a.J.(...V{|
-00000040  a9 f3 ab 5d db 30 ca 2c  d1 82 9e e2 00 08 13 02  |...].0.,........|
+00000000  16 03 01 00 da 01 00 00  d6 03 03 4f 56 85 14 53  |...........OV..S|
+00000010  57 df bb 75 5b c6 86 bd  cd a2 68 c6 87 ad 2e b5  |W..u[.....h.....|
+00000020  07 ef ce 55 c1 d3 12 35  aa a1 a7 20 d1 1e 60 1e  |...U...5... ..`.|
+00000030  a7 c7 2a e0 f8 ba 46 c3  f0 bf a7 d5 1c 73 68 98  |..*...F......sh.|
+00000040  9f 8c 7f 4e 15 9b 59 23  84 a0 f3 fc 00 08 13 02  |...N..Y#........|
 00000050  13 03 13 01 00 ff 01 00  00 85 00 00 00 0e 00 0c  |................|
 00000060  00 00 09 31 32 37 2e 30  2e 30 2e 31 00 0b 00 04  |...127.0.0.1....|
 00000070  03 00 01 02 00 0a 00 06  00 04 00 1d 00 17 00 16  |................|
 00000080  00 00 00 17 00 00 00 0d  00 1e 00 1c 04 03 05 03  |................|
 00000090  06 03 08 07 08 08 08 09  08 0a 08 0b 08 04 08 05  |................|
 000000a0  08 06 04 01 05 01 06 01  00 2b 00 03 02 03 04 00  |.........+......|
-000000b0  2d 00 02 01 01 00 33 00  26 00 24 00 1d 00 20 dd  |-.....3.&.$... .|
-000000c0  c7 c6 35 0b c9 5f f0 7e  40 e8 f1 f7 6f e7 84 8f  |..5.._.~@...o...|
-000000d0  7f 32 2f 8c a3 22 c6 c1  b9 34 1c ef 17 e7 25     |.2/.."...4....%|
+000000b0  2d 00 02 01 01 00 33 00  26 00 24 00 1d 00 20 9d  |-.....3.&.$... .|
+000000c0  63 d4 5c 11 f7 4b d3 49  41 e2 1d ca 2c 67 68 c1  |c.\..K.IA...,gh.|
+000000d0  7d 9c ad 2b 77 34 d8 77  82 1c ea e4 26 51 48     |}..+w4.w....&QH|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 58 02 00 00  54 03 03 cf 21 ad 74 e5  |....X...T...!.t.|
 00000010  9a 61 11 be 1d 8c 02 1e  65 b8 91 c2 a2 11 16 7a  |.a......e......z|
-00000020  bb 8c 5e 07 9e 09 e2 c8  a8 33 9c 20 96 7c 00 da  |..^......3. .|..|
-00000030  35 8c 39 0a f8 1c 61 b8  4a a8 28 b4 a2 de 56 7b  |5.9...a.J.(...V{|
-00000040  a9 f3 ab 5d db 30 ca 2c  d1 82 9e e2 13 02 00 00  |...].0.,........|
-00000050  0c 00 2b 00 02 03 04 00  33 00 02 00 17           |..+.....3....|
+00000020  bb 8c 5e 07 9e 09 e2 c8  a8 33 9c 20 d1 1e 60 1e  |..^......3. ..`.|
+00000030  a7 c7 2a e0 f8 ba 46 c3  f0 bf a7 d5 1c 73 68 98  |..*...F......sh.|
+00000040  9f 8c 7f 4e 15 9b 59 23  84 a0 f3 fc 13 02 00 00  |...N..Y#........|
+00000050  0c 00 2b 00 02 03 04 00  33 00 02 00 17 14 03 03  |..+.....3.......|
+00000060  00 01 01                                          |...|
 >>> Flow 3 (client to server)
 00000000  14 03 03 00 01 01 16 03  03 00 fb 01 00 00 f7 03  |................|
-00000010  03 29 a2 7e 24 c3 02 bf  2c 29 7b 47 08 06 bf 75  |.).~$...,){G...u|
-00000020  ef c5 59 2d a4 f0 2f fc  53 62 5d b8 4d 3c f1 31  |..Y-../.Sb].M<.1|
-00000030  2d 20 96 7c 00 da 35 8c  39 0a f8 1c 61 b8 4a a8  |- .|..5.9...a.J.|
-00000040  28 b4 a2 de 56 7b a9 f3  ab 5d db 30 ca 2c d1 82  |(...V{...].0.,..|
-00000050  9e e2 00 08 13 02 13 03  13 01 00 ff 01 00 00 a6  |................|
+00000010  03 4f 56 85 14 53 57 df  bb 75 5b c6 86 bd cd a2  |.OV..SW..u[.....|
+00000020  68 c6 87 ad 2e b5 07 ef  ce 55 c1 d3 12 35 aa a1  |h........U...5..|
+00000030  a7 20 d1 1e 60 1e a7 c7  2a e0 f8 ba 46 c3 f0 bf  |. ..`...*...F...|
+00000040  a7 d5 1c 73 68 98 9f 8c  7f 4e 15 9b 59 23 84 a0  |...sh....N..Y#..|
+00000050  f3 fc 00 08 13 02 13 03  13 01 00 ff 01 00 00 a6  |................|
 00000060  00 00 00 0e 00 0c 00 00  09 31 32 37 2e 30 2e 30  |.........127.0.0|
 00000070  2e 31 00 0b 00 04 03 00  01 02 00 0a 00 06 00 04  |.1..............|
 00000080  00 1d 00 17 00 16 00 00  00 17 00 00 00 0d 00 1e  |................|
 00000090  00 1c 04 03 05 03 06 03  08 07 08 08 08 09 08 0a  |................|
 000000a0  08 0b 08 04 08 05 08 06  04 01 05 01 06 01 00 2b  |...............+|
 000000b0  00 03 02 03 04 00 2d 00  02 01 01 00 33 00 47 00  |......-.....3.G.|
-000000c0  45 00 17 00 41 04 30 30  c4 62 c9 14 6b f7 28 88  |E...A.00.b..k.(.|
-000000d0  ff c8 3f 87 2b 9f 24 a3  46 9b 2f 86 c7 df 3f 05  |..?.+.$.F./...?.|
-000000e0  6b 8e a7 80 64 ff 66 b7  4d 80 62 fd b4 ba de 27  |k...d.f.M.b....'|
-000000f0  44 7f 7a a4 c7 4a f0 81  25 52 3f 8a 8a 48 1e ff  |D.z..J..%R?..H..|
-00000100  6f 11 ad a9 fe bd                                 |o.....|
+000000c0  45 00 17 00 41 04 ab 06  ea de b6 17 db 32 11 c8  |E...A........2..|
+000000d0  ed 1e 8b 03 c2 a8 87 46  65 e8 3e 25 34 84 52 dc  |.......Fe.>%4.R.|
+000000e0  22 4a 67 ce 89 00 04 ce  46 47 0a b8 b0 2d a0 0a  |"Jg.....FG...-..|
+000000f0  d1 91 e1 73 34 91 77 52  c6 1a 75 8d 70 ad 57 53  |...s4.wR..u.p.WS|
+00000100  75 47 81 67 e7 3f                                 |uG.g.?|
 >>> Flow 4 (server to client)
 00000000  16 03 03 00 9b 02 00 00  97 03 03 00 00 00 00 00  |................|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000020  00 00 00 00 00 00 00 00  00 00 00 20 96 7c 00 da  |........... .|..|
-00000030  35 8c 39 0a f8 1c 61 b8  4a a8 28 b4 a2 de 56 7b  |5.9...a.J.(...V{|
-00000040  a9 f3 ab 5d db 30 ca 2c  d1 82 9e e2 13 02 00 00  |...].0.,........|
+00000020  00 00 00 00 00 00 00 00  00 00 00 20 d1 1e 60 1e  |........... ..`.|
+00000030  a7 c7 2a e0 f8 ba 46 c3  f0 bf a7 d5 1c 73 68 98  |..*...F......sh.|
+00000040  9f 8c 7f 4e 15 9b 59 23  84 a0 f3 fc 13 02 00 00  |...N..Y#........|
 00000050  4f 00 2b 00 02 03 04 00  33 00 45 00 17 00 41 04  |O.+.....3.E...A.|
 00000060  1e 18 37 ef 0d 19 51 88  35 75 71 b5 e5 54 5b 12  |..7...Q.5uq..T[.|
 00000070  2e 8f 09 67 fd a7 24 20  3e b2 56 1c ce 97 28 5e  |...g..$ >.V...(^|
 00000080  f8 2b 2d 4f 9e f1 07 9f  6c 4b 5b 83 56 e2 32 42  |.+-O....lK[.V.2B|
 00000090  e9 58 b6 d7 49 a6 b5 68  1a 41 03 56 6b dc 5a 89  |.X..I..h.A.Vk.Z.|
-000000a0  17 03 03 00 17 74 86 c5  4d 7f f0 06 2b fa a3 03  |.....t..M...+...|
-000000b0  4d 27 46 e7 33 ce 70 32  ba 61 55 61 17 03 03 02  |M'F.3.p2.aUa....|
-000000c0  6d c5 ac cc 02 19 b0 92  c1 bc 6a fe 1d 94 a6 75  |m.........j....u|
-000000d0  66 6a 88 b0 87 76 da 3f  f9 07 40 67 c7 e5 b8 b7  |fj...v.?..@g....|
-000000e0  70 38 41 0e 11 3b cf db  0b 76 73 58 10 93 0e 06  |p8A..;...vsX....|
-000000f0  cb 31 75 d0 a8 2f 20 35  b4 c2 87 5f 42 94 e1 18  |.1u../ 5..._B...|
-00000100  d5 f8 bc 11 d7 7c 9b ff  0b fe 59 8b 78 1e ef 52  |.....|....Y.x..R|
-00000110  6f ea 39 e5 f5 55 93 8b  0b 65 87 05 d3 0d a3 6d  |o.9..U...e.....m|
-00000120  2e 10 79 1d 60 61 ba 43  13 cd 5a 58 28 cb 32 df  |..y.`a.C..ZX(.2.|
-00000130  74 3a 58 4e e0 21 d4 d0  2f 6f 63 72 1c 82 18 16  |t:XN.!../ocr....|
-00000140  12 4c e7 0b 5e 21 ce e4  de 26 6c d2 91 c1 fd 85  |.L..^!...&l.....|
-00000150  5a f4 b7 5d 5a c6 fe 8c  05 fe f7 2a ae a1 67 73  |Z..]Z......*..gs|
-00000160  8a 66 60 07 57 35 46 ed  cf e1 58 f3 22 94 57 26  |.f`.W5F...X.".W&|
-00000170  ae 81 3c ea 42 1c ef 56  ca 0e 35 5a 4c 97 49 36  |..<.B..V..5ZL.I6|
-00000180  73 e2 be 8b ad 55 42 a3  8f 50 65 8a 7a 9d cf 7c  |s....UB..Pe.z..||
-00000190  4f d9 4b db 0d a4 0e 57  99 08 72 0a 1f cf 9d 19  |O.K....W..r.....|
-000001a0  ad 24 7b 64 9b ef d2 9f  8f 42 d4 ca a8 84 2f 15  |.${d.....B..../.|
-000001b0  3a 10 8e 1e 22 b8 fc 9f  77 0b 8e 82 22 bd 08 f2  |:..."...w..."...|
-000001c0  3e 4c a7 f1 d0 46 a8 fb  fb 5e f6 0d 32 8e 2d e4  |>L...F...^..2.-.|
-000001d0  3b 17 b8 da 71 03 cb d9  b8 12 9b 70 a0 3a 07 19  |;...q......p.:..|
-000001e0  f6 c1 66 1e b8 e2 b2 5a  50 50 c5 51 8f f3 91 e7  |..f....ZPP.Q....|
-000001f0  bc ba a2 ee ca a8 71 24  5f f2 25 79 c3 a2 23 70  |......q$_.%y..#p|
-00000200  03 0b 8b 99 4d 33 92 f1  ff 64 cd cc 31 b2 13 a9  |....M3...d..1...|
-00000210  d3 c2 37 b7 11 17 7f d7  64 ba da 6d 46 b1 a2 03  |..7.....d..mF...|
-00000220  fe 8d 4d e3 cd eb a3 2f  af 89 f4 a4 af 82 0e e3  |..M..../........|
-00000230  65 c3 64 38 33 6a bd c9  13 77 9d 37 c7 c8 1d 55  |e.d83j...w.7...U|
-00000240  f9 a6 b8 fc 57 0f f7 94  76 1f bd 4f 4a 74 fe 0a  |....W...v..OJt..|
-00000250  98 be e9 d9 2e d2 c0 c9  fb d2 3b 27 fb 37 14 f5  |..........;'.7..|
-00000260  29 d5 f4 88 a5 b0 98 1d  0c 85 9e 1f ad 29 cf 36  |)............).6|
-00000270  3d 2f c0 54 93 1f 14 8b  1e a3 93 aa 53 af da d1  |=/.T........S...|
-00000280  da 0b 2b e4 01 fe 8e 48  df 8b 97 fe 92 ab 32 80  |..+....H......2.|
-00000290  c3 d2 84 1a 45 a7 0d f3  f8 07 e3 7d a3 27 62 67  |....E......}.'bg|
-000002a0  10 4b 3e 09 ee 22 77 0d  54 71 8b 6f 68 6a a9 cc  |.K>.."w.Tq.ohj..|
-000002b0  80 34 5e 35 36 b0 cb d5  8b 04 6f 0f 28 82 5f 69  |.4^56.....o.(._i|
-000002c0  d3 66 cd 19 db 39 1d 73  c2 28 36 94 5f 1b 24 c6  |.f...9.s.(6._.$.|
-000002d0  9a 62 34 0f ec 9a f9 c5  8c 72 5c c3 a0 c7 d6 5b  |.b4......r\....[|
-000002e0  1d 2e 4b 31 cd 2e 8b 37  cc 9a b2 ca e9 5d b0 f9  |..K1...7.....]..|
-000002f0  b4 2c ba 27 08 c3 d6 90  1b 51 0c 83 72 0b 8a 72  |.,.'.....Q..r..r|
-00000300  a1 12 ab 5c 91 a8 b2 76  f1 c1 09 d3 74 fb bc e5  |...\...v....t...|
-00000310  33 96 59 91 3e e0 89 cf  99 7c 40 c4 af 0e 8d 58  |3.Y.>....|@....X|
-00000320  20 ea d9 0d 0e 64 10 2c  c8 ad ed 38 b0 fa 17 03  | ....d.,...8....|
-00000330  03 00 99 f0 80 72 33 a3  53 2f c6 7f 68 e5 42 ee  |.....r3.S/..h.B.|
-00000340  d0 81 00 07 8b b7 69 ec  0d 9e 5a dc f5 0b 40 82  |......i...Z...@.|
-00000350  0e a5 bc ce dd 13 1e 15  4c 10 d8 62 00 42 45 eb  |........L..b.BE.|
-00000360  2b f1 aa d4 43 4e 29 02  a8 0e b8 3d 17 88 84 0c  |+...CN)....=....|
-00000370  2d d0 49 48 ff f5 83 8f  0d da 7f 81 d6 e7 93 d5  |-.IH............|
-00000380  12 c0 59 1c ed b7 35 7f  9e 1f 9c 39 e6 56 ce a2  |..Y...5....9.V..|
-00000390  98 ca 74 72 49 65 7f 69  16 a7 13 67 b3 11 fe 32  |..trIe.i...g...2|
-000003a0  99 23 c6 8f 37 e5 18 e8  5e 3b e3 25 84 cd f5 9f  |.#..7...^;.%....|
-000003b0  de 4c f0 b1 cb 25 31 86  73 07 48 f8 30 7e 7c 7b  |.L...%1.s.H.0~|{|
-000003c0  04 0f a5 5c 15 c2 25 00  43 18 6e 35 17 03 03 00  |...\..%.C.n5....|
-000003d0  45 e0 8a a3 17 a4 5d 29  0d da b8 c1 e8 b9 19 cf  |E.....])........|
-000003e0  4b 08 e6 d8 5c 0e 9e ed  b4 ea cc 95 68 54 6b 4b  |K...\.......hTkK|
-000003f0  0f 1f 32 3e f0 68 10 a1  9f aa 4b 44 86 3f 3b 66  |..2>.h....KD.?;f|
-00000400  08 cd cb d0 92 a2 07 df  64 f9 f2 88 f9 c2 63 9f  |........d.....c.|
-00000410  01 98 a7 58 41 e6                                 |...XA.|
+000000a0  17 03 03 00 17 62 79 8a  7b 99 e8 48 ab 97 44 7c  |.....by.{..H..D||
+000000b0  e1 79 b8 53 a0 a8 d8 38  87 ab 3b f6 17 03 03 02  |.y.S...8..;.....|
+000000c0  6d 19 53 7e 2f b0 c9 42  b1 0d e1 f9 d3 5b ae 1b  |m.S~/..B.....[..|
+000000d0  31 66 13 32 05 c8 af f9  c7 86 78 64 ff a6 1b 78  |1f.2......xd...x|
+000000e0  6c 5e 4f c4 ec 21 9f 61  b2 9b 66 6f d1 97 cc 09  |l^O..!.a..fo....|
+000000f0  ab da 91 be 8b a2 00 9b  60 ae 7b 9d f1 a4 6d 7e  |........`.{...m~|
+00000100  27 3d 18 d7 79 8c 7a bb  5a 7e a7 e6 dd 95 06 ec  |'=..y.z.Z~......|
+00000110  fc 9e 11 45 a8 f8 46 7e  cb 50 5f 24 b8 b9 b9 10  |...E..F~.P_$....|
+00000120  ae 78 0e 42 a6 28 ea 3f  0e f3 ca f2 10 94 84 a9  |.x.B.(.?........|
+00000130  a7 a2 85 25 ce a7 1c 2b  5a 6e 61 06 b6 19 c3 1a  |...%...+Zna.....|
+00000140  5e 42 2b e6 cc 7e 7e 82  30 69 e8 5d e5 01 21 16  |^B+..~~.0i.]..!.|
+00000150  6f e1 e1 f7 1c 77 06 d2  9d 25 80 a4 6d a5 ae 2e  |o....w...%..m...|
+00000160  cd 9a e3 56 34 81 13 51  63 85 f4 45 26 ae 6a 88  |...V4..Qc..E&.j.|
+00000170  4c 3c 00 ec 1b 1a 43 24  c0 e3 79 b3 45 3d c8 9a  |L<....C$..y.E=..|
+00000180  9e 91 69 9b cd 62 43 06  18 71 b6 78 d7 b0 1b d7  |..i..bC..q.x....|
+00000190  a0 42 30 f9 bb 4e f1 90  e0 f0 11 6a c5 03 6e 47  |.B0..N.....j..nG|
+000001a0  3c de 86 e2 0b a6 4f 6b  15 cc 5d 40 51 0f 26 9a  |<.....Ok..]@Q.&.|
+000001b0  5b 16 20 2f d2 d4 58 56  28 23 77 a6 a0 dd cb e5  |[. /..XV(#w.....|
+000001c0  e8 c6 5c 52 2b 26 f6 07  85 c1 39 97 e4 7e c8 b2  |..\R+&....9..~..|
+000001d0  c7 79 c0 fa 81 64 7a 53  9b 72 ef 81 69 12 a3 ba  |.y...dzS.r..i...|
+000001e0  e9 40 6f a5 a0 9f 4d e7  0f 3a a3 1a d5 df 32 ec  |.@o...M..:....2.|
+000001f0  64 28 40 3a b4 87 ea ca  9a 13 60 38 18 23 7b f0  |d(@:......`8.#{.|
+00000200  d8 f0 0f 44 ae c8 ce 2c  8d 48 fd 33 78 f1 28 4a  |...D...,.H.3x.(J|
+00000210  5f db f5 ce 51 a1 9d 80  a2 fd aa 46 3a ff 8f 26  |_...Q......F:..&|
+00000220  c2 4a 8a 31 7c f6 a9 2c  60 49 f2 36 2a 86 ec db  |.J.1|..,`I.6*...|
+00000230  4d 9f 26 cd d8 67 ac b3  6a 63 c0 b6 77 56 cd ed  |M.&..g..jc..wV..|
+00000240  e0 ba ae 45 d4 c8 fb 62  6a 52 46 32 28 49 76 b0  |...E...bjRF2(Iv.|
+00000250  5c f7 17 49 a2 06 cb ee  49 e8 5c 0c 11 b1 4b 55  |\..I....I.\...KU|
+00000260  d4 c4 e2 3e 31 ed 0c eb  84 40 c2 20 3c 40 a6 26  |...>1....@. <@.&|
+00000270  db e7 80 f8 4d 2e 4c fc  67 eb d8 ae 89 70 7f c4  |....M.L.g....p..|
+00000280  18 40 1e 82 df 17 da 49  e0 9c 72 ab 34 04 39 a5  |.@.....I..r.4.9.|
+00000290  1a a3 2b 0b 73 b6 32 89  b5 d1 e4 74 95 f3 58 b0  |..+.s.2....t..X.|
+000002a0  7a 7b d4 c6 e9 7e 68 86  09 5f 94 12 bd fd 84 1f  |z{...~h.._......|
+000002b0  fa 7d 56 cf 40 1a 02 04  90 16 5c da 2f b1 de 15  |.}V.@.....\./...|
+000002c0  31 d9 59 62 3b fe 8e 99  ec 79 51 44 49 0f a5 a1  |1.Yb;....yQDI...|
+000002d0  1f 6d ac e5 b1 93 39 af  50 b4 5e 04 29 31 d7 b8  |.m....9.P.^.)1..|
+000002e0  1a e2 58 37 90 e8 a7 a7  1a f3 bb 14 a6 d2 27 b7  |..X7..........'.|
+000002f0  71 58 f0 0a 94 63 23 4d  d5 4b 22 fd e6 0e 23 9e  |qX...c#M.K"...#.|
+00000300  90 b8 cb d4 10 c7 49 32  7c 8e 49 cd 17 c9 7f 38  |......I2|.I....8|
+00000310  2b e1 38 84 57 25 02 72  a6 d3 f7 28 b2 e3 85 c4  |+.8.W%.r...(....|
+00000320  72 ca e1 b2 84 6a 86 4c  78 d4 8e 1c 60 09 17 03  |r....j.Lx...`...|
+00000330  03 00 99 14 16 3c 69 12  63 89 2f c4 58 1c 95 97  |.....<i.c./.X...|
+00000340  69 d3 ab 0c 69 e1 9f 10  dc 31 9e 8c f3 83 cf e2  |i...i....1......|
+00000350  15 8b 9b dd 67 db 7a f2  03 92 fd 51 64 77 6a 92  |....g.z....Qdwj.|
+00000360  13 44 61 54 ab 0b d3 3f  8f d3 6c fc b0 83 8d 33  |.DaT...?..l....3|
+00000370  eb 03 6f c3 bd fc 17 db  c9 88 3b da e8 46 05 9a  |..o.......;..F..|
+00000380  19 0e dd fa 92 d2 f6 e8  3a 06 2e 73 e1 16 20 e0  |........:..s.. .|
+00000390  0c 95 a5 32 ed 72 54 4c  ef e4 0f 3c 14 21 dd b9  |...2.rTL...<.!..|
+000003a0  58 e4 78 40 98 25 b8 63  b1 a3 c0 8c da f8 d4 c5  |X.x@.%.c........|
+000003b0  eb 8d 68 1d 92 cb e3 c2  9d f5 d9 d9 a3 c3 df c3  |..h.............|
+000003c0  1e 09 a5 e3 a3 9c ab 52  5b 32 fd 18 17 03 03 00  |.......R[2......|
+000003d0  45 32 58 1f a5 fa 66 47  b9 70 4f fb 5b c3 93 14  |E2X...fG.pO.[...|
+000003e0  ee 96 dd ae 16 df 90 43  ab 8b dd a8 30 d4 53 50  |.......C....0.SP|
+000003f0  ac f4 8a 5e fa db 10 34  a0 0c 15 37 92 8f a0 cf  |...^...4...7....|
+00000400  85 f5 ed 2b e9 46 f1 ce  ab f2 94 d4 63 61 46 db  |...+.F......caF.|
+00000410  fb a3 e3 df 37 94                                 |....7.|
 >>> Flow 5 (client to server)
-00000000  17 03 03 00 45 64 f9 84  9e cc d0 58 bd 27 48 4f  |....Ed.....X.'HO|
-00000010  5c fb 26 21 50 37 f7 eb  80 fc 86 a9 a7 00 d7 0f  |\.&!P7..........|
-00000020  c4 4e e8 2d 4a cf 0b 57  34 10 f4 ea df a0 91 31  |.N.-J..W4......1|
-00000030  80 45 78 20 38 1c cd dd  16 5d f5 6c 83 a6 ee f4  |.Ex 8....].l....|
-00000040  24 c7 3f f1 0a f8 2d 78  7e b4                    |$.?...-x~.|
+00000000  17 03 03 00 45 ad 18 70  16 81 4f b3 f5 a2 f3 53  |....E..p..O....S|
+00000010  37 84 03 37 89 be ad c2  fe 02 da 67 a6 b6 fd 1a  |7..7.......g....|
+00000020  9b d4 8b de 8e 80 ab 7d  e1 81 c2 de 31 be 07 04  |.......}....1...|
+00000030  5d 57 59 7a 05 ea f5 7d  aa 7f 8f 23 6c 00 89 4a  |]WYz...}...#l..J|
+00000040  1f 07 8a a3 e8 c7 9b 0e  8a 8b                    |..........|
 >>> Flow 6 (server to client)
-00000000  17 03 03 00 1e fe 3e da  ac 07 b3 a8 37 ca 6d 3a  |......>.....7.m:|
-00000010  21 3a 2e 52 e4 1c ee 1c  49 e8 c5 a4 ef 10 bb 92  |!:.R....I.......|
-00000020  7b 45 ba 17 03 03 00 13  4d f6 22 39 83 19 74 a8  |{E......M."9..t.|
-00000030  86 55 bb 07 4d db 37 a6  f1 9f 13                 |.U..M.7....|
+00000000  17 03 03 00 1e 22 ef 90  a4 90 32 71 67 2a f9 ca  |....."....2qg*..|
+00000010  8c 5d 36 51 05 2d 10 a7  72 e8 95 34 69 0e f2 06  |.]6Q.-..r..4i...|
+00000020  16 15 7e 17 03 03 00 13  15 3b 8b e7 c9 e1 cd c1  |..~......;......|
+00000030  93 f1 34 62 a1 82 9a 91  0b 7c 3a                 |..4b.....|:|
diff --git a/src/crypto/tls/testdata/Server-TLSv13-P256 b/src/crypto/tls/testdata/Server-TLSv13-P256
index 433327be21..1143e9f1ce 100644
--- a/src/crypto/tls/testdata/Server-TLSv13-P256
+++ b/src/crypto/tls/testdata/Server-TLSv13-P256
@@ -1,95 +1,95 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 f9 01 00 00  f5 03 03 9b 17 e9 d1 ef  |................|
-00000010  4d bc 9c 08 44 87 d5 43  09 b5 bd f3 7c a6 52 59  |M...D..C....|.RY|
-00000020  ae d3 af 09 c4 24 18 12  7f 4a 03 20 af 3e 04 1d  |.....$...J. .>..|
-00000030  3a 26 d4 bb 9c 02 71 32  c4 19 a6 ef 46 26 0f d6  |:&....q2....F&..|
-00000040  ab 9e 49 4f b5 06 37 92  7a 0a 37 5e 00 08 13 02  |..IO..7.z.7^....|
+00000000  16 03 01 00 f9 01 00 00  f5 03 03 3c c9 61 89 62  |...........<.a.b|
+00000010  10 c6 ba 45 a5 af c4 8a  02 27 58 b8 74 de 6f 8b  |...E.....'X.t.o.|
+00000020  62 27 b1 71 54 09 c4 48  e4 e6 33 20 dd 11 6b b4  |b'.qT..H..3 ..k.|
+00000030  59 b7 e2 d9 b3 91 01 ab  11 68 65 2e 1d 60 2f 58  |Y........he..`/X|
+00000040  41 a6 7a 94 bc ad fd ff  05 a5 56 cb 00 08 13 02  |A.z.......V.....|
 00000050  13 03 13 01 00 ff 01 00  00 a4 00 00 00 0e 00 0c  |................|
 00000060  00 00 09 31 32 37 2e 30  2e 30 2e 31 00 0b 00 04  |...127.0.0.1....|
 00000070  03 00 01 02 00 0a 00 04  00 02 00 17 00 16 00 00  |................|
 00000080  00 17 00 00 00 0d 00 1e  00 1c 04 03 05 03 06 03  |................|
 00000090  08 07 08 08 08 09 08 0a  08 0b 08 04 08 05 08 06  |................|
 000000a0  04 01 05 01 06 01 00 2b  00 03 02 03 04 00 2d 00  |.......+......-.|
-000000b0  02 01 01 00 33 00 47 00  45 00 17 00 41 04 ec c3  |....3.G.E...A...|
-000000c0  f4 ab c7 58 b2 1c b4 8d  d9 62 5f eb b9 b8 8f 33  |...X.....b_....3|
-000000d0  e3 77 4a e5 57 1d 03 ce  2b bb 9d e6 b3 e4 b6 b6  |.wJ.W...+.......|
-000000e0  10 01 03 df c6 b4 ac 26  c8 58 9a a8 97 1d e7 92  |.......&.X......|
-000000f0  15 d3 78 a4 40 12 8f e1  c0 0a 80 2b 06 c5        |..x.@......+..|
+000000b0  02 01 01 00 33 00 47 00  45 00 17 00 41 04 50 4f  |....3.G.E...A.PO|
+000000c0  1c 9c 0f 11 5a f0 a0 54  82 44 5b 82 95 e1 0a 1d  |....Z..T.D[.....|
+000000d0  56 23 a1 7a ee e8 ee ef  8d 28 be 21 c2 dd c9 05  |V#.z.....(.!....|
+000000e0  13 bc 6b 0a 69 15 95 4e  e3 f9 6a 75 ef 4d 96 12  |..k.i..N..ju.M..|
+000000f0  d0 c9 46 78 d7 9d a2 80  0a b7 c8 3f bd c2        |..Fx.......?..|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 9b 02 00 00  97 03 03 00 00 00 00 00  |................|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000020  00 00 00 00 00 00 00 00  00 00 00 20 af 3e 04 1d  |........... .>..|
-00000030  3a 26 d4 bb 9c 02 71 32  c4 19 a6 ef 46 26 0f d6  |:&....q2....F&..|
-00000040  ab 9e 49 4f b5 06 37 92  7a 0a 37 5e 13 02 00 00  |..IO..7.z.7^....|
+00000020  00 00 00 00 00 00 00 00  00 00 00 20 dd 11 6b b4  |........... ..k.|
+00000030  59 b7 e2 d9 b3 91 01 ab  11 68 65 2e 1d 60 2f 58  |Y........he..`/X|
+00000040  41 a6 7a 94 bc ad fd ff  05 a5 56 cb 13 02 00 00  |A.z.......V.....|
 00000050  4f 00 2b 00 02 03 04 00  33 00 45 00 17 00 41 04  |O.+.....3.E...A.|
 00000060  1e 18 37 ef 0d 19 51 88  35 75 71 b5 e5 54 5b 12  |..7...Q.5uq..T[.|
 00000070  2e 8f 09 67 fd a7 24 20  3e b2 56 1c ce 97 28 5e  |...g..$ >.V...(^|
 00000080  f8 2b 2d 4f 9e f1 07 9f  6c 4b 5b 83 56 e2 32 42  |.+-O....lK[.V.2B|
 00000090  e9 58 b6 d7 49 a6 b5 68  1a 41 03 56 6b dc 5a 89  |.X..I..h.A.Vk.Z.|
-000000a0  17 03 03 00 17 42 79 da  18 8e 38 c1 2c a4 2a 9c  |.....By...8.,.*.|
-000000b0  fd 94 6a a6 b3 08 51 aa  7b 2d 19 a7 17 03 03 02  |..j...Q.{-......|
-000000c0  6d 57 f7 92 34 01 09 13  e8 f8 ef 75 ad ba e8 a5  |mW..4......u....|
-000000d0  9b cd e9 6c ab 48 b5 4d  33 1e 0b 95 47 74 78 9d  |...l.H.M3...Gtx.|
-000000e0  3c bb 27 a8 87 1c fb 11  80 91 93 ad 0f 0d 1c 98  |<.'.............|
-000000f0  44 cc 36 bc 00 0d eb c0  8b 73 40 11 dd c5 9a a9  |D.6......s@.....|
-00000100  90 55 81 e8 55 69 e0 73  97 49 c3 2b ee 56 3c c0  |.U..Ui.s.I.+.V<.|
-00000110  c3 b7 4a 18 a3 e4 45 c9  7f 0c 7d ba b4 52 9a a8  |..J...E...}..R..|
-00000120  b1 26 4e 57 3b fb 5b 30  28 b0 95 c9 72 35 2d 10  |.&NW;.[0(...r5-.|
-00000130  24 8e 70 bb c6 2a 33 83  1c 78 c1 91 c4 6b 06 c0  |$.p..*3..x...k..|
-00000140  d0 65 b5 d5 21 21 02 21  86 df 24 d0 99 90 24 12  |.e..!!.!..$...$.|
-00000150  9f c8 a4 8d e9 29 5c 84  52 82 4b 11 a6 de 7f 88  |.....)\.R.K.....|
-00000160  d9 35 b3 1b d5 c9 0a 54  f2 64 a7 43 13 19 61 0f  |.5.....T.d.C..a.|
-00000170  28 11 39 3f b1 2a 49 f7  0f de cb f8 ff ad b6 90  |(.9?.*I.........|
-00000180  5a af 2a 17 9a 40 c7 c8  32 88 5d e1 af 54 92 3a  |Z.*..@..2.]..T.:|
-00000190  8b b9 8a 50 93 dd 73 89  cf 0f bf ae 7e ad ba bf  |...P..s.....~...|
-000001a0  ed 2a f1 47 e0 e5 77 92  27 e5 5b bd 7f 7e a5 47  |.*.G..w.'.[..~.G|
-000001b0  af dd d7 ab 72 db 1a bb  83 f8 18 ba 46 92 74 a2  |....r.......F.t.|
-000001c0  9e 7a 5c 4d e8 b9 c0 6e  ed 20 6d ec 8f 3d 65 d6  |.z\M...n. m..=e.|
-000001d0  d5 48 4b 24 14 00 10 2c  f2 31 c1 94 ce b6 f8 e2  |.HK$...,.1......|
-000001e0  e1 d3 8c e7 38 3c 4b 34  1f 78 8d e0 9b d3 9d 21  |....8<K4.x.....!|
-000001f0  44 c7 02 59 47 5b c1 25  83 19 f3 7c 0c b3 ca a6  |D..YG[.%...|....|
-00000200  1f 64 1b 4d 37 24 a8 b3  e4 e2 b9 be 68 c9 8a 80  |.d.M7$......h...|
-00000210  15 6d 71 70 7d 15 51 26  b5 e8 cc 99 51 ee a6 34  |.mqp}.Q&....Q..4|
-00000220  ab 5d 7b 0a f6 3c 30 9e  a5 e1 fe ff 38 fb 5c 09  |.]{..<0.....8.\.|
-00000230  28 84 d2 67 52 5a 79 b6  9e a0 9a fe d2 93 cc 9b  |(..gRZy.........|
-00000240  31 90 a1 b4 c6 0f b9 50  73 b2 52 39 ff 6e 16 a1  |1......Ps.R9.n..|
-00000250  78 29 1c 30 c1 8f 76 81  08 e9 96 a2 3c 8e 17 94  |x).0..v.....<...|
-00000260  05 15 2c 46 11 b7 23 1d  10 75 43 68 f2 97 49 12  |..,F..#..uCh..I.|
-00000270  d3 e2 a9 08 25 e8 c1 2b  b8 ee 5f a3 bc 9e 88 92  |....%..+.._.....|
-00000280  21 1b da 9a c4 cd f1 53  8b a7 ca d3 4b de d4 61  |!......S....K..a|
-00000290  64 8b 67 42 43 99 fd cc  c6 6f ac c0 9d 48 2c 79  |d.gBC....o...H,y|
-000002a0  89 cf f2 3a 88 86 3d 40  a3 a6 07 6e 05 88 3d 60  |...:..=@...n..=`|
-000002b0  e7 b1 5b a5 47 5d 36 b2  1e 68 c7 d2 8d 5f 1e 1d  |..[.G]6..h..._..|
-000002c0  2c c3 77 f1 31 7c 2f bc  a1 4b f3 96 cd a9 45 18  |,.w.1|/..K....E.|
-000002d0  9c 19 72 52 39 2d bf 84  05 b8 d0 2b 3c 5d f5 c7  |..rR9-.....+<]..|
-000002e0  cc 7b f7 ca 17 68 e3 53  f8 64 68 01 a3 76 5a a1  |.{...h.S.dh..vZ.|
-000002f0  e9 65 95 72 bc 89 98 7a  e4 d4 d6 12 e7 83 23 4c  |.e.r...z......#L|
-00000300  03 28 b4 62 0d c9 16 16  cd 85 7e 87 5f ac f7 62  |.(.b......~._..b|
-00000310  04 d3 9d 99 a4 e9 93 16  39 c5 88 b5 52 21 8f 87  |........9...R!..|
-00000320  82 bb 77 32 10 36 2a ca  d7 7b ab 8a 42 e0 17 03  |..w2.6*..{..B...|
-00000330  03 00 99 3a bf a3 34 93  48 fb 05 37 66 85 cd 71  |...:..4.H..7f..q|
-00000340  03 a1 6a 3a 67 f7 f8 12  ce 2e e6 21 08 b9 68 c1  |..j:g......!..h.|
-00000350  f3 21 20 fe 5f 43 dc 29  5b 15 70 04 25 26 db ae  |.! ._C.)[.p.%&..|
-00000360  c9 52 03 1d d7 82 77 73  9f 18 76 07 db 48 85 f4  |.R....ws..v..H..|
-00000370  cb d7 cb 26 ce 74 2d 92  74 67 5c 59 d7 ec 35 a1  |...&.t-.tg\Y..5.|
-00000380  59 e6 24 1b 16 a0 7b 3a  71 80 a4 53 af 84 9b 63  |Y.$...{:q..S...c|
-00000390  bd 50 38 0f da aa b6 da  c8 d2 12 94 f2 83 12 d7  |.P8.............|
-000003a0  9b e6 7b d2 91 b0 e7 dd  27 ec 47 19 94 0e 7e a2  |..{.....'.G...~.|
-000003b0  43 07 78 ed 73 c9 33 55  52 9a 34 c1 64 c0 a7 5d  |C.x.s.3UR.4.d..]|
-000003c0  82 8b c0 c7 da c9 9f cf  64 06 d4 1e 17 03 03 00  |........d.......|
-000003d0  45 bf 5b 5a 59 de 6a 6a  69 5c f0 9d 1c e1 5c b9  |E.[ZY.jji\....\.|
-000003e0  e3 3c d1 64 b3 83 d0 3c  7b 11 e4 db 34 00 2a f7  |.<.d...<{...4.*.|
-000003f0  3a 15 ca 90 0f e9 37 39  ac d0 c6 aa fd ef 3b 5d  |:.....79......;]|
-00000400  29 97 4c 24 cb 4a 56 a1  db 77 80 b3 75 f5 1b 2f  |).L$.JV..w..u../|
-00000410  4a 54 8f 2e 0c c2                                 |JT....|
+000000a0  14 03 03 00 01 01 17 03  03 00 17 de 95 cd 3c b2  |..............<.|
+000000b0  4b 8b c7 43 28 60 d9 2b  83 21 fb 51 a7 ec 71 d6  |K..C(`.+.!.Q..q.|
+000000c0  de 03 17 03 03 02 6d bf  85 6f 36 00 4d 35 bd 40  |......m..o6.M5.@|
+000000d0  23 73 df 49 94 c8 92 6f  6a 71 3b 4f 82 54 74 60  |#s.I...ojq;O.Tt`|
+000000e0  d3 02 7e 99 85 f1 80 f4  cd fb a7 e4 9e 05 91 ef  |..~.............|
+000000f0  25 e9 23 fc db 3e b0 1f  4a d0 0b 1f 46 da 6b bc  |%.#..>..J...F.k.|
+00000100  6a e0 53 65 60 1e f5 cc  8b 01 be 1c 3b d9 a9 41  |j.Se`.......;..A|
+00000110  ef de eb 8b 73 f6 6d e4  ee 5d 97 c6 b7 2f 50 99  |....s.m..].../P.|
+00000120  c7 84 05 f1 80 13 d7 00  c6 05 d7 16 d0 bf 26 44  |..............&D|
+00000130  ad 94 47 f2 48 12 86 54  07 25 01 5f 97 b2 5e 11  |..G.H..T.%._..^.|
+00000140  6d cf 90 cb 91 f1 1e 9f  50 df 8d 2e 67 4c 12 08  |m.......P...gL..|
+00000150  2d 36 e6 b1 15 e4 b5 55  32 df ab 3a ec ae 2e ee  |-6.....U2..:....|
+00000160  98 31 32 38 73 fc 6c 65  a8 05 ef 91 4a 3a 90 22  |.128s.le....J:."|
+00000170  1b 92 df 65 b3 ce 94 b8  18 f5 25 a1 a3 bd a8 c6  |...e......%.....|
+00000180  33 ec ad 61 b9 0e 31 49  7d 43 cc 52 2e da 63 7b  |3..a..1I}C.R..c{|
+00000190  40 b2 40 6d 64 c5 f4 9c  96 7e 82 22 56 bc f1 57  |@.@md....~."V..W|
+000001a0  2f 10 f9 b2 b0 19 18 de  03 b7 29 1d 6e 6a df 1c  |/.........).nj..|
+000001b0  c9 78 02 4b 67 d5 c5 98  32 3f 6c a9 d5 50 3c e3  |.x.Kg...2?l..P<.|
+000001c0  4f 8e 75 84 e5 91 da 27  a0 0a d5 93 69 c7 2a 81  |O.u....'....i.*.|
+000001d0  85 10 d3 60 f8 51 83 02  fe fc da 00 60 47 be 67  |...`.Q......`G.g|
+000001e0  b3 61 c8 41 84 d1 45 cf  2f fa a6 01 e6 33 09 0d  |.a.A..E./....3..|
+000001f0  d9 a7 61 e0 44 cb e1 16  ad ec f0 65 9f bb 97 95  |..a.D......e....|
+00000200  76 ce 01 27 ae f0 c1 20  9c 2a 73 45 2c 06 33 59  |v..'... .*sE,.3Y|
+00000210  a6 d6 14 da 37 70 33 a7  9a 8e de 31 ff ce 4c 33  |....7p3....1..L3|
+00000220  5f 0e 4a 29 a0 ee 3a 06  cd f6 ae 03 74 e1 0a 95  |_.J)..:.....t...|
+00000230  22 68 0d c2 af 1b 40 ab  7c e2 8a 3a a1 36 ae 99  |"h....@.|..:.6..|
+00000240  79 ba 41 0a d6 91 04 dd  76 47 c7 a7 75 75 ab 24  |y.A.....vG..uu.$|
+00000250  c7 c4 c0 cd 5e ca 8f ae  9c cd 0a dd e1 8e 47 46  |....^.........GF|
+00000260  9e bd 48 aa 1e 10 d0 d0  e9 ee dd 10 52 c5 66 ad  |..H.........R.f.|
+00000270  9a 16 e4 af 96 13 3f b0  b3 75 6e b0 08 05 29 52  |......?..un...)R|
+00000280  c1 a7 60 f8 c3 08 fb 04  02 25 17 82 61 31 7a 5f  |..`......%..a1z_|
+00000290  39 bb de e7 59 d1 14 a7  40 65 24 6f 23 5b 10 81  |9...Y...@e$o#[..|
+000002a0  2c 02 b0 90 49 ef 12 1e  cd 97 0a bc 30 45 37 06  |,...I.......0E7.|
+000002b0  08 e0 47 0c b5 d1 39 6f  de e2 8a 00 75 ae 0b 66  |..G...9o....u..f|
+000002c0  f0 c7 7b a0 e1 9e 76 7b  eb 54 e2 04 cb 8f 76 77  |..{...v{.T....vw|
+000002d0  30 8e e6 ec 02 8c 86 00  cb c5 47 69 66 77 cd d9  |0.........Gifw..|
+000002e0  25 d6 30 f3 2e de f9 70  ee 52 20 0c 2f 85 87 42  |%.0....p.R ./..B|
+000002f0  5e 8b ee 63 b9 15 0a 09  b9 2d 11 c3 5f ab 9e b7  |^..c.....-.._...|
+00000300  33 a8 96 4a 11 9d e3 d3  c3 18 5e 35 b3 dd 88 21  |3..J......^5...!|
+00000310  c2 4d 93 07 75 66 b2 d8  2a 6e 1e 27 7a 37 2f 10  |.M..uf..*n.'z7/.|
+00000320  b4 3b 10 d7 4a 35 6d 16  ae 87 2e cc 07 e5 37 76  |.;..J5m.......7v|
+00000330  8e 27 00 f3 17 03 03 00  99 9a b6 00 63 9d fb b6  |.'..........c...|
+00000340  81 3f ab ed e9 74 6d 58  33 10 f0 fb 2c ef 95 ed  |.?...tmX3...,...|
+00000350  92 9e e2 7d 86 e0 9d 98  49 29 ee 90 0c 47 2d 0d  |...}....I)...G-.|
+00000360  d0 b9 5b 39 ce 3b 84 b4  e5 1c 8a 0b 7c a7 a6 ab  |..[9.;......|...|
+00000370  cf 26 d4 07 a3 94 b8 06  65 e1 63 fe 23 67 a0 60  |.&......e.c.#g.`|
+00000380  4f d8 81 33 7e 98 d0 0a  ec b4 36 2f e7 00 bf e3  |O..3~.....6/....|
+00000390  5e 83 d2 84 11 b5 8a c9  74 9c 7a 02 0a 26 28 cb  |^.......t.z..&(.|
+000003a0  d1 2d 76 8c 9c 23 55 a6  1a e9 55 6a e2 15 33 50  |.-v..#U...Uj..3P|
+000003b0  d0 f1 0f 45 7b bc 8b a8  1e 70 a3 9b d3 d0 a1 69  |...E{....p.....i|
+000003c0  3b 02 3d 59 f6 fa c5 5f  2f 75 b8 b5 cc d5 65 2e  |;.=Y..._/u....e.|
+000003d0  d1 0e 17 03 03 00 45 db  a5 de 00 16 ca e3 c9 93  |......E.........|
+000003e0  8e 2d 23 9b f4 ba 46 69  bb cb 40 6d 0f ef bf 2f  |.-#...Fi..@m.../|
+000003f0  ff ec 58 e7 3a 36 13 1c  dd ae 1e 1c 3b ca c4 1c  |..X.:6......;...|
+00000400  fd 2a f7 9d 00 eb 9f 76  1d ec 9a 61 ef 57 2e d0  |.*.....v...a.W..|
+00000410  ec 29 c6 35 e0 72 c5 fc  5c ae fa 55              |.).5.r..\..U|
 >>> Flow 3 (client to server)
-00000000  14 03 03 00 01 01 17 03  03 00 45 b1 15 d9 f0 b0  |..........E.....|
-00000010  cf 81 8f de 00 84 97 be  1b 6f af 52 3b d2 34 1b  |.........o.R;.4.|
-00000020  4d bb d3 b8 c2 09 60 21  e1 61 d3 d9 a1 80 68 77  |M.....`!.a....hw|
-00000030  6c 37 6a 87 0e e7 b7 de  fe b6 70 eb d3 36 92 c3  |l7j.......p..6..|
-00000040  e9 e9 02 e9 cf d0 d4 be  75 9b f3 84 51 fe da 78  |........u...Q..x|
+00000000  14 03 03 00 01 01 17 03  03 00 45 b5 0b 9f e1 e1  |..........E.....|
+00000010  0e a8 3c 22 83 fb 13 2a  d9 cc 96 32 15 d8 fb 1a  |..<"...*...2....|
+00000020  0b b2 ee 87 2b 50 a6 76  0a 07 a1 41 8b 8f f1 bb  |....+P.v...A....|
+00000030  b8 03 eb 77 c0 96 b9 5e  4c 2e 6b 9a 2f 7e 3e 8d  |...w...^L.k./~>.|
+00000040  aa 10 a4 ce 0f 83 d1 25  52 8e 91 98 bc 09 a3 a5  |.......%R.......|
 >>> Flow 4 (server to client)
-00000000  17 03 03 00 1e 7f 61 7b  92 ca 8f 9e c7 96 b0 a5  |......a{........|
-00000010  9b 3f cf c3 0e 7a 8d 2c  9f 5c 40 8a 99 6d 71 45  |.?...z.,.\@..mqE|
-00000020  9a 9c 96 17 03 03 00 13  01 42 62 3a 49 1a b5 5b  |.........Bb:I..[|
-00000030  43 0f ec 5b 46 0a e9 1c  6f a6 e2                 |C..[F...o..|
+00000000  17 03 03 00 1e 59 88 46  14 c1 2e 42 5d 1c 37 37  |.....Y.F...B].77|
+00000010  d7 83 5f 82 39 bf 29 6d  21 0a 4c 4f 19 91 b1 4f  |.._.9.)m!.LO...O|
+00000020  60 f6 97 17 03 03 00 13  a0 ca 1d 58 c1 29 96 42  |`..........X.).B|
+00000030  48 31 2d 9b 77 77 f8 f1  14 7b b2                 |H1-.ww...{.|
diff --git a/src/crypto/tls/testdata/Server-TLSv13-RSA-RSAPSS b/src/crypto/tls/testdata/Server-TLSv13-RSA-RSAPSS
index 01cc23032a..b3ff6f2aec 100644
--- a/src/crypto/tls/testdata/Server-TLSv13-RSA-RSAPSS
+++ b/src/crypto/tls/testdata/Server-TLSv13-RSA-RSAPSS
@@ -1,90 +1,90 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 c6 01 00 00  c2 03 03 f0 a4 89 8f b9  |................|
-00000010  fd ba d7 9f 2d ca bf f0  7a 6e 04 6a b4 54 9d f4  |....-...zn.j.T..|
-00000020  dd b5 e5 c9 f7 4f e1 a4  0c a9 72 20 57 d4 f7 3a  |.....O....r W..:|
-00000030  88 0a d3 95 c7 3a 4c 7c  e3 0c ac 99 bc 24 d7 ad  |.....:L|.....$..|
-00000040  3f 53 07 08 00 aa c3 e5  2c 2b d3 2f 00 08 13 02  |?S......,+./....|
+00000000  16 03 01 00 c6 01 00 00  c2 03 03 e9 1f 49 f4 6e  |.............I.n|
+00000010  6a 47 e9 46 ae 43 1b b4  00 98 20 27 a7 a6 21 76  |jG.F.C.... '..!v|
+00000020  fc 6b 35 d7 12 33 28 fb  2d 00 69 20 c9 28 5e 43  |.k5..3(.-.i .(^C|
+00000030  c9 36 a0 b9 c4 68 0f fd  d3 ce c6 39 3c 17 26 b1  |.6...h.....9<.&.|
+00000040  4c d5 36 50 59 fd cd 47  8f 43 eb 33 00 08 13 02  |L.6PY..G.C.3....|
 00000050  13 03 13 01 00 ff 01 00  00 71 00 00 00 0e 00 0c  |.........q......|
 00000060  00 00 09 31 32 37 2e 30  2e 30 2e 31 00 0b 00 04  |...127.0.0.1....|
 00000070  03 00 01 02 00 0a 00 0c  00 0a 00 1d 00 17 00 1e  |................|
 00000080  00 19 00 18 00 16 00 00  00 17 00 00 00 0d 00 04  |................|
 00000090  00 02 08 04 00 2b 00 03  02 03 04 00 2d 00 02 01  |.....+......-...|
-000000a0  01 00 33 00 26 00 24 00  1d 00 20 ef 5d 96 0f 42  |..3.&.$... .]..B|
-000000b0  9a fe c1 40 ee 31 cd 34  6d 11 d2 ad e9 99 9b b6  |...@.1.4m.......|
-000000c0  70 27 8f dc 81 c2 a6 ac  90 3f 4b                 |p'.......?K|
+000000a0  01 00 33 00 26 00 24 00  1d 00 20 a4 ab a1 75 b6  |..3.&.$... ...u.|
+000000b0  95 db 0e d6 fd 95 57 3b  3f 08 5e cd cc 19 d0 7b  |......W;?.^....{|
+000000c0  7b cd 67 34 d3 da 65 e5  e6 8d 0c                 |{.g4..e....|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 7a 02 00 00  76 03 03 00 00 00 00 00  |....z...v.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000020  00 00 00 00 00 00 00 00  00 00 00 20 57 d4 f7 3a  |........... W..:|
-00000030  88 0a d3 95 c7 3a 4c 7c  e3 0c ac 99 bc 24 d7 ad  |.....:L|.....$..|
-00000040  3f 53 07 08 00 aa c3 e5  2c 2b d3 2f 13 02 00 00  |?S......,+./....|
+00000020  00 00 00 00 00 00 00 00  00 00 00 20 c9 28 5e 43  |........... .(^C|
+00000030  c9 36 a0 b9 c4 68 0f fd  d3 ce c6 39 3c 17 26 b1  |.6...h.....9<.&.|
+00000040  4c d5 36 50 59 fd cd 47  8f 43 eb 33 13 02 00 00  |L.6PY..G.C.3....|
 00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 2f  |..+.....3.$... /|
 00000060  e5 7d a3 47 cd 62 43 15  28 da ac 5f bb 29 07 30  |.}.G.bC.(.._.).0|
-00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 17  |.........._X.;t.|
-00000080  03 03 00 17 e9 da 29 cf  f2 21 32 b3 92 c0 18 5b  |......)..!2....[|
-00000090  26 f6 c8 ed eb 67 5c 9c  df 5c f2 17 03 03 02 6d  |&....g\..\.....m|
-000000a0  c8 d6 15 36 38 ef 64 62  1b 49 c8 c9 bc ce f7 99  |...68.db.I......|
-000000b0  da da 8e d0 2f 98 b1 cf  9a fa 53 cf 8a 20 11 6c  |..../.....S.. .l|
-000000c0  25 10 fc fd b2 f1 22 ea  42 64 21 b5 2f 94 9a 0a  |%.....".Bd!./...|
-000000d0  d3 3e 3b 14 4e b1 d1 3e  fb 40 03 54 af d3 9e ea  |.>;.N..>.@.T....|
-000000e0  c8 fb b2 ed ff fa c1 1d  7e 72 fb bd dd 04 b2 0c  |........~r......|
-000000f0  ac 33 4c 1b e4 65 2f 91  c1 3e f1 1a 8f e0 92 23  |.3L..e/..>.....#|
-00000100  3a 4d 04 f2 4f 14 d4 bb  fe f7 fe 6a 69 8b aa 15  |:M..O......ji...|
-00000110  c4 97 dd 06 3c 79 1c c9  aa 77 51 ac 95 8e 50 f8  |....<y...wQ...P.|
-00000120  0c b4 d1 b7 1e 3d 68 8b  4e e7 28 c3 df 79 3f 66  |.....=h.N.(..y?f|
-00000130  31 a5 06 28 8d 3f 49 d6  de fd 32 dd 10 79 5e d5  |1..(.?I...2..y^.|
-00000140  77 4e 88 20 b5 e1 cc 96  b9 73 23 ca 09 25 30 3e  |wN. .....s#..%0>|
-00000150  2a be aa 06 e7 22 cd 8c  f1 46 2a 54 6e 54 bf 90  |*...."...F*TnT..|
-00000160  89 01 5e e4 e2 aa 7b d7  bc e9 37 d4 ee 75 18 57  |..^...{...7..u.W|
-00000170  0c f7 8b fb 70 b2 cc 1c  e2 ed 64 20 22 56 7a d3  |....p.....d "Vz.|
-00000180  24 eb 25 0d 29 6f 8b be  5a 99 89 eb aa 04 18 8c  |$.%.)o..Z.......|
-00000190  bd c8 b3 95 57 5d 5b 00  55 d8 ef a0 22 f8 cb 26  |....W][.U..."..&|
-000001a0  8d e0 9a 25 a7 77 6d 25  27 c3 aa 75 f7 51 15 c5  |...%.wm%'..u.Q..|
-000001b0  30 72 57 ef d4 41 3e cf  dd fc 77 d9 d8 08 41 87  |0rW..A>...w...A.|
-000001c0  b6 9a 06 c6 f2 00 c5 a2  14 e9 f3 52 91 65 db 69  |...........R.e.i|
-000001d0  a7 2e fb 32 5c 3f 13 c8  ea 65 3a 3a 4d 65 a9 69  |...2\?...e::Me.i|
-000001e0  3f 7b f8 7c ee 1e a2 87  81 10 5c 7f 8d 37 1a 75  |?{.|......\..7.u|
-000001f0  29 8a 78 58 8a d7 f7 af  75 ee 3d f2 58 c2 de a5  |).xX....u.=.X...|
-00000200  60 e7 f9 a3 a1 66 cf df  76 2f 2a cf 5e 6e 80 a3  |`....f..v/*.^n..|
-00000210  47 16 c9 c9 d1 b5 02 38  63 0a 86 fc f2 e8 0b 16  |G......8c.......|
-00000220  d6 43 8e d1 68 b8 01 a0  63 69 01 c8 d3 1e eb 48  |.C..h...ci.....H|
-00000230  28 5e 82 24 3a 19 62 f2  48 65 13 82 77 8c 9a ca  |(^.$:.b.He..w...|
-00000240  69 84 27 4d fd 88 81 79  74 8a a7 ef 2e be 6c c7  |i.'M...yt.....l.|
-00000250  89 9d 19 ab 44 fa 35 99  cc 8e af c3 c0 98 85 85  |....D.5.........|
-00000260  e7 92 45 84 39 c3 2d 27  a1 55 98 81 3a 09 1f f3  |..E.9.-'.U..:...|
-00000270  9a 86 e5 53 f4 7d 35 8d  1f 2e 06 ef ed bf eb cb  |...S.}5.........|
-00000280  54 41 b7 9c d9 df 1b 75  00 f3 81 29 27 e4 ed 90  |TA.....u...)'...|
-00000290  bd 16 39 96 15 22 c3 19  35 5c 88 db 00 05 38 77  |..9.."..5\....8w|
-000002a0  8e ef 42 f5 b2 8c 0a 6c  7f 38 7a f7 c1 13 a6 3d  |..B....l.8z....=|
-000002b0  80 3c 62 aa 26 d0 80 08  31 b0 f4 84 36 c1 8d 51  |.<b.&...1...6..Q|
-000002c0  6b 8c cd d7 e8 fa 95 8e  33 1d 33 16 a4 3f a9 85  |k.......3.3..?..|
-000002d0  cc 37 5e b9 29 4d ba 06  55 31 c5 4f c3 bd 91 f2  |.7^.)M..U1.O....|
-000002e0  8e c6 b7 a5 2d 58 09 fc  49 a5 74 1f 29 3d 4c 01  |....-X..I.t.)=L.|
-000002f0  73 6f a8 ae 1e af d8 91  2a 5b a0 69 59 91 03 92  |so......*[.iY...|
-00000300  bc d3 a0 f5 dd 1d 33 f2  a1 89 14 be 4a 17 03 03  |......3.....J...|
-00000310  00 99 d1 cc 25 8c e1 97  49 3f bf 3a cc b7 f1 84  |....%...I?.:....|
-00000320  16 7e 07 3c 18 f1 40 99  8f f4 ad 33 75 9d b5 c9  |.~.<..@....3u...|
-00000330  5b fe 17 e6 b1 4c 34 2d  02 67 16 1d 54 7a 0b 2e  |[....L4-.g..Tz..|
-00000340  ae 28 fd a0 a6 15 a0 ed  b1 12 19 6e 42 87 f9 96  |.(.........nB...|
-00000350  0e 7d 5e 4e 03 5b a0 c8  36 8f ed 4a 9b 87 3f 09  |.}^N.[..6..J..?.|
-00000360  c3 d0 4a e0 56 b7 fa fd  2b 3d 09 b9 d8 27 39 d9  |..J.V...+=...'9.|
-00000370  ff ab 4a 37 e6 5a 0f 74  3b c7 b2 56 5b c3 b6 34  |..J7.Z.t;..V[..4|
-00000380  0c 94 d2 0f 81 21 41 62  63 8c c4 19 38 3a 98 a6  |.....!Abc...8:..|
-00000390  4f 60 7e 38 bb 05 f9 06  17 31 cb b7 a5 ed 96 7c  |O`~8.....1.....||
-000003a0  9f 8f 87 f2 6d 53 84 e1  9c bd 9c 17 03 03 00 45  |....mS.........E|
-000003b0  8f 46 b9 62 e1 e3 a4 80  ac d7 63 17 6d 5c 9e 40  |.F.b......c.m\.@|
-000003c0  ef 8d 18 98 39 6c 3f 75  5a dc e5 d5 c5 55 d3 b5  |....9l?uZ....U..|
-000003d0  53 2d 4b 1e 04 50 30 a6  f2 a2 e4 db 15 40 25 fb  |S-K..P0......@%.|
-000003e0  b7 51 9c 24 cd 01 33 13  87 c4 35 04 db 28 67 a6  |.Q.$..3...5..(g.|
-000003f0  0f 6f 62 13 1f                                    |.ob..|
+00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 14  |.........._X.;t.|
+00000080  03 03 00 01 01 17 03 03  00 17 24 64 74 26 90 fe  |..........$dt&..|
+00000090  68 e7 db 87 79 32 3b 7c  2c e8 2e 2d d0 d1 d2 97  |h...y2;|,..-....|
+000000a0  62 17 03 03 02 6d 41 22  d8 7d 6c 44 d0 6e 2b 79  |b....mA".}lD.n+y|
+000000b0  bd d5 56 10 2a a6 41 c4  7f 2c 1f 01 b5 3a b2 e7  |..V.*.A..,...:..|
+000000c0  44 6f c2 d2 2b 83 74 80  46 8e 7e 24 81 b0 8e c4  |Do..+.t.F.~$....|
+000000d0  f0 90 03 89 03 b1 89 c5  28 b4 cc bc 3d df a9 25  |........(...=..%|
+000000e0  db f5 f1 1c f2 f3 04 15  d6 f7 f7 c3 03 24 dd e0  |.............$..|
+000000f0  19 22 62 67 3a 80 f8 f7  83 ca 5c 3f eb 9b 6e 98  |."bg:.....\?..n.|
+00000100  8a 2f ba c2 ed bc dd 28  75 1f a2 27 42 89 39 3e  |./.....(u..'B.9>|
+00000110  01 e0 88 73 0f bb f4 cc  7c 75 3a 3f b4 68 04 be  |...s....|u:?.h..|
+00000120  4e d7 c2 2c 8d 41 df 6c  44 b3 1b 35 dc 46 36 3f  |N..,.A.lD..5.F6?|
+00000130  f0 dc e4 cc c3 ca 3b bf  3f fa bf 87 7c 2e 65 e1  |......;.?...|.e.|
+00000140  d3 4b 2c 2a 6b 1a 57 8c  76 06 53 02 ef 79 d4 6f  |.K,*k.W.v.S..y.o|
+00000150  93 f0 36 f9 cb 13 05 b3  8c 22 16 fd 0a c2 e8 45  |..6......".....E|
+00000160  fa 46 e7 ce f2 35 9f 32  88 97 67 46 e9 0c 13 77  |.F...5.2..gF...w|
+00000170  30 b8 f3 59 71 e6 65 4f  f5 5b 06 6e 9a 7f 7a 24  |0..Yq.eO.[.n..z$|
+00000180  c5 e6 05 eb 8a ec 4d 0f  73 2c 6d aa 54 3d 5c 40  |......M.s,m.T=\@|
+00000190  44 68 7f e6 52 b1 02 37  8c a0 be c8 3a f0 74 85  |Dh..R..7....:.t.|
+000001a0  4e 0a 20 46 6c 3c 42 e7  94 18 02 30 a7 43 e7 c9  |N. Fl<B....0.C..|
+000001b0  11 c0 19 45 39 04 64 66  3e 9c 2a e4 bb 86 b8 92  |...E9.df>.*.....|
+000001c0  3d 77 1e 4e 13 51 7e 38  ba 06 b1 62 99 6c 98 8d  |=w.N.Q~8...b.l..|
+000001d0  87 b4 59 01 93 d3 84 80  6f e6 07 18 e0 a3 07 5d  |..Y.....o......]|
+000001e0  b7 97 1a 8b ed 78 20 d1  28 0e 60 dc 51 37 b1 07  |.....x .(.`.Q7..|
+000001f0  81 b1 0b d8 81 f4 79 bf  3d ae 60 32 22 2b c5 9c  |......y.=.`2"+..|
+00000200  d1 37 3a f8 71 22 49 c2  a7 1e 5a 56 c1 c4 b4 5d  |.7:.q"I...ZV...]|
+00000210  2a 08 60 c6 75 2a 10 3e  c0 84 77 dd 1d a6 be 8c  |*.`.u*.>..w.....|
+00000220  a7 2a 20 6b e1 20 bb bd  03 fb c1 2c 33 fb 97 64  |.* k. .....,3..d|
+00000230  88 31 75 df 6e b3 49 dd  e8 f2 b8 13 ca d5 24 40  |.1u.n.I.......$@|
+00000240  e6 0b e5 7e 12 cb 20 60  b0 0a 72 b6 a5 93 2d ea  |...~.. `..r...-.|
+00000250  74 22 48 b7 7e 10 bf 81  55 eb 3d 0c 33 f6 37 66  |t"H.~...U.=.3.7f|
+00000260  04 2a 1b 9c 3e 0a 06 0d  53 88 f0 cf 4f 52 c4 a1  |.*..>...S...OR..|
+00000270  31 ff b0 8e 5c 8e c3 cc  0d a1 68 cb f6 2e 0f 57  |1...\.....h....W|
+00000280  06 f9 d6 80 e5 ac b8 24  1f ef 6e b9 5c 32 a4 e1  |.......$..n.\2..|
+00000290  44 14 99 75 6e 57 d6 6b  51 5f 16 ee 65 c6 fc 96  |D..unW.kQ_..e...|
+000002a0  4e ea 83 85 3f c9 f6 5b  b8 14 5e 6a 41 2b 0f 91  |N...?..[..^jA+..|
+000002b0  ab 79 f4 3d 0e 63 2a 99  eb 4a e9 07 b8 cd fb d2  |.y.=.c*..J......|
+000002c0  ad 33 e6 48 25 b2 b3 29  a6 fc 14 84 a5 ee 53 44  |.3.H%..)......SD|
+000002d0  d4 b2 93 db 86 a6 b2 b3  ea 22 3d a7 52 db 53 56  |........."=.R.SV|
+000002e0  96 20 24 59 6c b6 10 c2  f4 88 9a ff 69 d3 92 0c  |. $Yl.......i...|
+000002f0  da e7 67 63 af 3f 94 c2  06 9f da 8a 78 f5 6d 4d  |..gc.?......x.mM|
+00000300  3d 7b fe 43 6c 71 82 ce  34 07 4b e2 57 05 f8 5c  |={.Clq..4.K.W..\|
+00000310  dc 17 03 17 03 03 00 99  97 2b be f7 da 39 40 7e  |.........+...9@~|
+00000320  9f bd 0a 93 db c8 0d 89  e9 b8 52 5c f6 83 6d 6c  |..........R\..ml|
+00000330  d9 44 1a 3a fe 39 05 f5  c3 25 5e 5e 92 4d 84 d9  |.D.:.9...%^^.M..|
+00000340  0e bc f2 27 09 e0 ba 70  f1 0a 9d 6a af b5 e7 90  |...'...p...j....|
+00000350  8c 91 c7 82 9b d4 8b 88  dc 16 ec 33 2c 81 e7 4f  |...........3,..O|
+00000360  ad dd c1 c5 c6 59 36 d4  aa 39 f1 6f de 93 a7 0e  |.....Y6..9.o....|
+00000370  39 e4 f3 cf 01 b3 ed ad  10 01 70 20 60 ac 6a c5  |9.........p `.j.|
+00000380  ec ec f9 fb 7c 40 72 10  c4 99 8f 10 eb b0 08 4e  |....|@r........N|
+00000390  dd 3f 65 a4 34 c0 69 94  2a 7c 2d cb 33 3b d5 b9  |.?e.4.i.*|-.3;..|
+000003a0  03 e0 e9 63 37 54 73 6a  34 ad c9 65 d1 d4 d7 6b  |...c7Tsj4..e...k|
+000003b0  38 17 03 03 00 45 1c f4  15 86 6e b6 2d cd 84 30  |8....E....n.-..0|
+000003c0  55 82 13 52 d9 c9 3f 01  27 ee 01 9c d4 da be ab  |U..R..?.'.......|
+000003d0  be 10 4d 82 55 32 86 a0  7b 74 bc 15 aa 68 3a e4  |..M.U2..{t...h:.|
+000003e0  a1 3a d9 0e b6 c3 60 48  b4 7d e1 77 9d ce f9 41  |.:....`H.}.w...A|
+000003f0  5f f7 d5 db ea 1f 6e b1  11 cd ca                 |_.....n....|
 >>> Flow 3 (client to server)
-00000000  14 03 03 00 01 01 17 03  03 00 45 93 78 a6 3d 50  |..........E.x.=P|
-00000010  bd bf cb d5 f5 2d af d7  1a 04 5a 7c 18 57 5f ce  |.....-....Z|.W_.|
-00000020  bf aa f3 25 1d 19 29 3a  90 06 9b 9a ad bb 03 92  |...%..):........|
-00000030  58 62 1f db 30 3b db 83  bf 21 dc 32 50 7a cc c1  |Xb..0;...!.2Pz..|
-00000040  51 2d 46 a4 41 eb 07 b3  91 54 55 23 bd 1b c9 82  |Q-F.A....TU#....|
+00000000  14 03 03 00 01 01 17 03  03 00 45 e9 b8 73 86 f8  |..........E..s..|
+00000010  0c ba 6d ee 91 c4 70 d6  06 df 59 f8 28 21 92 3d  |..m...p...Y.(!.=|
+00000020  a5 ad 7c d3 08 ad ea f6  9f c8 d6 8a b1 f0 fc d2  |..|.............|
+00000030  52 91 e8 1b b4 0b b9 a0  6e 48 18 d8 fb fe 3e d1  |R.......nH....>.|
+00000040  d9 81 d5 9f 6a bd 83 74  c5 2d fb 42 95 57 5b 23  |....j..t.-.B.W[#|
 >>> Flow 4 (server to client)
-00000000  17 03 03 00 1e 94 17 fa  b4 46 cf 05 18 36 1e 2c  |.........F...6.,|
-00000010  fa b8 76 fd 66 4f d0 6c  df 7d 35 ea cc 5f 8c fb  |..v.fO.l.}5.._..|
-00000020  6f 31 cc 17 03 03 00 13  7e 91 d1 39 ce 2c 4d e4  |o1......~..9.,M.|
-00000030  49 90 a1 a6 c1 12 bf 0b  12 80 40                 |I.........@|
+00000000  17 03 03 00 1e 64 cd 12  df 96 8c 5d a7 8f 92 98  |.....d.....]....|
+00000010  c9 f7 16 11 4e 37 48 dd  55 b2 c6 4c 91 82 8d a8  |....N7H.U..L....|
+00000020  01 8b a3 17 03 03 00 13  68 92 77 f7 88 86 d9 3c  |........h.w....<|
+00000030  4a 52 35 b2 2c b7 24 03  3c db 6c                 |JR5.,.$.<.l|
diff --git a/src/crypto/tls/testdata/Server-TLSv13-X25519 b/src/crypto/tls/testdata/Server-TLSv13-X25519
index e2ede18235..57a13f3560 100644
--- a/src/crypto/tls/testdata/Server-TLSv13-X25519
+++ b/src/crypto/tls/testdata/Server-TLSv13-X25519
@@ -1,91 +1,91 @@
 >>> Flow 1 (client to server)
-00000000  16 03 01 00 d8 01 00 00  d4 03 03 7b 32 49 3a 30  |...........{2I:0|
-00000010  09 44 1d e3 d6 4e c0 2e  ec e1 ce fc d9 70 6d 47  |.D...N.......pmG|
-00000020  32 61 92 e3 4b 0e 02 96  0a b4 b6 20 18 b5 42 4e  |2a..K...... ..BN|
-00000030  a4 06 40 82 76 bc 30 6b  5c ef 16 94 e4 bb fa 0b  |..@.v.0k\.......|
-00000040  49 d4 b1 c5 df 0d 01 92  be 99 6f f2 00 08 13 02  |I.........o.....|
+00000000  16 03 01 00 d8 01 00 00  d4 03 03 3a 50 25 cb 97  |...........:P%..|
+00000010  ed a7 58 c6 58 64 62 03  f6 ae 8c 70 72 98 55 c0  |..X.Xdb....pr.U.|
+00000020  65 8c f5 64 bc 41 29 7f  df ce 7b 20 99 ce de a1  |e..d.A)...{ ....|
+00000030  6c 2c 3a e0 cd b4 7b 97  ca 00 e0 ee 12 43 a4 0d  |l,:...{......C..|
+00000040  d0 c7 0d 17 21 d4 03 d2  56 56 f7 32 00 08 13 02  |....!...VV.2....|
 00000050  13 03 13 01 00 ff 01 00  00 83 00 00 00 0e 00 0c  |................|
 00000060  00 00 09 31 32 37 2e 30  2e 30 2e 31 00 0b 00 04  |...127.0.0.1....|
 00000070  03 00 01 02 00 0a 00 04  00 02 00 1d 00 16 00 00  |................|
 00000080  00 17 00 00 00 0d 00 1e  00 1c 04 03 05 03 06 03  |................|
 00000090  08 07 08 08 08 09 08 0a  08 0b 08 04 08 05 08 06  |................|
 000000a0  04 01 05 01 06 01 00 2b  00 03 02 03 04 00 2d 00  |.......+......-.|
-000000b0  02 01 01 00 33 00 26 00  24 00 1d 00 20 32 8d 5d  |....3.&.$... 2.]|
-000000c0  3b f5 8f b3 7b 41 92 90  e9 3f 4f aa 61 a8 91 f6  |;...{A...?O.a...|
-000000d0  85 c1 70 d6 1a 94 8d 16  1d 4e c8 ea 54           |..p......N..T|
+000000b0  02 01 01 00 33 00 26 00  24 00 1d 00 20 30 ac 6d  |....3.&.$... 0.m|
+000000c0  11 29 bd 1b 06 04 94 10  9a e4 25 1a fa f5 47 ff  |.)........%...G.|
+000000d0  fc 66 4d 8c d7 79 ed f7  52 c9 d1 3c 3e           |.fM..y..R..<>|
 >>> Flow 2 (server to client)
 00000000  16 03 03 00 7a 02 00 00  76 03 03 00 00 00 00 00  |....z...v.......|
 00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
-00000020  00 00 00 00 00 00 00 00  00 00 00 20 18 b5 42 4e  |........... ..BN|
-00000030  a4 06 40 82 76 bc 30 6b  5c ef 16 94 e4 bb fa 0b  |..@.v.0k\.......|
-00000040  49 d4 b1 c5 df 0d 01 92  be 99 6f f2 13 02 00 00  |I.........o.....|
+00000020  00 00 00 00 00 00 00 00  00 00 00 20 99 ce de a1  |........... ....|
+00000030  6c 2c 3a e0 cd b4 7b 97  ca 00 e0 ee 12 43 a4 0d  |l,:...{......C..|
+00000040  d0 c7 0d 17 21 d4 03 d2  56 56 f7 32 13 02 00 00  |....!...VV.2....|
 00000050  2e 00 2b 00 02 03 04 00  33 00 24 00 1d 00 20 2f  |..+.....3.$... /|
 00000060  e5 7d a3 47 cd 62 43 15  28 da ac 5f bb 29 07 30  |.}.G.bC.(.._.).0|
-00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 17  |.........._X.;t.|
-00000080  03 03 00 17 7c ee 15 67  75 36 92 d7 4a d6 56 f5  |....|..gu6..J.V.|
-00000090  6d ef 3d e1 2e 94 de 7d  72 dc 2f 17 03 03 02 6d  |m.=....}r./....m|
-000000a0  a4 38 eb 50 27 ef fa 47  59 74 d0 ad 55 e2 19 15  |.8.P'..GYt..U...|
-000000b0  a8 9e 12 dc c5 70 7c fd  b7 1c cd 56 b7 44 cc 9c  |.....p|....V.D..|
-000000c0  4c b7 6c 99 0a 20 8d db  fc 5b 4d 97 27 b3 64 61  |L.l.. ...[M.'.da|
-000000d0  fd e6 99 9b d7 1f 2c 86  a3 b7 23 16 8c f0 f0 a4  |......,...#.....|
-000000e0  70 e1 0e 70 61 db 2d c2  60 10 30 21 eb 3c f4 d4  |p..pa.-.`.0!.<..|
-000000f0  07 27 f2 54 bd e7 b8 7a  13 10 47 10 41 46 3d 6f  |.'.T...z..G.AF=o|
-00000100  20 3b 16 07 d6 0d 16 d0  06 34 a4 b9 eb 6a 3d 1b  | ;.......4...j=.|
-00000110  69 fd 7b f2 2d a8 8d 56  51 cf 0e 58 c3 19 ce 88  |i.{.-..VQ..X....|
-00000120  9f 6c c6 38 11 24 81 2f  da c1 f2 57 32 2f 5c 1e  |.l.8.$./...W2/\.|
-00000130  e1 04 56 58 fd 5c ca b8  c6 f1 bd 66 84 a9 2d 48  |..VX.\.....f..-H|
-00000140  4f 4c 08 b3 92 ba 5d 89  95 ce 3d b2 de 76 00 01  |OL....]...=..v..|
-00000150  95 56 56 2c 39 1a 65 68  f5 28 4e d2 e9 cc 85 2e  |.VV,9.eh.(N.....|
-00000160  f0 d9 e6 40 f3 f2 88 10  24 5b 92 5e 18 2d 4c e5  |...@....$[.^.-L.|
-00000170  36 dd c6 09 d1 ca ae 44  84 7a 9b dd f3 c9 ac 44  |6......D.z.....D|
-00000180  7d 77 e9 41 8b b2 26 93  16 e9 d4 06 8b f5 ab c5  |}w.A..&.........|
-00000190  8d ad f4 61 5f 1c ab f0  ff 86 20 f0 4d 90 f5 cb  |...a_..... .M...|
-000001a0  0f d8 fe 3f 2e 78 5e 11  bf 82 0d 55 a2 9a 7b 4b  |...?.x^....U..{K|
-000001b0  5d a0 b7 6c b1 d3 98 67  81 c2 ef fa 22 2f a4 68  |]..l...g...."/.h|
-000001c0  b4 bd 38 08 68 b8 08 2e  95 70 64 e1 c0 4a 29 2b  |..8.h....pd..J)+|
-000001d0  d0 5d 0c 2a f0 df 87 e9  7c bd f5 bc a5 e2 56 56  |.].*....|.....VV|
-000001e0  e6 79 0e f9 ce 42 9a 7c  d9 e4 3a b2 c9 c7 54 f7  |.y...B.|..:...T.|
-000001f0  a2 f8 af b0 8d 56 2b 9d  3a de da 22 7a f6 56 b9  |.....V+.:.."z.V.|
-00000200  6f cf 61 b1 9f 49 91 1e  aa da 27 cb bd 81 f9 a0  |o.a..I....'.....|
-00000210  01 8c e0 ad d6 3f ef 8a  2e 8c 4b da 77 83 b7 7a  |.....?....K.w..z|
-00000220  69 83 62 2e 48 00 d2 dc  96 46 ef e1 c5 1a 49 eb  |i.b.H....F....I.|
-00000230  3c 6d b9 a6 c1 45 21 a6  7a cb 46 23 57 b1 21 d9  |<m...E!.z.F#W.!.|
-00000240  46 23 a8 c7 d3 29 ae 0a  48 31 6d bd 7a d4 51 0b  |F#...)..H1m.z.Q.|
-00000250  e3 70 d7 43 ff 0d 7e 8b  61 15 db 51 ea 2a 58 77  |.p.C..~.a..Q.*Xw|
-00000260  ba 4c 3b 58 d0 f4 bb d6  15 27 7c 7a a8 c2 bd 83  |.L;X.....'|z....|
-00000270  1a 66 7e cf 5a 8d 2b 71  ca b4 6e 1b 3a 15 cf 2b  |.f~.Z.+q..n.:..+|
-00000280  74 8d 1a 79 77 99 d6 ca  49 10 e0 4d c7 7a 8b f7  |t..yw...I..M.z..|
-00000290  4f 01 e7 d2 96 bf 18 0f  df 79 3a 55 e4 96 e8 02  |O........y:U....|
-000002a0  9e 91 c5 d8 7f 28 d3 13  0a f8 b8 47 e8 a8 2f 57  |.....(.....G../W|
-000002b0  d4 75 41 f3 e7 98 ea 3c  cf 4d 4f d8 50 77 6a 89  |.uA....<.MO.Pwj.|
-000002c0  00 6b b1 d5 53 78 5e 9c  71 2c 2b be e7 ec 33 97  |.k..Sx^.q,+...3.|
-000002d0  f7 6a 3f aa ba 92 16 47  fd 17 a7 3c 81 79 93 b4  |.j?....G...<.y..|
-000002e0  37 1e 94 6b 96 e8 6e 7e  6e 97 38 31 99 89 b9 3c  |7..k..n~n.81...<|
-000002f0  8c de 06 66 42 c4 32 d1  41 aa 9b d8 d2 6f 8f c5  |...fB.2.A....o..|
-00000300  b2 29 a9 b5 9e c5 f0 99  05 db d3 82 6e 17 03 03  |.)..........n...|
-00000310  00 99 16 e1 53 2f 6a c0  ed 1c c8 d7 ab 0e 11 ce  |....S/j.........|
-00000320  cd a5 7d 77 15 80 51 d3  cf 1e 56 ae c7 47 9b 69  |..}w..Q...V..G.i|
-00000330  96 46 99 62 f5 d9 4c b7  de f1 b8 8b ee 38 c0 3e  |.F.b..L......8.>|
-00000340  e7 dd b0 e3 9f ee 2d e7  f4 fa 11 56 01 27 86 04  |......-....V.'..|
-00000350  4d 76 58 61 e5 1e b3 61  07 1e 50 2f 38 2e 2e 86  |MvXa...a..P/8...|
-00000360  b9 c5 77 c5 c5 bf 54 4d  b8 50 9f 03 fb 5f 8d 60  |..w...TM.P..._.`|
-00000370  49 ed 98 90 34 d5 66 e1  0a 17 9c 55 3f 7a 7e 31  |I...4.f....U?z~1|
-00000380  dd b5 d9 12 9d 8c 00 6e  37 d4 3e 45 ad da 6d 30  |.......n7.>E..m0|
-00000390  47 2c 70 95 10 a4 d2 1e  20 37 04 6a 58 96 34 0d  |G,p..... 7.jX.4.|
-000003a0  2c 93 09 de 7b 1b a0 5c  25 19 c5 17 03 03 00 45  |,...{..\%......E|
-000003b0  ba 0f cd 55 4f 62 24 0a  f9 7d 58 93 69 4f 5f c4  |...UOb$..}X.iO_.|
-000003c0  d2 bd 95 3e 10 15 57 1d  c1 16 e3 4d 46 8b fd d1  |...>..W....MF...|
-000003d0  16 d1 4a 83 4b d5 ed d2  00 90 90 c3 8f 91 43 81  |..J.K.........C.|
-000003e0  a1 90 16 3b c9 54 6c 3c  0f 71 c7 5f 2c b0 3f c3  |...;.Tl<.q._,.?.|
-000003f0  9b 69 ce 6c 60                                    |.i.l`|
+00000070  ff f6 84 af c4 cf c2 ed  90 99 5f 58 cb 3b 74 14  |.........._X.;t.|
+00000080  03 03 00 01 01 17 03 03  00 17 17 ae 18 e7 86 a2  |................|
+00000090  cb 27 29 d1 e5 e7 3a 73  d8 fd 98 ec 43 74 47 a2  |.')...:s....CtG.|
+000000a0  a6 17 03 03 02 6d d2 f0  a6 3e 2e 8d 47 3e b4 03  |.....m...>..G>..|
+000000b0  cd c7 96 a2 f0 1f 99 f0  58 b0 4d 81 4c e7 93 ae  |........X.M.L...|
+000000c0  a5 e9 0a 07 7f e3 6f 82  c5 2f 4f cb 78 1b a3 44  |......o../O.x..D|
+000000d0  72 63 75 bc a8 6e cd 21  a9 5b b1 4d 1d cb f4 3c  |rcu..n.!.[.M...<|
+000000e0  2f 69 f1 92 76 9b 60 b2  27 ff e9 88 3d 06 d1 ac  |/i..v.`.'...=...|
+000000f0  66 e8 80 a0 92 3d 1c aa  bd 81 5d 5b 64 7a b1 9a  |f....=....][dz..|
+00000100  04 7b 63 38 fa f6 df 56  bf 84 86 8b 05 c9 e5 da  |.{c8...V........|
+00000110  b0 83 7c 47 e2 39 50 df  e2 1b 4f 47 24 31 8d 7d  |..|G.9P...OG$1.}|
+00000120  80 9f 6d 3b 7e e9 d1 65  96 f5 fc 12 2c e9 d8 08  |..m;~..e....,...|
+00000130  f1 0b 4c dd ee c6 77 a1  83 f9 70 b0 48 72 d7 d0  |..L...w...p.Hr..|
+00000140  48 0a 58 6c f9 e6 04 37  31 bd ba c5 6a 31 66 6b  |H.Xl...71...j1fk|
+00000150  cc f5 70 db a3 0e 53 a8  7c ce c2 24 c0 21 c3 6e  |..p...S.|..$.!.n|
+00000160  bb dd 62 3d fc e6 71 0e  28 b5 76 1b 1c 06 bd c7  |..b=..q.(.v.....|
+00000170  4e 72 dd 54 9d 93 a3 8f  0d cb ec e4 f1 0f c1 b9  |Nr.T............|
+00000180  ce d4 50 44 61 46 de 1a  6a f4 19 61 bd 56 f2 06  |..PDaF..j..a.V..|
+00000190  bb 9f 9e d2 9a b2 7d bd  56 5f cc 6c aa f3 60 15  |......}.V_.l..`.|
+000001a0  93 41 05 97 8b 9d 7a 89  5c 1d 66 10 03 cc 7a da  |.A....z.\.f...z.|
+000001b0  41 5e 32 45 76 21 10 e2  49 a3 df 05 81 a0 4b 9d  |A^2Ev!..I.....K.|
+000001c0  b7 e5 43 93 c0 a4 33 48  11 81 bd 74 86 45 a4 0b  |..C...3H...t.E..|
+000001d0  a0 57 33 ea 02 c2 32 22  62 1f a7 85 06 27 bd 2a  |.W3...2"b....'.*|
+000001e0  4e a6 52 a9 81 76 d3 65  28 58 f9 d3 20 7a 6d a3  |N.R..v.e(X.. zm.|
+000001f0  a7 cd b1 5d e6 89 70 88  09 4e 54 bd d9 f1 91 5f  |...]..p..NT...._|
+00000200  e6 91 32 3e ef 09 40 f9  be 10 bd 46 40 9c 0d 8f  |..2>..@....F@...|
+00000210  e3 39 0c b6 dc ce dc 29  77 3c 14 dd 53 92 9d 24  |.9.....)w<..S..$|
+00000220  62 bb 5b 6e bf 08 ac 66  be bf 06 4d da 79 8a 3f  |b.[n...f...M.y.?|
+00000230  d6 07 15 2c 0b ed 9b 62  a3 30 2a 7e 73 c7 bc 16  |...,...b.0*~s...|
+00000240  35 24 56 67 86 68 72 1a  31 d2 4b 9d 33 51 82 30  |5$Vg.hr.1.K.3Q.0|
+00000250  09 8f 3f 71 dc 8f 96 ad  e2 9c 0e 9d a1 1b 52 1c  |..?q..........R.|
+00000260  03 b7 e2 8e 9e fc 7f e0  5c 13 3e 9c 5b e0 28 0c  |........\.>.[.(.|
+00000270  b1 e9 1f 5b 93 13 07 6d  19 11 43 94 df 27 3e 31  |...[...m..C..'>1|
+00000280  e9 ca 57 5a da 3f 69 c5  ef 5a 4b 54 88 b6 78 d3  |..WZ.?i..ZKT..x.|
+00000290  c0 17 d4 e8 73 6d d2 ac  4f 82 3c d5 39 dd 33 0d  |....sm..O.<.9.3.|
+000002a0  d0 65 a4 f4 b4 97 a3 76  cc ae a1 50 72 ae 8a 62  |.e.....v...Pr..b|
+000002b0  ba a3 5c ed df a9 d1 16  0e 57 0e c7 7f e2 07 d0  |..\......W......|
+000002c0  d1 c4 f3 f6 7b 53 2d 21  c5 92 76 24 22 77 01 ad  |....{S-!..v$"w..|
+000002d0  de 4b 44 3e 75 80 c3 b5  e0 ab e3 f4 ad d1 23 fd  |.KD>u.........#.|
+000002e0  e9 ef bf 91 ca b1 fd bd  3d d0 f6 2b 01 10 f2 be  |........=..+....|
+000002f0  e5 4f 6d cd 42 7d ec 0c  62 0b ec 3e b2 80 02 bb  |.Om.B}..b..>....|
+00000300  b2 29 49 58 3e d3 72 bb  17 1d d7 c5 3b 69 90 3b  |.)IX>.r.....;i.;|
+00000310  af 3a 4e 17 03 03 00 99  a4 24 43 f4 e8 d4 49 d9  |.:N......$C...I.|
+00000320  4f cf 34 47 cb f4 20 4d  d5 ec 13 cf f5 37 5a 5d  |O.4G.. M.....7Z]|
+00000330  0f 3f b6 47 aa 6c f7 70  85 cb ee 23 d2 a9 c3 26  |.?.G.l.p...#...&|
+00000340  bf 19 46 74 13 c6 0e 83  52 a6 41 9b e1 b9 91 3a  |..Ft....R.A....:|
+00000350  6f d2 ee bd 0b 9a ef 94  45 23 22 b6 19 55 04 a6  |o.......E#"..U..|
+00000360  c2 d7 e1 0b e4 ee 05 fc  83 c5 60 55 b6 4a 36 5f  |..........`U.J6_|
+00000370  04 5e fc cf c2 56 0c 61  39 c8 1d a7 e4 a0 08 4a  |.^...V.a9......J|
+00000380  75 29 d0 81 a4 8f f7 35  c7 b8 8c 0e d8 76 0a 6e  |u).....5.....v.n|
+00000390  5c ca 72 58 9a 61 3e 24  a7 2e 1c d5 6a f5 4b 6b  |\.rX.a>$....j.Kk|
+000003a0  15 86 09 fa 55 78 c3 96  ae 09 63 25 64 3c 7e 1b  |....Ux....c%d<~.|
+000003b0  aa 17 03 03 00 45 6f cf  21 85 b9 01 82 44 b1 f5  |.....Eo.!....D..|
+000003c0  26 f7 1f 20 59 db ca 41  50 6c da cf cd 8b 8e 7e  |&.. Y..APl.....~|
+000003d0  6d a6 a6 8d 56 d9 cb 00  25 71 69 75 af 26 02 cc  |m...V...%qiu.&..|
+000003e0  b5 de e3 06 bc d4 f5 10  93 f1 46 17 88 41 52 4f  |..........F..ARO|
+000003f0  8a 0f c4 08 e0 af 8e f1  5d 24 d1                 |........]$.|
 >>> Flow 3 (client to server)
-00000000  14 03 03 00 01 01 17 03  03 00 45 bf 5b 81 15 24  |..........E.[..$|
-00000010  3b be 70 41 4d ea 7c 04  a7 31 84 d3 38 b0 e4 cb  |;.pAM.|..1..8...|
-00000020  42 05 b7 a8 07 1a d5 4f  f3 e7 50 56 e8 73 63 1a  |B......O..PV.sc.|
-00000030  d8 a0 76 5e 10 c8 73 07  fa 88 86 65 69 40 81 37  |..v^..s....ei@.7|
-00000040  a2 00 89 b6 ff f1 49 1d  69 e5 63 2e bc 5a eb e6  |......I.i.c..Z..|
+00000000  14 03 03 00 01 01 17 03  03 00 45 58 42 c4 20 5f  |..........EXB. _|
+00000010  a3 5f 66 35 f3 c4 a1 fd  91 b4 f8 ef 21 c1 63 5b  |._f5........!.c[|
+00000020  d9 d9 3d f4 e5 e2 5b 85  66 63 be 1b 16 30 fd 4b  |..=...[.fc...0.K|
+00000030  92 86 75 d6 54 f0 44 93  ef f7 04 3d 84 35 5c 13  |..u.T.D....=.5\.|
+00000040  fd 31 1e 6f 5b 76 74 f6  43 89 2e b2 1c eb ad 88  |.1.o[vt.C.......|
 >>> Flow 4 (server to client)
-00000000  17 03 03 00 1e ca eb a0  6a b4 a5 eb ca 28 14 25  |........j....(.%|
-00000010  07 18 47 3d f0 f6 22 2e  7f 9c 09 73 8c a7 f8 63  |..G=.."....s...c|
-00000020  e7 41 fd 17 03 03 00 13  ba f6 ed 7e 36 b5 f2 c6  |.A.........~6...|
-00000030  15 27 34 2d 8d bd ea 99  29 81 ee                 |.'4-....)..|
+00000000  17 03 03 00 1e d5 f8 ad  21 c7 c8 98 99 57 b0 48  |........!....W.H|
+00000010  af 22 32 d7 dc 75 de 5c  eb cf bd 91 89 b5 23 31  |."2..u.\......#1|
+00000020  e4 b5 69 17 03 03 00 13  42 a1 ec 2a 8b 8a 05 e4  |..i.....B..*....|
+00000030  33 62 eb 3e 18 e8 25 3c  6c 88 ea                 |3b.>..%<l..|
