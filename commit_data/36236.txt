commit 261609f661fcade93f24b9a849638ce8410070cb
Author: Bryan C. Mills <bcmills@google.com>
Date:   Mon Aug 6 16:59:31 2018 -0400

    cmd/go/internal: factor out modload.QueryPackage and use in in modget
    
    modload.Import contains a loop that looks for the module containing a package.
    Because we overload Import to locate both packages and modules, that loop
    contains a bunch of special-cases for modules with empty roots.
    
    In this change, we factor out the loop into a new function (QueryPackage) and
    use that directly in modget.getQuery. That restores the invariant that
    the paths passed to modload.Import must be importable packages, and fixes 'go
    get' lookups for packages that have moved between a module and submodules with
    the same path prefix.
    
    Updates #26602.
    
    Change-Id: I8bc8340c17f2df062d03ce720f4dc18b2ba406b2
    Reviewed-on: https://go-review.googlesource.com/128136
    Reviewed-by: Russ Cox <rsc@golang.org>

 src/cmd/go/internal/modget/get.go                  | 41 +++------------
 src/cmd/go/internal/modload/import.go              | 59 ++--------------------
 src/cmd/go/internal/modload/query.go               | 54 ++++++++++++++++++++
 .../mod/example.com_join_subpkg_v1.0.0.txt         |  9 ++++
 .../mod/example.com_join_subpkg_v1.1.0.txt         |  9 ++++
 .../go/testdata/mod/example.com_join_v1.0.0.txt    |  7 +++
 .../go/testdata/mod/example.com_join_v1.1.0.txt    |  9 ++++
 .../mod/example.com_split_subpkg_v1.1.0.txt        | 11 ++++
 .../go/testdata/mod/example.com_split_v1.0.0.txt   |  9 ++++
 .../go/testdata/mod/example.com_split_v1.1.0.txt   |  9 ++++
 src/cmd/go/testdata/script/mod_bad_domain.txt      |  4 +-
 src/cmd/go/testdata/script/mod_get_indirect.txt    |  2 +-
 src/cmd/go/testdata/script/mod_get_local.txt       | 10 ++--
 src/cmd/go/testdata/script/mod_get_moved.txt       | 37 ++++++++++++++
 14 files changed, 172 insertions(+), 98 deletions(-)
