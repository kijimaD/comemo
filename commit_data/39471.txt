commit 820ad17303e42665fbe9d38d79f07ed218e86302
Author: Ian Lance Taylor <iant@golang.org>
Date:   Wed Feb 20 15:15:18 2019 -0800

    cmd/go: remove work directory on usage error
    
    Ensure that cmd/go consistently calls base.Exit rather than os.Exit,
    so that we don't incorrectly leave the work directory around on exit.
    
    Test this by modifying the testsuite to run all the tests with TMPDIR
    set to a temporary directory, and then check that no files are left
    behind in that temporary directory. Adjust a couple of tests to make
    this approach work.
    
    Updates #30500
    Updates https://gcc.gnu.org/PR89406
    
    Change-Id: Ib6a5fc8a288a6cf4713022baa2b8dfefad62ba34
    Reviewed-on: https://go-review.googlesource.com/c/163237
    Run-TryBot: Ian Lance Taylor <iant@golang.org>
    TryBot-Result: Gobot Gobot <gobot@golang.org>
    Reviewed-by: Bryan C. Mills <bcmills@google.com>

 src/cmd/go/go_test.go               | 39 +++++++++++++++++++++++++++++++++++--
 src/cmd/go/internal/base/base.go    |  3 ++-
 src/cmd/go/internal/cmdflag/flag.go |  3 ++-
 src/cmd/go/internal/help/help.go    |  6 ++++--
 src/cmd/go/internal/vet/vetflag.go  | 12 ++++++++----
 src/cmd/go/internal/work/action.go  |  6 ++++--
 src/cmd/go/internal/work/exec.go    |  2 +-
 src/cmd/go/internal/work/gccgo.go   |  3 ++-
 src/cmd/go/internal/work/init.go    | 15 +++++++++-----
 src/cmd/go/script_test.go           |  1 +
 10 files changed, 71 insertions(+), 19 deletions(-)
