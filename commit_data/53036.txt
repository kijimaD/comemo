commit 20760cff001e9acc05627dfeab42ea50b57920e6
Author: Michael Pratt <mpratt@google.com>
Date:   Tue Jun 28 16:32:50 2022 -0400

    runtime: add race annotations to cbs.lock
    
    cbs.lock protects a map. The map implementation is race instrumented
    regardless of which package is it called from.
    
    lock/unlock are not automatically race instrumented, so we can trigger
    race false positives without manually annotating our lock acquire and
    release.
    
    compileCallback is used during initialization before the P is available,
    at which point raceacquire will crash during a racecallback to get the
    race proc. Thus we skip instrumentation until scheduler initialization
    is complete.
    
    Fixes #50249.
    
    Change-Id: Ie49227c9e9210ffbf0aee65f86f2b7b6a2f64638
    Reviewed-on: https://go-review.googlesource.com/c/go/+/414518
    TryBot-Result: Gopher Robot <gobot@golang.org>
    Reviewed-by: Cherry Mui <cherryyz@google.com>
    Run-TryBot: Michael Pratt <mpratt@google.com>

 src/runtime/syscall_windows.go | 28 +++++++++++++++++++++++-----
 1 file changed, 23 insertions(+), 5 deletions(-)
